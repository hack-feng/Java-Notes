# 互联网 Java 工程师面试题

内容涵盖：Java、MyBatis、ZooKeeper、Dubbo、Elasticsearch、Memcached、
Redis、MySQL、Spring、SpringBoot、SpringCloud、RabbitMQ、Kafka、
Linux 等技术栈

#### 目录

互联网Java工程师面试题.......................................................................................... 1
........................................................................................................................................ 1
MyBatis面试题........................................................................................................ 33
1 、什么是Mybatis？............................................................................... 33
2 、Mybaits的优点：............................................................................... 33
3 、MyBatis框架的缺点：....................................................................... 34
4 、MyBatis框架适用场合：................................................................... 34
5 、MyBatis与Hibernate有哪些不同？.............................................. 35


## 9 、通常一个Xml映射文件，都会写一个Dao接口与之对应，请问，














象的属性，并可返回变化后的结果，那么这里到底是值传递还是引用传
递？............................................................................................................ 225
19 、String和StringBuilder、StringBuffer的区别？..................... 226
20 、重载（Overload）和重写（Override）的区别。重载的方法能否
根据返回类型进行区分？........................................................................ 227
21 、描述一下JVM加载class文件的原理机制？.............................. 228
22 、char 型变量中能不能存贮一个中文汉字，为什么？................. 229
23 、抽象类（abstractclass）和接口（interface）有什么异同？. 230
24 、静态嵌套类(StaticNestedClass)和内部类（InnerClass）的不
同？............................................................................................................ 230
25 、Java 中会存在内存泄漏吗，请简单描述。................................. 234
26 、抽象的（abstract）方法是否可同时是静态的（static）,是否可同
时是本地方法（native），是否可同时被synchronized修饰？..... 236
27 、阐述静态变量和实例变量的区别。............................................... 236
28 、是否可以从一个静态（static）方法内部发出对非静态（non-static）
方法的调用？............................................................................................ 237
29 、如何实现对象克隆？....................................................................... 237
30 、GC是什么？为什么要有GC？...................................................... 242
31 、Strings=newString(“xyz”);创建了几个字符串对象？..... 244
32 、 接 口 是 否 可 继 承 （extends） 接 口 ？ 抽 象 类 是 否 可 实 现
（implements）接口？抽象类是否可继承具体类（concreteclass）？
.................................................................................................................... 244

33 、一个”.java”源文件中是否可以包含多个类（不是内部类）？有
什么限制？................................................................................................ 245
34 、AnonymousInnerClass(匿名内部类)是否可以继承其它类？是否
可以实现接口？........................................................................................ 245
35 、内部类可以引用它的包含类（外部类）的成员吗？有没有什么限
制？............................................................................................................ 245
36 、Java 中的final关键字有哪些用法？........................................... 245
37 、指出下面程序的运行结果............................................................... 246
38 、数据类型之间的转换：................................................................... 247


## 40 、怎样将GB231 2 编码的字符串转换为ISO-8859- 1 编码的字符串？





   - 6 、#{}和${}的区别是什么？.....................................................................
   - 7 、当实体类中的属性名和表中的字段名不一样 ，怎么办 ？...........
   - 8 、 模糊查询like语句该怎么写?...........................................................
   - 方法能重载吗？.......................................................................................... 这个Dao接口的工作原理是什么？Dao接口里的方法，参数不同时，
   - 10 、Mybatis是如何进行分页的？分页插件的原理是什么？.............
   - 哪些映射形式？.......................................................................................... 11 、Mybatis是如何将sql执行结果封装为目标对象并返回的？都有
   - 12 、如何执行批量插入?...........................................................................
   - 13 、如何获取自动生成的(主)键值?........................................................
   - 14 、在mapper中如何传递多个参数?..................................................
   - 15 、Mybatis动态sql有什么用？执行原理？有哪些动态sql？.......
   - 外，还有哪些标签？.................................................................................. 16 、Xml映射文件中，除了常见的select|insert|updae|delete标签之
   - 在哪里？...................................................................................................... 18 、为什么说Mybatis是半自动ORM映射工具？它与全自动的区别
   - 19 、 一对一、一对多的关联查询 ？.....................................................
   - 20 、MyBatis实现一对一有几种方式?具体怎么操作的？...................
   - 21 、MyBatis实现一对多有几种方式,怎么操作的？............................
   - 22 、Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？
   - 23 、Mybatis的一级、二级缓存:............................................................
   - 24 、什么是MyBatis的接口绑定？有哪些实现方式？........................
   - 25 、使用MyBatis的mapper接口调用时有哪些要求？...................
   - 26 、Mapper编写有哪几种方式？.........................................................
   - 27 、简述Mybatis的插件运行原理，以及如何编写一个插件。........
- ZooKeeper 面试题...................................................................................................
  - 1.ZooKeeper 面试题？..........................................................................
  - 2.ZooKeeper提供了什么？...................................................................
  - 3.Zookeeper文件系统............................................................................
  - 4.ZAB协议？............................................................................................
  - 5. 四种类型的数据节点 Znode..............................................................
  - 6.ZookeeperWatcher 机制 -- 数据变更通知..................................
  - 7. 客户端注册Watcher实现..................................................................
  - 8. 服务端处理Watcher实现..................................................................
  - 9. 客户端回调Watcher...........................................................................
  - 10.ACL权限控制机制..............................................................................
  - 11.Chroot特性.........................................................................................
  - 12. 会话管理..............................................................................................
  - 13. 服务器角色..........................................................................................
  - 14.Zookeeper 下 Server工作状态.....................................................
  - 15. 数据同步..............................................................................................
  - 16.zookeeper是如何保证事务的顺序一致性的？..............................
  - 17. 分布式集群中为什么会有Master？................................................
  - 18.zk节点宕机如何处理？......................................................................
  - 19.zookeeper负载均衡和nginx负载均衡区别.................................
  - 20.Zookeeper有哪几种几种部署模式？.............................................
  - 21. 集群最少要几台机器，集群规则是怎样的?....................................
  - 22. 集群支持动态添加机器吗？..............................................................
  - 久的?............................................................................................................ 23.Zookeeper对节点的watch监听通知是永久的吗？为什么不是永
  - 24.Zookeeper的java客户端都有哪些？............................................
  - 25.chubby是什么，和zookeeper比你怎么看？..............................
  - 26. 说几个zookeeper常用的命令。....................................................
  - 27.ZAB和Paxos算法的联系与区别？.................................................
  - 28.Zookeeper的典型应用场景.............................................................
- Dubbo面试题..........................................................................................................
  - 1 、为什么要用Dubbo？.........................................................................
  - 2 、Dubbo的整体架构设计有哪些分层?..............................................
  - 3 、默认使用的是什么通信框架，还有别的选择吗?.............................
  - 4 、服务调用是阻塞的吗？.......................................................................
  - 5 、一般使用什么注册中心？还有别的选择吗？...................................
  - 6 、默认使用什么序列化框架，你知道的还有哪些？...........................
  - 7 、服务提供者能实现失效踢出是什么原理？.......................................
  - 8 、服务上线怎么不影响旧版本？...........................................................
  - 9 、如何解决服务调用链过长的问题？...................................................
  - 10 、说说核心的配置有哪些？.................................................................
  - 11 、Dubbo推荐用什么协议？..............................................................
  - 12 、同一个服务多个注册的情况下可以直连某一个服务吗？.............
  - 13 、画一画服务注册与发现的流程图？.................................................
  - 14 、Dubbo集群容错有几种方案？......................................................
  - 15 、Dubbo服务降级，失败重试怎么做？..........................................
  - 16 、Dubbo使用过程中都遇到了些什么问题？..................................
  - 17 、DubboMonitor 实现原理？.........................................................
  - 18 、Dubbo用到哪些设计模式？..........................................................
  - 19 、Dubbo配置文件是如何加载到Spring中的？...........................
  - 20 、DubboSPI 和 JavaSPI 区别？...................................................
  - 21 、Dubbo支持分布式事务吗？..........................................................
  - 22 、Dubbo可以对结果进行缓存吗？..................................................
  - 23 、服务上线怎么兼容旧版本？.............................................................
  - 24 、Dubbo必须依赖的包有哪些？.......................................................
  - 25 、Dubbotelnet 命令能做什么？......................................................
  - 26 、Dubbo支持服务降级吗？..............................................................
  - 27 、Dubbo如何优雅停机？..................................................................
  - 28 、Dubbo和 Dubbox 之间的区别？...............................................
  - 29 、Dubbo和 SpringCloud的区别？.............................................
  - 30 、你还了解别的分布式框架吗？.........................................................
- Elasticsearch 面试题...............................................................................................
  - 大小，分片有多少，以及一些调优手段 。............................................ 1 、elasticsearch了解多少，说说你们公司es的集群架构，索引数据
  - 2 、elasticsearch的倒排索引是什么......................................................
  - 3 、elasticsearch 索引数据多了怎么办，如何调优，部署.................
  - 4 、elasticsearch是如何实现master选举的.......................................
  - 5 、详细描述一下Elasticsearch索引文档的过程.................................
  - 6 、详细描述一下Elasticsearch搜索的过程？.....................................
  - 7 、Elasticsearch在部署时，对Linux的设置有哪些优化方法..........
  - 8 、lucence内部结构是什么？................................................................
  - 9 、Elasticsearch是如何实现Master选举的？...................................
  - master，另外 10 个选了另一个master，怎么办？............................ 10 、Elasticsearch中的节点（比如共 20 个），其中的 10 个选了一个
  - 11 、客户端在和集群连接时，如何选择特定的节点执行请求的？.....
  - 12 、详细描述一下Elasticsearch索引文档的过程。...........................
  - 13 、详细描述一下Elasticsearch更新和删除文档的过程。...............
  - 14 、详细描述一下Elasticsearch搜索的过程。...................................
  - 15 、在Elasticsearch中，是怎么根据一个词找到对应的倒排索引的？
  - 16 、Elasticsearch在部署时，对Linux的设置有哪些优化方法？....
  - 17 、对于GC方面，在使用Elasticsearch时要注意什么？...............
  - 18 、Elasticsearch对于大数据量（上亿量级）的聚合如何实现？....
  - 19 、在并发情况下，Elasticsearch如果保证读写一致？....................
  - 20 、如何监控Elasticsearch集群状态？...............................................
  - 21 、介绍下你们电商搜索的整体技术架构。.........................................
  - 22 、介绍一下你们的个性化搜索方案？.................................................
  - 23 、是否了解字典树？.............................................................................
  - 24 、拼写纠错是如何实现的？...............................................................
- Memcached 面试题..............................................................................................
  - 1 、Memcached是什么，有什么作用？.............................................
  - 2 、Memcached服务分布式集群如何实现？.....................................
  - 3 、Memcached服务特点及工作原理是什么？.................................
  - 4 、简述Memcached内存管理机制原理？........................................
  - 5 、memcached是怎么工作的？.........................................................
  - 6 、memcached最大的优势是什么？.................................................
  - 7 、memcached和MySQL的query.................................................
  - 文件等）相比，有什么优缺点？............................................................
  - 9 、memcached的cache机制是怎样的？........................................
  - 10 、memcached如何实现冗余机制？...............................................
  - 11 、memcached如何处理容错的？...................................................
  - 12 、如何将memcached中item批量导入导出？...........................
  - 13 、如果缓存数据在导出导入之间过期了，您又怎么处理这些数据呢？
  - 14 、memcached是如何做身份验证的？...........................................
  - 15 、memcached的多线程是什么？如何使用它们？.......................
  - 16 、memcached能接受的key的最大长度是多少？......................
  - 17 、memcached最大能存储多大的单个item？.............................
  - 18 、memcached能够更有效地使用内存吗？...................................
  - 19 、什么是二进制协议，我该关注吗？...............................................
  - malloc/free！？为何要使用slabs？................................................... 20 、memcached的 内 存 分 配 器 是 如 何 工 作 的 ？ 为 什 么 不 适用
  - 21 、memcached是原子的吗？...........................................................
  - 22 、如何实现集群中的session共享存储？.......................................
  - 23 、memcached与redis的区别？...................................................
- Redis 面试题...........................................................................................................
  - 1 、什么是Redis?....................................................................................
  - 2 、Redis的数据类型？..........................................................................
  - 3 、使用Redis有哪些好处？.................................................................
  - 4 、Redis相比Memcached有哪些优势？........................................
  - 5 、Memcache与Redis的区别都有哪些？.......................................
  - 6 、Redis是单进程单线程的？..............................................................
  - 7 、一个字符串类型的值能存储最大容量是多少？.............................
  - 8 、Redis的持久化机制是什么？各自的优缺点？..............................
  - 9 、Redis常见性能问题和解决方案：..................................................
  - 10 、redis过期键的删除策略？.............................................................
  - 11 、Redis的回收策略（淘汰策略）?..................................................
  - 12 、为什么edis需要把所有数据放到内存中？.................................
- 13 、Redis的同步机制了解么？...........................................................
- 14 、Pipeline有什么好处，为什么要用pipeline？..........................
- 15 、是否使用过Redis集群，集群的原理是什么？..........................
- 16 、Redis集群方案什么情况下会导致整个集群不可用？...............
- 17 、Redis支持的Java客户端都有哪些？官方推荐用哪个？.........
- 18 、Jedis与Redisson对比有什么优缺点？.....................................
- 19 、Redis如何设置密码及验证密码？...............................................
- 20 、说说Redis哈希槽的概念？..........................................................
- 21 、Redis集群的主从复制模型是怎样的？.......................................
- 22 、Redis集群会有写操作丢失吗？为什么？...................................
- 23 、Redis集群之间是如何复制的？...................................................
- 24 、Redis集群最大节点个数是多少？...............................................
- 25 、Redis集群如何选择数据库？.......................................................
- 26 、怎么测试Redis的连通性？..........................................................
- 27 、怎么理解Redis事务？..................................................................
- 28 、Redis事务相关的命令有哪几个？...............................................
- 29 、Rediskey的过期时间和永久有效分别怎么设置？....................
- 30 、Redis如何做内存优化？...............................................................
- 31 、Redis回收进程如何工作的？.......................................................
- 32 、都有哪些办法可以降低Redis的内存使用情况呢？..................
- 33 、Redis的内存用完了会发生什么？...............................................
- 他们最多能存放多少元素？.................................................................... 34 、一个Redis实例最多能存放多少的keys？List、Set、SortedSet
- redis中的数据都是热点数据？............................................................. 35 、MySQL里有2000w数据，redis中只存20w的数据，如何保证
- 36 、Redis最适合的场景？...................................................................
- 的已知的前缀开头的，如果将它们全部找出来？................................ 37 、假如Redis里面有 1 亿个key，其中有10w个key是以某个固定
- 38 、如果有大量的key需要设置同一时间过期，一般需要注意什么？
- 39 、使用过Redis做异步队列么，你是怎么用的？..........................
- 40 、使用过Redis分布式锁么，它是什么回事？..............................
- MySQL 面试题........................................................................................................
  - 1 、MySQL中有哪几种锁？...................................................................
  - 2 、MySQL中有哪些不同的表格？.......................................................
  - 3 、简述在MySQL数据库中MyISAM和InnoDB的区别...............
  - 的区别？.................................................................................................... 4 、MySQL中InnoDB支持的四种事务隔离级别名称，以及逐级之间
  - 5 、CHAR和VARCHAR的区别？........................................................
  - 6 、主键和候选键有什么区别？.............................................................
  - 7 、myisamchk是用来做什么的？.......................................................
  - 8 、如果一个表有一列定义为TIMESTAMP，将发生什么？.............
  - 9 、你怎么看到为表格定义的所有索引？.............................................
  - 10 、LIKE声明中的％和_是什么意思？................................................
  - 11 、列对比运算符是什么？...................................................................
  - 12 、BLOB和TEXT有什么区别？........................................................
  - 13 、MySQL_fetch_array和MySQL_fetch_object的区别是什么？
  - 14 、MyISAM表格将在哪里存储，并且还提供其存储格式？..........
  - 15 、MySQL如何优化DISTINCT？.....................................................
  - 16 、如何显示前 50 行？........................................................................
  - 17 、可以使用多少列创建索引？...........................................................
  - 18 、NOW（）和CURRENT_DATE（）有什么区别？....................
  - 19 、什么是非标准字符串类型？...........................................................
  - 20 、什么是通用SQL函数？.................................................................
  - 21 、MySQL支持事务吗？....................................................................
  - 22 、MySQL里记录货币用什么字段类型好........................................
  - 23 、MySQL有关权限的表都有哪几个？............................................
  - 24 、列的字符串类型可以是什么？.......................................................
  - 运维三年,怎么优化？............................................................................... 25 、MySQL数据库作发布系统的存储，一天五万条以上的增量，预计
  - 26 、锁的优化策略...................................................................................
  - 27 、索引的底层实现原理和优化...........................................................
  - 28 、什么情况下设置了索引但无法使用...............................................
  - 29 、实践中如何优化MySQL................................................................
  - 30 、优化数据库的方法...........................................................................
  - 对数据库的性能有什么影响（从读写两方面）.................................... 31 、简单描述MySQL中，索引，主键，唯一索引，联合索引的区别，
  - 32 、数据库中的事务是什么?.................................................................
  - 33 、SQL注入漏洞产生的原因？如何防止？......................................
  - 34 、为表中得字段选择合适得数据类型...............................................
  - 35 、存储时期...........................................................................................
  - 引的几个问题：........................................................................................ 36 、对于关系型数据库而言，索引是相当重要的概念，请回答有关索
  - 37 、解释MySQL外连接、内连接与自连接的区别...........................
  - 38 、Myql中的事务回滚机制概述........................................................
  - 39 、SQL语言包括哪几部分？每部分都有哪些操作关键字？..........
  - 40 、完整性约束包括哪些？...................................................................
  - 41 、什么是锁？.......................................................................................
  - 42 、什么叫视图？游标是什么？...........................................................
  - 43 、什么是存储过程？用什么来调用？...............................................
  - 44 、如何通俗地理解三个范式？...........................................................
  - 45 、什么是基本表？什么是视图？.......................................................
  - 46 、试述视图的优点？...........................................................................
  - 47 、 NULL是什么意思.........................................................................
  - 48 、主键、外键和索引的区别？...........................................................
  - 49 、你可以用什么来确保表格里的字段只接受特定范围里的值?.....
  - 50 、说说对SQL语句优化有哪些方法？（选择几条）.....................
- Java 并发编程（一）.............................................................................................
  - 1 、在java中守护线程和本地线程区别？............................................
  - 2 、线程与进程的区别？.........................................................................
  - 3 、什么是多线程中的上下文切换？.....................................................
  - 4 、死锁与活锁的区别，死锁与饥饿的区别？.....................................
  - 5 、Java中用到的线程调度算法是什么？............................................
  - 6 、什么是线程组，为什么在Java中不推荐使用？...........................
- 7 、为什么使用Executor框架？...........................................................
- 8 、在Java中Executor和Executors的区别？................................
- 9 、如何在Windows和Linux上查找哪个线程使用的CPU时间最长？
- (atomicclasses)？.................................................................................. 10 、 什 么 是 原 子 操 作 ？ 在JavaConcurrencyAPI中 有 哪 些 原 子 类
- 对比同步它有什么优势？........................................................................ 11 、JavaConcurrencyAPI中的Lock接口(Lockinterface)是什么？
- 12 、什么是Executors框架？..............................................................
- 列来实现生产者-消费者模型？.............................................................. 13 、什么是阻塞队列？阻塞队列的实现原理是什么？如何使用阻塞队
- 14 、什么是Callable和Future?..........................................................
- 15 、什么是FutureTask?使用ExecutorService启动任务。...........
- 16 、什么是并发容器的实现？...............................................................
- 17 、多线程同步和互斥有几种实现方法，都是什么？.......................
- 18 、什么是竞争条件？你怎样发现和解决竞争？...............................
- 19 、你将如何使用threaddump？你将如何分析Threaddump？
- 直接调用run()方法？............................................................................. 20 、为什么我们调用start()方法时会执行run()方法，为什么我们不能
- 21 、Java中你怎样唤醒一个阻塞的线程？..........................................
- 22 、在Java中CycliBarriar和CountdownLatch有什么区别？...
- 23 、什么是不可变对象，它对写并发应用有什么帮助？...................
- 24 、什么是多线程中的上下文切换？...................................................
- 25 、Java中用到的线程调度算法是什么？..........................................
- 26 、什么是线程组，为什么在Java中不推荐使用？.........................
- 27 、为什么使用Executor框架比使用应用创建和管理线程好？....
- 28 、java中有几种方法可以实现一个线程？......................................
- 29 、如何停止一个正在运行的线程？...................................................
- 30 、notify()和notifyAll()有什么区别？.............................................
- 31 、什么是Daemon线程？它有什么意义？.....................................
- 32 、java如何实现多线程之间的通讯和协作？..................................
- 33 、什么是可重入锁（ReentrantLock）？.......................................
- 它线程是否可进入此对象的其它方法？................................................ 34 、当一个线程进入某个对象的一个synchronized的实例方法后，其
- 35 、乐观锁和悲观锁的理解及如何实现，有哪些实现方式？...........
- 36 、SynchronizedMap和ConcurrentHashMap有什么区别？..
- 37 、CopyOnWriteArrayList可以用于什么应用场景？...................
- 38 、什么叫线程安全？servlet是线程安全吗?...................................
- 39 、volatile有什么用？能否用一句话说明下volatile的应用场景？
- 40 、为什么代码会重排序？...................................................................
- 41 、在java中wait和sleep方法的不同？.......................................
- 42 、用Java实现阻塞队列.....................................................................
- 43 、一个线程运行时发生异常会怎样？...............................................
- 44 、如何在两个线程间共享数据？.......................................................
- 45 、Java中notify 和 notifyAll有什么区别？.................................
- 46 、为什么wait,notify 和 notifyAll这些方法不在thread类里面？
- 47 、什么是ThreadLocal变量？..........................................................
- 48 、Java中interrupted 和 isInterrupted方法的区别？.............
- 49 、为什么wait和notify方法要在同步块中调用？........................
- 50 、为什么你应该在循环中检查等待条件?.........................................
- 51 、Java中的同步集合与并发集合有什么区别？..............................
- 52 、什么是线程池？ 为什么要使用它？.............................................
- 53 、怎么检测一个线程是否拥有锁？...................................................
- 54 、你如何在Java中获取线程堆栈？.................................................
- 56 、Thread类中的yield方法有什么作用？.....................................
- 57 、Java中ConcurrentHashMap的并发度是什么？....................
- 58 、Java中Semaphore是什么？......................................................
- 59 、Java线程池中submit() 和 execute()方法有什么区别？.......
- 60 、什么是阻塞式方法？.......................................................................
- 61 、Java中的ReadWriteLock是什么？...........................................
- 62 、volatile 变量和 atomic 变量有什么不同？..............................
  - 63 、可以直接调用Thread类的run()方法么？................................
  - 64 、如何让正在运行的线程暂停一段时间？.......................................
  - 65 、你对线程优先级的理解是什么？...................................................
  - Slicing)？................................................................................................ 66 、 什 么 是 线 程 调 度 器(Thread Scheduler)和 时 间 分 片(Time
  - 67 、你如何确保main()方法所在的线程是Java 程序最后结束的线程？
  - 68 、线程之间是如何通信的？...............................................................
  - Object 类里？......................................................................................... 69 、 为 什 么 线 程 通 信 的 方 法wait(),notify()和notifyAll()被 定 义在
  - 中被调用？................................................................................................ 70 、为什么wait(),notify()和notifyAll()必须在同步方法或者同步块
  - 71 、为什么Thread类的sleep()和yield()方法是静态的？............
  - 72 、如何确保线程安全？.......................................................................
  - 73 、同步方法和同步块，哪个是更好的选择？...................................
  - 74 、如何创建守护线程？.......................................................................
  - 75 、什么是JavaTimer 类？如何创建一个有特定时间间隔的任务？
- Java 并发编程（二）.............................................................................................
  - 1 、并发编程三要素？.............................................................................
  - 2 、实现可见性的方法有哪些？.............................................................
  - 3 、多线程的价值？.................................................................................
  - 4 、创建线程的有哪些方式？.................................................................
  - 5 、创建线程的三种方式的对比？.........................................................
  - 6 、线程的状态流转图.............................................................................
  - 7 、Java线程具有五中基本状态............................................................
  - 8 、什么是线程池？有哪几种创建方式？.............................................
  - 9 、四种线程池的创建：.........................................................................
  - 10 、线程池的优点？...............................................................................
  - 11 、常用的并发工具类有哪些？...........................................................
  - 12 、CyclicBarrier和CountDownLatch的区别...............................
  - 13 、synchronized的作用？.................................................................
- 14 、volatile关键字的作用....................................................................
- 15 、什么是CAS......................................................................................
- 16 、CAS的问题......................................................................................
- 17 、什么是Future？.............................................................................
- 18 、什么是AQS.....................................................................................
- 19 、AQS支持两种同步方式：.............................................................
- 20 、ReadWriteLock是什么.................................................................
- 21 、FutureTask是什么.........................................................................
- 22 、synchronized和ReentrantLock的区别...................................
- 23 、什么是乐观锁和悲观锁...................................................................
- 24 、线程B怎么知道线程A修改了变量..............................................
- 25 、synchronized、volatile、CAS比较...........................................
- 26 、sleep方法和wait方法有什么区别?............................................
- 27 、ThreadLocal是什么？有什么用？...............................................
- 28 、为什么wait()方法和notify()/notifyAll()方法要在同步块中被调用
- 29 、多线程同步有哪几种方法？...........................................................
- 30 、线程的调度策略...............................................................................
- 31 、ConcurrentHashMap的并发度是什么......................................
- 32 、Linux环境下如何查找哪个线程使用CPU最长..........................
- 33 、Java死锁以及如何避免？..............................................................
- 34 、死锁的原因.......................................................................................
- 35 、怎么唤醒一个阻塞的线程...............................................................
- 36 、不可变对象对多线程有什么帮助...................................................
- 37 、什么是多线程的上下文切换...........................................................
- 38 、如果你提交任务时，线程池队列已满，这时会发生什么...........
- 39 、Java中用到的线程调度算法是什么..............................................
- Slicing)？.................................................................................................. 40 、 什 么 是 线 程 调 度 器(Thread Scheduler)和 时 间 分 片(Time
- 41 、什么是自旋.......................................................................................
  - 对比同步它有什么优势？........................................................................
  - 43 、单例模式的线程安全性...................................................................
  - 44 、Semaphore有什么作用................................................................
  - 45 、Executors类是什么？...................................................................
  - 46 、线程类的构造方法、静态块是被哪个线程调用的.......................
  - 47 、同步方法和同步块，哪个是更好的选择?.....................................
  - 48 、Java线程数过多会造成什么异常？..............................................
- Java 面试题（一）.................................................................................................
  - 1 、面向对象的特征有哪些方面？.........................................................
  - 2 、访问修饰符public,private,protected,以及不写（默认）时的区别？
  - 3 、String 是最基本的数据类型吗？....................................................
  - 4 、floatf=3.4;是否正确？....................................................................
  - 5 、shorts1=1;s1=s1+1;有错吗?shorts1=1;s1+=1;有错吗？
  - 6 、Java有没有goto？..........................................................................
  - 7 、int和Integer有什么区别？...........................................................
  - 8 、&和&&的区别？...............................................................................
  - 9 、解释内存中的栈(stack)、堆(heap)和方法区(methodarea)的用法。
  - 10 、Math.round(11.5) 等于多少？Math.round(-11.5)等于多少？
  - 作用在String上？.................................................................................. 11 、switch 是否能作用在byte 上，是否能作用在long 上，是否能
  - 12 、用最有效率的方法计算 2 乘以 8 ？...............................................
  - 13 、数组有没有length()方法？String有没有length()方法？......
  - 14 、在Java中，如何跳出当前的多重嵌套循环？.............................
  - 15 、构造器（constructor）是否可被重写（override）？.............
  - code，这句话对不对？.......................................................................... 16 、两个对象值相同(x.equals(y)==true)，但却可有不同的hash
  - 17 、是否可以继承String类？.............................................................
- 39 、如何实现字符串的反转及替换？...................................................
  -
- 41 、日期和时间：...................................................................................
- 42 、打印昨天的当前时刻。...................................................................
- 43 、比较一下Java和JavaSciprt。.....................................................
- 44 、什么时候用断言（assert）？........................................................
- 45 、Error和Exception有什么区别？................................................
- 的代码会不会被执行，什么时候被执行，在return前还是后?........ 46 、try{}里有一个return语句，那么紧跟在这个try后的finally{}里
- finally分别如何使用？........................................................................... 47 、Java语言如何进行异常处理，关键字：throws、throw、try、catch、
- 48 、运行时异常与受检异常有何异同？...............................................
- 49 、列出一些你常见的运行时异常？...................................................
- 50 、阐述final、finally、finalize的区别。........................................
- 51 、类ExampleA继承Exception，类ExampleB继承ExampleA。
- 52 、List、Set、Map是否继承自Collection接口？.......................
- 53 、阐述ArrayList、Vector、LinkedList的存储性能和特性。.....
- 54 、Collection和Collections的区别？............................................
- 55 、List、Map、Set三个接口存取元素时，各有什么特点？.........
- 类中的sort()方法如何比较元素？........................................................ 56 、TreeMap和TreeSet在排序时如何比较元素？Collections工具
- 行，它们有什么区别?.............................................................................. 57 、Thread类的sleep()方法和对象的wait()方法都可以让线程暂停执
- 58 、线程的sleep()方法和yield()方法有什么区别？........................
- 程是否可进入此对象的synchronized方法B？................................. 59 、当一个线程进入一个对象的synchronized方法A之后，其它线
- 60 、请说出与线程同步以及线程调度相关的方法。...........................
- 61 、编写多线程程序有几种实现方式？...............................................
- 62 、synchronized关键字的用法？.....................................................
- 63 、举例说明同步和异步。...................................................................
- 64 、启动一个线程是调用run()还是start()方法？............................
- 65 、什么是线程池（threadpool）？................................................
- 66 、线程的基本状态以及状态之间的关系？.......................................
- 67 、简述synchronized 和java.util.concurrent.locks.Lock的异同？
- 68 、Java中如何实现序列化，有什么意义？......................................
- 69 、Java中有几种类型的流？..............................................................
- 这个文件中出现的次数。........................................................................ 70 、写一个方法，输入一个文件名和一个字符串，统计这个字符串在
- 71 、如何用Java代码列出一个目录下所有的文件？.........................
- 72 、用Java的套接字编程实现一个多线程的回显（echo）服务器。
- 文档有哪几种方式？................................................................................ 73 、XML文档定义有几种形式？它们之间有何本质区别？解析XML
- 74 、你在项目中哪些地方用到了XML？.............................................
- 75 、阐述JDBC操作数据库的步骤。...................................................
- 76 、Statement和PreparedStatement有什么区别？哪个性能更好？
- 更新数据的性能？.................................................................................... 77 、使用JDBC操作数据库时，如何提升读取数据的性能？如何提升
- 78 、在进行数据库编程时，连接池有什么作用？...............................
- 79 、什么是DAO模式？........................................................................
- 80 、事务的ACID是指什么？...............................................................
- 82 、JDBC能否处理Blob和Clob？....................................................
- 83 、简述正则表达式及其用途。...........................................................
- 84 、Java中是如何支持正则表达式操作的？......................................
- 85 、获得一个类的类对象有哪些方式？...............................................
- 88 、如何通过反射调用对象的方法？...................................................
- 90 、简述一下你了解的设计模式。.......................................................
- 91 、用Java写一个单例类。.................................................................
- 92 、什么是UML？.................................................................................
- 93 、UML中有哪些常用的图？.............................................................
  - 95 、用Java写一个折半查找。.............................................................
- Java 面试题（二）.................................................................................................
  - 多线程、并发及线程的基础问题............................................................
  - 1 、Java 中能创建 volatile 数组吗？.................................................
  - 2 、volatile 能使得一个非原子操作变成原子操作吗？.....................
  - 3 、volatile 修饰符的有过什么实践？.................................................
  - 4 、volatile 类型变量提供什么保证？.................................................
  - 5 、 10 个线程和 2 个线程的同步代码，哪个更容易写？................
  - 6 、你是如何调用 wait（）方法的？使用 if 块还是循环？为什么？
  - 有经验程序员的 Java 面试题...............................................................
  - 8 、什么是 Busyspin？我们为什么要使用它？.................................
  - 9 、Java 中怎么获取一份线程 dump 文件？....................................
  - 10 、Swing 是线程安全的？.................................................................
  - 11 、什么是线程局部变量？...................................................................
  - 12 、用 wait-notify 写一段代码来解决生产者-消费者问题？........
  - 13 、用 Java 写一个线程安全的单例模式（Singleton）？.............
  - 14 、Java 中 sleep 方法和 wait 方法的区别？...............................
  - 个不可变对象？........................................................................................ 15 、什么是不可变对象（immutableobject）？Java 中怎么创建一
  - 16 、我们能创建一个包含可变对象的不可变对象吗？.......................
  - 数据类型和 Java 基础面试问题...........................................................
  - 17 、Java 中应该使用什么数据类型来代表价格？.............................
  - 18 、怎么将 byte 转换为 String？.....................................................
  - 19 、Java 中怎样将 bytes 转换为 long 类型？..............................
  - byte 类型的范围，将会出现什么现象？............................................. 20 、我们能将 int 强制转换为 byte 类型的变量吗？如果该值大于
  - 如 C=(C)B；........................................................................................ 21 、存在两个类，B 继承 A，C 继承 B，我们能将 B转换为 C 么？
  - 22 、哪个类包含 clone 方法？是 Cloneable 还是 Object？.......
  - 23 、Java 中 ++ 操作符是线程安全的吗？.......................................
- 然后存储回内存，这个过程可能会出现多个线程交差。....................
- 24 、a=a+b 与 a+=b 的区别......................................................
- 类型的变量吗？........................................................................................ 25 、我能在不进行强制转换的情况下将一个 double 值赋值给 long
- 26 、3*0.1==0.3 将会返回什么？true 还是 false？.....................
- 27 、int 和 Integer 哪个会占用更多的内存？..................................
- 28 、为什么 Java 中的 String 是不可变的（Immutable）？.......
- JVM 底层 与 GC（GarbageCollection） 的面试问题.................
- 31 、 64 位 JVM 中，int 的长度是多数？.........................................
- 32 、Serial 与 ParallelGC之间的不同之处？...................................
- 33 、 32 位和 64 位的 JVM，int 类型变量的长度是多数？..........
- 34 、Java 中 WeakReference 与 SoftReference的区别？.........
- 35 、WeakHashMap 是怎么工作的？................................................
- 使用？........................................................................................................ 36 、JVM 选项 -XX:+UseCompressedOops 有什么作用？为什么要
- 37 、怎样通过 Java 程序来判断 JVM 是 32 位 还是 64 位？...
- 38 、 32 位 JVM 和 64 位 JVM的最大堆内存分别是多数？.......
- 39 、JRE、JDK、JVM及 JIT 之间有什么不同？..............................
- 3 年工作经验的 Java 面试题...............................................................
- 40 、解释 Java 堆空间及 GC？...........................................................
- JVM 底层面试题及答案.........................................................................
- 41 、你能保证 GC 执行吗？.................................................................
- 42 、怎么获取 Java 程序使用的内存？堆使用的百分比？...............
- 43 、Java 中堆和栈有什么区别？.........................................................
- 关于内存的的面试问题和答案................................................................
- Java 基本概念面试题.............................................................................
- 44 、“a==b”和”a.equals(b)”有什么区别？...............................
- 45 、a.hashCode() 有什么用？与 a.equals(b) 有什么关系？.......
- 46 、final、finalize和 finally 的不同之处？....................................
- 47 、Java 中的编译期常量是什么？使用它又什么风险？.................
- Java 集合框架的面试题.........................................................................
- 48 、List、Set、Map 和 Queue 之间的区别(答案)........................
- 49 、poll() 方法和 remove() 方法的区别？......................................
- 50 、Java 中 LinkedHashMap 和 PriorityQueue 的区别是什么？
- 51 、ArrayList 与 LinkedList 的不区别？.........................................
- 52 、用哪两种方式来实现集合的排序？...............................................
- 53 、Java 中怎么打印数组？.................................................................
- 54 、Java 中的 LinkedList 是单向链表还是双向链表？..................
- 55 、Java 中的 TreeMap 是采用什么树实现的？(答案).................
- 56 、Hashtable 与 HashMap 有什么不同之处？...........................
- 57 、Java 中的 HashSet，内部是如何工作的？...............................
- 58 、写一段代码在遍历 ArrayList 时移除一个元素？......................
- 59 、我们能自己写一个容器类，然后使用 for-each 循环码？.......
- 60 、ArrayList 和 HashMap 的默认大小是多数？..........................
- 61 、有没有可能两个不相等的对象有有相同的 hashcode？..........
- 62 、两个相同的对象会有不同的的 hashcode 吗？.......................
- 63 、我们可以在 hashcode() 中使用随机数字吗？..........................
- 64 、Java 中，Comparator 与 Comparable 有什么不同？........
- JavaIO 和 NIO 的面试题....................................................................
- 66 、在我 Java 程序中，我有三个 socket，我需要多少个线程来处理？
- 67 、Java 中怎么创建 ByteBuffer？...................................................
- 68 、Java 中，怎么读写 ByteBuffer ？.............................................
- 69 、Java 采用的是大端还是小端？.....................................................
- 70 、ByteBuffer 中的字节序是什么？.................................................
- 71 、Java 中，直接缓冲区与非直接缓冲器有什么区别？.................
- 72 、Java 中的内存映射缓存区是什么？.............................................
- 73 、socket 选项 TCPNODELAY 是指什么？................................
- 74 、TCP 协议与 UDP 协议有什么区别？.........................................
- 75 、Java 中，ByteBuffer 与 StringBuffer有什么区别？(答案)..
- Java 最佳实践的面试问题.....................................................................
- 76 、Java 中，编写多线程程序的时候你会遵循哪些最佳实践？.....


77 、说出几点 Java 中使用 Collections 的最佳实践...................... 348
78 、说出至少 5 点在 Java 中使用线程的最佳实践。.................... 348
79 、说出 5 条 IO 的最佳实践(答案)................................................. 349
80 、列出 5 个应该遵循的 JDBC 最佳实践....................................... 349
81 、说出几条 Java 中方法重载的最佳实践？................................... 350
Date、Time 及 Calendar 的面试题.................................................. 350
82 、在多线程环境下，SimpleDateFormat 是线程安全的吗？..... 350
83 、Java 中如何格式化一个日期？如格式化为 ddMMyyyy 的形式？
.................................................................................................................... 350

84 、Java 中，怎么在格式化的日期中显示时区？............................. 351
85 、Java 中 java.util.Date 与 java.sql.Date 有什么区别？........ 351
86 、Java 中，如何计算两个日期之间的差距？................................. 351
87 、Java 中，如何将字符串 YYYYMMDD 转换为日期？............. 352
单元测试 JUnit 面试题.......................................................................... 352
89 、如何测试静态方法？(答案)............................................................ 352
90 、怎么利用 JUnit 来测试一个方法的异常？................................. 352
91 、你使用过哪个单元测试库来测试你的 Java 程序？................... 352
92 、@Before 和 @BeforeClass 有什么区别？.............................. 352
编程和代码相关的面试题........................................................................ 353
93 、怎么检查一个字符串只包含数字？解决方案............................... 353
94 、Java 中如何利用泛型写一个 LRU 缓存？................................. 353
95 、写一段 Java 程序将 byte 转换为 long？................................ 353
95 、在不使用 StringBuffer 的前提下，怎么反转一个字符串？.... 353
97 、Java 中，怎么获取一个文件中单词出现的最高频率？............. 353
98 、如何检查出两个给定的字符串是反序的？................................... 354
99 、Java 中，怎么打印出一个字符串的所有排列？......................... 354
100 、Java 中，怎样才能打印出数组中的重复元素？...................... 354
101 、Java 中如何将字符串转换为整数？.......................................... 354
102 、在没有使用临时变量的情况如何交换两个整数变量的值？.... 355
关于 OOP 和设计模式的面试题........................................................... 355
103 、接口是什么？为什么要使用接口而不是直接使用具体类？.... 355


104 、Java 中，抽象类与接口之间有什么不同？.............................. 355
105 、除了单例模式，你在生产环境中还用过什么设计模式？........ 356
106 、你能解释一下里氏替换原则吗?................................................... 356

107) 什么情况下会违反迪米特法则？为什么会有这个问题？......... 356
     108 、适配器模式是什么？什么时候使用？........................................ 356
     109 、什么是“依赖注入”和“控制反转”？为什么有人使用？.... 356
     110 、抽象类是什么？它与接口有什么区别？你为什么要使用过抽象
     类？............................................................................................................ 357
     111 、构造器注入和 setter 依赖注入，那种方式更好？.................. 357
     112 、依赖注入和工程模式之间有什么不同？.................................... 357
     113 、适配器模式和装饰器模式有什么区别？.................................... 358
     114 、适配器模式和代理模式之前有什么不同？................................ 358
     115 、什么是模板方法模式？................................................................ 358
     116 、什么时候使用访问者模式？........................................................ 358
     117 、什么时候使用组合模式？............................................................ 358
     118 、继承和组合之间有什么不同？.................................................... 359
     119 、描述 Java 中的重载和重写？.................................................... 359
     120 、Java 中，嵌套公共静态类与顶级类有什么不同？.................. 359
     121 、 OOP 中的 组合、聚合和关联有什么区别？.......................... 359
     122 、给我一个符合开闭原则的设计模式的例子？............................ 360
     123 、抽象工厂模式和原型模式之间的区别？.................................... 360
     Java 面试中其他各式各样的问题......................................................... 361
     125 、嵌套静态类与顶级类有什么区别？............................................ 361
     126 、你能写出一个正则表达式来判断一个字符串是否是一个数字吗？
     .................................................................................................................... 361

127 、Java 中，受检查异常 和 不受检查异常的区别？.................. 362
128 、Java 中，throw 和 throws 有什么区别................................ 362
129 、Java 中，Serializable 与 Externalizable 的区别？............ 362
130 、Java 中，DOM 和 SAX 解析器有什么不同？...................... 363
131 、说出 JDK1.7 中的三个新特性？.............................................. 363
132 、说出 5 个 JDK1.8 引入的新特性？........................................ 363


133 、Java 中，Maven 和 ANT 有什么区别？............................... 363
Spring 面试题（一）............................................................................................. 364
1 、一般问题............................................................................................. 364
1.1、不同版本的 SpringFramework 有哪些主要功能？............... 364
1.2、什么是 SpringFramework？..................................................... 365
1.3、列举 SpringFramework 的优点。........................................... 365
1.4、SpringFramework 有哪些不同的功能？................................. 365
1.5、SpringFramework 中有多少个模块，它们分别是什么？..... 365
1.6、什么是 Spring 配置文件？......................................................... 368
1.7、Spring 应用程序有哪些不同组件？........................................... 368
1.8、使用 Spring 有哪些方式？......................................................... 368
2 、依赖注入（Ioc）............................................................................... 369
2.1、什么是 SpringIOC 容器？......................................................... 369
2.2、什么是依赖注入？.......................................................................... 369
2.3、可以通过多少种方式完成依赖注入？.......................................... 370
2.4、区分构造函数注入和 setter 注入。........................................... 370
2.5、spring 中有多少种 IOC 容器？................................................. 370
2.6、区分 BeanFactory 和 ApplicationContext。........................ 371
2.7、列举 IoC 的一些好处。............................................................... 371
2.8、SpringIoC 的实现机制。............................................................ 371
3 、Beans.................................................................................................. 373
3.1、什么是 springbean？................................................................. 373
3.2、spring 提供了哪些配置方式？.................................................... 373
3.3、spring 支持集中 beanscope？................................................ 375
3.4、springbean 容器的生命周期是什么样的？............................. 375
3.5、什么是 spring 的内部 bean？.................................................. 376
3.6、什么是 spring 装配...................................................................... 377
3.7、自动装配有哪些方式？.................................................................. 377
3.8、自动装配有什么局限？.................................................................. 378
4 、注解..................................................................................................... 378
4.1、什么是基于注解的容器配置.......................................................... 378


4.2、如何在 spring 中启动注解装配？.............................................. 379
4.3、@Component,@Controller,@Repository,@Service 有何区
别？............................................................................................................ 379
4.4、@Required 注解有什么用？...................................................... 380
4.5、@Autowired 注解有什么用？.................................................... 380
4.6、@Qualifier 注解有什么用？....................................................... 381
4.7、@RequestMapping 注解有什么用？....................................... 382
5 、数据访问............................................................................................. 382
5.1、springDAO 有什么用？.............................................................. 382
5.2、列举 SpringDAO 抛出的异常。............................................... 383
5.3、springJDBCAPI 中存在哪些类？............................................. 383
5.4、使用 Spring 访问 Hibernate 的方法有哪些？...................... 384
5.5、列举 spring 支持的事务管理类型.............................................. 384
5.6、spring 支持哪些 ORM 框架...................................................... 384
6 、AOP..................................................................................................... 385
6.1、什么是 AOP？............................................................................... 385
6.2、什么是 Aspect？........................................................................... 385
6.3、什么是切点（JoinPoint）............................................................ 386
6.4、什么是通知（Advice）？............................................................. 386
6.5、有哪些类型的通知（Advice）？................................................. 387
6.6、指出在 springaop 中 concern 和 cross-cuttingconcern 的
不同之处。................................................................................................ 387
6.7、AOP 有哪些实现方式？............................................................... 387
6.8、SpringAOPandAspectJAOP 有什么区别？........................ 388
6.9、如何理解 Spring 中的代理？..................................................... 388
6.10、什么是编织（Weaving）？....................................................... 389
7 、MVC.................................................................................................... 389
7.1、SpringMVC 框架有什么用？..................................................... 389
7.2、描述一下 DispatcherServlet的工作流程................................ 389
7.3、介绍一下 WebApplicationContext.......................................... 391
Spring 面试题（二）............................................................................................. 392


1 、什么是spring?.................................................................................. 392
2 、使用Spring框架的好处是什么？................................................... 392
3 、Spring由哪些模块组成?.................................................................. 392
4 、核心容器（应用上下文) 模块。...................................................... 393
5 、BeanFactory – BeanFactory 实现举例。.................................. 393
6 、XMLBeanFactory............................................................................. 394
7 、解释AOP模块................................................................................... 394
8 、解释JDBC抽象和DAO模块。...................................................... 394
9 、解释对象/关系映射集成模块。....................................................... 394
10 、解释WEB 模块。........................................................................... 394
12 、Spring配置文件............................................................................. 395
13 、什么是SpringIOC 容器？........................................................... 395
14 、IOC的优点是什么？....................................................................... 395
15 、ApplicationContext通常的实现是什么?................................... 395
16 、Bean 工厂和 Applicationcontexts 有什么区别？................ 396
17 、一个Spring的应用看起来象什么？............................................ 396
依赖注入.................................................................................................... 396
18 、什么是Spring的依赖注入？........................................................ 396
19 、有哪些不同类型的IOC（依赖注入）方式？............................... 397
20 、哪种依赖注入方式你建议使用，构造器注入，还是 Setter方法注
入？............................................................................................................ 397
SpringBeans........................................................................................... 397
21.什么是Springbeans?...................................................................... 397
22 、一个 SpringBean 定义 包含什么？.......................................... 398
23 、如何给Spring 容器提供配置元数据?......................................... 398
24 、你怎样定义类的作用域?................................................................. 398
25 、解释Spring支持的几种bean的作用域。................................. 399
26 、Spring框架中的单例bean是线程安全的吗?............................ 399
27 、解释Spring框架中bean的生命周期。..................................... 399
28 、哪些是重要的bean生命周期方法？你能重载它们吗？........... 400
29 、什么是Spring的内部bean？...................................................... 400


30 、在 Spring中如何注入一个java集合？...................................... 400
31 、什么是bean装配?......................................................................... 401
32 、什么是bean的自动装配？........................................................... 401
33 、解释不同方式的自动装配 。......................................................... 401
34.自动装配有哪些局限性 ?.................................................................. 402
35 、你可以在Spring中注入一个null 和一个空字符串吗？.......... 402
Spring注解.............................................................................................. 402
36 、什么是基于Java的Spring注解配置? 给一些注解的例子...... 403
37 、什么是基于注解的容器配置?......................................................... 403
38 、怎样开启注解装配？....................................................................... 403
39 、@Required 注解........................................................................... 403
40 、@Autowired 注解......................................................................... 404
41 、@Qualifier 注解............................................................................ 404
Spring数据访问...................................................................................... 404
42.在Spring框架中如何更有效地使用JDBC?................................... 404
43 、JdbcTemplate................................................................................ 404
44 、Spring对DAO的支持.................................................................. 405
45 、使用Spring通过什么方式访问Hibernate?.............................. 405
46 、Spring支持的ORM....................................................................... 405
47.如何通过HibernateDaoSupport将Spring和Hibernate结合起
来？............................................................................................................ 406
48 、Spring支持的事务管理类型......................................................... 406
49 、Spring框架的事务管理有哪些优点？......................................... 406
50 、你更倾向用那种事务管理类型？................................................... 407
Spring面向切面编程（AOP）.............................................................. 407
51 、解释AOP......................................................................................... 407
52 、Aspect 切面.................................................................................... 407
52 、在SpringAOP 中，关注点和横切关注的区别是什么？.......... 407
54 、连接点............................................................................................... 408
55 、通知................................................................................................... 408
56 、切点................................................................................................... 408


57 、什么是引入?..................................................................................... 409
58 、什么是目标对象?............................................................................. 409
59 、什么是代理?..................................................................................... 409
60 、有几种不同类型的自动代理？....................................................... 409
61 、什么是织入。什么是织入应用的不同点？................................... 409
62 、解释基于XMLSchema方式的切面实现。................................ 410
63 、解释基于注解的切面实现............................................................... 410
Spring 的MVC....................................................................................... 410
64 、什么是Spring的MVC框架？..................................................... 410
65 、DispatcherServlet......................................................................... 410
66 、WebApplicationContext............................................................. 411
67 、什么是SpringMVC框架的控制器？.......................................... 411
68 、@Controller 注解.......................................................................... 411
69 、@RequestMapping 注解............................................................ 411
微服务 面试题.......................................................................................................... 411
1 、您对微服务有何了解？..................................................................... 411
2 、微服务架构有哪些优势？................................................................. 413
3 。微服务有哪些特点？......................................................................... 414
4 、设计微服务的最佳实践是什么？..................................................... 415
5 、微服务架构如何运作？..................................................................... 415
6 、微服务架构的优缺点是什么？......................................................... 416
7 、单片，SOA和微服务架构有什么区别？........................................ 417
8 、在使用微服务架构时，您面临哪些挑战？..................................... 418
9 、SOA和微服务架构之间的主要区别是什么？................................ 418
10 、微服务有什么特点？....................................................................... 419
11 、什么是领域驱动设计？................................................................... 419
12 、为什么需要域驱动设计（DDD）？.............................................. 420
13 、什么是无所不在的语言？............................................................... 420
14 、什么是凝聚力？............................................................................... 421
15 、什么是耦合？................................................................................... 421
16 、什么是REST/RESTful以及它的用途是什么？......................... 421


17 、你对SpringBoot有什么了解？.................................................. 421
18 、什么是Spring引导的执行器？.................................................... 422
19 、什么是SpringCloud？................................................................. 422
20 、SpringCloud解决了哪些问题？................................................. 423
21 、在SpringMVC应用程序中使用WebMvcTest注释有什么用处？
.................................................................................................................... 423

22 。你能否给出关于休息和微服务的要点？....................................... 424
23 、什么是不同类型的微服务测试？................................................... 424
24 、您对DistributedTransaction有何了解？................................ 424
25 、什么是Idempotence以及它在哪里使用？............................... 425
26 、什么是有界上下文？....................................................................... 425
27 、什么是双因素身份验证？............................................................... 425
28 、双因素身份验证的凭据类型有哪些？........................................... 426
29 、什么是客户证书？........................................................................... 427
30 、PACT在微服务架构中的用途是什么？........................................ 427
31 、什么是OAuth？............................................................................. 427
32 、康威定律是什么？........................................................................... 428
33 、合同测试你懂什么？....................................................................... 428
34 、什么是端到端微服务测试？........................................................... 429
35 、Container在微服务中的用途是什么？....................................... 429
36 、什么是微服务架构中的DRY？...................................................... 430
37 、什么是消费者驱动的合同（CDC）？.......................................... 430
38 、Web，RESTfulAPI在微服务中的作用是什么？....................... 431
39 、您对微服务架构中的语义监控有何了解？................................... 431
40 、我们如何进行跨功能测试？........................................................... 431
41 、我们如何在测试中消除非决定论？............................................... 431
42 、Mock或Stub有什么区别？........................................................ 432
43 、您对MikeCohn的测试金字塔了解多少？................................ 432
44 、Docker的目的是什么？................................................................ 433
45 、什么是金丝雀释放？....................................................................... 434
46 、什么是持续集成（CI）？............................................................... 434


47 、什么是持续监测？........................................................................... 434
48 、架构师在微服务架构中的角色是什么？....................................... 434
49 、我们可以用微服务创建状态机吗？............................................... 435
50 、什么是微服务中的反应性扩展？................................................... 435
Linux 面试题........................................................................................................... 435
1 、绝对路径用什么符号表示？当前目录、上层目录用什么表示？主目
录用什么表示? 切换目录用什么命令？................................................ 436
2 、怎么查看当前进程？怎么执行退出？怎么查看当前路径？......... 436
3 、怎么清屏？怎么退出当前命令？怎么执行睡眠？怎么查看当前用户
id？查看指定帮助用什么命令？............................................................ 436
4 、Ls 命令执行什么功能？ 可以带哪些参数，有什么区别？......... 437
5 、建立软链接(快捷方式)，以及硬链接的命令。............................... 437
6 、目录创建用什么命令？创建文件用什么命令？复制文件用什么命
令？............................................................................................................ 437
7 、查看文件内容有哪些命令可以使用？............................................. 438
8 、随意写文件命令？怎么向屏幕输出带空格的字符串，比如”hello
world”?................................................................................................... 439
9 、终端是哪个文件夹下的哪个文件？黑洞文件是哪个文件夹下的哪个
命令？........................................................................................................ 439
10 、移动文件用哪个命令？改名用哪个命令？................................... 439
11 、复制文件用哪个命令？如果需要连同文件夹一块复制呢？如果需
要有提示功能呢？.................................................................................... 440
12 、删除文件用哪个命令？如果需要连目录及目录下文件一块删除
呢？删除空文件夹用什么命令？............................................................ 440
13 、Linux 下命令有哪几种可使用的通配符？分别代表什么含义?. 440
14 、用什么命令对一个文件的内容进行统计？(行号、单词数、字节数)
.................................................................................................................... 441
15 、Grep 命令有什么用？ 如何忽略大小写？ 如何查找不含该串的行?
.................................................................................................................... 441
16 、Linux 中进程有哪几种状态？在 ps 显示出来的信息中，分别用
什么符号表示的？.................................................................................... 441


17 、怎么使一个命令在后台运行?......................................................... 442
18 、利用 ps 怎么显示所有的进程? 怎么利用 ps 查看指定进程的信
息？............................................................................................................ 443
19 、哪个命令专门用来查看后台任务?................................................. 443
20 、把后台任务调到前台执行使用什么命令?把停下的后台任务在后台
执行起来用什么命令?.............................................................................. 443
21 、终止进程用什么命令? 带什么参数?............................................. 444
22 、怎么查看系统支持的所有信号？................................................... 444
23 、搜索文件用什么命令? 格式是怎么样的?..................................... 444
24 、查看当前谁在使用该主机用什么命令? 查找自己所在的终端信息
用什么命令?.............................................................................................. 445
25 、使用什么命令查看用过的命令列表?............................................. 445
26 、使用什么命令查看磁盘使用空间？ 空闲空间呢?....................... 445
27 、使用什么命令查看网络是否连通?................................................. 446
28 、使用什么命令查看 ip 地址及接口信息？................................... 446
29 、查看各类环境变量用什么命令?..................................................... 446
30 、通过什么命令指定命令提示符?..................................................... 446
31 、查找命令的可执行文件是去哪查找的? 怎么对其进行设置及添加?
.................................................................................................................... 447

32 、通过什么命令查找执行命令?......................................................... 448
33 、怎么对命令进行取别名？............................................................... 448
34 、du 和 df 的定义，以及区别？.................................................... 448
35 、awk 详解。..................................................................................... 449
36 、当你需要给命令绑定一个宏或者按键的时候，应该怎么做呢？ 449
37 、如果一个linux新手想要知道当前系统支持的所有命令的列表，他
需要怎么做？............................................................................................ 450
38 、如果你的助手想要打印出当前的目录栈，你会建议他怎么做？ 451
39 、你的系统目前有许多正在运行的任务，在不重启机器的条件下，
有什么方法可以把所有正在运行的进程移除呢？................................ 451
40 、bashshell 中的hash 命令有什么作用？.................................. 452
41 、哪一个bash内置命令能够进行数学运算。................................ 452


42 、怎样一页一页地查看一个大文件的内容呢？............................... 453
43 、数据字典属于哪一个用户的？....................................................... 453
44 、怎样查看一个linux命令的概要与用法？假设你在/bin目录中偶
然看到一个你从没见过的的命令，怎样才能知道它的作用和用法呢？ 453
45 、使用哪一个命令可以查看自己文件系统的磁盘空间配额呢？... 454
SpringBoot 面试题............................................................................................... 454
1 、什么是SpringBoot？..................................................................... 454
2 、SpringBoot有哪些优点？............................................................. 455
3 、什么是JavaConfig？....................................................................... 455
4 、如何重新加载SpringBoot上的更改，而无需重新启动服务器？ 456
5 、SpringBoot中的监视器是什么？................................................. 457
6 、如何在SpringBoot中禁用Actuator端点安全性？.................. 457
7 、如何在自定义端口上运行SpringBoot应用程序？.................... 457
8 、什么是YAML？................................................................................. 458
9 、如何实现SpringBoot应用程序的安全性？................................ 458
10 、如何集成SpringBoot和ActiveMQ？...................................... 458
11 、如何使用SpringBoot实现分页和排序？.................................. 458
12 、什么是Swagger？你用SpringBoot实现了它吗？................ 459
13 、什么是SpringProfiles？.............................................................. 459
14 、什么是SpringBatch？................................................................. 459
15 、什么是FreeMarker模板？........................................................... 459
16 、如何使用SpringBoot实现异常处理？...................................... 460
17 、您使用了哪些startermaven依赖项？...................................... 460
18 、什么是CSRF攻击？....................................................................... 460
19 、什么是WebSockets？.................................................................. 460
20 、什么是AOP？................................................................................. 461
21 、什么是ApacheKafka？................................................................ 462
22 、我们如何监视所有SpringBoot微服务？.................................. 462
SpringCloud 面试题............................................................................................. 462
1 、什么是SpringCloud？................................................................... 462
2 、使用SpringCloud有什么优势？.................................................. 463


3 、服务注册和发现是什么意思？SpringCloud如何实现？........... 463
4 、负载平衡的意义什么？..................................................................... 463
5 、什么是Hystrix？它如何实现容错？............................................... 464
6 、什么是Hystrix断路器？我们需要它吗？...................................... 465
7 、什么是NetflixFeign？它的优点是什么？.................................... 466
8 、什么是SpringCloudBus？我们需要它吗？............................... 468
RabbitMQ 面试题.................................................................................................. 470
1 、什么是rabbitmq.............................................................................. 470
2 、为什么要使用rabbitmq.................................................................. 471
3 、使用rabbitmq的场景..................................................................... 471
4 、如何确保消息正确地发送至RabbitMQ？ 如何确保消息接收方消
费了消息？................................................................................................ 471
5.如何避免消息重复投递或重复消费？................................................ 472
6 、消息基于什么传输？......................................................................... 473
7 、消息如何分发？................................................................................. 473
8 、消息怎么路由？................................................................................. 473
9 、如何确保消息不丢失？..................................................................... 474
10 、使用RabbitMQ有什么好处？..................................................... 474
11 、RabbitMQ的集群.......................................................................... 474
12 、mq的缺点........................................................................................ 475
无标题.......................................................................................... **错误！未定义书签。**
kafka 面试题........................................................................................................... 475
1 、如何获取topic主题的列表.............................................................. 475
2 、生产者和消费者的命令行是什么？................................................. 476
3 、consumer是推还是拉？................................................................. 476
4 、讲讲kafka维护消费状态跟踪的方法............................................. 477
5 、讲一下主从同步**.............................................................................. 478
6 、为什么需要消息系统，mysql不能满足需求吗？......................... 478
7 、Zookeeper对于Kafka的作用是什么？....................................... 479
8 、数据传输的事务定义有哪三种？..................................................... 480
9 、Kafka判断一个节点是否还活着有那两个条件？.......................... 480


```
10 、Kafka 与传统MQ消息系统之间有三个关键区别..................... 481
11 、讲一讲kafka的ack的三种机制.................................................. 481
13 、消费者故障，出现活锁问题如何解决？....................................... 482
14 、如何控制消费的位置....................................................................... 483
15 、kafka分布式（不是单机）的情况下，如何保证消息的顺序消费? 483
16 、kafka的高可用机制是什么？........................................................ 483
17 、kafka如何减少数据丢失................................................................ 484
18 、kafka如何不消费重复数据？比如扣款，我们不能重复的扣。 484
```

## MyBatis 面试题

### 1 、什么是Mybatis？

1 、Mybatis是 一 个 半ORM（对 象 关 系 映 射）框 架，它 内 部 封 装 了JDBC，开 发 时
只 需 要 关 注SQL语 句 本 身 ， 不 需 要 花 费 精 力 去 处 理 加 载 驱 动 、 创 建 连 接 、 创建
statement等 繁 杂 的 过 程。程 序 员 直 接 编 写 原 生 态sql，可 以 严 格 控 制sql执 行 性
能 ， 灵 活 度 高 。

2 、MyBatis 可 以 使 用 XML 或 注 解 来 配 置 和 映 射 原 生 信 息 ， 将 POJO映 射 成 数
据 库 中 的 记 录 ， 避 免 了 几 乎 所 有 的 JDBC 代 码 和 手 动 设 置 参 数 以 及 获 取 结 果 集。

3 、 通 过xml 文 件 或 注 解 的 方 式 将 要 执 行 的 各 种 statement 配 置 起 来 ， 并 通过
java对 象 和 statement中sql的 动 态 参 数 进 行 映 射 生 成 最 终 执 行 的sql语 句，最
后 由mybatis框 架 执 行sql并 将 结 果 映 射 为java对 象 并 返 回 。 （ 从 执 行sql到 返
回result的 过 程 ） 。

### 2 、Mybaits的优点：


#### 1 、基 于SQL语 句 编 程，相 当 灵 活，不 会 对 应 用 程 序 或 者 数 据 库 的 现 有 设 计 造 成 任

何 影 响，SQL写 在XML里，解 除sql与 程 序 代 码 的 耦 合，便 于 统 一 管 理；提 供XML
标 签 ， 支 持 编 写 动 态SQL语 句 ， 并 可 重 用 。

2 、与JDBC相 比，减 少 了50%以 上 的 代 码 量，消 除 了JDBC大 量 冗 余 的 代 码，不
需 要 手 动 开 关 连 接 ；

3 、很 好 的 与 各 种 数 据 库 兼 容（因 为MyBatis使 用JDBC来 连 接 数 据 库，所 以 只要
JDBC支 持 的 数 据 库MyBatis都 支 持 ） 。

4 、 能 够 与Spring很 好 的 集 成 ；

5 、 提 供 映 射 标 签 ， 支 持 对 象 与 数 据 库 的ORM字 段 关 系 映 射 ； 提 供 对 象 关 系 映 射
标 签 ， 支 持 对 象 关 系 组 件 维 护 。

### 3 、MyBatis框架的缺点：

#### 1 、SQL语 句 的 编 写 工 作 量 较 大 ， 尤 其 当 字 段 多 、 关 联 表 多 时 ， 对 开 发 人 员 编写

#### SQL语 句 的 功 底 有 一 定 要 求 。

#### 2 、SQL语 句 依 赖 于 数 据 库 ， 导 致 数 据 库 移 植 性 差 ， 不 能 随 意 更 换 数 据 库 。

### 4 、MyBatis框架适用场合：

1 、MyBatis专 注 于SQL本 身 ， 是 一 个 足 够 灵 活 的DAO层 解 决 方 案 。

2 、对 性 能 的 要 求 很 高，或 者 需 求 变 化 较 多 的 项 目，如 互 联 网 项 目，MyBatis将 是
不 错 的 选 择 。


### 5 、MyBatis与Hibernate有哪些不同？

1 、Mybatis和hibernate不 同，它 不 完 全 是 一 个ORM框 架，因 为MyBatis需 要
程 序 员 自 己 编 写Sql语 句 。

2 、Mybatis直 接 编 写 原 生 态sql， 可 以 严 格 控 制sql执 行 性 能 ， 灵 活 度 高 ， 非 常
适 合 对 关 系 数 据 模 型 要 求 不 高 的 软 件 开 发 ， 因 为 这 类 软 件 需 求 变 化 频 繁 ， 一 但 需
求 变 化 要 求 迅 速 输 出 成 果 。 但 是 灵 活 的 前 提 是mybatis无 法 做 到 数 据 库 无 关 性 ，
如 果 需 要 实 现 支 持 多 种 数 据 库 的 软 件，则 需 要 自 定 义 多 套sql映 射 文 件，工 作 量 大。

3 、Hibernate对 象/关 系 映 射 能 力 强 ， 数 据 库 无 关 性 好 ， 对 于 关 系 模 型 要 求 高 的
软 件 ， 如 果 用hibernate开 发 可 以 节 省 很 多 代 码 ， 提 高 效 率 。

### 6 、#{}和${}的区别是什么？.....................................................................

#{}是 预 编 译 处 理 ，${}是 字 符 串 替 换 。

Mybatis在 处 理#{}时，会 将sql中 的#{}替 换 为?号，调 用PreparedStatement的
set方 法 来 赋 值 ；

Mybatis在 处 理${}时 ， 就 是 把${}替 换 成 变 量 的 值 。

使 用#{}可 以 有 效 的 防 止SQL注 入 ， 提 高 系 统 安 全 性 。

### 7 、当实体类中的属性名和表中的字段名不一样 ，怎么办 ？...........

第 1 种： 通 过 在 查 询 的sql语 句 中 定 义 字 段 名 的 别 名，让 字 段 名 的 别 名 和 实 体 类
的 属 性 名 一 致 。


<selectid=”selectorder” parametertype=”int” resultetype=”
me.gacl.domain.order”>
selectorder_idid,order_noorderno,order_pricepriceform
orderswhereorder_id=#{id};
</select>

第 2 种 ： 通 过<resultMap>来 映 射 字 段 名 和 实 体 类 属 性 名 的 一 一 对 应 的 关 系。

<selectid="getOrder"parameterType="int"
resultMap="orderresultmap">
select*fromorderswhereorder_id=#{id}
</select>

<resultMaptype=”me.gacl.domain.order” id=”orderresultmap”>
<!–用id属性来映射主键字段–>
<idproperty=”id” column=”order_id”>

<!–用result属性来映射非主键字段，property为实体类属性名，column
为数据表中的属性–>
<resultproperty= “orderno” column=”order_no”/>
<resultproperty=”price” column=”order_price” />
</reslutMap>

### 8 、 模糊查询like语句该怎么写?...........................................................

第 1 种 ： 在Java代 码 中 添 加sql通 配 符 。

stringwildcardname= “%smi%”;
list<name>names=mapper.selectlike(wildcardname);


<selectid=”selectlike”>
select*fromfoowherebarlike#{value}
</select>

第 2 种 ： 在sql语 句 中 拼 接 通 配 符 ， 会 引 起sql注 入

stringwildcardname= “smi”;
list<name>names=mapper.selectlike(wildcardname);

<selectid=”selectlike”>
select*fromfoowherebarlike"%"#{value}"%"
</select>

### 9 、通常一个Xml映射文件，都会写一个Dao接口与之对应，

### 请问，这个Dao接口的工作原理是什么？Dao接口里的方法，

### 参数不同时，方法能重载吗？

Dao接 口 即Mapper接 口。接 口 的 全 限 名，就 是 映 射 文 件 中 的namespace的 值；
接 口 的 方 法 名 ， 就 是 映 射 文 件 中Mapper的Statement的id值 ； 接 口 方 法 内 的
参 数 ， 就 是 传 递 给sql的 参 数 。

Mapper接 口 是 没 有 实 现 类 的，当 调 用 接 口 方 法 时，接 口 全 限 名+方 法 名 拼 接 字 符
串 作 为key值 ， 可 唯 一 定 位 一 个MapperStatement。 在Mybatis中 ， 每 一 个

<select>、<insert>、<update>、<delete>标 签 ， 都 会 被 解 析 为 一个
MapperStatement对 象 。



举 例 ：com.mybatis3.mappers.StudentDao.findStudentById， 可 以 唯
一 找 到namespace为com.mybatis3.mappers.StudentDao下 面 id 为
findStudentById 的 MapperStatement。

Mapper接 口 里 的 方 法，是 不 能 重 载 的，因 为 是 使 用 全 限 名+方 法 名 的 保 存 和 寻
找 策 略。Mapper 接 口 的 工 作 原 理 是JDK动 态 代 理，Mybatis运 行 时 会 使 用JDK
动 态 代 理 为Mapper接 口 生 成 代 理 对 象proxy， 代 理 对 象 会 拦 截 接 口 方 法 ， 转 而
执 行MapperStatement所 代 表 的sql， 然 后 将sql执 行 结 果 返 回 。

### 10 、Mybatis是如何进行分页的？分页插件的原理是什么？.............

Mybatis使 用RowBounds对 象 进 行 分 页 ， 它 是 针 对ResultSet结 果 集 执 行 的 内
存 分 页，而 非 物 理 分 页。可 以 在sql内 直 接 书 写 带 有 物 理 分 页 的 参 数 来 完 成 物 理 分
页 功 能 ， 也 可 以 使 用 分 页 插 件 来 完 成 物 理 分 页 。

分 页 插 件 的 基 本 原 理 是 使 用Mybatis提 供 的 插 件 接 口 ， 实 现 自 定 义 插 件 ， 在 插 件
的 拦 截 方 法 内 拦 截 待 执 行 的sql，然 后 重 写sql，根 据dialect方 言，添 加 对 应 的 物
理 分 页 语 句 和 物 理 分 页 参 数 。

### 11 、Mybatis是如何将sql执行结果封装为目标对象并返回的？

### 都有哪些映射形式？

第 一 种 是 使 用<resultMap>标 签 ， 逐 一 定 义 数 据 库 列 名 和 对 象 属 性 名 之 间 的 映
射 关 系 。

第 二 种 是 使 用sql列 的 别 名 功 能 ， 将 列 的 别 名 书 写 为 对 象 属 性 名 。


有 了 列 名 与 属 性 名 的 映 射 关 系 后 ，Mybatis通 过 反 射 创 建 对 象 ， 同 时 使 用 反 射 给
对 象 的 属 性 逐 一 赋 值 并 返 回 ， 那 些 找 不 到 映 射 关 系 的 属 性 ， 是 无 法 完 成 赋 值 的 。

### 12 、如何执行批量插入?...........................................................................

首 先,创 建 一 个 简 单 的insert语 句:

<insertid=”insertname”>
insertintonames(name)values(#{value})
</insert>

然 后 在java代 码 中 像 下 面 这 样 执 行 批 处 理 插 入:

list<string>names=newarraylist();
names.add(“fred”);
names.add(“barney”);
names.add(“betty”);
names.add(“wilma”);
// 注意这里 executortype.batch
sqlsessionsqlsession=
sqlsessionfactory.opensession(executortype.batch);
try{
namemappermapper=sqlsession.getmapper(namemapper.class);
for(stringname:names){
mapper.insertname(name);
}
sqlsession.commit();
}catch(Exceptione){
e.printStackTrace();
sqlSession.rollback();


throwe;
}
finally{
sqlsession.close();
}

### 13 、如何获取自动生成的(主)键值?........................................................

insert 方 法 总 是 返 回 一 个int值 ， 这 个 值 代 表 的 是 插 入 的 行 数 。

如 果 采 用 自 增 长 策 略，自 动 生 成 的 键 值 在 insert 方 法 执 行 完 后 可 以 被 设 置 到 传 入
的 参 数 对 象 中 。

示 例 ：

<insertid=”insertname” usegeneratedkeys=”true” keyproperty=”
id”>
insertintonames(name)values(#{name})
</insert>
namename=newname();
name.setname(“fred”);

introws=mapper.insertname(name);
// 完成后,id已经被设置到对象中
system.out.println(“rowsinserted= ” +rows);
system.out.println(“generatedkeyvalue= ” +name.getid());

### 14 、在mapper中如何传递多个参数?..................................................


#### 1 、 第 一 种 ：

#### DAO层 的 函 数

publicUserselectUser(Stringname,Stringarea);
对应的xml,#{ 0 }代表接收的是dao层中的第一个参数，#{ 1 }代表dao层中第二
参数，更多参数一致往后加即可。

<selectid="selectUser"resultMap="BaseResultMap">
select* fromuser_user_t whereuser_name=#{0}
anduser_area=#{1}
</select>

2 、 第 二 种 ： 使 用 @param 注 解:

publicinterfaceusermapper{
userselectuser(@param(“username”)string
username,@param(“hashedpassword”)stringhashedpassword);
}

然 后,就 可 以 在xml像 下 面 这 样 使 用(推 荐 封 装 为 一 个map,作 为 单 个 参 数 传 递给
mapper):

<selectid=”selectuser” resulttype=”user”>
selectid,username,hashedpassword
fromsome_table
whereusername=#{username}
andhashedpassword=#{hashedpassword}
</select>

3 、 第 三 种 ： 多 个 参 数 封 装 成map


try{
//映射文件的命名空间.SQL片段的ID，就可以调用对应的映射文件中的
SQL
//由于我们的参数超过了两个，而方法中只有一个Object参数收集，因此
我们使用Map集合来装载我们的参数
Map<String,Object>map=newHashMap();
map.put("start",start);
map.put("end",end);
returnsqlSession.selectList("StudentID.pagination",map);
}catch(Exceptione){
e.printStackTrace();
sqlSession.rollback();
throwe;
}finally{
MybatisUtil.closeSqlSession();
}

### 15 、Mybatis动态sql有什么用？执行原理？有哪些动态sql？.......

Mybatis动 态sql可 以 在Xml映 射 文 件 内，以 标 签 的 形 式 编 写 动 态sql，执 行 原 理
是 根 据 表 达 式 的 值 完 成 逻 辑 判 断 并 动 态 拼 接sql的 功 能 。

Mybatis提 供了 9 种 动态sql标 签：trim|where|set|foreach|if|choose
|when|otherwise|bind。

### 16 、Xml映射文件中，除了常见的select|insert|updae|delete

### 标签之外，还有哪些标签？


答 ：<resultMap>、<parameterMap>、<sql>、<include>、
<selectKey>， 加 上 动 态sql的 9 个 标 签 ， 其 中<sql>为sql片 段 标 签 ， 通 过
<include>标 签 引 入sql片 段 ，<selectKey>为 不 支 持 自 增 的 主 键 生 成 策 略 标
签 。

17 、Mybatis的Xml映 射 文 件 中 ， 不 同 的Xml映 射 文 件 ，id是 否 可 以 重 复 ？

不 同 的Xml映 射 文 件 ， 如 果 配 置 了namespace， 那 么id可 以 重 复 ； 如 果 没 有 配
置namespace， 那 么id不 能 重 复 ；

原 因 就 是namespace+id是 作 为Map<String,MapperStatement>的key
使 用 的 ， 如 果 没 有namespace， 就 剩 下id， 那 么 ，id重 复 会 导 致 数 据 互 相 覆 盖。
有 了namespace，自 然id就 可 以 重 复，namespace不 同，namespace+id自 然
也 就 不 同 。

### 18 、为什么说Mybatis是半自动ORM映射工具？它与全自动

### 的区别在哪里？

Hibernate属 于 全 自 动ORM映 射 工 具 ， 使 用Hibernate查 询 关 联 对 象 或 者 关 联
集 合 对 象 时 ， 可 以 根 据 对 象 关 系 模 型 直 接 获 取 ， 所 以 它 是 全 自 动 的 。 而Mybatis
在 查 询 关 联 对 象 或 关 联 集 合 对 象 时，需 要 手 动 编 写sql来 完 成，所 以，称 之 为 半 自
动ORM映 射 工 具 。

### 19 、 一对一、一对多的关联查询 ？.....................................................

<mappernamespace="com.lcb.mapping.userMapper">
<!--association 一对一关联查询 -->


<selectid="getClass"parameterType="int"
resultMap="ClassesResultMap">
select*fromclassc,teachertwherec.teacher_id=t.t_idand
c.c_id=#{id}
</select>

<resultMaptype="com.lcb.user.Classes"id="ClassesResultMap">
<!-- 实体类的字段名和数据表的字段名映射 -->
<idproperty="id"column="c_id"/>
<resultproperty="name"column="c_name"/>
<associationproperty="teacher"
javaType="com.lcb.user.Teacher">
<idproperty="id"column="t_id"/>
<resultproperty="name"column="t_name"/>
</association>
</resultMap>

<!--collection 一对多关联查询 -->
<selectid="getClass2"parameterType="int"
resultMap="ClassesResultMap2">
select*fromclassc,teachert,studentswherec.teacher_id=t.t_id
andc.c_id=s.class_idandc.c_id=#{id}
</select>

<resultMaptype="com.lcb.user.Classes"id="ClassesResultMap2">
<idproperty="id"column="c_id"/>
<resultproperty="name"column="c_name"/>
<associationproperty="teacher"
javaType="com.lcb.user.Teacher">
<idproperty="id"column="t_id"/>


```
<resultproperty="name"column="t_name"/>
</association>
```

<collectionproperty="student"
ofType="com.lcb.user.Student">
<idproperty="id"column="s_id"/>
<resultproperty="name"column="s_name"/>
</collection>
</resultMap>
</mapper>

### 20 、MyBatis实现一对一有几种方式?具体怎么操作的？...................

#### 有 联 合 查 询 和 嵌 套 查 询,联 合 查 询 是 几 个 表 联 合 查 询,只 查 询 一 次, 通 过在

resultMap里 面 配 置association节 点 配 置 一 对 一 的 类 就 可 以 完 成 ；

嵌 套 查 询 是 先 查 一 个 表，根 据 这 个 表 里 面 的 结 果 的 外 键id，去 再 另 外 一 个 表 里 面
查 询 数 据,也 是 通 过association配 置，但 另 外 一 个 表 的 查 询 通 过select属 性 配 置。

### 21 、MyBatis实现一对多有几种方式,怎么操作的？............................

#### 有 联 合 查 询 和 嵌 套 查 询 。 联 合 查 询 是 几 个 表 联 合 查 询,只 查 询 一 次,通 过在

resultMap里 面 的collection节 点 配 置 一 对 多 的 类 就 可 以 完 成 ； 嵌 套 查 询 是 先 查
一 个 表,根 据 这 个 表 里 面 的 结 果 的 外键id,去 再 另 外 一 个 表 里 面 查 询 数 据,也 是 通 过
配 置collection,但 另 外 一 个 表 的 查 询 通 过select节 点 配 置 。


### 22 、Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？

答 ：Mybatis仅 支 持association关 联 对 象 和collection关 联 集 合 对 象 的 延 迟 加
载，association指 的 就 是 一 对 一，collection指 的 就 是 一 对 多 查 询。在Mybatis
配 置 文 件 中 ， 可 以 配 置 是 否 启 用 延 迟 加 载lazyLoadingEnabled=true|false。

#### 它 的 原 理 是 ， 使 用CGLIB创 建 目 标 对 象 的 代 理 对 象 ， 当 调 用 目 标 方 法 时 ， 进 入 拦

截 器 方 法 ， 比 如 调 用a.getB().getN ame()， 拦 截 器invoke()方 法 发 现a.getB()是
null值 ， 那 么 就 会 单 独 发 送 事 先 保 存 好 的 查 询 关 联B对 象 的sql， 把B查 询 上 来，
然 后 调用a.setB(b)，于是a的 对象b属 性 就 有 值 了，接 着 完成a.getB().getName()
方 法 的 调 用 。 这 就 是 延 迟 加 载 的 基 本 原 理 。

当 然 了 ， 不 光 是Mybatis， 几 乎 所 有 的 包 括Hibernate， 支 持 延 迟 加 载 的 原 理 都
是 一 样 的 。

### 23 、Mybatis的一级、二级缓存:............................................................

1 ）一 级 缓 存: 基 于 PerpetualCache 的 HashMap 本 地 缓 存，其 存 储 作 用 域 为
Session， 当 Sessionflush 或 close 之 后 ， 该 Session 中 的 所 有 Cache 就
将 清 空 ， 默 认 打 开 一 级 缓 存 。

2 ）二 级 缓 存 与 一 级 缓 存 其 机 制 相 同，默 认 也 是 采 用 PerpetualCache，HashMap
存 储 ， 不 同 在 于 其 存 储 作 用 域 为 Mapper(Namespace)， 并 且 可 自 定 义 存 储 源 ，
如 Ehcache。 默 认 不 打 开 二 级 缓 存 ， 要 开 启 二 级 缓 存 ， 使 用 二 级 缓 存 属 性 类 需 要
实 现Serializable序 列 化 接 口(可 用 来 保 存 对 象 的 状 态),可 在 它 的 映 射 文 件 中 配 置
<cache/> ；


3 ） 对 于 缓 存 数 据 更 新 机 制 ， 当 某 一 个 作 用 域(一 级 缓 存 Session/二 级 缓存
Namespaces)的 进 行 了C/U/D 操 作 后，默 认 该 作 用 域 下 所 有 select 中 的 缓 存 将
被 clear。

### 24 、什么是MyBatis的接口绑定？有哪些实现方式？........................

接 口 绑 定，就 是 在MyBatis中 任 意 定 义 接 口,然 后 把 接 口 里 面 的 方 法 和SQL语 句 绑
定, 我 们 直 接 调 用 接 口 方 法 就 可 以,这 样 比 起 原 来了SqlSession提 供 的 方 法 我 们 可
以 有 更 加 灵 活 的 选 择 和 设 置 。

接 口 绑 定 有 两 种 实 现 方 式,一 种 是 通 过 注 解 绑 定 ， 就 是 在 接 口 的 方 法 上 面 加 上
@Select、@Update等 注 解 ， 里 面 包 含Sql语 句 来 绑 定 ； 另 外 一 种 就 是 通 过xml
里 面 写SQL来 绑 定, 在 这 种 情 况 下,要 指 定xml映 射 文 件 里 面 的namespace必 须
为 接 口 的 全 路 径 名 。 当Sql语 句 比 较 简 单 时 候,用 注 解 绑 定, 当SQL语 句 比 较 复 杂
时 候,用xml绑 定,一 般 用xml绑 定 的 比 较 多 。

### 25 、使用MyBatis的mapper接口调用时有哪些要求？...................

1 、Mapper接 口 方 法 名 和mapper.xml中 定 义 的 每 个sql的id相 同 ；
2 、Mapper接 口 方 法 的 输 入 参 数 类 型 和mapper.xml中 定 义 的 每 个sql 的
parameterType的 类 型 相 同 ；
3 、Mapper接 口 方 法 的 输 出 参 数 类 型 和mapper.xml中 定 义 的 每 个sql的
resultType的 类 型 相 同 ；
4 、Mapper.xml文 件 中 的namespace即 是mapper接 口 的 类 路 径 。

### 26 、Mapper编写有哪几种方式？.........................................................


第 一 种 ： 接 口 实 现 类 继 承SqlSessionDaoSupport： 使 用 此 种 方 法 需 要 编写
mapper接 口 ，mapper接 口 实 现 类 、mapper.xml文 件 。

1 、 在sqlMapConfig.xml中 配 置mapper.xml的 位 置

<mappers>
<mapperresource="mapper.xml文件的地址"/>
<mapperresource="mapper.xml文件的地址"/>
</mappers>

1 、 定 义mapper接 口
3 、 实 现 类 集 成SqlSessionDaoSupport
mapper方 法 中 可 以this.getSqlSession()进 行 数 据 增 删 改 查 。
4 、spring 配 置

<beanid=""class="mapper接口的实现">
<propertyname="sqlSessionFactory"
ref="sqlSessionFactory"></property>
</bean>

第 二 种 ： 使 用org.mybatis.spring.mapper.MapperFactoryBean：

1 、 在sqlMapConfig.xml中 配 置mapper.xml的 位 置 ， 如 果mapper.xml和
mappre接 口 的 名 称 相 同 且 在 同 一 个 目 录 ， 这 里 可 以 不 用 配 置

<mappers>
<mapperresource="mapper.xml文件的地址"/>
<mapperresource="mapper.xml文件的地址"/>
</mappers>

2 、 定 义mapper接 口 ：


1 、mapper.xml中 的namespace为mapper接 口 的 地 址
2 、mapper接 口 中 的 方 法 名 和mapper.xml中 的 定 义 的statement的id保 持 一
致
3 、Spring中 定 义

<beanid=""class="org.mybatis.spring.mapper.MapperFactoryBean">
<propertyname="mapperInterface" value="mapper接口地址"/>
<propertyname="sqlSessionFactory"ref="sqlSessionFactory"/>
</bean>

第 三 种 ： 使 用mapper扫 描 器 ：

1 、mapper.xml文 件 编 写 ：

mapper.xml中 的namespace为mapper接 口 的 地 址 ；
mapper接 口 中 的 方 法 名 和mapper.xml中 的 定 义 的statement的id保 持 一 致；
如 果将mapper.xml和mapper接 口 的 名 称 保 持 一 致 则 不 用在sqlMapConfig.xml
中 进 行 配 置 。

2 、 定 义mapper接 口 ：

注 意mapper.xml的 文 件 名 和mapper的 接 口 名 称 保 持 一 致 ， 且 放 在 同 一 个 目 录
3 、 配 置mapper扫 描 器 ：

<beanclass="org.mybatis.spring.mapper.MapperScannerConfigurer">
<propertyname="basePackage"value="mapper接口包地址
"></property>
<propertyname="sqlSessionFactoryBeanName"
value="sqlSessionFactory"/>
</bean>


4 、 使 用 扫 描 器 后 从spring容 器 中 获 取mapper的 实 现 对 象 。

### 27 、简述Mybatis的插件运行原理，以及如何编写一个插件。........

答 ：Mybatis仅 可 以 编 写 针 对ParameterHandler、ResultSetHandler、
StatementHandler、Executor这 4 种 接 口 的 插 件 ，Mybatis使 用JDK的 动 态 代
理 ， 为 需 要 拦 截 的 接 口 生 成 代 理 对 象 以 实 现 接 口 方 法 拦 截 功 能 ， 每 当 执 行 这 4 种
接 口 对 象 的 方 法 时，就 会 进 入 拦 截 方 法，具 体 就 是InvocationHandler的invoke()
方 法 ， 当 然 ， 只 会 拦 截 那 些 你 指 定 需 要 拦 截 的 方 法 。

编 写 插 件 ： 实 现Mybatis的Interceptor接 口 并 复 写intercept()方 法 ， 然 后 在 给
插 件 编 写 注 解 ， 指 定 要 拦 截 哪 一 个 接 口 的 哪 些 方 法 即 可 ， 记 住 ， 别 忘 了 在 配 置 文
件 中 配 置 你 编 写 的 插 件 。

## ZooKeeper 面试题...................................................................................................

### 1.ZooKeeper 面试题？..........................................................................

ZooKeeper是 一 个 开 放 源 码 的 分 布 式 协 调 服 务 ， 它 是 集 群 的 管 理 者 ， 监 视 着 集 群
中 各 个 节 点 的 状 态 根 据 节 点 提 交 的 反 馈 进 行 下 一 步 合 理 操 作 。 最 终 ， 将 简 单 易 用
的 接 口 和 性 能 高 效 、 功 能 稳 定 的 系 统 提 供 给 用 户 。

分 布 式 应 用 程 序 可 以 基 于Zookeeper实 现 诸 如 数 据 发 布/订 阅 、 负 载 均 衡 、 命 名
服 务、分 布 式 协 调/通 知、集 群 管 理、Master选 举、分 布 式 锁 和 分 布 式 队 列 等 功 能。

**Zookeeper保 证 了 如 下 分 布 式 一 致 性 特 性** ：


#### 1 、 顺 序 一 致 性

#### 2 、 原 子 性

#### 3 、 单 一 视 图

#### 4 、 可 靠 性

#### 5 、 实 时 性 （ 最 终 一 致 性 ）

#### 客 户 端 的 读 请 求 可 以 被 集 群 中 的 任 意 一 台 机 器 处 理 ， 如 果 读 请 求 在 节 点 上 注 册 了

**监 听 器，这 个 监 听 器 也 是 由 所 连 接 的zookeeper机 器 来 处 理** 。对 于 写 请 求，这 些
请 求 会 同 时 发 给 其 他zookeeper机 器 并 且 达 成 一 致 后，请 求 才 会 返 回 成 功。因 此，
随着zookeeper的 集 群 机 器 增 多，读 请 求 的 吞 吐 会 提 高 但 是 写 请 求 的 吞 吐 会 下 降。

有 序 性 是zookeeper中 非 常 重 要 的 一 个 特 性，所 有 的 更 新 都 是 全 局 有 序 的，每 个
更 新 都 有 一 个 唯 一 的 时 间 戳，这 个 时 间 戳 称 为zxid（ZookeeperTransactionId）。
而 读 请 求 只 会 相 对 于 更 新 有 序 ， 也 就 是 读 请 求 的 返 回 结 果 中 会 带 有 这个
zookeeper最 新 的zxid。

### 2.ZooKeeper提供了什么？...................................................................

#### 1 、 文 件 系 统

#### 2 、 通 知 机 制

### 3.Zookeeper文件系统............................................................................

Zookeeper提 供 一 个 多 层 级 的 节 点 命 名 空 间（节 点 称 为znode）。与 文 件 系 统 不
同 的 是 ， 这 些 节 点 都 可 以 设 置 关 联 的 数 据 ， 而 文 件 系 统 中 只 有 文 件 节 点 可 以 存 放
数 据 而 目 录 节 点 不 行 。
Zookeeper为 了 保 证 高 吞 吐 和 低 延 迟 ， 在 内 存 中 维 护 了 这 个 树 状 的 目 录 结 构 ， **这
种 特 性 使 得Zookeeper不 能 用 于 存 放 大 量 的 数 据 ， 每 个 节 点 的 存 放 数 据 上 限为
1M** 。


### 4.ZAB协议？............................................................................................

ZAB协 议 是 为 分 布 式 协 调 服务Zookeeper专 门 设 计 的 一 种 支 持 崩 溃 恢 复 的 原 子 广
播 协 议 。

ZAB协 议 包 括 两 种 基 本 的 模 式 ： **崩 溃 恢 复 和 消 息 广 播** 。

当 整 个zookeeper集 群 刚 刚 启 动 或 者Leader服 务 器 宕 机 、 重 启 或 者 网 络 故 障 导
致 不 存 在 过 半 的 服 务 器 与Leader服 务 器 保 持 正 常 通 信 时，所 有 进 程（服 务 器）进
入 崩 溃 恢 复 模 式 ， 首 先 选 举 产 生 新 的Leader服 务 器 ， 然 后 集 群 中Follower服 务
器 开 始 与 新 的Leader服 务 器 进 行 数 据 同 步 ， 当 集 群 中 超 过 半 数 机 器 与 该Leader
服 务 器 完 成 数 据 同 步 之 后 ， 退 出 恢 复 模 式 进 入 消 息 广 播 模 式 ，Leader服 务 器 开 始
接 收 客 户 端 的 事 务 请 求 生 成 事 物 提 案 来 进 行 事 务 请 求 处 理 。

### 5. 四种类型的数据节点 Znode..............................................................

#### 1 、 PERSISTENT - 持 久 节 点

除 非 手 动 删 除 ， 否 则 节 点 一 直 存 在 于Zookeeper上

#### 2 、 EPHEMERAL - 临 时 节 点

#### 临 时 节 点 的 生 命 周 期 与 客 户 端 会 话 绑 定 ， 一 旦 客 户 端 会 话 失 效 （ 客 户 端与

zookeeper连 接 断 开 不 一 定 会 话 失 效 ） ， 那 么 这 个 客 户 端 创 建 的 所 有 临 时 节 点 都
会 被 移 除 。

3 、 **PERSISTENT_SEQUENTIAL** - 持 久 顺 序 节 点
基 本 特 性 同 持 久 节 点 ， 只 是 增 加 了 顺 序 属 性 ， 节 点 名 后 边 会 追 加 一 个 由 父 节 点 维
护 的 自 增 整 型 数 字 。


#### 4 、 EPHEMERAL_SEQUENTIAL - 临 时 顺 序 节 点

#### 基 本 特 性 同 临 时 节 点 ， 增 加 了 顺 序 属 性 ， 节 点 名 后 边 会 追 加 一 个 由 父 节 点 维 护 的

#### 自 增 整 型 数 字 。

### 6.ZookeeperWatcher 机制 -- 数据变更通知..................................

Zookeeper允 许 客 户 端 向 服 务 端 的 某 个Znode注 册 一 个Watcher监 听 ， 当 服 务
端 的 一 些 指 定 事 件 触 发 了 这 个Watcher， 服 务 端 会 向 指 定 客 户 端 发 送 一 个 事 件 通
知 来 实 现 分 布 式 的 通 知 功 能 ， 然 后 客 户 端 根 据Watcher通 知 状 态 和 事 件 类 型 做 出
业 务 上 的 改 变 。

**工 作 机 制** ：

1 、 客 户 端 注 册watcher
2 、 服 务 端 处 理watcher
3 、 客 户 端 回 调watcher

**Watcher特 性 总 结** ：

1 、 一 次 性
无 论 是 服 务 端 还 是 客 户 端，一 旦 一 个Watcher被 触 发，Zookeeper都 会 将 其 从 相
应 的 存 储 中 移 除 。 这 样 的 设 计 有 效 的 减 轻 了 服 务 端 的 压 力 ， 不 然 对 于 更 新 非 常 频
繁 的 节 点 ， 服 务 端 会 不 断 的 向 客 户 端 发 送 事 件 通 知 ， 无 论 对 于 网 络 还 是 服 务 端 的
压 力 都 非 常 大 。

2 、 客 户 端 串 行 执 行
客 户 端Watcher回 调 的 过 程 是 一 个 串 行 同 步 的 过 程 。

#### 3 、 轻 量


3.1、Watcher通 知 非 常 简 单，只 会 告 诉 客 户 端 发 生 了 事 件，而 不 会 说 明 事 件 的 具
体 内 容 。
3.2、 客 户 端 向 服 务 端 注 册Watcher的 时 候 ， 并 不 会 把 客 户 端 真 实 的Watcher对
象 实 体 传 递 到 服 务 端，仅 仅 是 在 客 户 端 请 求 中 使 用boolean类 型 属 性 进 行 了 标 记。

4 、watcherevent异 步 发 送watcher的 通 知 事 件 从server发 送 到client是 异 步
的，这 就 存 在 一 个 问 题，不 同 的 客 户 端 和 服 务 器 之 间 通 过socket进 行 通 信，由 于
网 络 延 迟 或 其 他 因 素 导 致 客 户 端 在 不 通 的 时 刻 监 听 到 事 件，由 于Zookeeper本 身
提 供 了orderingguarantee， 即 客 户 端 监 听 事 件 后 ， 才 会 感 知 它 所 监 视znode
发 生 了 变 化 。 所 以 我 们 使 用Zookeeper不 能 期 望 能 够 监 控 到 节 点 每 次 的 变 化 。
Zookeeper只 能 保 证 最 终 的 一 致 性 ， 而 无 法 保 证 强 一 致 性 。

5 、 注 册watchergetData、exists、getChildren

6 、 触 发watchercreate、delete、setData

7 、当 一 个 客 户 端 连 接 到 一 个 新 的 服 务 器 上 时，watch将 会 被 以 任 意 会 话 事 件 触 发。
当 与 一 个 服 务 器 失 去 连 接 的 时 候 ， 是 无 法 接 收 到watch的 。 而 当client重 新 连 接
时 ， 如 果 需 要 的 话 ， 所 有 先 前 注 册 过 的watch， 都 会 被 重 新 注 册 。 通 常 这 是 完 全
透 明 的 。 只 有 在 一 个 特 殊 情 况 下 ，watch可 能 会 丢 失 ： 对 于 一 个 未 创 建 的znode
的existwatch，如 果 在 客 户 端 断 开 连 接 期 间 被 创 建 了，并 且 随 后 在 客 户 端 连 接 上
之 前 又 删 除 了 ， 这 种 情 况 下 ， 这 个watch事 件 可 能 会 被 丢 失 。

### 7. 客户端注册Watcher实现..................................................................

1 、 调 用getData()/getChildren()/exist()三 个API， 传 入Watcher对 象
2 、 标 记 请 求request， 封 装Watcher到WatchRegistration
3 、 封 装 成Packet对 象 ， 发 服 务 端 发 送request
4 、 收 到 服 务 端 响 应 后 ， 将Watcher注 册 到ZKWatcherManager中 进 行 管 理
5 、 请 求 返 回 ， 完 成 注 册 。


### 8. 服务端处理Watcher实现..................................................................

1 、 **服 务 端 接 收Watcher并 存 储**
接 收 到 客 户 端 请 求 ， 处 理 请 求 判 断 是 否 需 要 注 册Watcher， 需 要 的 话 将 数 据 节 点
的 节 点 路 径 和ServerCnxn（ServerCnxn代 表 一 个 客 户 端 和 服 务 端 的 连 接 ， 实 现
了Watcher的process接 口 ， 此 时 可 以 看 成 一 个Watcher对 象 ） 存 储在
WatcherManager的WatchTable和watch2Paths中 去 。

2 、 **Watcher触 发**
以 服 务 端 接 收 到 setData() 事 务 请 求 触 发NodeDataChanged事 件 为 例 ：

2.1 封 装WatchedEvent
将 通 知 状 态 （SyncConnected） 、 事 件 类 型 （NodeDataChanged） 以 及 节 点 路
径 封 装 成 一 个WatchedEvent对 象

2.2 查 询Watcher
从WatchTable中 根 据 节 点 路 径 查 找Watcher

2.3 没 找 到 ； 说 明 没 有 客 户 端 在 该 数 据 节 点 上 注 册 过Watcher

2.4 找 到；提 取 并 从WatchTable和Watch2Paths中 删 除 对 应Watcher（ **从 这 里
可 以 看 出Watcher在 服 务 端 是 一 次 性 的 ， 触 发 一 次 就 失 效 了** ）

3 、 **调 用process方 法 来 触 发Watcher**
这里process主 要 就 是 通过ServerCnxn对 应的TCP连 接 发送Watcher事 件 通 知。

### 9. 客户端回调Watcher...........................................................................


客 户 端SendThread线 程 接 收 事 件 通 知 ， 交 由EventThread线 程 回 调Watcher。
客 户 端 的Watcher机 制 同 样 是 一 次 性 的 ， 一 旦 被 触 发 后 ， 该Watcher就 失 效 了。

### 10.ACL权限控制机制..............................................................................

**UGO（User/Group/Others）**

目 前 在Linux/Unix文 件 系 统 中 使 用，也 是 使 用 最 广 泛 的 权 限 控 制 方 式。是 一 种 粗
粒 度 的 文 件 系 统 权 限 控 制 模 式 。

**ACL（AccessControlList） 访 问 控 制 列 表**

**包 括 三 个 方 面** ：

**权 限 模 式 （Scheme）**

1 、IP： 从IP地 址 粒 度 进 行 权 限 控 制
2 、Digest： 最 常 用 ， 用 类 似 于 username:password 的 权 限 标 识 来 进 行 权 限 配
置 ， 便 于 区 分 不 同 应 用 来 进 行 权 限 控 制
3 、World：最 开 放 的 权 限 控 制 方 式，是 一 种 特 殊 的digest模 式，只 有 一 个 权 限 标
识“world:anyone”
4 、Super： 超 级 用 户

**授 权 对 象**

授 权 对 象 指 的 是 权 限 赋 予 的 用 户 或 一 个 指 定 实 体 ， 例 如IP地 址 或 是 机 器 灯 。

**权 限 Permission**

1 、 **CREATE** ： 数 据 节 点 创 建 权 限 ， 允 许 授 权 对 象 在 该Znode下 创 建 子 节 点


#### 2 、 DELETE ： 子 节 点 删 除 权 限 ， 允 许 授 权 对 象 删 除 该 数 据 节 点 的 子 节 点

#### 3 、 READ ： 数 据 节 点 的 读 取 权 限 ， 允 许 授 权 对 象 访 问 该 数 据 节 点 并 读 取 其 数 据 内

#### 容 或 子 节 点 列 表 等

#### 4 、 WRITE ： 数 据 节 点 更 新 权 限 ， 允 许 授 权 对 象 对 该 数 据 节 点 进 行 更 新 操 作

#### 5 、 ADMIN ：数 据 节 点 管 理 权 限，允 许 授 权 对 象 对 该 数 据 节 点 进 行ACL相 关 设 置

#### 操 作

### 11.Chroot特性.........................................................................................

3.2.0版 本 后，添 加 了 Chroot特 性，该 特 性 允 许 每 个 客 户 端 为 自 己 设 置 一 个 命 名
空 间。如 果 一 个 客 户 端 设 置 了Chroot，那 么 该 客 户 端 对 服 务 器 的 任 何 操 作，都 将
会 被 限 制 在 其 自 己 的 命 名 空 间 下 。

通 过 设 置Chroot， 能 够 将 一 个 客 户 端 应 用 于Zookeeper服 务 端 的 一 颗 子 树 相 对
应，在 那 些 多 个 应 用 公 用 一 个Zookeeper进 群 的 场 景 下，对 实 现 不 同 应 用 间 的 相
互 隔 离 非 常 有 帮 助 。

### 12. 会话管理..............................................................................................

**分 桶 策 略** ：将 类 似 的 会 话 放 在 同 一 区 块 中 进 行 管 理，以 便 于Zookeeper对 会 话 进
行 不 同 区 块 的 隔 离 处 理 以 及 同 一 区 块 的 统 一 处 理 。

**分 配 原 则** ： 每 个 会 话 的“下 次 超 时 时 间 点”（ExpirationTime）

**计 算 公 式** ：

ExpirationTime_=currentTime+sessionTimeout


ExpirationTime=(ExpirationTime_/ExpirationInrerval+1)*
ExpirationInterval,ExpirationInterval 是指 Zookeeper会话超时检查时间
间隔，默认 tickTime

### 13. 服务器角色..........................................................................................

**Leader**

#### 1 、 事 务 请 求 的 唯 一 调 度 和 处 理 者 ， 保 证 集 群 事 务 处 理 的 顺 序 性

#### 2 、 集 群 内 部 各 服 务 的 调 度 者

**Follower**

1 、 处 理 客 户 端 的 非 事 务 请 求 ， 转 发 事 务 请 求 给Leader服 务 器
2 、 参 与 事 务 请 求Proposal的 投 票
3 、 参 与Leader选 举 投 票

**Observer**

1 、3.0版 本 以 后 引 入 的 一 个 服 务 器 角 色 ， 在 不 影 响 集 群 事 务 处 理 能 力 的 基 础 上 提
升 集 群 的 非 事 务 处 理 能 力
2 、 处 理 客 户 端 的 非 事 务 请 求 ， 转 发 事 务 请 求 给Leader服 务 器
3 、 不 参 与 任 何 形 式 的 投 票

### 14.Zookeeper 下 Server工作状态.....................................................

#### 服 务 器 具 有 四 种 状 态，分 别 是LOOKING、FOLLOWING、LEADING、OBSERVING。


1 、 **LOOKING** ：寻 找Leader状 态。当 服 务 器 处 于 该 状 态 时，它 会 认 为 当 前 集 群 中
没 有Leader， 因 此 需 要 进 入Leader选 举 状 态 。
2 、 **FOLLOWING** ： 跟 随 者 状 态 。 表 明 当 前 服 务 器 角 色 是Follower。
3 、 **LEADING** ： 领 导 者 状 态 。 表 明 当 前 服 务 器 角 色 是Leader。
4 、 **OBSERVING** ： 观 察 者 状 态 。 表 明 当 前 服 务 器 角 色 是Observer。

### 15. 数据同步..............................................................................................

整 个 集 群 完 成Leader选 举 之 后 ，Learner（Follower和Observer的 统 称 ） 回向
Leader服 务 器 进 行 注 册 。 当Learner服 务 器 想Leader服 务 器 完 成 注 册 后 ， 进 入
数 据 同 步 环 节 。

数 据 同 步 流 程 ： （ 均 以 消 息 传 递 的 方 式 进 行 ）

Learner向Learder注 册

数 据 同 步

同 步 确 认

**Zookeeper的 数 据 同 步 通 常 分 为 四 类** ：

#### 1 、 直 接 差 异 化 同 步 （DIFF同 步 ）

#### 2 、 先 回 滚 再 差 异 化 同 步 （TRUNC+DIFF同 步 ）

#### 3 、 仅 回 滚 同 步 （TRUNC同 步 ）

#### 4 、 全 量 同 步 （SNAP同 步 ）

在 进 行 数 据 同 步 前 ，Leader服 务 器 会 完 成 数 据 同 步 初 始 化 ：

peerLastZxid：


 从learner服务器注册时发送的ACKEPOCH消息中提取lastZxid（该
Learner服务器最后处理的ZXID）

```
minCommittedLog：
```

 Leader服务器Proposal缓存队列committedLog中最小ZXID

```
maxCommittedLog：
```

 Leader服务器Proposal缓存队列committedLog中最大ZXID

#### 直 接 差 异 化 同 步 （DIFF同 步 ）

 **场景** ：peerLastZxid介于minCommittedLog和maxCommittedLog
之间

#### 先 回 滚 再 差 异 化 同 步 （TRUNC+DIFF同 步 ）

 **场景** ：当新的Leader服务器发现某个Learner服务器包含了一条自己没
有的事务记录，那么就需要让该Learner服务器进行事务回滚--回滚到Leader
服务器上存在的，同时也是最接近于peerLastZxid的ZXID

#### 仅 回 滚 同 步 （TRUNC同 步 ）


 **场景** ：peerLastZxid 大于 maxCommittedLog

#### 全 量 同 步 （SNAP同 步 ）

 **场景一** ：peerLastZxid 小于 minCommittedLog
 **场景二** ：Leader服务器上没有Proposal缓存队列且peerLastZxid不等
于lastProcessZxid

### 16.zookeeper是如何保证事务的顺序一致性的？..............................

```
zookeeper采 用 了 全 局 递 增 的 事 务Id来 标 识 ， 所 有 的proposal（ 提 议 ） 都 在 被
提 出 的 时 候 加 上 了zxid，zxid实 际 上 是 一 个 64 位 的 数 字，高 32 位 是epoch（时
期; 纪 元; 世; 新 时 代）用 来 标识leader周 期，如 果 有 新的leader产 生 出 来，epoch
会 自 增 ， 低 32 位 用 来 递 增 计 数 。 当 新 产 生proposal的 时 候 ， 会 依 据 数 据 库 的 两
阶 段 过 程 ， 首 先 会 向 其 他 的server发 出 事 务 执 行 请 求 ， 如 果 超 过 半 数 的 机 器 都 能
执 行 并 且 能 够 成 功 ， 那 么 就 会 开 始 执 行 。
```

### 17. 分布式集群中为什么会有Master？................................................

#### 在 分 布 式 环 境 中 ， 有 些 业 务 逻 辑 只 需 要 集 群 中 的 某 一 台 机 器 进 行 执 行 ， 其 他 的 机

#### 器 可 以 共 享 这 个 结 果 ， 这 样 可 以 大 大 减 少 重 复 计 算 ， 提 高 性 能 ， 于 是 就 需 要 进行

```
leader选 举 。
```

### 18.zk节点宕机如何处理？......................................................................


Zookeeper本 身 也 是 集 群，推 荐 配 置 不 少 于 3 个 服 务 器。Zookeeper自 身 也 要 保
证 当 一 个 节 点 宕 机 时 ， 其 他 节 点 会 继 续 提 供 服 务 。
如 果 是 一 个Follow er宕 机 ， 还 有 2 台 服 务 器 提 供 访 问 ， 因 为Zookeeper上 的 数
据 是 有 多 个 副 本 的 ， 数 据 并 不 会 丢 失 ；
如 果 是 一 个Leader宕 机 ，Zookeeper会 选 举 出 新 的Leader。
ZK集 群 的 机 制 是 只 要 超 过 半 数 的 节 点 正 常 ， 集 群 就 能 正 常 提 供 服 务 。 只 有 在ZK
节 点 挂 得 太 多 ， 只 剩 一 半 或 不 到 一 半 节 点 能 工 作 ， 集 群 才 失 效 。
所 以
3 个 节 点 的cluster可 以 挂 掉 1 个 节 点(leader可 以 得 到 2 票>1.5)
2 个 节 点 的cluster就 不 能 挂 掉 任 何 1 个 节 点 了(leader可 以 得 到 1 票<=1)

### 19.zookeeper负载均衡和nginx负载均衡区别.................................

zk的 负 载 均 衡 是 可 以 调 控 ，nginx只 是 能 调 权 重 ， 其 他 需 要 可 控 的 都 需 要 自 己 写
插 件 ； 但 是nginx的 吞 吐 量 比zk大 很 多 ， 应 该 说 按 业 务 选 择 用 哪 种 方 式 。

### 20.Zookeeper有哪几种几种部署模式？.............................................

#### 部 署 模 式 ： 单 机 模 式 、 伪 集 群 模 式 、 集 群 模 式 。

### 21. 集群最少要几台机器，集群规则是怎样的?....................................

#### 集 群 规 则 为2N +1台 ，N>0， 即 3 台 。

### 22. 集群支持动态添加机器吗？..............................................................

其 实 就 是 水 平 扩 容 了 ，Zookeeper在 这 方 面 不 太 好 。 两 种 方 式 ：


**全 部 重 启** ：关 闭 所 有Zookeeper服 务，修 改 配 置 之 后 启 动。不 影 响 之 前 客 户 端 的
会 话 。

**逐 个 重 启** ： 在 过 半 存 活 即 可 用 的 原 则 下 ， 一 台 机 器 重 启 不 影 响 整 个 集 群 对 外 提 供
服 务 。 这 是 比 较 常 用 的 方 式 。

3.5版 本 开 始 支 持 动 态 扩 容 。

### 23.Zookeeper对节点的watch监听通知是永久的吗？为什么

### 不是永久的?

不 是 。 官 方 声 明 ： 一 个Watch事 件 是 一 个 一 次 性 的 触 发 器 ， 当 被 设 置 了Watch
的 数 据 发 生 了 改 变 的 时 候 ， 则 服 务 器 将 这 个 改 变 发 送 给 设 置 了Watch的 客 户 端，
以 便 通 知 它 们 。

为 什 么 不 是 永 久 的 ， 举 个 例 子 ， 如 果 服 务 端 变 动 频 繁 ， 而 监 听 的 客 户 端 很 多 情 况
下 ， 每 次 变 动 都 要 通 知 到 所 有 的 客 户 端 ， 给 网 络 和 服 务 器 造 成 很 大 压 力 。
一 般 是 客 户 端 执 行getData(“/节 点A”,true)， 如 果 节 点A发 生 了 变 更 或 删 除，
客 户 端 会 得 到 它 的watch事 件，但 是 在 之 后 节 点A又 发 生 了 变 更，而 客 户 端 又 没
有 设 置watch事 件 ， 就 不 再 给 客 户 端 发 送 。
在 实 际 应 用 中 ， 很 多 情 况 下 ， 我 们 的 客 户 端 不 需 要 知 道 服 务 端 的 每 一 次 变 动 ， 我
只 要 最 新 的 数 据 即 可 。

### 24.Zookeeper的java客户端都有哪些？............................................

java客 户 端 ：zk自 带 的zkclient及Apache开 源 的Curator。


### 25.chubby是什么，和zookeeper比你怎么看？..............................

chubby是google的 ， 完 全 实 现paxos算 法 ， 不 开 源 。zookeeper是chubby
的 开 源 实 现 ， 使 用zab协 议 ，paxos算 法 的 变 种 。

### 26. 说几个zookeeper常用的命令。....................................................

常 用 命 令 ：lsgetsetcreatedelete等 。

### 27.ZAB和Paxos算法的联系与区别？.................................................

#### 相 同 点 ：

1 、两 者 都 存 在 一 个 类 似 于Leader进 程 的 角 色，由 其 负 责 协 调 多 个Follower进 程
的 运 行
2 、Leader进 程 都 会 等 待 超 过 半 数 的Follower做 出 正 确 的 反 馈 后，才 会 将 一 个 提
案 进 行 提 交
3 、ZAB协 议 中 ， 每 个Proposal中 都 包 含 一 个 epoch 值 来 代 表 当 前 的Leader
周 期 ，Paxos中 名 字 为Ballot

#### 不 同 点 ：

ZAB用 来 构 建 高 可 用 的 分 布 式 数 据 主 备 系 统 （Zookeeper） ，Paxos是 用 来 构 建
分 布 式 一 致 性 状 态 机 系 统 。

### 28.Zookeeper的典型应用场景.............................................................


Zookeeper是 一 个 典 型 的 发 布/订 阅 模 式 的 分 布 式 数 据 管 理 与 协 调 框 架，开 发 人 员
可 以 使 用 它 来 进 行 分 布 式 数 据 的 发 布 和 订 阅 。

通 过 对Zookeeper中 丰 富 的 数 据 节 点 进 行 交 叉 使 用 ， 配 合Watcher事 件 通 知 机
制 ， 可 以 非 常 方 便 的 构 建 一 系 列 分 布 式 应 用 中 年 都 会 涉 及 的 核 心 功 能 ， 如 ：

1 、 数 据 发 布/订 阅
2 、 负 载 均 衡
3 、 命 名 服 务
4 、 分 布 式 协 调/通 知
5 、 集 群 管 理
6 、Master选 举
7 、 分 布 式 锁
8 、 分 布 式 队 列

#### 1. 数 据 发 布/订 阅

#### 介 绍

#### 数 据 发 布/订 阅 系 统 ， 即 所 谓 的 配 置 中 心 ， 顾 名 思 义 就 是 发 布 者 发 布 数 据 供 订 阅 者

#### 进 行 数 据 订 阅 。

#### 目 的

#### 动 态 获 取 数 据 （ 配 置 信 息 ）

#### 实 现 数 据 （ 配 置 信 息 ） 的 集 中 式 管 理 和 数 据 的 动 态 更 新

#### 设 计 模 式

Push 模 式
Pull 模 式


#### 数 据 （ 配 置 信 息 ） 特 性

#### 1 、 数 据 量 通 常 比 较 小

#### 2 、 数 据 内 容 在 运 行 时 会 发 生 动 态 更 新

#### 3 、 集 群 中 各 机 器 共 享 ， 配 置 一 致

#### 如 ： 机 器 列 表 信 息 、 运 行 时 开 关 配 置 、 数 据 库 配 置 信 息 等

```
基 于Zookeeper的 实 现 方 式
```

 **数据存储** ：将数据（配置信息）存储到Zookeeper上的一个数据节点
 **数据获取** ：应用在启动初始化节点从Zookeeper数据节点读取数据，并
在该节点上注册一个数据变更Watcher
 **数据变更** ：当变更数据时，更新Zookeeper对应节点数据，Zookeeper
会将数据变更通知发到各客户端，客户端接到通知后重新读取变更后的数据即
可。

#### 2. 负 载 均 衡

```
zk的 命 名 服 务
```

```
命 名 服 务 是 指 通 过 指 定 的 名 字 来 获 取 资 源 或 者 服 务 的 地 址，利 用zk创 建 一 个 全 局
的 路 径，这 个 路 径 就 可 以 作 为 一 个 名 字，指 向 集 群 中 的 集 群，提 供 的 服 务 的 地 址，
或 者 一 个 远 程 的 对 象 等 等 。
```

```
分 布 式 通 知 和 协 调
```

```
对 于 系 统 调 度 来 说 ： 操 作 人 员 发 送 通 知 实 际 是 通 过 控 制 台 改 变 某 个 节 点 的 状 态 ，
然 后zk将 这 些 变 化 发 送 给 注 册 了 这 个 节 点 的watcher的 所 有 客 户 端 。
```

#### 对 于 执 行 情 况 汇 报 ： 每 个 工 作 进 程 都 在 某 个 目 录 下 创 建 一 个 临 时 节 点 。 并 携 带 工

#### 作 的 进 度 数 据 ， 这 样 汇 总 的 进 程 可 以 监 控 目 录 子 节 点 的 变 化 获 得 工 作 进 度 的 实 时

#### 的 全 局 情 况 。

**zk的 命 名 服 务 （ 文 件 系 统 ）**

命 名 服 务 是 指 通 过 指 定 的 名 字 来 获 取 资 源 或 者 服 务 的 地 址，利 用zk创 建 一 个 全 局
的 路 径 ， 即 是 唯 一 的 路 径 ， 这 个 路 径 就 可 以 作 为 一 个 名 字 ， 指 向 集 群 中 的 集 群 ，
提 供 的 服 务 的 地 址 ， 或 者 一 个 远 程 的 对 象 等 等 。

**zk的 配 置 管 理 （ 文 件 系 统 、 通 知 机 制 ）**

程 序 分 布 式 的 部 署 在 不 同 的 机 器 上，将 程 序 的 配 置 信 息 放 在zk的znode下，当 有
配 置 发 生 改 变 时，也 就 是znode发 生 变 化 时，可 以 通 过 改 变zk中 某 个 目 录 节 点 的
内 容 ， 利 用watcher通 知 给 各 个 客 户 端 ， 从 而 更 改 配 置 。

**Zookeeper集 群 管 理 （ 文 件 系 统 、 通 知 机 制 ）**

所 谓 集 群 管 理 无 在 乎 两 点 ： 是 否 有 机 器 退 出 和 加 入 、 选 举master。
对 于 第 一 点 ， 所 有 机 器 约 定 在 父 目 录 下 创 建 临 时 目 录 节 点 ， 然 后 监 听 父 目 录 节 点
的 子 节 点 变 化 消 息。一 旦 有 机 器 挂 掉，该 机 器 与 zookeeper的 连 接 断 开，其 所 创
建 的 临 时 目 录 节 点 被 删 除 ， 所 有 其 他 机 器 都 收 到 通 知 ： 某 个 兄 弟 目 录 被 删 除 ， 于
是 ， 所 有 人 都 知 道 ： 它 上 船 了 。
新 机 器 加 入 也 是 类 似，所 有 机 器 收 到 通 知：新 兄 弟 目 录 加 入，highcount又 有 了，
对 于 第 二 点 ， 我 们 稍 微 改 变 一 下 ， 所 有 机 器 创 建 临 时 顺 序 编 号 目 录 节 点 ， 每 次 选
取 编 号 最 小 的 机 器 作 为master就 好 。

**Zookeeper分 布 式 锁 （ 文 件 系 统 、 通 知 机 制 ）**

有 了zookeeper的 一 致 性 文 件 系 统 ， 锁 的 问 题 变 得 容 易 。 锁 服 务 可 以 分 为 两 类，
一 个 是 保 持 独 占 ， 另 一 个 是 控 制 时 序 。


对 于 第 一 类，我 们将zookeeper上 的 一个znode看 作 是 一 把 锁，通过createznode
的 方 式 来 实 现。所 有 客 户 端 都 去 创 建 /distribute_lock 节 点，最 终 成 功 创 建 的 那
个 客 户 端 也 即 拥 有 了 这 把 锁。用 完 删 除 掉 自 己 创 建 的distribute_lock 节 点 就 释 放
出 锁 。
对 于 第 二 类， /distribute_lock 已 经 预 先 存 在，所 有 客 户 端 在 它 下 面 创 建 临 时 顺
序 编 号 目 录 节 点 ， 和 选master一 样 ， 编 号 最 小 的 获 得 锁 ， 用 完 删 除 ， 依 次 方 便。

**Zookeeper队 列 管 理 （ 文 件 系 统 、 通 知 机 制 ）**

#### 两 种 类 型 的 队 列 ：

#### 1 、同 步 队 列，当 一 个 队 列 的 成 员 都 聚 齐 时，这 个 队 列 才 可 用，否 则 一 直 等 待 所 有

#### 成 员 到 达 。

#### 2 、 队 列 按 照 FIFO 方 式 进 行 入 队 和 出 队 操 作 。

#### 第 一 类，在 约 定 目 录 下 创 建 临 时 目 录 节 点，监 听 节 点 数 目 是 否 是 我 们 要 求 的 数 目。

#### 第 二 类 ， 和 分 布 式 锁 服 务 中 的 控 制 时 序 场 景 基 本 原 理 一 致 ， 入 列 有 编 号 ， 出 列 按

#### 编 号 。 在 特 定 的 目 录 下 创 建PERSISTENT_SEQUENTIAL节 点 ， 创 建 成 功时

Watcher通 知 等 待 的 队 列 ， 队 列 删 除 序 列 号 最 小 的 节 点 用 以 消 费 。 此 场 景下
Zookeeper的znode用 于 消 息 存 储，znode存 储 的 数 据 就 是 消 息 队 列 中 的 消 息 内
容 ，SEQUENTIAL序 列 号 就 是 消 息 的 编 号 ， 按 序 取 出 即 可 。 由 于 创 建 的 节 点 是 持
久 化 的 ， 所 以 不 必 担 心 队 列 消 息 的 丢 失 问 题 。

## Dubbo面试题..........................................................................................................

### 1 、为什么要用Dubbo？.........................................................................


#### 随 着 服 务 化 的 进 一 步 发 展 ， 服 务 越 来 越 多 ， 服 务 之 间 的 调 用 和 依 赖 关 系 也 越 来 越

#### 复 杂 ， 诞 生 了 面 向 服 务 的 架 构 体 系(SOA)，

#### 也 因 此 衍 生 出 了 一 系 列 相 应 的 技 术 ， 如 对 服 务 提 供 、 服 务 调 用 、 连 接 处 理 、 通 信

#### 协 议、序 列 化 方 式、服 务 发 现、服 务 路 由、日 志 输 出 等 行 为 进 行 封 装 的 服 务 框 架。

就 这 样 为 分 布 式 系 统 的 服 务 治 理 框 架 就 出 现 了 ，Dubbo也 就 这 样 产 生 了 。

### 2 、Dubbo的整体架构设计有哪些分层?..............................................

**接 口 服 务 层（Service）** ：该 层 与 业 务 逻 辑 相 关，根 据 provider 和 consumer 的
业 务 设 计 对 应 的 接 口 和 实 现

**配 置 层（Config）** ：对 外 配 置 接 口，以 ServiceConfig 和 ReferenceConfig 为
中 心

**服 务 代 理 层（Proxy）** ：服 务 接 口 透 明 代 理，生 成 服 务 的 客 户 端 Stub 和 服 务 端
的 Skeleton， 以 ServiceProxy 为 中 心 ， 扩 展 接 口 为 ProxyFactory

**服 务 注 册 层 （Registry）** ： 封 装 服 务 地 址 的 注 册 和 发 现 ， 以 服 务 URL 为 中 心 ，
扩 展 接 口 为 RegistryFactory、Registry、RegistryService

**路 由 层 （Cluster）** ： 封 装 多 个 提 供 者 的 路 由 和 负 载 均 衡 ， 并 桥 接 注 册 中 心 ，以
Invoker 为 中 心 ， 扩 展 接 口 为 Cluster、Directory、Router和LoadBlancce

**监 控 层（Monitor）** ：RPC调 用 次 数 和 调 用 时 间 监 控，以 Statistics 为 中 心，扩
展 接 口 为 MonitorFactory、Monitor和MonitorService

**远 程 调 用 层（Protocal）** ：封 装 RPC 调 用，以 Invocation 和 Result 为 中 心，
扩 展 接 口 为 Protocal、Invoker和Exporter


**信 息 交 换 层 （Exchange** ） ： 封 装 请 求 响 应 模 式 ， 同 步 转 异 步 。 以 Request 和
Response 为 中 心 ， 扩 展 接 口 为 Exchanger、ExchangeChannel、
ExchangeClient和ExchangeServer

**网 络 传 输 层（Transport）** ：抽 象 mina 和 netty 为 统 一 接 口，以 Message 为
中 心 ， 扩 展 接 口 为Channel、Transporter、Client、Server和Codec

**数 据 序 列 化 层 （Serialize）** ： 可 复 用 的 一 些 工 具 ， 扩 展 接 口 为Serialization、
ObjectInput、ObjectOutput和ThreadPool

### 3 、默认使用的是什么通信框架，还有别的选择吗?.............................

默 认 也 推 荐 使 用netty框 架 ， 还 有mina。

### 4 、服务调用是阻塞的吗？.......................................................................

#### 默 认 是 阻 塞 的 ， 可 以 异 步 调 用 ， 没 有 返 回 值 的 可 以 这 么 做 。

Dubbo 是 基 于 NIO 的 非 阻 塞 实 现 并 行 调 用，客 户 端 不 需 要 启 动 多 线 程 即 可 完 成
并 行 调 用 多 个 远 程 服 务 ， 相 对 多 线 程 开 销 较 小 ， 异 步 调 用 会 返 回 一 个 Future 对
象 。

### 5 、一般使用什么注册中心？还有别的选择吗？...................................

推 荐 使 用 Zookeeper 作 为 注 册 中 心，还 有 Redis、Multicast、Simple 注 册 中
心 ， 但 不 推 荐 。


### 6 、默认使用什么序列化框架，你知道的还有哪些？...........................

推 荐 使 用Hessian序 列 化 ， 还 有Duddo、FastJson、Java自 带 序 列 化 。

### 7 、服务提供者能实现失效踢出是什么原理？.......................................

服 务 失 效 踢 出 基 于zookeeper的 临 时 节 点 原 理 。

### 8 、服务上线怎么不影响旧版本？...........................................................

#### 采 用 多 版 本 开 发 ， 不 影 响 旧 版 本 。

### 9 、如何解决服务调用链过长的问题？...................................................

可 以 结 合zipkin实 现 分 布 式 服 务 追 踪 。

### 10 、说说核心的配置有哪些？.................................................................

#### 配置 配置说明

dubbo:service 服务配置

dubbo:reference 引用配置

dubbo:protocol 协议配置

dubbo:applicatio
n

#### 应用配置


```
dubbo:module 模块配置
```

```
dubbo:registry 注册中心配置
dubbo:monitor 监控中心配置
```

```
dubbo:provider 提供方配置
dubbo:consumer 消费方配置
```

```
dubbo:method 方法配置
dubbo:argument 参数配置
```

### 11 、Dubbo推荐用什么协议？..............................................................

 dubbo://（推荐）
 rmi://
 hessian://
 [http://](http://)
 webservice://
 thrift://
 memcached://
 redis://
 rest://

### 12 、同一个服务多个注册的情况下可以直连某一个服务吗？.............

```
可 以 点 对 点 直 连 ， 修 改 配 置 即 可 ， 也 可 以 通 过telnet直 接 某 个 服 务 。
```

### 13 、画一画服务注册与发现的流程图？.................................................

### 14 、Dubbo集群容错有几种方案？......................................................

#### 集群容错方案 说明

FailoverCluster 失败自动切换，自动重试其它服务器（默认）

FailfastCluster 快速失败，立即报错，只发起一次调用

FailsafeCluster 失败安全，出现异常时，直接忽略

FailbackCluster 失败自动恢复，记录失败请求，定时重发

ForkingCluster 并行调用多个服务器，只要一个成功即返回


BroadcastCluster 广播逐个调用所有提供者，任意一个报错则报错

### 15 、Dubbo服务降级，失败重试怎么做？..........................................

可 以 通 过dubbo:reference 中 设 置 mock="returnnull"。mock 的 值 也 可 以 修
改 为 true，然 后 再 跟 接 口 同 一 个 路 径 下 实 现 一 个 Mock 类，命 名 规 则 是 “接 口
名 称+Mock” 后 缀 。 然 后 在 Mock 类 里 实 现 自 己 的 降 级 逻 辑

### 16 、Dubbo使用过程中都遇到了些什么问题？..................................

在 注 册 中 心 找 不 到 对 应 的 服 务,检 查service实 现 类 是 否 添 加 了@service注 解
无 法 连 接 到 注 册 中 心,检 查 配 置 文 件 中 的 对 应 的 测 试ip是 否 正 确

### 17 、DubboMonitor 实现原理？.........................................................

Consumer端 在 发 起 调 用 之 前 会 先 走filter链 ；provider端 在 接 收 到 请 求 时 也 是
先 走filter链 ， 然 后 才 进 行 真 正 的 业 务 逻 辑 处 理 。

默 认 情 况 下 ， 在consumer和provider的filter链 中 都 会 有Monitorfilter。

1 、MonitorFilter向DubboMonitor发 送 数 据
2 、DubboMonitor将 数 据 进 行 聚 合 后 （ 默 认 聚 合1min中 的 统 计 数 据 ） 暂 存到
ConcurrentMap<Statistics,AtomicReference>statisticsMap， 然 后 使 用 一 个
含 有 3 个 线 程（线 程 名 字：DubboMonitorSendTimer）的 线 程 池 每 隔1min钟，
调 用SimpleMonitorService遍 历 发 送statisticsMap中 的 统 计 数 据，每 发 送 完 毕
一 个 ， 就 重 置 当 前 的Statistics的AtomicReference
3 、SimpleMonitorService将 这 些 聚 合 数 据 塞 入BlockingQueuequeue中 （ 队
列 大 写 为 100000 ）


4 、SimpleMonitorService使 用 一 个 后 台 线 程 （ 线 程 名 为 ：
DubboMonitorAsyncWriteLogThread）将queue中 的 数 据 写 入 文 件（该 线 程 以
死 循 环 的 形 式 来 写 ）
5 、SimpleMonitorService还 会 使 用 一 个 含 有 1 个 线 程 （ 线 程 名 字 ：
DubboMonitorTimer） 的 线 程 池 每 隔5min钟 ， 将 文 件 中 的 统 计 数 据 画 成 图 表

### 18 、Dubbo用到哪些设计模式？..........................................................

Dubbo框 架 在 初 始 化 和 通 信 过 程 中 使 用 了 多 种 设 计 模 式 ， 可 灵 活 控 制 类 加 载 、 权
限 控 制 等 功 能 。

**工 厂 模 式**
Provider在export服 务 时，会 调用ServiceConfig的export方 法。ServiceConfig
中 有 个 字 段 ：

privatestaticfinalProtocolprotocol=
ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtensi
on();

Dubbo里 有 很 多 这 种 代 码。这 也 是 一 种 工 厂 模 式，只 是 实 现 类 的 获 取 采 用 了JDK
SPI的 机 制 。 这 么 实 现 的 优 点 是 可 扩 展 性 强 ， 想 要 扩 展 实 现 ， 只 需 要 在classpath
下 增 加 个 文 件 就 可 以 了，代 码 零 侵 入。另 外，像 上 面 的Adaptive实 现，可 以 做 到
调 用 时 动 态 决 定 调 用 哪 个 实 现 ， 但 是 由 于 这 种 实 现 采 用 了 动 态 代 理 ， 会 造 成 代 码
调 试 比 较 麻 烦 ， 需 要 分 析 出 实 际 调 用 的 实 现 类 。

**装 饰 器 模 式**
Dubbo在 启 动 和 调 用 阶 段 都 大 量 使 用 了 装 饰 器 模 式。以Provider提 供 的 调 用 链 为
例 ， 具 体 的 调 用 链 代 码 是 在ProtocolFilterWrapper的buildInvokerChain完 成
的 ， 具 体 是 将 注 解 中 含 有group=provider的Filter实 现 ， 按 照order排 序 ， 最
后 的 调 用 顺 序 是 ：


EchoFilter->ClassLoaderFilter->GenericFilter->ContextFilter->
ExecuteLimitFilter->TraceFilter->TimeoutFilter->MonitorFilter->
ExceptionFilter

更 确 切 地 说，这 里 是 装 饰 器 和 责 任 链 模 式 的 混 合 使 用。例 如，EchoFilter的 作 用 是
判 断 是 否 是 回 声 测 试 请 求 ， 是 的 话 直 接 返 回 内 容 ， 这 是 一 种 责 任 链 的 体 现 。 而像
ClassLoaderFilter则 只 是 在 主 功 能 上 添 加 了 功 能，更 改 当 前 线 程 的ClassLoader，
这 是 典 型 的 装 饰 器 模 式 。

**观 察 者 模 式**
Dubbo的Provider启 动 时，需 要 与 注 册 中 心 交 互，先 注 册 自 己 的 服 务，再 订 阅 自
己 的 服 务，订 阅 时，采 用 了 观 察 者 模 式，开 启 一 个listener。注 册 中 心 会 每 5 秒 定
时 检 查 是 否 有 服 务 更 新 ， 如 果 有 更 新 ， 向 该 服 务 的 提 供 者 发 送 一 个notify消 息 ，
provider接 受 到notify消 息 后 ， 即 运 行NotifyListener的notify方 法 ， 执 行 监
听 器 方 法 。

**动 态 代 理 模 式**
Dubbo扩展JDKSPI的类ExtensionLoader的Adaptive实 现 是 典 型 的 动 态 代 理
实 现 。Dubbo需 要 灵 活 地 控 制 实 现 类 ， 即 在 调 用 阶 段 动 态 地 根 据 参 数 决 定 调 用 哪
个 实 现 类 ， 所 以 采 用 先 生 成 代 理 类 的 方 法 ， 能 够 做 到 灵 活 的 调 用 。 生 成 代 理 类 的
代 码 是ExtensionLoader的createAdaptiveExtensionClassCode方 法。代 理 类
的 主 要 逻 辑 是 ， 获 取URL参 数 中 指 定 参 数 的 值 作 为 获 取 实 现 类 的key。

### 19 、Dubbo配置文件是如何加载到Spring中的？...........................

Spring容 器 在 启 动 的 时 候，会 读 取 到Spring默 认 的 一 些schema以 及Dubbo自
定 义 的schema， 每 个schema都 会 对 应 一 个 自 己 的NamespaceHandler，
NamespaceHandler里 面 通 过BeanDefinitionParser来 解 析 配 置 信 息 并 转 化 为
需 要 加 载 的bean对 象 ！


### 20 、DubboSPI 和 JavaSPI 区别？...................................................

#### JDKSPI

#### JDK 标 准 的 SPI 会 一 次 性 加 载 所 有 的 扩 展 实 现，如 果 有 的 扩 展 吃 实 话 很 耗 时，但

#### 也 没 用 上 ， 很 浪 费 资 源 。

#### 所 以 只 希 望 加 载 某 个 的 实 现 ， 就 不 现 实 了

#### DUBBOSPI

1 ， 对Dubbo进 行 扩 展 ， 不 需 要 改 动Dubbo的 源 码
2 ， 延 迟 加 载 ， 可 以 一 次 只 加 载 自 己 想 要 加 载 的 扩 展 实 现 。
3 ， 增 加 了 对 扩 展 点 IOC 和 AOP 的 支 持 ， 一 个 扩 展 点 可 以 直 接 setter 注 入 其
它 扩 展 点 。
3 ，Dubbo的 扩 展 机 制 能 很 好 的 支 持 第 三 方IoC容 器 ， 默 认 支 持SpringBean。

### 21 、Dubbo支持分布式事务吗？..........................................................

目 前 暂 时 不 支 持 ， 可 与 通 过 tcc-transaction框 架 实 现

介 绍 ：tcc-transaction是 开 源 的TCC补 偿 性 分 布 式 事 务 框 架

Git地 址 ：https://github.com/changmingxie/tcc-transaction

TCC-Transaction 通 过 Dubbo 隐 式 传 参 的 功 能 ， 避 免 自 己 对 业 务 代 码 的 入 侵。

### 22 、Dubbo可以对结果进行缓存吗？..................................................


为 了 提 高 数 据 访 问 的 速 度 。Dubbo提 供 了 声 明 式 缓 存 ， 以 减 少 用 户 加 缓 存 的 工 作
量

<dubbo:reference cache="true"/>

其 实 比 普 通 的 配 置 文 件 就 多 了 一 个 标 签 cache="true"

### 23 、服务上线怎么兼容旧版本？.............................................................

可 以 用 版 本 号 （version） 过 渡 ， 多 个 不 同 版 本 的 服 务 注 册 到 注 册 中 心 ， 版 本 号 不
同 的 服 务 相 互 间 不 引 用 。 这 个 和 服 务 分 组 的 概 念 有 一 点 类 似 。

### 24 、Dubbo必须依赖的包有哪些？.......................................................

Dubbo 必 须 依 赖 JDK， 其 他 为 可 选 。

### 25 、Dubbotelnet 命令能做什么？......................................................

dubbo服 务 发 布 之 后 ， 我 们 可 以 利 用telnet命 令 进 行 调 试 、 管 理 。
Dubbo2.0.5以 上 版 本 服 务 提 供 端 口 支 持telnet命 令

**连 接 服 务**
telnetlocalhost 20880 //键 入 回 车 进 入Dubbo命 令 模 式 。

**查 看 服 务 列 表**

dubbo>ls
com.test.TestService


```
dubbo>lscom.test.TestService
create
delete
query
```

 ls(listservicesandmethods)
 ls: 显示服务列表。
 ls-l: 显示服务详细信息列表。
 lsXxxService：显示服务的方法列表。
 ls-lXxxService：显示服务的方法详细信息列表。

### 26 、Dubbo支持服务降级吗？..............................................................

```
以 通 过dubbo:reference 中 设 置 mock="returnnull"。mock 的 值 也 可 以 修 改
为 true，然 后 再 跟 接 口 同 一 个 路 径 下 实 现 一 个 Mock 类，命 名 规 则 是 “接 口 名
称+Mock” 后 缀 。 然 后 在 Mock 类 里 实 现 自 己 的 降 级 逻 辑
```

### 27 、Dubbo如何优雅停机？..................................................................

```
Dubbo 是 通 过 JDK 的 ShutdownHook 来 完 成 优 雅 停 机 的 ， 所 以 如 果 使 用
kill-9PID 等 强 制 关 闭 指 令，是 不 会 执 行 优 雅 停 机 的，只 有 通 过 killPID 时，才
会 执 行 。
```

### 28 、Dubbo和 Dubbox 之间的区别？...............................................

```
Dubbox 是 继 Dubbo 停 止 维 护 后，当 当 网 基 于 Dubbo 做 的 一 个 扩 展 项 目，如
加 了 服 务 可 Restful 调 用 ， 更 新 了 开 源 组 件 等 。
```

### 29 、Dubbo和 SpringCloud的区别？.............................................

根 据 微 服 务 架 构 在 各 方 面 的 要 素 ， 看 看SpringCloud和Dubbo都 提 供 了 哪 些 支
持 。

```
Dubbo SpringCloud
```

服务注册中心 Zookeep
er

```
SpringCloudNetflixEureka
```

#### 服务调用方式 RPC RESTAPI

服务网关 无 SpringCloudNetflixZuul

断路器 不完善 SpringCloudNetflixHystrix

分布式配置 无 SpringCloudConfig

服务跟踪 无 SpringCloudSleuth

消息总线 无 SpringCloudBus

数据流 无 SpringCloudStream

批量任务 无 SpringCloudTask

...... ...... ......

使 用Dubbo构 建 的 微 服 务 架 构 就 像 组 装 电 脑，各 环 节 我 们 的 选 择 自 由 度 很 高，但
是 最 终 结 果 很 有 可 能 因 为 一 条 内 存 质 量 不 行 就 点 不 亮 了 ， 总 是 让 人 不 怎 么 放 心 ，
但 是 如 果 你 是 一 名 高 手 ， 那 这 些 都 不 是 问 题 ； 而SpringCloud就 像 品 牌 机 ，在
SpringSource的 整 合 下，做 了 大 量 的 兼 容 性 测 试，保 证 了 机 器 拥 有 更 高 的 稳 定 性，
但 是 如 果 要 在 使 用 非 原 装 组 件 外 的 东 西 ， 就 需 要 对 其 基 础 有 足 够 的 了 解 。


### 30 、你还了解别的分布式框架吗？.........................................................

别 的 还 有spring的springcloud，facebook的thrift，twitter的finagle等

## Elasticsearch 面试题...............................................................................................

### 1 、elasticsearch了解多少，说说你们公司es的集群架构，索

### 引数据大小，分片有多少，以及一些调优手段 。

面 试 官： 想 了 解 应 聘 者 之 前 公 司 接 触 的ES使 用 场 景 、 规 模 ， 有 没 有 做 过 比 较 大
规 模 的 索 引 设 计 、 规 划 、 调 优 。
解 答：
如 实 结 合 自 己 的 实 践 场 景 回 答 即 可 。
比 如 ：ES集 群 架 构 13 个 节 点 ， 索 引 根 据 通 道 不 同 共20+索 引 ， 根 据 日 期 ， 每 日
递 增20+， 索 引 ： 10 分 片 ， 每 日 递 增 1 亿+数 据 ，
每 个 通 道 每 天 索 引 大 小 控 制 ：150G B之 内 。

仅 索 引 层 面 调 优 手 段 ：

#### 1.1、 设 计 阶 段 调 优

1 、 根 据 业 务 增 量 需 求 ， 采 取 基 于 日 期 模 板 创 建 索 引 ， 通 过rolloverAPI滚 动 索
引 ；

#### 2 、 使 用 别 名 进 行 索 引 管 理 ；

3 、 每 天 凌 晨 定 时 对 索 引 做force_merge操 作 ， 以 释 放 空 间 ；


4 、采 取 冷 热 分 离 机 制，热 数 据 存 储 到SSD，提 高 检 索 效 率；冷 数 据 定 期 进 行shrink
操 作 ， 以 缩 减 存 储 ；

5 、 采 取curator进 行 索 引 的 生 命 周 期 管 理 ；

6 、 仅 针 对 需 要 分 词 的 字 段 ， 合 理 的 设 置 分 词 器 ；

7 、Mapping阶 段 充 分 结 合 各 个 字 段 的 属 性，是 否 需 要 检 索、是 否 需 要 存 储 等。... .....

**1.2、 写 入 调 优**

1 、 写 入 前 副 本 数 设 置 为 0 ；

2 、 写 入 前 关 闭refresh_interval设 置 为-1， 禁 用 刷 新 机 制 ；

3 、 写 入 过 程 中 ： 采 取bulk批 量 写 入 ；

4 、 写 入 后 恢 复 副 本 数 和 刷 新 间 隔 ；

5 、 尽 量 使 用 自 动 生 成 的id。

#### 1.3、 查 询 调 优

1 、 禁 用wildcard；

2 、 禁 用 批 量terms（ 成 百 上 千 的 场 景 ） ；

3 、 充 分 利 用 倒 排 索 引 机 制 ， 能keyword类 型 尽 量keyword；

4 、 数 据 量 大 时 候 ， 可 以 先 基 于 时 间 敲 定 索 引 再 检 索 ；


#### 5 、 设 置 合 理 的 路 由 机 制 。

#### 1.4、 其 他 调 优

#### 部 署 调 优 ， 业 务 调 优 等 。

#### 上 面 的 提 及 一 部 分 ， 面 试 者 就 基 本 对 你 之 前 的 实 践 或 者 运 维 经 验 有 所 评 估 了 。

### 2 、elasticsearch的倒排索引是什么......................................................

面 试 官： 想 了 解 你 对 基 础 概 念 的 认 知 。
解 答： 通 俗 解 释 一 下 就 可 以 。

传 统 的 我 们 的 检 索 是 通 过 文 章 ， 逐 个 遍 历 找 到 对 应 关 键 词 的 位 置 。
而 倒 排 索 引，是 通 过 分 词 策 略，形 成 了 词 和 文 章 的 映 射 关 系 表，这 种 词 典+映 射 表
即 为 倒 排 索 引 。
有 了 倒 排 索 引，就 能 实 现o（ 1 ）时 间 复 杂 度的 效 率 检 索 文 章 了，极 大 的 提 高 了
检 索 效 率 。


#### 学 术 的 解 答 方 式 ：

#### 倒 排 索 引 ， 相 反 于 一 篇 文 章 包 含 了 哪 些 词 ， 它 从 词 出 发 ， 记 载 了 这 个 词 在 哪 些 文

#### 档 中 出 现 过 ， 由 两 部 分 组 成— —词 典 和 倒 排 表 。

加 分 项： 倒 排 索 引 的 底 层 实 现 是 基 于 ：FST（FiniteStateTransducer） 数 据 结
构 。
lucene从4+版 本 后 开 始 大 量 使 用 的 数 据 结 构 是FST。FST有 两 个 优 点 ：

#### 1 、 空 间 占 用 小 。 通 过 对 词 典 中 单 词 前 缀 和 后 缀 的 重 复 利 用 ， 压 缩 了 存 储 空 间 ；

2 、 查 询 速 度 快 。O(len(str))的 查 询 时 间 复 杂 度 。

### 3 、elasticsearch 索引数据多了怎么办，如何调优，部署.................

面 试 官： 想 了 解 大 数 据 量 的 运 维 能 力 。
解 答： 索 引 数 据 的 规 划 ， 应 在 前 期 做 好 规 划 ， 正 所 谓“设 计 先 行 ， 编 码 在 后”，
这 样 才 能 有 效 的 避 免 突 如 其 来 的 数 据 激 增 导 致 集 群 处 理 能 力 不 足 引 发 的 线 上 客 户
检 索 或 者 其 他 业 务 受 到 影 响 。
如 何 调 优 ， 正 如 问 题 1 所 说 ， 这 里 细 化 一 下 ：

#### 3.1 动 态 索 引 层 面

基 于模 板+时 间+rolloverapi滚 动创 建 索 引 ， 举 例 ： 设 计 阶 段 定 义 ：blog索
引 的 模 板 格 式 为 ：blog_index_时 间 戳 的 形 式 ， 每 天 递 增 数 据 。

这 样 做 的 好 处 ： 不 至 于 数 据 量 激 增 导 致 单 个 索 引 数 据 量 非 常 大 ， 接 近 于 上 线 2 的
32 次 幂-1， 索 引 存 储 达 到 了TB+甚 至 更 大 。

一 旦 单 个 索 引 很 大 ， 存 储 等 各 种 风 险 也 随 之 而 来 ， 所 以 要 提 前 考 虑+及 早 避 免 。


#### 3.2 存 储 层 面

冷 热 数 据 分 离 存 储，热 数 据（比 如 最 近 3 天 或 者 一 周 的 数 据），其 余 为 冷 数 据。
对 于 冷 数 据 不 会 再 写 入 新 数 据 ， 可 以 考 虑 定 期force_merge加shrink压 缩 操 作，
节 省 存 储 空 间 和 检 索 效 率 。

**3.3 部 署 层 面**

#### 一 旦 之 前 没 有 规 划 ， 这 里 就 属 于 应 急 策 略 。

#### 结 合ES自 身 的 支 持 动 态 扩 展 的 特 点，动 态 新 增 机 器 的 方 式 可 以 缓 解 集 群 压 力，注

意 ： 如 果 之 前 主 节 点 等规 划 合 理， 不 需 要 重 启 集 群 也 能 完 成 动 态 新 增 的 。

### 4 、elasticsearch是如何实现master选举的.......................................

面 试 官： 想 了 解ES集 群 的 底 层 原 理 ， 不 再 只 关 注 业 务 层 面 了 。
解 答：
前 置 前 提 ：

1 、 只 有 候 选 主 节 点 （master：true） 的 节 点 才 能 成 为 主 节 点 。

2 、 最 小 主 节 点 数 （min_master_nodes） 的 目 的 是 防 止 脑 裂 。

这 个 我 看 了 各 种 网 上 分 析 的 版 本 和 源 码 分 析 的 书 籍 ， 云 里 雾 里 。
核 对 了 一 下 代 码，核 心 入 口 为findMaster，选 择 主 节 点 成 功 返 回 对 应Master，否
则 返 回null。 选 举 流 程 大 致 描 述 如 下 ：

第 一 步 ： 确 认 候 选 主 节 点 数 达 标 ，elasticsearch.yml设 置 的值
discovery.zen.minimum_master_nodes；


第 二 步 ： 比 较 ： 先 判 定 是 否 具 备master资 格 ， 具 备 候 选 主 节 点 资 格 的 优 先 返 回；
若 两 节 点 都 为 候 选 主 节 点，则id小 的 值 会 主 节 点。注 意 这 里 的id为string类 型。

题 外 话 ： 获 取 节 点id的 方 法 。

1GET/_cat/nodes?v&h=ip,port,heapPercent,heapMax,id,name
2ip portheapPercentheapMaxid name

### 5 、详细描述一下Elasticsearch索引文档的过程.................................

面 试 官： 想 了 解ES的 底 层 原 理 ， 不 再 只 关 注 业 务 层 面 了 。
解 答：
这 里 的 索 引 文 档 应 该 理 解 为 文 档 写 入ES， 创 建 索 引 的 过 程 。
文 档 写 入 包 含：单 文 档 写 入 和 批 量bulk写 入，这 里 只 解 释 一 下：单 文 档 写 入 流 程。

#### 记 住 官 方 文 档 中 的 这 个 图 。

#### 第 一 步：客 户 写 集 群 某 节 点 写 入 数 据，发 送 请 求。（如 果 没 有 指 定 路 由/协 调 节 点，

请 求 的 节 点 扮 演路 由 节 点的 角 色 。 ）


第 二 步：节 点 1 接 受 到 请 求 后，使 用 文 档_id来 确 定 文 档 属 于 分 片 0 。请 求 会 被 转
到 另 外 的 节 点 ， 假 定 节 点 3 。 因 此 分 片 0 的 主 分 片 分 配 到 节 点 3 上 。

#### 第 三 步 ： 节 点 3 在 主 分 片 上 执 行 写 操 作 ， 如 果 成 功 ， 则 将 请 求 并 行 转 发 到 节 点 1

#### 和 节 点 2 的 副 本 分 片 上 ， 等 待 结 果 返 回 。 所 有 的 副 本 分 片 都 报 告 成 功 ， 节 点 3 将

#### 向 协 调 节 点 （ 节 点 1 ） 报 告 成 功 ， 节 点 1 向 请 求 客 户 端 报 告 写 入 成 功 。

#### 如 果 面 试 官 再 问 ： 第 二 步 中 的 文 档 获 取 分 片 的 过 程 ？

回 答：借 助 路 由 算 法 获 取，路 由 算 法 就 是 根 据 路 由 和 文 档id计 算 目 标 的 分 片id的
过 程 。

1shard=hash(_routing)%(num_of_primary_shards)

### 6 、详细描述一下Elasticsearch搜索的过程？.....................................

面 试 官： 想 了 解ES搜 索 的 底 层 原 理 ， 不 再 只 关 注 业 务 层 面 了 。
解 答：
搜 索 拆 解 为“querythenfetch” 两 个 阶 段 。
**query阶 段 的 目 的** ： 定 位 到 位 置 ， 但 不 取 。
步 骤 拆 解 如 下 ：

#### 1 、 假 设 一 个 索 引 数 据 有 5 主+1副 本 共 10 分 片 ， 一 次 请 求 会 命 中 （ 主 或 者 副 本

#### 分 片 中 ） 的 一 个 。

#### 2 、 每 个 分 片 在 本 地 进 行 查 询 ， 结 果 返 回 到 本 地 有 序 的 优 先 队 列 中 。

#### 3 、 第 2 ） 步 骤 的 结 果 发 送 到 协 调 节 点 ， 协 调 节 点 产 生 一 个 全 局 的 排 序 列 表 。

**fetch阶 段 的 目 的** ： 取 数 据 。
路 由 节 点 获 取 所 有 文 档 ， 返 回 给 客 户 端 。


### 7 、Elasticsearch在部署时，对Linux的设置有哪些优化方法..........

面 试 官： 想 了 解 对ES集 群 的 运 维 能 力 。
解 答：

1 、 关 闭 缓 存swap;

2 、 堆 内 存 设 置 为 ：Min（ 节 点 内 存/2,32GB）;

3 、 设 置 最 大 文 件 句 柄 数 ；

4 、 线 程 池+队 列 大 小 根 据 业 务 需 要 做 调 整 ；

5 、磁 盘 存 储raid方 式— —存 储 有 条 件 使 用RAID10，增 加 单 节 点 性 能 以 及 避 免 单
节 点 存 储 故 障 。

### 8 、lucence内部结构是什么？................................................................

面 试 官： 想 了 解 你 的 知 识 面 的 广 度 和 深 度 。
解 答：


Lucene是 有 索 引 和 搜 索 的 两 个 过 程，包 含 索 引 创 建，索 引，搜 索 三 个 要 点。可 以
基 于 这 个 脉 络 展 开 一 些 。

最 近 面 试 一 些 公 司，被 问 到 的 关 于Elasticsearch和 搜 索 引 擎 相 关 的 问 题，以 及 自
己 总 结 的 回 答 。

### 9 、Elasticsearch是如何实现Master选举的？...................................

1 、Elasticsearch的 选 主 是ZenDiscovery模 块 负 责 的 ， 主 要 包 含Ping（ 节 点 之
间 通 过 这 个RPC来 发 现 彼 此 ） 和Unicast（ 单 播 模 块 包 含 一 个 主 机 列 表 以 控 制 哪
些 节 点 需 要ping通 ） 这 两 部 分 ；


2 、 对 所 有 可 以 成 为master的 节 点 （ **node.master:true** ） 根 据nodeId字 典 排
序，每 次 选 举 每 个 节 点 都 把 自 己 所 知 道 节 点 排 一 次 序，然 后 选 出 第 一 个（第 0 位）
节 点 ， 暂 且 认 为 它 是master节 点 。

3 、如 果 对 某 个 节 点 的 投 票 数 达 到 一 定 的 值（可 以 成 为master节 点 数n/2+1）并
且 该 节 点 自 己 也 选 举 自 己，那 这 个 节 点 就 是master。否 则 重 新 选 举 一 直 到 满 足 上
述 条 件 。

4 、 补 充 ：master节 点 的 职 责 主 要 包 括 集 群 、 节 点 和 索 引 的 管 理 ， 不 负 责 文 档 级
别 的 管 理 ；data节 点 可 以 关 闭http功 能*。

### master，另外 10 个选了另一个master，怎么办？............................ 10 、Elasticsearch中的节点（比如共 20 个），其中的 10 个选了一个

### 选了一个master，另外 10 个选了另一个master，怎么办？

1 、 当 集 群master候 选 数 量 不 小 于 3 个 时 ， 可 以 通 过 设 置 最 少 投 票 通 过 数 量
（ **discovery.zen.minimum_master_nodes** ） 超 过 所 有 候 选 节 点 一 半 以 上 来 解
决 脑 裂 问 题 ；
2 、 当 候 选 数 量 为 两 个 时 ， 只 能 修 改 为 唯 一 的 一 个master候 选 ， 其 他 作 为data
节 点 ， 避 免 脑 裂 问 题 。

### 11 、客户端在和集群连接时，如何选择特定的节点执行请求的？.....

1 、TransportClient利 用transport模 块 远 程 连 接 一 个elasticsearch集 群。它 并
不 加 入 到 集 群 中，只 是 简 单 的 获 得 一 个 或 者 多 个 初 始 化的transport地 址，并 以 **轮
询** 的 方 式 与 这 些 地 址 进 行 通 信 。

### 12 、详细描述一下Elasticsearch索引文档的过程。...........................


协 调 节 点 默 认 使 用 文 档ID参 与 计 算 （ 也 支 持 通 过routing） ， 以 便 为 路 由 提 供 合
适 的 分 片 。

shard=hash(document_id)%(num_of_primary_shards)

1 、 当 分 片 所 在 的 节 点 接 收 到 来 自 协 调 节 点 的 请 求 后 ， 会 将 请 求 写 入 到Memory
Buffer，然 后 定 时（默 认 是 每 隔 1 秒）写 入 到FilesystemCache，这 个 从Momery
Buffer到FilesystemCache的 过 程 就 叫 做refresh；

2 、当 然 在 某 些 情 况 下，存 在MomeryBuffer和FilesystemCache的 数 据 可 能 会
丢 失，ES是 通 过translog的 机 制 来 保 证 数 据 的 可 靠 性 的。其 实 现 机 制 是 接 收 到 请
求 后，同 时 也 会 写 入 到translog中，当Filesystemcache中 的 数 据 写 入 到 磁 盘 中
时 ， 才 会 清 除 掉 ， 这 个 过 程 叫 做flush；

3 、 在flush过 程 中 ， 内 存 中 的 缓 冲 将 被 清 除 ， 内 容 被 写 入 一 个 新 段 ， 段 的fsync
将 创 建 一 个 新 的 提 交 点 ， 并 将 内 容 刷 新 到 磁 盘 ， 旧 的translog将 被 删 除 并 开 始 一
个 新 的translog。

4 、flush触 发 的 时 机 是 定 时 触 发 （ 默 认 30 分 钟 ） 或 者translog变 得 太 大 （ 默 认
为512M） 时 ；


**补 充 ： 关 于Lucene的Segement：**

1 、Lucene索 引 是 由 多 个 段 组 成 ， 段 本 身 是 一 个 功 能 齐 全 的 倒 排 索 引 。

2 、 段 是 不 可 变 的 ， 允 许Lucene将 新 的 文 档 增 量 地 添 加 到 索 引 中 ， 而 不 用 从 头 重
建 索 引 。

3 、 对 于 每 一 个 搜 索 请 求 而 言 ， 索 引 中 的 所 有 段 都 会 被 搜 索 ， 并 且 每 个 段 会 消耗
CPU的 时 钟 周 、 文 件 句 柄 和 内 存 。 这 意 味 着 段 的 数 量 越 多 ， 搜 索 性 能 会 越 低 。

4 、为 了 解 决 这 个 问 题，Elasticsearch会 合 并 小 段 到 一 个 较 大 的 段，提 交 新 的 合 并
段 到 磁 盘 ， 并 删 除 那 些 旧 的 小 段 。

### 13 、详细描述一下Elasticsearch更新和删除文档的过程。...............

1 、 删 除 和 更 新 也 都 是 写 操 作 ， 但 是Elasticsearch中 的 文 档 是 不 可 变 的 ， 因 此 不
能 被 删 除 或 者 改 动 以 展 示 其 变 更 ；

2 、磁 盘 上 的 每 个 段 都 有 一 个 相 应 的.del文 件。当 删 除 请 求 发 送 后，文 档 并 没 有 真
的 被 删 除 ， 而 是 在.del文 件 中 被 标 记 为 删 除 。 该 文 档 依 然 能 匹 配 查 询 ， 但 是 会 在
结 果 中 被 过 滤 掉 。 当 段 合 并 时 ， 在.del文 件 中 被 标 记 为 删 除 的 文 档 将 不 会 被 写 入
新 段 。

3 、在 新 的 文 档 被 创 建 时，Elasticsearch会 为 该 文 档 指 定 一 个 版 本 号，当 执 行 更 新
时，旧 版 本 的 文 档 在.del文 件 中 被 标 记 为 删 除，新 版 本 的 文 档 被 索 引 到 一 个 新 段。
旧 版 本 的 文 档 依 然 能 匹 配 查 询 ， 但 是 会 在 结 果 中 被 过 滤 掉 。

### 14 、详细描述一下Elasticsearch搜索的过程。...................................


1 、 搜 索 被 执 行 成 一 个 两 阶 段 过 程 ， 我 们 称 之 为 QueryThenFetch；

#### 2 、在 初 始 查 询 阶 段 时，查 询 会 广 播 到 索 引 中 每 一 个 分 片 拷 贝（主 分 片 或 者 副 本 分

片 ） 。 每 个 分 片 在 本 地 执 行 搜 索 并 构 建 一 个 匹 配 文 档 的 大 小 为 from+size 的
优 先 队 列 。

PS：在 搜 索 的 时 候 是 会 查 询FilesystemCache的，但 是 有 部 分 数 据 还 在Memory
Buffer， 所 以 搜 索 是 近 实 时 的 。

#### 3 、每 个 分 片 返 回 各 自 优 先 队 列 中 所 有 文 档 的 ID 和 排 序 值 给 协 调 节 点，它 合 并

#### 这 些 值 到 自 己 的 优 先 队 列 中 来 产 生 一 个 全 局 排 序 后 的 结 果 列 表 。

#### 4 、 接 下 来 就 是 取 回 阶 段 ， 协 调 节 点 辨 别 出 哪 些 文 档 需 要 被 取 回 并 向 相 关 的 分 片

提 交 多 个 GET 请 求 。 每 个 分 片 加 载 并 丰 富 文 档 ， 如 果 有 需 要 的 话 ， 接 着 返 回
文 档 给 协 调 节 点 。 一 旦 所 有 的 文 档 都 被 取 回 了 ， 协 调 节 点 返 回 结 果 给 客 户 端 。

5 、 补 充 ：QueryThenFetch的 搜 索 类 型 在 文 档 相 关 性 打 分 的 时 候 参 考 的 是 本 分
片 的 数 据，这 样 在 文 档 数 量 较 少 的 时 候 可 能 不 够 准 确，DFSQueryThenFetch增
加 了 一 个 预 查 询 的 处 理，询 问Term和Documentfrequency，这 个 评 分 更 准 确，
但 是 性 能 会 变 差 。*


### 15 、在Elasticsearch中，是怎么根据一个词找到对应的倒排索引的？

#### SEE：

 Lucene的索引文件格式(1)
 Lucene的索引文件格式(2)

### 16 、Elasticsearch在部署时，对Linux的设置有哪些优化方法？....

#### 1 、 64 GB 内 存 的 机 器 是 非 常 理 想 的， 但 是 32 GB 和 16 GB 机 器 也 是 很 常 见 的。

#### 少 于 8 GB 会 适 得 其 反 。

```
2 、 如 果 你 要 在 更 快 的 CPUs 和 更 多 的 核 心 之 间 选 择 ， 选 择 更 多 的 核 心 更 好 。 多
个 内 核 提 供 的 额 外 并 发 远 胜 过 稍 微 快 一 点 点 的 时 钟 频 率 。
```

#### 3 、如 果 你 负 担 得 起 SSD，它 将 远 远 超 出 任 何 旋 转 介 质。 基 于 SSD 的 节 点，查

#### 询 和 索 引 性 能 都 有 提 升 。 如 果 你 负 担 得 起 ，SSD 是 一 个 好 的 选 择 。

#### 4 、即 使 数 据 中 心 们 近 在 咫 尺，也 要 避 免 集 群 跨 越 多 个 数 据 中 心。绝 对 要 避 免 集 群

#### 跨 越 大 的 地 理 距 离 。

#### 5 、 请 确 保 运 行 你 应 用 程 序 的 JVM 和 服 务 器 的 JVM 是 完 全 一 样 的 。 在

```
Elasticsearch 的 几 个 地 方 ， 使 用 Java 的 本 地 序 列 化 。
```

6 、 通 过 设 置gateway.recover_after_nodes、gateway.expected_nodes、
gateway.recover_after_time可 以 在 集 群 重 启 的 时 候 避 免 过 多 的 分 片 交 换 ， 这 可
能 会 让 数 据 恢 复 从 数 个 小 时 缩 短 为 几 秒 钟 。

7 、Elasticsearch 默 认 被 配 置 为 使 用 单 播 发 现 ， 以 防 止 节 点 无 意 中 加 入 集 群 。 只
有 在 同 一 台 机 器 上 运 行 的 节 点 才 会 自 动 组 成 集 群 。 最 好 使 用 单 播 代 替 组 播 。

#### 8 、 不 要 随 意 修 改 垃 圾 回 收 器 （CMS） 和 各 个 线 程 池 的 大 小 。

9 、 把 你 的 内 存 的 （ 少 于 ） 一 半 给 Lucene（ 但 不 要 超 过 32 GB！ ） ， 通过
ES_HEAP_SIZE 环 境 变 量 设 置 。

10 、 内 存 交 换 到 磁 盘 对 服 务 器 性 能 来 说 是 致 命 的 。 如 果 内 存 交 换 到 磁 盘 上 ， 一 个
100 微 秒 的 操 作 可 能 变 成 10 毫 秒 。 再 想 想 那 么 多 10 微 秒 的 操 作 时 延 累 加 起
来 。 不 难 看 出 swapping 对 于 性 能 是 多 么 可 怕 。

11 、Lucene 使 用 了大 量 的文 件 。 同 时 ，Elasticsearch 在 节 点 和 HTTP 客 户 端
之 间 进 行 通 信 也 使 用 了 大 量 的 套 接 字。 所 有 这 一 切 都 需 要 足 够 的 文 件 描 述 符。你
应 该 增 加 你 的 文 件 描 述 符 ， 设 置 一 个 很 大 的 值 ， 如 64,000。

**补 充 ： 索 引 阶 段 性 能 提 升 方 法**

#### 1 、 使 用 批 量 请 求 并 调 整 其 大 小 ： 每 次 批 量 数 据 5 – 15 MB 大 是 个 不 错 的 起 始 点。

#### 2 、 存 储 ： 使 用 SSD

3 、段 和 合 并：Elasticsearch 默 认 值 是 20 MB/s，对 机 械 磁 盘 应 该 是 个 不 错 的 设
置。如 果 你 用 的 是 SSD，可 以 考 虑 提 高 到 100 – 200 MB/s。如 果 你 在 做 批 量 导 入，
完 全 不 在 意 搜 索 ， 你 可 以 彻 底 关 掉 合 并 限 流 。 另 外 还 可 以 增 加


index.translog.flush_threshold_size 设 置 ， 从 默 认 的 512 MB 到 更 大 一 些 的
值 ， 比 如 1 GB， 这 可 以 在 一 次 清 空 触 发 的 时 候 在 事 务 日 志 里 积 累 出 更 大 的 段 。

#### 4 、 如 果 你 的 搜 索 结 果 不 需 要 近 实 时 的 准 确 度 ， 考 虑 把 每 个 索 引的

index.refresh_interval 改 到30s。

5 、如 果 你 在 做 大 批 量 导 入，考 虑 通 过 设 置index.number_of_replicas: 0 关 闭 副
本 。

### 17 、对于GC方面，在使用Elasticsearch时要注意什么？...............

1 、SEE：https://elasticsearch.cn/article/32

2 、 倒 排 词 典 的 索 引 需 要 常 驻 内 存 ， 无 法GC， 需 要 监 控datanode上segment
memory增 长 趋 势 。

3 、 各 类 缓 存 ，fieldcache,filtercache,indexingcache,bulkqueue等 等 ， 要
设 置 合 理 的 大 小，并 且 要 应 该 根 据 最 坏 的 情 况 来 看heap是 否 够 用，也 就 是 各 类 缓
存 全 部 占 满 的 时 候，还有heap空 间 可 以 分 配 给 其 他 任 务 吗 ？ 避 免 采用clearcache
等“自 欺 欺 人”的 方 式 来 释 放 内 存 。

#### 4 、避 免 返 回 大 量 结 果 集 的 搜 索 与 聚 合。确 实 需 要 大 量 拉 取 数 据 的 场 景，可 以 采用

scan&scrollapi来 实 现 。

5 、clusterstats驻 留 内 存 并 无 法 水 平 扩 展，超 大 规 模 集 群 可 以 考 虑 分 拆 成 多 个 集
群 通 过tribenode连 接 。

6 、 想 知 道heap够 不 够 ， 必 须 结 合 实 际 应 用 场 景 ， 并 对 集 群 的heap使 用 情 况 做
持 续 的 监 控 。


### 18 、Elasticsearch对于大数据量（上亿量级）的聚合如何实现？....

Elasticsearch 提 供 的 首 个 近 似 聚 合 是cardinality 度 量。它 提 供 一 个 字 段 的 基 数，
即 该 字 段 的dis t in c t或 者un i q u e值 的 数 目 。 它 是 基 于HLL算 法 的 。HLL 会 先 对
我 们 的 输 入 作 哈 希 运 算，然 后 根 据 哈 希 运 算 的 结 果 中 的 bits 做 概 率 估 算 从 而 得 到
基 数。其 特 点 是：可 配 置 的 精 度，用 来 控 制 内 存 的 使 用（更 精 确 ＝ 更 多 内 存）；
小 的 数 据 集 精 度 是 非 常 高 的 ； 我 们 可 以 通 过 配 置 参 数 ， 来 设 置 去 重 需 要 的 固 定 内
存 使 用 量。无 论 数 千 还 是 数 十 亿 的 唯 一 值，内 存 使 用 量 只 与 你 配 置 的 精 确 度 相 关。

### 19 、在并发情况下，Elasticsearch如果保证读写一致？....................

#### 1 、可 以 通 过 版 本 号 使 用 乐 观 并 发 控 制，以 确 保 新 版 本 不 会 被 旧 版 本 覆 盖，由 应 用

#### 层 来 处 理 具 体 的 冲 突 ；

2 、 另 外 对 于 写 操 作 ， 一 致 性 级 别 支 持quorum/one/all， 默 认 为quorum， 即 只
有 当 大 多 数 分 片 可 用 时 才 允 许 写 操 作 。 但 即 使 大 多 数 可 用 ， 也 可 能 存 在 因 为 网 络
等 原 因 导 致 写 入 副 本 失 败 ， 这 样 该 副 本 被 认 为 故 障 ， 分 片 将 会 在 一 个 不 同 的 节 点
上 重 建 。

3 、 对 于 读 操 作 ， 可 以 设 置replication为sync(默 认)， 这 使 得 操 作 在 主 分 片 和 副
本 分 片 都 完 成 后 才 会 返 回；如 果 设 置replication为async时，也 可 以 通 过 设 置 搜
索 请 求 参 数_preference为primary来 查 询 主 分 片 ， 确 保 文 档 是 最 新 版 本 。

### 20 、如何监控Elasticsearch集群状态？...............................................

Marvel 让 你 可 以 很 简 单 的 通 过 Kibana 监 控 Elasticsearch。你 可 以 实 时 查 看 你
的 集 群 健 康 状 态 和 性 能 ， 也 可 以 分 析 过 去 的 集 群 、 索 引 和 节 点 指 标 。


### 21 、介绍下你们电商搜索的整体技术架构。.........................................

### 22 、介绍一下你们的个性化搜索方案？.................................................

SEE 基 于word2vec和Elasticsearch实 现 个 性 化 搜 索

### 23 、是否了解字典树？.............................................................................

#### 常 用 字 典 数 据 结 构 如 下 所 示 ：


Trie的 核 心 思 想 是 空 间 换 时 间 ， 利 用 字 符 串 的 公 共 前 缀 来 降 低 查 询 时 间 的 开 销 以
达 到 提 高 效 率 的 目 的 。 它 有 3 个 基 本 性 质 ：

#### 1 、 根 节 点 不 包 含 字 符 ， 除 根 节 点 外 每 一 个 节 点 都 只 包 含 一 个 字 符 。

#### 2 、 从 根 节 点 到 某 一 节 点 ， 路 径 上 经 过 的 字 符 连 接 起 来 ， 为 该 节 点 对 应 的 字 符 串。

#### 3 、 每 个 节 点 的 所 有 子 节 点 包 含 的 字 符 都 不 相 同 。


1 、 可 以 看 到 ，trie树 每 一 层 的 节 点 数 是26^i级 别 的 。 所 以 为 了 节 省 空 间 ， 我 们
还 可 以 用 动 态 链 表，或 者 用 数 组 来 模 拟 动 态。而 空 间 的 花 费，不 会 超 过 单 词 数×单
词 长 度 。

2 、实 现：对 每 个 结 点 开 一 个 字 母 集 大 小 的 数 组，每 个 结 点 挂 一 个 链 表，使 用 左 儿
子 右 兄 弟 表 示 法 记 录 这 棵 树 ；

#### 3 、对 于 中 文 的 字 典 树，每 个 节 点 的 子 节 点 用 一 个 哈 希 表 存 储，这 样 就 不 用 浪 费 太

#### 大 的 空 间 ， 而 且 查 询 速 度 上 可 以 保 留 哈 希 的 复 杂 度O(1)。

### 24 、拼写纠错是如何实现的？...............................................................

#### 1 、拼 写 纠 错 是 基 于 编 辑 距 离 来 实 现；编 辑 距 离 是 一 种 标 准 的 方 法，它 用 来 表 示 经

#### 过 插 入 、 删 除 和 替 换 操 作 从 一 个 字 符 串 转 换 到 另 外 一 个 字 符 串 的 最 小 操 作 步 数 ；

2 、编 辑 距 离 的 计 算 过 程：比 如 要 计 算batyu和beauty的 编 辑 距 离，先 创 建 一个
7 × 8 的 表（batyu长 度 为 5 ，coffee长 度 为 6 ，各 加 2 ），接 着，在 如 下 位 置 填 入
黑 色 数 字 。 其 他 格 的 计 算 过 程 是 取 以 下 三 个 值 的 最 小 值 ：

如 果 最 上 方 的 字 符 等 于 最 左 方 的 字 符 ， 则 为 左 上 方 的 数 字 。 否 则 为 左 上 方 的 数 字
+1。 （ 对 于3,3来 说 为 0 ）
左 方 数 字+1（ 对 于3,3格 来 说 为 2 ）
上 方 数 字+1（ 对 于3,3格 来 说 为 2 ）

最 终 取 右 下 角 的 值 即 为 编 辑 距 离 的 值 3 。


对 于 拼 写 纠 错 ， 我 们 考 虑 构 造 一 个 度 量 空 间 （MetricSpace） ， 该 空 间 内 任 何 关
系 满 足 以 下 三 条 基 本 条 件 ：

d(x,y)= 0 -- 假 如x与y的 距 离 为 0 ， 则x=y
d(x,y)=d(y,x) --x到y的 距 离 等 同 于y到x的 距 离
d(x,y)+d(y,z)>=d(x,z)-- 三 角 不 等 式

1 、根 据 三 角 不 等 式，则 满 足 与query距 离 在n范 围 内 的 另 一 个 字 符 转B，其 与A
的 距 离 最 大 为d+n， 最 小 为d-n。

#### 2 、BK树 的 构 造 就 过 程 如 下 ： 每 个 节 点 有 任 意 个 子 节 点 ， 每 条 边 有 个 值 表 示 编 辑

距 离。所 有 子 节 点 到 父 节 点 的 边 上 标 注n表 示 编 辑 距 离 恰 好 为n。比 如，我 们 有 棵


树 父 节 点 是”book”和 两 个 子 节 点”cake”和”books”，”book”到”books”
的 边 标 号 1 ，”book”到”cake”的 边 上 标 号 4 。 从 字 典 里 构 造 好 树 后 ， 无 论 何
时 你 想 插 入 新 单 词 时 ， 计 算 该 单 词 与 根 节 点 的 编 辑 距 离 ， 并 且 查 找 数 值为
d(neweord,root)的 边 。 递 归 得 与 各 子 节 点 进 行 比 较 ， 直 到 没 有 子 节 点 ， 你 就 可
以 创 建 新 的 子 节 点 并 将 新 单 词 保 存 在 那。比 如，插 入”boo”到 刚 才 上 述 例 子 的 树
中，我 们 先 检 查 根 节 点，查 找d(“book”, “boo”)= 1 的 边，然 后 检 查 标 号为
1 的 边 的 子 节 点，得 到 单 词”books”。我 们 再 计 算 距 离d(“books”,“boo”)=2，
则 将 新 单 词 插 在”books”之 后 ， 边 标 号 为 2 。

3 、 查 询 相 似 词 如 下 ： 计 算 单 词 与 根 节 点 的 编 辑 距 离d， 然 后 递 归 查 找 每 个 子 节 点
标 号 为d-n到d+n（包 含）的 边。假 如 被 检 查 的 节 点 与 搜 索 单 词 的 距 离d小 于n，
则 返 回 该 节 点 并 继 续 查 询。比 如 输 入cape且 最 大 容 忍 距 离 为 1 ，则 先 计 算 和 根 的
编 辑 距 离d(“book”, “cape”)=4， 然 后 接 着 找 和 根 节 点 之 间 编 辑 距 离 为 3 到
5 的，这 个 就 找 到 了cake这 个 节 点，计 算d(“cake”, “cape”)=1，满 足 条 件
所 以 返 回 **cake** ， 然 后 再 找 和cake节 点 编 辑 距 离 是 0 到 2 的 ， 分 别 找 到cape和
cart节 点 ， 这 样 就 得 到 **cape** 这 个 满 足 条 件 的 结 果 。

## Memcached 面试题..............................................................................................

### 1 、Memcached是什么，有什么作用？.............................................


```
Memcached是 一 个 开 源 的，高 性 能 的 内 存 绶 存 软 件，从 名 称 上 看Mem就 是 内 存
的 意 思 ， 而Cache就 是 缓 存 的 意 思 。Memcached的 作 用 ： 通 过 在 事 先 规 划 好 的
内 存 空 间 中 临 时 绶 存 数 据 库 中 的 各 类 数 据 ， 以 达 到 减 少 业 务 对 数 据 库 的 直 接 高 并
发 访 问 ， 从 而 达 到 提 升 数 据 库 的 访 问 性 能 ， 加 速 网 站 集 群 动 态 应 用 服 务 的 能 力 。
```

```
memcached服 务 在 企 业 集 群 架 构 中 有 哪 些 应 用 场 景 ？
```

#### 一 、 作 为 数 据 库 的 前 端 缓 存 应 用

```
a、 完 整 缓 存 （ 易 ） ， 静 态 缓 存
例 如 ： 商 品 分 类 （ 京 东 ） ， 以 及 商 品 信 息 ， 可 事 先 放 在 内 存 里 ， 然 后 再 对 外 提 供
数 据 访 问 ， 这 种 先 放 到 内 存 ， 我 们 称 之 为 预 热 ， （ 先 把 数 据 存 缓 存 中 ） ， 用 户 访
问 时 可 以 只 读 取memcached缓 存 ， 不 读 取 数 据 库 了 。
b、 执 点 缓 存 （ 难 ）
需 要 前 端web程 序 配 合 ， 只 缓 存 热 点 的 数 据 ， 即 缓 存 经 常 被 访 问 的 数 据 。
先 预 热 数 据 库 里 的 基 础 数 据 ， 然 后 在 动 态 更 新 ， 选 读 取 缓 存 ， 如 果 缓 存 里 没 有 对
应 的 数 据 ， 程 序 再 去 读 取 数 据 库 ， 然 后 程 序 把 读 取 的 新 数 据 放 入 缓 存 存 储 。
```

```
特 殊 说 明 ：
```

 如果碰到电商秒杀等高并发的业务，一定要事先预热，或者其它思想实现，
例如：称杀只是获取资格，而不是瞬间秒杀到手商品。

那么什么是获取资格？_
 就是在数据库中，把 0 标成1.就有资格啦。再慢慢的去领取商品订单。
因为秒杀过程太长会占用服务器资源。
 如果数据更新，同时触发缓存更新，防止给用户过期数据。
 对于持久化缓存存储系统，例如：redis，可以替代一部分数据库的存储，
一些简单的数据业务，投票，统计，好友关注，商品分类等。nosql=notonly
sql


```
二 、 作 业 集 群 的session会 话 共 享 存 储 。
```

 Memcached服务在不同企业业务应用场景中的工作流程
 当web程序需要访问后端数据库获取数据时会优先访问Memcached内
存缓存，如果缓存中有数据就直接获取返回前端服务及用户，如果没有数据（没
有命中），在由程序请求后端的数据库服务器，获取到对应的数据后，除了返回
给前端服务及用户数据外，还会把数据放到Memcached内存中进行缓存，等
待下次请求被访问，Memcache内存始终是数据库的挡箭牌，从而大大的减轻
数据库的访问压力，提高整个网站架构的响应速度，提升了用户体验。
 当程序更新，修改或删除数据库中已有的数据时，会同时发送请求通知
Memcached已经缓存的同一个ID内容的旧数据失效，从而保证Memcache
中数据和数据库中的数据一致。
 如果在高并发场合，除了通知Memcached过程的缓存失效外，还会通
过相关机制，使得在用户访问新数据前，通过程序预先把更新过的数据推送到
memcache中缓存起来，这样可以减少数据库的访问压力，提升Memcached
中缓存命中率。
 数据库插件可以再写入更新数据库后，自动抛给MC缓存起来，自身不
Cache.

### 2 、Memcached服务分布式集群如何实现？.....................................

```
特 殊 说 明：Memcached集 群 和web服 务 集 群 是 不 一 样 的，所 有Memcached的
数 据 总 和 才 是 数 据 库 的 数 据 。 每 台Memcached都 是 部 分 数 据 。
（ 一 台memcached的 数 据 ， 就 是 一 部 分mysql数 据 库 的 数 据 ）
```

```
a、 程 序 端 实 现
程 序 加 载 所 有mc的ip列 表 ， 通 过 对key做hash(一 致 性 哈 希 算 法)
```

例 如：web1(key)===>对 应A,B,C,D,E,F,G.....若 干 台 服 务 器。（通 过 哈 希 算 法 实
现 ）

b、 负 载 均 衡 器
通 过 对key做hash(一 致 性 哈 希 算 法)

一 致 哈 希 算 法 的 目 的 是 不 但 保 证 每 个 对 象 只 请 求 一 个 对 应 的 服 务 器 ， 而 且 当 节 点
宕 机 ， 缓 存 服 务 器 的 更 新 重 新 分 配 比 例 降 到 最 低 。

### 3 、Memcached服务特点及工作原理是什么？.................................

a、 完 全 基 于 内 存 缓 存 的
b、 节 点 之 间 相 互 独 立
c、C/S模 式 架 构 ，C语 言 编 写 ， 总 共 2000 行 代 码 。
d、 异 步 Ｉ/O 模 型 ， 使 用libevent作 为 事 件 通 知 机 制 。
e、 被 缓 存 的 数 据 以key/value键 值 对 形 式 存 在 的 。
f、 全 部 数 据 存 放 于 内 存 中 ， 无 持 久 性 存 储 的 设 计 ， 重 启 服 务 器 ， 内 存 里 的 数 据 会
丢 失 。
g、 当 内 存 中 缓 存 的 数 据 容 量 达 到 启 动 时 设 定 的 内 存 值 时 ， 就 自 动 使 用LRU算 法
删 除 过 期 的 缓 存 数 据 。
h、可 以 对 存 储 的 数 据 设 置 过 期 时 间，这 样 过 期 后 的 数 据 自 动 被 清 除，服 务 本 身 不
会 监 控 过 期 ， 而 是 在 访 问 的 时 候 查 看key的 时 间 戳,判 断 是 否 过 期 。
j、memcache会 对 设 定 的 内 存 进 行 分 块 ， 再 把 块 分 组 ， 然 后 再 提 供 服 务 。

### 4 、简述Memcached内存管理机制原理？........................................

早 期 的Memcached内 存 管 理 方 式 是 通 过malloc的 分 配 的 内 存 ， 使 用 完 后 通过
free来 回 收 内 存 ， 这 种 方 式 容 易 产 生 内 存 碎 片 ， 并 降 低 操 作 系 统 对 内 存 的 管 理 效
率 。 加 重 操 作 系 统 内 存 管 理 器 的 负 担 ， 最 坏 的 情 况 下 ， 会 导 致 操 作 系 统比


memcached进 程 本 身 还 慢 ， 为 了 解 决 这 个 问 题 ，SlabAllocation内 存 分 配 机 制
就 延 生 了 。

现 在Memcached利 用SlabAllocation机 制 来 分 配 和 管 理 内 存 。

Slab
Allocation机 制 原 理 是 按 照 预 先 规 定 的 大 小 ， 将 分 配 给memcached的 内 存 分 割
成 特 定 长 度 的 内 存 块 （chunk)， 再 把 尺 寸 相 同 的 内 存 块 ， 分 成 组
（chunksslabclass),这 些 内 存 块 不 会 释 放 ， 可 以 重 复 利 用 。

而 且 ，slaballocator还 有 重 复 使 用 已 分 配 的 内 存 的 目 的 。 也 就 是 说 ， 分 配 到 的
内 存 不 会 释 放 ， 而 是 重 复 利 用 。

**SlabAllocation** 的 主 要 术 语

Page

分 配 给Slab的 内 存 空 间，默 认 是1MB。分 配 给Slab之 后 根 据slab的 大 小 切 分成
chunk。

Chunk

#### 用 于 缓 存 记 录 的 内 存 空 间 。

SlabClass

特 定 大 小 的chunk的 组 。

#### 集 群 架 构 方 面 的 问 题


### 5 、memcached是怎么工作的？.........................................................

Memcached的 神 奇 来 自 两 阶 段 哈 希 （two-stagehash） 。Memcached就 像 一
个 巨 大 的、存 储 了 很 多<key,value>对 的 哈 希 表。通 过key，可 以 存 储 或 查 询 任 意
的 数 据 。

客 户 端 可 以 把 数 据 存 储 在 多 台memcached上 。 当 查 询 数 据 时 ， 客 户 端 首 先 参 考
节 点 列 表 计 算 出key的 哈 希 值 （ 阶 段 一 哈 希 ） ， 进 而 选 中 一 个 节 点 ； 客 户 端 将 请
求 发 送 给 选 中 的 节 点 ， 然 后memcached节 点 通 过 一 个 内 部 的 哈 希 算 法 （ 阶 段 二
哈 希 ） ， 查 找 真 正 的 数 据 （item） 。

### 6 、memcached最大的优势是什么？.................................................

Memcached最 大 的 好 处 就 是 它 带 来 了 极 佳 的 水 平 可 扩 展 性，特 别 是 在 一 个 巨 大 的
系 统 中 。 由 于 客 户 端 自 己 做 了 一 次 哈 希 ， 那 么 我 们 很 容 易 增 加 大 量memcached
到 集 群 中。memcached之 间 没 有 相 互 通 信，因 此 不 会 增 加 memcached的 负 载；
没 有 多 播 协 议 ， 不 会 网 络 通 信 量 爆 炸 （implode） 。memcached的 集 群 很 好 用。
内 存 不 够 了 ？ 增 加 几 台memcached吧 ；CPU不 够 用 了 ？ 再 增 加 几 台 吧 ； 有 多 余
的 内 存 ？ 在 增 加 几 台 吧 ， 不 要 浪 费 了 。

基 于memcached的 基 本 原 则 ， 可 以 相 当 轻 松 地 构 建 出 不 同 类 型 的 缓 存 架 构 。 除
了 这 篇FAQ， 在 其 他 地 方 很 容 易 找 到 详 细 资 料 的 。

### 7 、memcached和MySQL的query.................................................

cache相 比 ， 有 什 么 优 缺 点 ？


```
把memcached引 入 应 用 中 ， 还 是 需 要 不 少 工 作 量 的 。MySQL有 个 使 用 方 便的
querycache， 可 以 自 动 地 缓 存SQL查 询 的 结 果 ， 被 缓 存 的SQL查 询 可 以 被 反 复
地 快 速 执 行。Memcached与 之 相 比，怎 么 样 呢 ？MySQL的querycache是 集 中
式 的 ， 连 接 到 该querycache的MySQL服 务 器 都 会 受 益 。
```

 当您修改表时，MySQL的querycache会立刻被刷新（flush）。存储
一个memcacheditem只需要很少的时间，但是当写操作很频繁时，MySQL
的querycache会经常让所有缓存数据都失效。
 在多核CPU上，MySQL的querycache会遇到扩展问题（scalability
issues）。在多核CPU上，querycache会增加一个全局锁（globallock）, 由
于需要刷新更多的缓存数据，速度会变得更慢。
 在 MySQL的querycache中，我们是不能存储任意的数据的（只能是
SQL查询结果）。而利用memcached，我们可以搭建出各种高效的缓存。比
如，可以执行多个独立的查询，构建出一个用户对象（userobject），然后将
用户对象缓存到memcached中。而querycache是SQL语句级别的，不可能
做到这一点。在小的网站中，querycache会有所帮助，但随着网站规模的增加，
querycache的弊将大于利。
 querycache能够利用的内存容量受到MySQL服务器空闲内存空间的限
制。给数据库服务器增加更多的内存来缓存数据，固然是很好的。但是，有了
memcached，只要您有空闲的内存，都可以用来增加memcached集群的规
模，然后您就可以缓存更多的数据。

### 8 、memcached和服务器的localcache（比如PHP的APC、

### mmap文件等）相比，有什么优缺点？

```
首 先 ，localcache有 许 多 与 上 面(querycache)相 同 的 问 题 。localcache能 够 利
用 的 内 存 容 量 受 到 （ 单 台 ） 服 务 器 空 闲 内 存 空 间 的 限 制 。 不 过 ，local
```

```
cache有 一 点 比memcached和querycache都 要 好 ， 那 就 是 它 不 但 可 以 存 储 任
意 的 数 据 ， 而 且 没 有 网 络 存 取 的 延 迟 。
```

 localcache的数据查询更快。考虑把highlycommon的数据放在local
cache中吧。如果每个页面都需要加载一些数量较少的数据，考虑把它们放在
local

cached吧。
 localcache缺少集体失效（group

invalidation）的特性。在memcached集群中，删除或更新一个key会让所有
的观察者觉察到。但是在localcache中,我们只能通知所有的服务器刷新cache
（很慢，不具扩展性），或者仅仅依赖缓存超时失效机制。
 localcache面临着严重的内存限制，这一点上面已经提到。

### 9 、memcached的cache机制是怎样的？........................................

```
Memcached主 要 的cache机 制 是LRU（ 最 近 最 少 用 ） 算 法+超 时 失 效 。 当 您 存
数 据 到memcached中 ， 可 以 指 定 该 数 据 在 缓 存 中 可 以 呆 多 久Whichisforever,
orsometimeinthefuture。 如 果memcached的 内 存 不 够 用 了 ， 过 期 的slabs
会 优 先 被 替 换 ， 接 着 就 轮 到 最 老 的 未 被 使 用 的slabs。
```

### 10 、memcached如何实现冗余机制？...............................................

```
不 实 现！我 们 对 这 个 问 题 感 到 很 惊 讶。Memcached应 该 是 应 用 的 缓 存 层。它 的 设
计 本 身 就 不 带 有 任 何 冗 余 机 制 。 如 果 一 个memcached节 点 失 去 了 所 有 数 据 ， 您
应 该 可 以 从 数 据 源 （ 比 如 数 据 库 ） 再 次 获 取 到 数 据 。 您 应 该 特 别 注 意 ， 您 的 应 用
应 该 可 以 容 忍 节 点 的 失 效 。 不 要 写 一 些 糟 糕 的 查 询 代 码 ， 寄 希 望 于 memcached
```

#### 来 保 证 一 切 ！ 如 果 您 担 心 节 点 失 效 会 大 大 加 重 数 据 库 的 负 担 ， 那 么 您 可 以 采 取 一

#### 些 办 法 。 比 如 您 可 以 增 加 更 多 的 节 点 （ 来 减 少 丢 失 一 个 节 点 的 影 响 ） ， 热 备 节 点

```
（ 在 其 他 节 点down了 的 时 候 接 管IP） ， 等 等 。
```

### 11 、memcached如何处理容错的？...................................................

```
不 处 理！ 在memcached节 点 失 效 的 情 况 下，集 群 没 有 必 要 做 任 何 容 错 处 理。如
果 发 生 了 节 点 失 效 ， 应 对 的 措 施 完 全 取 决 于 用 户 。 节 点 失 效 时 ， 下 面 列 出 几 种 方
案 供 您 选 择 ：
```

 忽略它！ 在失效节点被恢复或替换之前，还有很多其他节点可以应对节
点失效带来的影响。
 把失效的节点从节点列表中移除。做这个操作千万要小心！在默认情况下
（余数式哈希算法），客户端添加或移除节点，会导致所有的缓存数据不可用！
因为哈希参照的节点列表变化了，大部分key会因为哈希值的改变而被映射到
（与原来）不同的节点上。
 启动热备节点，接管失效节点所占用的IP。这样可以防止哈希紊乱
（hashingchaos）。
 如果希望添加和移除节点，而不影响原先的哈希结果，可以使用一致性哈
希算法（consistenthashing）。您可以百度一下一致性哈希算法。支持一致性
哈希的客户端已经很成熟，而且被广泛使用。去尝试一下吧！
 两次哈希（reshing）。当客户端存取数据时，如果发现一个节点down
了，就再做一次哈希（哈希算法与前一次不同），重新选择另一个节点（需要注
意的时，客户端并没有把down的节点从节点列表中移除，下次还是有可能先
哈希到它）。如果某个节点时好时坏，两次哈希的方法就有风险了，好的节点和
坏的节点上都可能存在脏数据（staledata）。

### 12 、如何将memcached中item批量导入导出？...........................


您 不 应 该 这 样 做 ！Memcached是 一 个 非 阻 塞 的 服 务 器 。 任 何 可 能 导致
memcached暂 停 或 瞬 时 拒 绝 服 务 的 操 作 都 应 该 值 得 深 思 熟 虑 。 向 memcached
中 批 量 导 入 数 据 往 往 不 是 您 真 正 想 要 的 ！ 想 象 看 ， 如 果 缓 存 数 据 在 导 出 导 入 之 间
发 生 了 变 化 ， 您 就 需 要 处 理 脏 数 据 了 ；

### 13 、如果缓存数据在导出导入之间过期了，您又怎么处理这些数据呢？

#### 因 此 ， 批 量 导 出 导 入 数 据 并 不 像 您 想 象 中 的 那 么 有 用 。 不 过 在 一 个 场 景 倒 是 很 有

用。如 果 您 有 大 量 的 从 不 变 化 的 数 据，并 且 希 望 缓 存 很 快 热（warm）起 来，批 量
导 入 缓 存 数 据 是 很 有 帮 助 的 。 虽 然 这 个 场 景 并 不 典 型 ， 但 却 经 常 发 生 ， 因 此 我 们
会 考 虑 在 将 来 实 现 批 量 导 出 导 入 的 功 能 。

如 果 一 个memcached节 点down了 让 您 很 痛 苦，那 么 您 还 会 陷 入 其 他 很 多 麻 烦。
您 的 系 统 太 脆 弱 了 。 您 需 要 做 一 些 优 化 工 作 。 比 如 处 理”惊 群”问 题 （ 比 如
memcached节 点 都 失 效 了，反 复 的 查 询 让 您 的 数 据 库 不 堪 重 负...这 个 问 题在FAQ
的 其 他 提 到 过 ） ， 或 者 优 化 不 好 的 查 询 。 记 住 ，Memcached 并 不 是 您 逃 避 优 化
查 询 的 借 口 。

### 14 、memcached是如何做身份验证的？...........................................

没 有 身 份 认 证 机 制！memcached是 运 行 在 应 用 下 层 的 软 件（身 份 验 证 应 该 是 应 用
上 层 的 职 责）。memcached的 客 户 端 和 服 务 器 端 之 所 以 是 轻 量 级 的，部 分 原 因 就
是 完 全 没 有 实 现 身 份 验 证 机 制。这 样，memcached可 以 很 快 地 创 建 新 连 接，服 务
器 端 也 无 需 任 何 配 置 。


如 果 您 希 望 限 制 访 问，您 可 以 使 用 防 火 墙，或 者 让memcached监 听unixdomain
socket。

### 15 、memcached的多线程是什么？如何使用它们？.......................

线 程 就 是 定 律 （threadsrule） ！ 在StevenGrimm和Facebook的 努 力 下 ，
memcached1.2及 更 高 版 本 拥 有 了 多 线 程 模 式。多 线 程 模 式 允 许memcached能
够 充 分 利 用 多 个CPU，并 在CPU之 间 共 享 所 有 的 缓 存 数 据。memcached使 用 一
种 简 单 的 锁 机 制 来 保 证 数 据 更 新 操 作 的 互 斥 。 相 比 在 同 一 个 物 理 机 器 上 运 行 多个
memcached实 例 ， 这 种 方 式 能 够 更 有 效 地 处 理multigets。

如 果 您 的 系 统 负 载 并 不 重 ， 也 许 您 不 需 要 启 用 多 线 程 工 作 模 式 。 如 果 您 在 运 行 一
个 拥 有 大 规 模 硬 件 的 、 庞 大 的 网 站 ， 您 将 会 看 到 多 线 程 的 好 处 。

简 单 地 总 结 一 下：命 令 解 析（memcached在 这 里 花 了 大 部 分 时 间）可 以 运 行 在 多
线 程 模 式 下。memcached内 部 对 数 据 的 操 作 是 基 于 很 多 全 局 锁 的（因 此 这 部 分 工
作 不 是 多 线 程 的 ） 。 未 来 对 多 线 程 模 式 的 改 进 ， 将 移 除 大 量 的 全 局 锁 ， 提高
memcached在 负 载 极 高 的 场 景 下 的 性 能 。

### 16 、memcached能接受的key的最大长度是多少？......................

key的 最 大 长 度 是 250 个 字 符 。 需 要 注 意 的 是 ， 250 是memcached服 务 器 端 内
部 的 限 制，如 果 您 使 用 的 客 户 端 支 持”key的 前 缀”或 类 似 特 性，那 么key（前 缀
+原 始key）的 最 大 长 度 是 可 以 超 过 250 个 字 符 的。我 们 推 荐 使 用 使 用 较 短 的key，
因 为 可 以 节 省 内 存 和 带 宽 。

memcached对item的 过 期 时 间 有 什 么 限 制 ？


过 期 时 间 最 大 可 以 达 到 30 天。memcached把 传 入 的 过 期 时 间（时 间 段）解 释 成
时 间 点 后，一 旦 到 了 这 个 时 间 点，memcached就 把item置 为 失 效 状 态。这 是 一
个 简 单 但obscure的 机 制 。

### 17 、memcached最大能存储多大的单个item？.............................

1MB。 如 果 你 的 数 据 大 于1MB， 可 以 考 虑 在 客 户 端 压 缩 或 拆 分 到 多 个key中 。

为 什 么 单 个item的 大 小 被 限 制 在1Mbyte之 内 ？

啊...这 是 一 个 大 家 经 常 问 的 问 题 ！

简 单 的 回 答 ： 因 为 内 存 分 配 器 的 算 法 就 是 这 样 的 。

详 细 的 回 答：Memcached的 内 存 存 储 引 擎（引 擎 将 来 可 插 拔...），使 用slabs来
管 理 内 存。内 存 被 分 成 大 小 不 等 的slabschunks（先 分 成 大 小 相 等 的slabs，然 后
每 个slab被 分 成 大 小 相 等chunks，不 同slab的chunk大 小 是 不 相 等 的）。chunk
的 大 小 依 次 从 一 个 最 小 数 开 始 ， 按 某 个 因 子 增 长 ， 直 到 达 到 最 大 的 可 能 值 。

### 18 、memcached能够更有效地使用内存吗？...................................

Memcache客 户 端 仅 根 据 哈 希 算 法 来 决 定 将 某 个key存 储 在 哪 个 节 点 上，而 不 考
虑 节 点 的 内 存 大 小 。 因 此 ， 您 可 以 在 不 同 的 节 点 上 使 用 大 小 不 等 的 缓 存 。 但 是 一
般 都 是 这 样 做 的 ： 拥 有 较 多 内 存 的 节 点 上 可 以 运 行 多 个memcached实 例 ， 每 个
实 例 使 用 的 内 存 跟 其 他 节 点 上 的 实 例 相 同 。

### 19 、什么是二进制协议，我该关注吗？...............................................


#### 关 于 二 进 制 最 好 的 信 息 当 然 是 二 进 制 协 议 规 范 ：

#### 二 进 制 协 议 尝 试 为 端 提 供 一 个 更 有 效 的 、 可 靠 的 协 议 ， 减 少 客 户 端/服 务 器 端 因 处

#### 理 协 议 而 产 生 的CPU时 间 。

根 据Facebook的 测 试，解 析ASCII协 议 是memcached中 消 耗CPU时 间 最 多 的
环 节 。 所 以 ， 我 们 为 什 么 不 改 进ASCII协 议 呢 ？

### 20 、memcached的内存分配器是如何工作的？为什么不适用

### malloc/free！？为何要使用slabs？

实 际 上 ， 这 是 一 个 编 译 时 选 项 。 默 认 会 使 用 内 部 的slab分 配 器 。 您 确 实 确 实 应 该
使 用 内 建 的slab分 配 器。最 早 的 时 候，memcached只 使 用 malloc/free来 管 理
内 存。然 而，这 种 方 式 不 能 与OS的 内 存 管 理 以 前 很 好 地 工 作。反 复 地malloc/free
造 成 了 内 存 碎 片 ，OS最 终 花 费 大 量 的 时 间 去 查 找 连 续 的 内 存 块 来 满 足malloc的
请 求，而 不 是 运 行memcached进 程。如 果 您 不 同 意，当 然 可 以 使 用malloc！只

是 不 要 在 邮 件 列 表 中 抱 怨 啊

slab分 配 器 就 是 为 了 解 决 这 个 问 题 而 生 的。内 存 被 分 配 并 划 分 成chunks，一 直 被
重 复 使 用。因 为 内 存 被 划 分 成 大 小 不 等 的slabs，如 果item 的 大 小 与 被 选 择 存 放
它 的slab不 是 很 合 适 的 话 ， 就 会 浪 费 一 些 内 存 。StevenGrimm正 在 这 方 面 已 经
做 出 了 有 效 的 改 进 。

### 21 、memcached是原子的吗？...........................................................


所 有 的 被 发 送 到memcached的 单 个 命 令 是 完 全 原 子 的 。 如 果 您 针 对 同 一 份 数 据
同 时 发 送 了 一 个set命 令 和 一 个get命 令，它 们 不 会 影 响 对 方。它 们 将 被 串 行 化、
先 后 执 行 。 即 使 在 多 线 程 模 式 ， 所 有 的 命 令 都 是 原 子 的 ， 除 非 程 序 有bug:)

命 令 序 列 不 是 原 子 的 。 如 果 您 通 过get命 令 获 取 了 一 个item， 修 改 了 它 ， 然 后 想
把 它set回memcached， 我 们 不 保 证 这 个item没 有 被 其 他 进 程 （process， 未
必 是 操 作 系 统 中 的 进 程 ） 操 作 过 。 在 并 发 的 情 况 下 ， 您 也 可 能 覆 写 了 一 个 被 其 他
进 程set的item。

memcached1.2.5以 及 更 高 版 本 ， 提 供 了gets和cas命 令 ， 它 们 可 以 解 决 上 面
的 问 题 。 如 果 您 使 用gets命 令 查 询 某 个key的item，memcached会 给 您 返 回
该item当 前 值 的 唯 一 标 识。如 果 您 覆 写 了 这个item并 想 把 它 写 回到memcached
中，您 可 以 通 过cas命 令 把 那 个 唯 一 标 识 一 起 发 送 给 memcached。如 果 该item
存 放 在memcached中 的 唯 一 标 识 与 您 提 供 的 一 致 ， 您 的 写 操 作 将 会 成 功 。 如 果
另 一 个 进 程 在 这 期 间 也 修 改 了 这 个 item，那 么 该item存 放 在memcached中 的
唯 一 标 识 将 会 改 变 ， 您 的 写 操 作 就 会 失 败

### 22 、如何实现集群中的session共享存储？.......................................

Session是 运 行 在 一 台 服 务 器 上 的，所 有 的 访 问 都 会 到 达 我 们 的 唯 一 服 务 器 上，这
样 我 们 可 以 根 据 客 户 端 传 来 的sessionID，来 获 取session，或 在 对 应Session不
存 在 的 情 况 下（session 生 命 周 期 到 了/用 户 第 一 次 登 录），创 建 一 个 新 的Session；
但 是 ， 如 果 我 们 在 集 群 环 境 下 ， 假 设 我 们 有 两 台 服 务 器A，B， 用 户 的 请 求 会由
Nginx服 务 器 进 行 转 发 （ 别 的 方 案 也 是 同 理 ） ， 用 户 登 录 时 ，Nginx将 请 求 转 发
至 服 务 器A上，A创 建 了 新 的session，并 将SessionID返 回 给 客 户 端，用 户 在 浏
览 其 他 页 面 时 ， 客 户 端 验 证 登 录 状 态 ，Nginx将 请 求 转 发 至 服 务 器B， 由 于B上
并 没 有 对 应 客 户 端 发 来sessionId的session，所 以 会 重 新 创 建 一 个 新 的session，
并 且 再 将 这 个 新 的sessionID返 回 给 客 户 端 ， 这 样 ， 我 们 可 以 想 象 一 下 ， 用 户 每
一 次 操 作 都 有1/2的 概 率 进 行 再 次 的 登 录 ， 这 样 不 仅 对 用 户 体 验 特 别 差 ， 还 会 让
服 务 器 上 的session激 增 ， 加 大 服 务 器 的 运 行 压 力 。


为 了 解 决 集 群 环 境 下 的seesion共 享 问 题 ， 共 有 4 种 解 决 方 案 ：

1.粘 性session

粘 性session是 指Ngnix每 次 都 将 同 一 用 户 的 所 有 请 求 转 发 至 同 一 台 服 务 器 上 ，
即 将 用 户 与 服 务 器 绑 定 。

2.服 务 器session复 制

即 每 次session发 生 变 化 时 ， 创 建 或 者 修 改 ， 就 广 播 给 所 有 集 群 中 的 服 务 器 ， 使
所 有 的 服 务 器 上 的session相 同 。

3.session共 享

缓 存session， 使 用redis， memcached。

4.session持 久 化

将session存 储 至 数 据 库 中 ， 像 操 作 数 据 一 样 才 做session。

### 23 、memcached与redis的区别？...................................................

1 、Redis不 仅 仅 支 持 简 单 的k/v类 型 的 数 据，同 时 还 提 供list，set，zset，hash
等 数 据 结 构 的 存 储。而memcache只 支 持 简 单 数 据 类 型，需 要 客 户 端 自 己 处 理 复
杂 对 象

2 、Redis支 持 数 据 的 持 久 化 ， 可 以 将 内 存 中 的 数 据 保 持 在 磁 盘 中 ， 重 启 的 时 候 可
以 再 次 加 载 进 行 使 用 （PS： 持 久 化 在rdb、aof） 。


3 、 由 于Memcache没 有 持 久 化 机 制 ， 因 此 宕 机 所 有 缓 存 数 据 失 效 。Redis配 置
为 持 久 化 ， 宕 机 重 启 后 ， 将 自 动 加 载 宕 机 时 刻 的 数 据 到 缓 存 系 统 中 。 具 有 更 好 的
灾 备 机 制 。

4 、Memcache可 以 使 用Magent在 客 户 端 进 行 一 致 性hash做 分 布 式。Redis支
持 在 服 务 器 端 做 分 布 式（PS:Twemproxy/Codis/Redis-cluster多 种 分 布 式 实 现 方
式 ）

5 、Memcached的 简 单 限 制 就 是 键（key）和Value的 限 制。最 大 键 长 为 250 个
字 符 。 可 以 接 受 的 储 存 数 据 不 能 超 过1MB（ 可 修 改 配 置 文 件 变 大 ） ， 因 为 这 是 典
型slab 的 最 大 值 ， 不 适 合 虚 拟 机 使 用 。 而Redis的Key长 度 支 持 到512k。

6 、Redis使 用 的 是 单 线 程 模 型 ， 保 证 了 数 据 按 顺 序 提 交 。Memcache需 要 使用
cas保 证 数 据 一 致 性 。CAS（CheckandSet） 是 一 个 确 保 并 发 一 致 性 的 机 制 ， 属
于“乐 观 锁”范 畴 ； 原 理 很 简 单 ： 拿 版 本 号 ， 操 作 ， 对 比 版 本 号 ， 如 果 一 致 就 操
作 ， 不 一 致 就 放 弃 任 何 操 作

cpu利 用 。 由 于Redis只 使 用 单 核 ， 而Memcached可 以 使 用 多 核 ， 所 以 平 均 每
一 个 核 上Redis在 存 储 小 数 据 时 比Memcached性 能 更 高。而 在100k以 上 的 数
据 中 ，Memcached性 能 要 高 于Redis 。

7 、memcache内 存 管 理 ： 使 用SlabAllocation。 原 理 相 当 简 单 ， 预 先 分 配 一 系
列 大 小 固 定 的 组，然 后 根 据 数 据 大 小 选 择 最 合 适 的 块 存 储。避 免 了 内 存 碎 片。（缺
点 ： 不 能 变 长 ， 浪 费 了 一 定 空 间 ）memcached默 认 情 况 下 下 一 个slab的 最 大 值
为 前 一 个 的1.25倍 。

8 、redis内 存 管 理：Redis通 过 定 义 一 个 数 组 来 记 录 所 有 的 内 存 分 配 情 况，Redis
采 用 的 是 包 装 的malloc/free，相 较 于Memcached的 内 存 管 理 方 法 来 说，要 简
单 很 多。由 于malloc 首 先 以 链 表 的 方 式 搜 索 已 管 理 的 内 存 中 可 用 的 空 间 分 配，导
致 内 存 碎 片 比 较 多


## Redis 面试题...........................................................................................................

### 1 、什么是Redis?....................................................................................

Redis 是 完 全 开 源 免 费 的 ， 遵 守BSD协 议 ， 是 一 个 高 性 能 的key-value数 据 库。

**Redis 与 其 他 key-value 缓 存 产 品 有 以 下 三 个 特 点 ：**

Redis支 持 数 据 的 持 久 化，可 以 将 内 存 中 的 数 据 保 存 在 磁 盘 中，重 启 的 时 候 可 以 再
次 加 载 进 行 使 用 。
Redis不 仅 仅 支 持 简 单 的key-value类 型 的 数 据 ， 同 时 还 提 供list，set，zset，
hash等 数 据 结 构 的 存 储 。
Redis支 持 数 据 的 备 份 ， 即master-slave模 式 的 数 据 备 份 。

**Redis 优 势**

性 能 极 高 – Redis能 读 的 速 度 是 110000 次/s,写 的 速 度 是 81000 次/s 。
丰 富 的 数 据 类 型 – Redis支 持 二 进 制 案 例 的 Strings,Lists,Hashes,Sets 及
OrderedSets 数 据 类 型 操 作 。
原 子 – Redis的 所 有 操 作 都 是 原 子 性 的，意 思 就 是 要 么 成 功 执 行 要 么 失 败 完 全 不
执 行。单 个 操 作 是 原 子 性 的。多 个 操 作 也 支 持 事 务，即 原 子 性，通 过MULTI和EXEC
指 令 包 起 来 。
丰 富 的 特 性 – Redis还 支 持 publish/subscribe, 通 知,key 过 期 等 等 特 性 。

**Redis与 其 他key-value存 储 有 什 么 不 同 ？**

Redis有 着 更 为 复 杂 的 数 据 结 构 并 且 提 供 对 他 们 的 原 子 性 操 作，这 是 一 个 不 同 于 其
他 数 据 库 的 进 化 路 径。Redis的 数 据 类 型 都 是 基 于 基 本 数 据 结 构 的 同 时 对 程 序 员 透
明 ， 无 需 进 行 额 外 的 抽 象 。


Redis运 行 在 内 存 中 但 是 可 以 持 久 化 到 磁 盘，所 以 在 对 不 同 数 据 集 进 行 高 速 读 写 时
需 要 权 衡 内 存 ， 因 为 数 据 量 不 能 大 于 硬 件 内 存 。 在 内 存 数 据 库 方 面 的 另 一 个 优 点
是，相 比 在 磁 盘 上 相 同 的 复 杂 的 数 据 结 构，在 内 存 中 操 作 起 来 非 常 简 单，这 样Redis
可 以 做 很 多 内 部 复 杂 性 很 强 的 事 情 。 同 时 ， 在 磁 盘 格 式 方 面 他 们 是 紧 凑 的 以 追 加
的 方 式 产 生 的 ， 因 为 他 们 并 不 需 要 进 行 随 机 访 问 。

### 2 、Redis的数据类型？..........................................................................

答：Redis支 持 五 种 数 据 类 型：string（字 符 串），hash（哈 希），list（列 表），
set（ 集 合 ） 及zsetsortedset： 有 序 集 合)。

我 们 实 际 项 目 中 比 较 常 用 的 是string，hash如 果 你 是Redis中 高 级 用 户，还 需 要
加 上 下 面 几 种 数 据 结 构HyperLogLog、Geo、Pub/Sub。

如 果 你 说 还 玩 过RedisModule，像BloomFilter，RedisSearch，Redis-ML，面
试 官 得 眼 睛 就 开 始 发 亮 了 。

### 3 、使用Redis有哪些好处？.................................................................

1 、 速 度 快 ， 因 为 数 据 存 在 内 存 中 ， 类 似 于HashMap，HashMap的 优 势 就 是 查
找 和 操 作 的 时 间 复 杂 度 都 是O1)

2 、 支 持 丰 富 数 据 类 型 ， 支 持string，list，set，Zset，hash等

3 、 支 持 事 务 ， 操 作 都 是 原 子 性 ， 所 谓 的 原 子 性 就 是 对 数 据 的 更 改 要 么 全 部 执 行，
要 么 全 部 不 执 行

4 、丰 富 的 特 性：可 用 于 缓 存，消 息，按key设 置 过 期 时 间，过 期 后 将 会 自 动 删 除


### 4 、Redis相比Memcached有哪些优势？........................................

1 、Memcached所 有 的 值 均 是 简 单 的 字 符 串 ，redis作 为 其 替 代 者 ， 支 持 更 为 丰
富 的 数 据 类
2 、Redis的 速 度 比Memcached快 很
3 、Redis可 以 持 久 化 其 数 据

### 5 、Memcache与Redis的区别都有哪些？.......................................

1 、 存 储 方 式 Memecache把 数 据 全 部 存 在 内 存 之 中 ， 断 电 后 会 挂 掉 ， 数 据 不 能
超 过 内 存 大 小 。 Redis有 部 份 存 在 硬 盘 上 ， 这 样 能 保 证 数 据 的 持 久 性 。

2 、数 据 支 持 类 型 Memcache对 数 据 类 型 支 持 相 对 简 单。 Redis有 复 杂 的 数 据 类
型 。

3 、使 用 底 层 模 型 不 同 它 们 之 间 底 层 实 现 方 式 以 及 与 客 户 端 之 间 通 信 的 应 用 协 议
不 一 样。 Redis直 接 自 己 构 建 了VM 机 制 ，因 为 一 般 的 系 统 调 用 系 统 函 数 的 话，
会 浪 费 一 定 的 时 间 去 移 动 和 请 求 。

### 6 、Redis是单进程单线程的？..............................................................

答 ：Redis是 单 进 程 单 线 程 的 ，redis利 用 队 列 技 术 将 并 发 访 问 变 为 串 行 访 问 ， 消
除 了 传 统 数 据 库 串 行 控 制 的 开 销 。

### 7 、一个字符串类型的值能存储最大容量是多少？.............................


#### 答 ：512M

### 8 、Redis的持久化机制是什么？各自的优缺点？..............................

**Redis提 供 两 种 持 久 化 机 制RDB和AOF机 制:**

1 、RDBRedisDataBase)持 久 化 方 式 ： 是 指 用 数 据 集 快 照 的 方 式 半 持 久 化 模 式)
记 录redis数 据 库 的 所 有 键 值 对,在 某 个 时 间 点 将 数 据 写 入 一 个 临 时 文 件 ， 持 久 化
结 束 后 ， 用 这 个 临 时 文 件 替 换 上 次 持 久 化 的 文 件 ， 达 到 数 据 恢 复 。

**优 点 ：**

1 、 只 有 一 个 文 件dump.rdb， 方 便 持 久 化 。

#### 2 、 容 灾 性 好 ， 一 个 文 件 可 以 保 存 到 安 全 的 磁 盘 。

3 、 性 能 最 大 化 ，fork子 进 程 来 完 成 写 操 作 ， 让 主 进 程 继 续 处 理 命 令 ， 所 以 是IO
最 大 化。使 用 单 独 子 进 程 来 进 行 持 久 化，主 进 程 不 会 进 行 任何IO操 作，保 证了redis
的 高 性 能)4.相 对 于 数 据 集 大 时 ， 比AOF的 启 动 效 率 更 高 。

**缺 点 ：**

1 、数 据 安 全 性 低。RDB是 间 隔 一 段 时 间 进 行 持 久 化，如 果 持 久 化 之 间redis发 生
故 障 ， 会 发 生 数 据 丢 失 。 所 以 这 种 方 式 更 适 合 数 据 要 求 不 严 谨 的 时 候)

2 、AOFAppend-onlyfile)持 久 化 方 式 ： 是 指 所 有 的 命 令 行 记 录 以redis命 令 请
求 协 议 的 格 式 完 全 持 久 化 存 储)保 存 为aof文 件 。

#### 优 点 ：


1 、 数 据 安 全 ，aof持 久 化 可 以 配 置appendfsync属 性 ， 有always， 每 进 行 一 次
命 令 操 作 就 记 录 到aof文 件 中 一 次 。

2 、 通 过append模 式 写 文 件 ， 即 使 中 途 服 务 器 宕 机 ， 可 以 通 过redis-check-aof
工 具 解 决 数 据 一 致 性 问 题 。

3 、AOF机 制 的rewrite模 式。AOF文 件 没 被rewrite之 前（文 件 过 大 时 会 对 命 令
进 行 合 并 重 写 ） ， 可 以 删 除 其 中 的 某 些 命 令 （ 比 如 误 操 作 的flushall）)

#### 缺 点 ：

#### 1 、AOF文 件 比RDB文 件 大 ， 且 恢 复 速 度 慢 。

2 、 数 据 集 大 的 时 候 ， 比rdb启 动 效 率 低 。

### 9 、Redis常见性能问题和解决方案：..................................................

1 、Master最 好 不 要 写 内 存 快 照，如果Master写 内 存 快 照，save命 令 调度rdbSave
函 数 ， 会 阻 塞 主 线 程 的 工 作 ， 当 快 照 比 较 大 时 对 性 能 影 响 是 非 常 大 的 ， 会 间 断 性
暂 停 服 务
2 、 如 果 数 据 比 较 重 要 ， 某 个Slave开 启AOF备 份 数 据 ， 策 略 设 置 为 每 秒 同 步 一
3 、 为 了 主 从 复 制 的 速 度 和 连 接 的 稳 定 性 ，Master和Slave最 好 在 同 一 个 局 域 网
4 、 尽 量 避 免 在 压 力 很 大 的 主 库 上 增 加 从
5 、主 从 复 制 不 要 用 图 状 结 构，用 单 向 链 表 结 构 更 为 稳 定，即：Master<-Slave1
<-Slave2<-Slave3...这 样 的 结 构 方 便 解 决 单 点 故 障 问 题，实 现Slave对Master
的 替 换 。 如 果Master挂 了 ， 可 以 立 刻 启 用Slave1做Master， 其 他 不 变 。

### 10 、redis过期键的删除策略？.............................................................


1 、定 时 删 除:在 设 置 键 的 过 期 时 间 的 同 时，创 建 一 个 定 时 器timer). 让 定 时 器 在 键
的 过 期 时 间 来 临 时 ， 立 即 执 行 对 键 的 删 除 操 作 。

#### 2 、惰 性 删 除:放 任 键 过 期 不 管，但 是 每 次 从 键 空 间 中 获 取 键 时，都 检 查 取 得 的 键 是

#### 否 过 期 ， 如 果 过 期 的 话 ， 就 删 除 该 键;如 果 没 有 过 期 ， 就 返 回 该 键 。

#### 3 、定 期 删 除:每 隔 一 段 时 间 程 序 就 对 数 据 库 进 行 一 次 检 查，删 除 里 面 的 过 期 键。至

#### 于 要 删 除 多 少 过 期 键 ， 以 及 要 检 查 多 少 个 数 据 库 ， 则 由 算 法 决 定 。

### 11 、Redis的回收策略（淘汰策略）?..................................................

**volatile-lru** ：从 已 设 置 过 期 时 间 的 数 据 集（server.db[i].expires）中 挑 选 最 近 最
少 使 用 的 数 据 淘 汰

**volatile-ttl** ： 从 已 设 置 过 期 时 间 的 数 据 集 （server.db[i].expires） 中 挑 选 将 要 过
期 的 数 据 淘 汰

**volatile-random** ： 从 已 设 置 过 期 时 间 的 数 据 集 （server.db[i].expires） 中 任 意
选 择 数 据 淘 汰

**allkeys-lru** ： 从 数 据 集 （server.db[i].dict） 中 挑 选 最 近 最 少 使 用 的 数 据 淘 汰

**allkeys-random** ： 从 数 据 集 （server.db[i].dict） 中 任 意 选 择 数 据 淘 汰

**no-enviction（ 驱 逐 ）** ： 禁 止 驱 逐 数 据

注 意 这 里 的 6 种 机 制，volatile和allkeys规 定 了 是 对 已 设 置 过 期 时 间 的 数 据 集 淘
汰 数 据 还 是 从 全 部 数 据 集 淘 汰 数 据 ， 后 面 的lru、ttl以 及random是 三 种 不 同 的
淘 汰 策 略 ， 再 加 上 一 种no-enviction永 不 回 收 的 策 略 。


#### 使 用 策 略 规 则 ：

#### 1 、如 果 数 据 呈 现 幂 律 分 布，也 就 是 一 部 分 数 据 访 问 频 率 高，一 部 分 数 据 访 问 频 率

低 ， 则 使 用allkeys-lru

2 、 如 果 数 据 呈 现 平 等 分 布 ， 也 就 是 所 有 的 数 据 访 问 频 率 都 相 同 ， 则 使用
allkeys-random

### 12 、为什么edis需要把所有数据放到内存中？.................................

答：Redis为 了 达 到 最 快 的 读 写 速 度 将 数 据 都 读 到 内 存 中，并 通 过 异 步 的 方 式 将 数
据 写 入 磁 盘。所 以redis具 有 快 速 和 数 据 持 久 化 的 特 征。如 果 不 将 数 据 放 在 内 存 中，
磁 盘I/O速 度 为 严 重 影 响redis的 性 能 。 在 内 存 越 来 越 便 宜 的 今 天 ，redis将 会 越
来 越 受 欢 迎 。 如 果 设 置 了 最 大 使 用 的 内 存 ， 则 数 据 已 有 记 录 数 达 到 内 存 限 值 后 不
能 继 续 插 入 新 值 。

## 13 、Redis的同步机制了解么？...........................................................

答：Redis可 以 使 用 主 从 同 步，从 从 同 步。第 一 次 同 步 时，主 节 点 做 一 次bgsave，
并 同 时 将 后 续 修 改 操 作 记 录 到 内 存buffer， 待 完 成 后 将rdb文 件 全 量 同 步 到 复 制
节 点 ， 复 制 节 点 接 受 完 成 后 将rdb镜 像 加 载 到 内 存 。 加 载 完 成 后 ， 再 通 知 主 节 点
将 期 间 修 改 的 操 作 记 录 同 步 到 复 制 节 点 进 行 重 放 就 完 成 了 同 步 过 程 。

## 14 、Pipeline有什么好处，为什么要用pipeline？..........................

答：可 以 将 多 次IO往 返 的 时 间 缩 减 为 一 次，前 提 是pipeline执 行 的 指 令 之 间 没 有
因 果 相 关 性。使 用redis-benchmark进 行 压 测 的 时 候 可 以 发 现 影 响redis的QPS
峰 值 的 一 个 重 要 因 素 是pipeline批 次 指 令 的 数 目 。


## 15 、是否使用过Redis集群，集群的原理是什么？..........................

1)、RedisSentinal着 眼 于 高 可 用 ， 在master宕 机 时 会 自 动 将slave提 升为
master， 继 续 提 供 服 务 。

2)、RedisCluster着 眼 于 扩 展 性 ， 在 单 个redis内 存 不 足 时 ， 使 用Cluster进 行
分 片 存 储 。

## 16 、Redis集群方案什么情况下会导致整个集群不可用？...............

#### 答 ： 有A，B，C三 个 节 点 的 集 群,在 没 有 复 制 模 型 的 情 况 下,如 果 节 点B失 败 了 ，

#### 那 么 整 个 集 群 就 会 以 为 缺 少5501-11000这 个 范 围 的 槽 而 不 可 用 。

## 17 、Redis支持的Java客户端都有哪些？官方推荐用哪个？.........

答 ：Redisson、Jedis、lettuce等 等 ， 官 方 推 荐 使 用Redisson。

## 18 、Jedis与Redisson对比有什么优缺点？.....................................

答 ：Jedis是Redis的Java实 现 的 客 户 端 ， 其API提 供 了 比 较 全 面 的Redis命 令
的 支 持；Redisson实 现 了 分 布 式 和 可 扩 展 的Java数 据 结 构，和Jedis相 比，功 能
较 为 简 单 ， 不 支 持 字 符 串 操 作 ， 不 支 持 排 序 、 事 务 、 管 道 、 分 区 等Redis特 性 。
Redisson的 宗 旨 是 促 进 使 用 者 对Redis的 关 注 分 离，从 而 让 使 用 者 能 够 将 精 力 更
集 中 地 放 在 处 理 业 务 逻 辑 上 。


## 19 、Redis如何设置密码及验证密码？...............................................

设 置 密 码 ：configsetrequirepass 123456

授 权 密 码 ：auth 123456

## 20 、说说Redis哈希槽的概念？..........................................................

答 ：Redis集 群 没 有 使 用 一 致 性hash,而 是 引 入 了 哈 希 槽 的 概 念 ，Redis集 群有
16384 个 哈 希 槽，每 个key通 过CRC16校 验 后 对 16384 取 模 来 决 定 放 置 哪 个 槽，
集 群 的 每 个 节 点 负 责 一 部 分hash槽 。

## 21 、Redis集群的主从复制模型是怎样的？.......................................

#### 答 ： 为 了 使 在 部 分 节 点 失 败 或 者 大 部 分 节 点 无 法 通 信 的 情 况 下 集 群 仍 然 可 用 ， 所

#### 以 集 群 使 用 了 主 从 复 制 模 型,每 个 节 点 都 会 有N-1个 复 制 品.

## 22 、Redis集群会有写操作丢失吗？为什么？...................................

答：Redis并 不 能 保 证 数 据 的 强 一 致 性，这 意 味 这 在 实 际 中 集 群 在 特 定 的 条 件 下 可
能 会 丢 失 写 操 作 。

## 23 、Redis集群之间是如何复制的？...................................................

#### 答 ： 异 步 复 制


## 24 、Redis集群最大节点个数是多少？...............................................

#### 答 ： 16384 个 。

## 25 、Redis集群如何选择数据库？.......................................................

答 ：Redis集 群 目 前 无 法 做 数 据 库 选 择 ， 默 认 在 0 数 据 库 。

## 26 、怎么测试Redis的连通性？..........................................................

答 ： 使 用ping命 令 。

## 27 、怎么理解Redis事务？..................................................................

#### 答 ：

#### 1 ） 事 务 是 一 个 单 独 的 隔 离 操 作 ： 事 务 中 的 所 有 命 令 都 会 序 列 化 、 按 顺 序 地 执 行。

#### 事 务 在 执 行 的 过 程 中 ， 不 会 被 其 他 客 户 端 发 送 来 的 命 令 请 求 所 打 断 。

#### 2 ） 事 务 是 一 个 原 子 操 作 ： 事 务 中 的 命 令 要 么 全 部 被 执 行 ， 要 么 全 部 都 不 执 行 。

## 28 、Redis事务相关的命令有哪几个？...............................................

#### 答 ：MULTI、EXEC、DISCARD、WATCH


## 29 、Rediskey的过期时间和永久有效分别怎么设置？....................

#### 答 ：EXPIRE和PERSIST命 令 。

## 30 、Redis如何做内存优化？...............................................................

答 ： 尽 可 能 使 用 散 列 表 （hashes） ， 散 列 表 （ 是 说 散 列 表 里 面 存 储 的 数 少 ） 使 用
的 内 存 非 常 小 ， 所 以 你 应 该 尽 可 能 的 将 你 的 数 据 模 型 抽 象 到 一 个 散 列 表 里 面 。 比
如 你 的web系 统 中 有 一 个 用 户 对 象 ， 不 要 为 这 个 用 户 的 名 称 ， 姓 氏 ， 邮 箱 ， 密 码
设 置 单 独 的key,而 是 应 该 把 这 个 用 户 的 所 有 信 息 存 储 到 一 张 散 列 表 里 面.

## 31 、Redis回收进程如何工作的？.......................................................

答 ： 一 个 客 户 端 运 行 了 新 的 命 令 ， 添 加 了 新 的 数 据 。Redi检 查 内 存 使 用 情 况 ， 如
果 大 于maxmemory的 限 制, 则 根 据 设 定 好 的 策 略 进 行 回 收 。 一 个 新 的 命 令 被 执
行 ， 等 等 。 所 以 我 们 不 断 地 穿 越 内 存 限 制 的 边 界 ， 通 过 不 断 达 到 边 界 然 后 不 断 地
回 收 回 到 边 界 以 下 。 如 果 一 个 命 令 的 结 果 导 致 大 量 内 存 被 使 用 （ 例 如 很 大 的 集 合
的 交 集 保 存 到 一 个 新 的 键 ） ， 不 用 多 久 内 存 限 制 就 会 被 这 个 内 存 使 用 量 超 越 。

## 32 、都有哪些办法可以降低Redis的内存使用情况呢？..................

答：如 果 你 使 用 的 是 32 位 的Redis实 例，可 以 好 好 利 用Hash,list,sortedset,set
等 集 合 类 型 数 据 ， 因 为 通 常 情 况 下 很 多 小 的Key-Value可 以 用 更 紧 凑 的 方 式 存 放
到 一 起 。

## 33 、Redis的内存用完了会发生什么？...............................................


答：如 果 达 到 设 置 的 上 限，Redis的 写 命 令 会 返 回 错 误 信 息（但 是 读 命 令 还 可 以 正
常 返 回 。 ） 或 者 你 可 以 将Redis当 缓 存 来 使 用 配 置 淘 汰 机 制 ， 当Redis达 到 内 存
上 限 时 会 冲 刷 掉 旧 的 内 容 。

### 34 、一个Redis实例最多能存放多少的keys？List、Set、

### SortedSet他们最多能存放多少元素？

答：理 论 上Redis可 以 处 理 多 达 232 的keys，并 且 在 实 际 中 进 行 了 测 试，每 个 实
例 至 少 存 放 了 2 亿 5 千 万 的keys。 我 们 正 在 测 试 一 些 较 大 的 值 。 任 何list、set、
和sortedset都 可 以 放 232 个 元 素 。 换 句 话 说 ，Redis的 存 储 极 限 是 系 统 中 的 可
用 内 存 值 。

### 35 、MySQL里有2000w数据，redis中只存20w的数据，如

### 何保证redis中的数据都是热点数据？

答 ：Redis内 存 数 据 集 大 小 上 升 到 一 定 大 小 的 时 候 ， 就 会 施 行 数 据 淘 汰 策 略 。

相 关 知 识 ：Redis提 供 6 种 数 据 淘 汰 策 略 ：

**volatile-lru** ：从 已 设 置 过 期 时 间 的 数 据 集（server.db[i].expires）中 挑 选 最 近 最
少 使 用 的 数 据 淘 汰

**volatile-ttl** ： 从 已 设 置 过 期 时 间 的 数 据 集 （server.db[i].expires） 中 挑 选 将 要 过
期 的 数 据 淘 汰


**volatile-random** ： 从 已 设 置 过 期 时 间 的 数 据 集 （server.db[i].expires） 中 任 意
选 择 数 据 淘 汰

**allkeys-lru** ： 从 数 据 集 （server.db[i].dict） 中 挑 选 最 近 最 少 使 用 的 数 据 淘 汰

**allkeys-random** ： 从 数 据 集 （server.db[i].dict） 中 任 意 选 择 数 据 淘 汰

**no-enviction（ 驱 逐 ）** ： 禁 止 驱 逐 数 据

## 36 、Redis最适合的场景？...................................................................

**1 、 会 话 缓 存 （SessionCache）**

最 常 用 的 一 种 使 用Redis的 情 景 是 会 话 缓 存（sessioncache）。用Redis缓 存 会
话 比 其 他 存 储（如Memcached）的 优 势 在 于：Redis提 供 持 久 化。当 维 护 一 个 不
是 严 格 要 求 一 致 性 的 缓 存 时 ， 如 果 用 户 的 购 物 车 信 息 全 部 丢 失 ， 大 部 分 人 都 会 不
高 兴 的 ， 现 在 ， 他 们 还 会 这 样 吗 ？ 幸 运 的 是 ， 随 着 Redis 这 些 年 的 改 进 ， 很 容
易 找 到 怎 么 恰 当 的 使 用Redis来 缓 存 会 话 的 文 档 。 甚 至 广 为 人 知 的 商 业 平台
Magento也 提 供Redis的 插 件 。

**2 、 全 页 缓 存 （FPC）**

除 基 本 的 会 话token之 外 ，Redis还 提 供 很 简 便 的FPC平 台 。 回 到 一 致 性 问 题 ，
即 使 重 启 了Redis实 例 ， 因 为 有 磁 盘 的 持 久 化 ， 用 户 也 不 会 看 到 页 面 加 载 速 度 的
下 降，这 是 一 个 极 大 改 进，类 似PHP本 地FPC。再 次 以Magento为 例，Magento
提 供 一 个 插 件 来 使 用Redis作 为 全 页 缓 存 后 端 。 此 外 ， 对WordPress的 用 户 来
说，Pantheon有 一 个 非 常 好 的 插 件 wp-redis，这 个 插 件 能 帮 助 你 以 最 快 速 度 加
载 你 曾 浏 览 过 的 页 面 。

**3 、 队 列**


Reids在 内 存 存 储 引 擎 领 域 的 一 大 优 点 是 提 供 list 和 set 操 作 ， 这 使 得Redis
能 作 为 一 个 很 好 的 消 息 队 列 平 台 来 使 用。Redis作 为 队 列 使 用 的 操 作，就 类 似 于 本
地 程 序 语 言（如Python）对 list 的 push/pop 操 作。 如 果 你 快 速 的 在Google
中 搜 索“Redisqueues”， 你 马 上 就 能 找 到 大 量 的 开 源 项 目 ， 这 些 项 目 的 目 的 就
是 利 用Redis创 建 非 常 好 的 后 端 工 具 ， 以 满 足 各 种 队 列 需 求 。 例 如 ，Celery有 一
个 后 台 就 是 使 用Redis作 为broker， 你 可 以 从 这 里 去 查 看 。

#### 4 ， 排 行 榜/计 数 器

Redis在 内 存 中 对 数 字 进 行 递 增 或 递 减 的 操 作 实 现 的 非 常 好 。 集 合 （Set） 和 有 序
集 合（SortedSet）也 使 得 我 们 在 执 行 这 些 操 作 的 时 候 变 的 非 常 简 单，Redis只 是
正 好 提 供 了 这 两 种 数 据 结 构 。 所 以 ， 我 们 要 从 排 序 集 合 中 获 取 到 排 名 最 靠 前 的 10
个 用 户–我 们 称 之 为“user_scores”， 我 们 只 需 要 像 下 面 一 样 执 行 即 可 ： 当 然，
这 是 假 定 你 是 根 据 你 用 户 的 分 数 做 递 增 的 排 序。如 果 你 想 返 回 用 户 及 用 户 的 分 数，
你 需 要 这 样 执 行 ： ZRANGEuser_scores 010 WITHSCORESAgoraGames就
是 一 个 很 好 的 例 子，用Ruby实 现 的，它 的 排 行 榜 就 是 使 用Redis来 存 储 数 据 的，
你 可 以 在 这 里 看 到 。

**5 、 发 布/订 阅**

最 后（但 肯 定 不 是 最 不 重 要 的）是Redis的 发 布/订 阅 功 能。发 布/订 阅 的 使 用 场 景
确 实 非 常 多 。 我 已 看 见 人 们 在 社 交 网 络 连 接 中 使 用 ， 还 可 作 为 基 于 发 布/订 阅 的 脚
本 触 发 器 ， 甚 至 用Redis的 发 布/订 阅 功 能 来 建 立 聊 天 系 统 ！

## 的已知的前缀开头的，如果将它们全部找出来？................................ 37 、假如Redis里面有 1 亿个key，其中有10w个key是以某个固定

### 某个固定的已知的前缀开头的，如果将它们全部找出来？

答 ： 使 用keys指 令 可 以 扫 出 指 定 模 式 的key列 表 。


对 方 接 着 追 问 ： 如 果 这 个redis正 在 给 线 上 的 业 务 提 供 服 务 ， 那 使 用keys指 令 会
有 什 么 问 题 ？

这 个 时 候 你 要 回 答redis关 键 的 一 个 特 性：redis的 单 线 程 的。keys指 令 会 导 致 线
程 阻 塞 一 段 时 间 ， 线 上 服 务 会 停 顿 ， 直 到 指 令 执 行 完 毕 ， 服 务 才 能 恢 复 。 这 个 时
候 可 以 使 用scan指 令 ，scan指 令 可 以 无 阻 塞 的 提 取 出 指 定 模 式 的key列 表 ， 但
是 会 有 一 定 的 重 复 概 率 ， 在 客 户 端 做 一 次 去 重 就 可 以 了 ， 但 是 整 体 所 花 费 的 时 间
会 比 直 接 用keys指 令 长 。

## 38 、如果有大量的key需要设置同一时间过期，一般需要注意什么？

答：如 果 大 量 的key过 期 时 间 设 置 的 过 于 集 中，到 过 期 的 那 个 时 间 点，redis可 能
会 出 现 短 暂 的 卡 顿 现 象 。 一 般 需 要 在 时 间 上 加 一 个 随 机 值 ， 使 得 过 期 时 间 分 散 一
些 。

## 39 、使用过Redis做异步队列么，你是怎么用的？..........................

答：一 般 使 用list结 构 作 为 队 列，rpush生 产 消 息，lpop消 费 消 息。当lpop没 有
消 息 的 时 候 ， 要 适 当sleep一 会 再 重 试 。

**如 果 对 方 追 问 可 不 可 以 不 用sleep呢 ？**

list还 有 个 指 令 叫blpop，在 没 有 消 息 的 时 候，它 会 阻 塞 住 直 到 消 息 到 来。如 果 对
方 追 问 能 不 能 生 产 一 次 消 费 多 次 呢 ？ 使 用pub/sub主 题 订 阅 者 模 式 ， 可 以 实现
1:N的 消 息 队 列 。


**如 果 对 方 追 问pub/sub有 什 么 缺 点 ？**

在 消 费 者 下 线 的 情 况 下，生 产 的 消 息 会 丢 失，得 使 用 专 业 的 消 息 队 列 如RabbitMQ
等 。

**如 果 对 方 追 问redis如 何 实 现 延 时 队 列 ？**

我 估 计 现 在 你 很 想 把 面 试 官 一 棒 打 死 如 果 你 手 上 有 一 根 棒 球 棍 的 话 ， 怎 么 问 的 这
么 详 细。但 是 你 很 克 制，然 后 神 态 自 若 的 回 答 道：使 用sortedset，拿 时 间 戳 作为
score，消 息 内 容 作 为key调 用zadd来 生 产 消 息，消 费 者 用zrangebyscore指 令
获 取N秒 之 前 的 数 据 轮 询 进 行 处 理 。 到 这 里 ， 面 试 官 暗 地 里 已 经 对 你 竖 起 了 大 拇
指 。 但 是 他 不 知 道 的 是 此 刻 你 却 竖 起 了 中 指 ， 在 椅 子 背 后 。

## 40 、使用过Redis分布式锁么，它是什么回事？..............................

先 拿setnx来 争 抢 锁 ， 抢 到 之 后 ， 再 用expire给 锁 加 一 个 过 期 时 间 防 止 锁 忘 记 了
释 放 。

这 时 候 对 方 会 告 诉 你 说 你 回 答 得 不 错 ， 然 后 接 着 问 如 果 在setnx之 后 执 行expire
之 前 进 程 意 外crash或 者 要 重 启 维 护 了 ， 那 会 怎 么 样 ？

#### 这 时 候 你 要 给 予 惊 讶 的 反 馈 ： 唉 ， 是 喔 ， 这 个 锁 就 永 远 得 不 到 释 放 了 。 紧 接 着 你

#### 需 要 抓 一 抓 自 己 得 脑 袋，故 作 思 考 片 刻，好 像 接 下 来 的 结 果 是 你 主 动 思 考 出 来 的，

然 后 回 答 ： 我 记 得set指 令 有 非 常 复 杂 的 参 数 ， 这 个 应 该 是 可 以 同 时 把setnx和
expire合 成 一 条 指 令 来 用 的 ！ 对 方 这 时 会 显 露 笑 容 ， 心 里 开 始 默 念 ： 摁 ， 这 小 子
还 不 错 。

## MySQL 面试题........................................................................................................


### 1 、MySQL中有哪几种锁？...................................................................

#### 1 、表 级 锁：开 销 小，加 锁 快；不 会 出 现 死 锁；锁 定 粒 度 大，发 生 锁 冲 突 的 概 率 最

#### 高 ， 并 发 度 最 低 。

#### 2 、行 级 锁：开 销 大，加 锁 慢；会 出 现 死 锁；锁 定 粒 度 最 小，发 生 锁 冲 突 的 概 率 最

#### 低 ， 并 发 度 也 最 高 。

#### 3 、页 面 锁：开 销 和 加 锁 时 间 界 于 表 锁 和 行 锁 之 间；会 出 现 死 锁；锁 定 粒 度 界 于 表

#### 锁 和 行 锁 之 间 ， 并 发 度 一 般 。

### 2 、MySQL中有哪些不同的表格？.......................................................

#### 共 有 5 种 类 型 的 表 格 ：

1 、MyISAM

2 、Heap

3 、Merge

#### 4 、INNODB

#### 5 、ISAM

### 3 、简述在MySQL数据库中MyISAM和InnoDB的区别...............

**MyISAM：**


#### 不 支 持 事 务 ， 但 是 每 次 查 询 都 是 原 子 的 ；

#### 支 持 表 级 锁 ， 即 每 次 操 作 是 对 整 个 表 加 锁 ；

#### 存 储 表 的 总 行 数 ；

#### 一 个MYISAM表 有 三 个 文 件 ： 索 引 文 件 、 表 结 构 文 件 、 数 据 文 件 ；

#### 采 用 菲 聚 集 索 引 ， 索 引 文 件 的 数 据 域 存 储 指 向 数 据 文 件 的 指 针 。 辅 索 引 与 主 索 引

#### 基 本 一 致 ， 但 是 辅 索 引 不 用 保 证 唯 一 性 。

**InnoDb：**

支 持ACID的 事 务 ， 支 持 事 务 的 四 种 隔 离 级 别 ；

#### 支 持 行 级 锁 及 外 键 约 束 ： 因 此 可 以 支 持 写 并 发 ；

#### 不 存 储 总 行 数 ：

一 个InnoDb引 擎 存 储 在 一 个 文 件 空 间（共 享 表 空 间，表 大 小 不 受 操 作 系 统 控 制，
一 个 表 可 能 分 布 在 多 个 文 件 里 ） ， 也 有 可 能 为 多 个 （ 设 置 为 独 立 表 空 ， 表 大 小 受
操 作 系 统 文 件 大 小 限 制 ， 一 般 为2G） ， 受 操 作 系 统 文 件 大 小 的 限 制 ；

主 键 索 引 采 用 聚 集 索 引 （ 索 引 的 数 据 域 存 储 数 据 文 件 本 身 ） ， 辅 索 引 的 数 据 域 存
储 主 键 的 值 ； 因 此 从 辅 索 引 查 找 数 据 ， 需 要 先 通 过 辅 索 引 找 到 主 键 值 ， 再 访 问 辅
索 引 ； 最 好 使 用 自 增 主 键 ， 防 止 插 入 数 据 时 ， 为 维 持B+树 结 构 ， 文 件 的 大 调 整。


### 4 、MySQL中InnoDB支持的四种事务隔离级别名称，以及逐

### 级之间的区别？

#### SQL标 准 定 义 的 四 个 隔 离 级 别 为 ：

1 、readuncommited ： 读 到 未 提 交 数 据

2 、readcommitted： 脏 读 ， 不 可 重 复 读

3 、repeatableread： 可 重 读

4 、serializable ： 串 行 事 物

### 5 、CHAR和VARCHAR的区别？........................................................

#### 1 、CHAR和VARCHAR类 型 在 存 储 和 检 索 方 面 有 所 不 同

#### 2 、CHAR列 长 度 固 定 为 创 建 表 时 声 明 的 长 度 ， 长 度 值 范 围 是 1 到 255 当CHAR

#### 值 被 存 储 时 ， 它 们 被 用 空 格 填 充 到 特 定 长 度 ， 检 索CHAR值 时 需 删 除 尾 随 空 格 。

### 6 、主键和候选键有什么区别？.............................................................

#### 表 格 的 每 一 行 都 由 主 键 唯 一 标 识,一 个 表 只 有 一 个 主 键 。

#### 主 键 也 是 候 选 键 。 按 照 惯 例 ， 候 选 键 可 以 被 指 定 为 主 键 ， 并 且 可 以 用 于 任 何 外 键

#### 引 用 。


### 7 、myisamchk是用来做什么的？.......................................................

它 用 来 压 缩MyISAM表 ， 这 减 少 了 磁 盘 或 内 存 使 用 。

**MyISAMStatic和MyISAMDynamic有 什 么 区 别 ？**

在MyISAMStatic上 的 所 有 字 段 有 固 定 宽 度 。 动 态MyISAM表 将 具 有 像TEXT，
BLOB等 字 段 ， 以 适 应 不 同 长 度 的 数 据 类 型 。

MyISAMStatic在 受 损 情 况 下 更 容 易 恢 复 。

### 8 、如果一个表有一列定义为TIMESTAMP，将发生什么？.............

#### 每 当 行 被 更 改 时 ， 时 间 戳 字 段 将 获 取 当 前 时 间 戳 。

#### 列 设 置 为AUTOINCREMENT时 ， 如 果 在 表 中 达 到 最 大 值 ， 会 发 生 什 么 情 况 ？

#### 它 会 停 止 递 增 ， 任 何 进 一 步 的 插 入 都 将 产 生 错 误 ， 因 为 密 钥 已 被 使 用 。

#### 怎 样 才 能 找 出 最 后 一 次 插 入 时 分 配 了 哪 个 自 动 增 量 ？

LAST_INSERT_ID将 返 回 由Auto_increment分 配 的 最 后 一 个 值 ， 并 且 不 需 要 指
定 表 名 称 。

### 9 、你怎么看到为表格定义的所有索引？.............................................

#### 索 引 是 通 过 以 下 方 式 为 表 格 定 义 的 ：


SHOWINDEXFROM<tablename>;

### 10 、LIKE声明中的％和_是什么意思？................................................

#### ％ 对 应 于 0 个 或 更 多 字 符 ，_只 是LIKE语 句 中 的 一 个 字 符 。

**如 何 在Unix和MySQL时 间 戳 之 间 进 行 转 换 ？**

UNIX_TIMESTAMP是 从MySQL时 间 戳 转 换 为Unix时 间 戳 的 命 令
FROM_UN IXTIME是 从Unix时 间 戳 转 换 为MySQL时 间 戳 的 命 令

### 11 、列对比运算符是什么？...................................................................

#### 在SELECT语 句 的 列 比 较 中 使 用=，<>，<=，<，>=，>，<<，>>，<=>，AND，

#### OR或LIKE运 算 符 。

### 12 、BLOB和TEXT有什么区别？........................................................

#### BLOB是 一 个 二 进 制 对 象 ， 可 以 容 纳 可 变 数 量 的 数 据 。TEXT是 一 个 不 区 分 大 小 写

#### 的BLOB。

#### BLOB和TEXT类 型 之 间 的 唯 一 区 别 在 于 对BLOB值 进 行 排 序 和 比 较 时 区 分 大 小

#### 写 ， 对TEXT值 不 区 分 大 小 写 。

### 13 、MySQL_fetch_array和MySQL_fetch_object的区别是什么？


以 下 是MySQL_fetch_array和MySQL_fetch_object的 区 别 ：

MySQL_fetch_array（）– 将 结 果 行 作 为 关 联 数 组 或 来 自 数 据 库 的 常 规 数 组 返 回。

MySQL_fetch_object – 从 数 据 库 返 回 结 果 行 作 为 对 象 。

### 14 、MyISAM表格将在哪里存储，并且还提供其存储格式？..........

每 个MyISAM表 格 以 三 种 格 式 存 储 在 磁 盘 上 ：

· “.frm”文 件 存 储 表 定 义

·数 据 文 件 具 有“.MYD”（MYData） 扩 展 名

索 引 文 件 具 有“.MYI”（MYIndex） 扩 展 名

### 15 、MySQL如何优化DISTINCT？.....................................................

#### DISTINCT在 所 有 列 上 转 换 为GROUPBY， 并 与ORDERBY子 句 结 合 使 用 。

SELECTDISTINCTt1.aFROMt1,t2wheret1.a=t2.a;

### 16 、如何显示前 50 行？........................................................................

在MySQL中 ， 使 用 以 下 代 码 查 询 显 示 前 50 行 ：

SELECT*FROM


#### LIMIT0,50;

### 17 、可以使用多少列创建索引？...........................................................

#### 任 何 标 准 表 最 多 可 以 创 建 16 个 索 引 列 。

### 18 、NOW（）和CURRENT_DATE（）有什么区别？....................

#### NOW（ ） 命 令 用 于 显 示 当 前 年 份 ， 月 份 ， 日 期 ， 小 时 ， 分 钟 和 秒 。

#### CURRENT_DATE（ ） 仅 显 示 当 前 年 份 ， 月 份 和 日 期 。

### 19 、什么是非标准字符串类型？...........................................................

#### 1 、TINYTEXT

#### 2 、TEXT

#### 3 、MEDIUMTEXT

#### 4 、LON GTEXT

### 20 、什么是通用SQL函数？.................................................................

#### 1 、CONCAT(A,B) – 连 接 两 个 字 符 串 值 以 创 建 单 个 字 符 串 输 出。通 常 用 于 将 两 个

#### 或 多 个 字 段 合 并 为 一 个 字 段 。


#### 2 、FORMAT(X,D)- 格 式 化 数 字X到D有 效 数 字 。

#### 3 、CURRDATE(),CURRTIME()- 返 回 当 前 日 期 或 时 间 。

#### 4 、NOW（ ） – 将 当 前 日 期 和 时 间 作 为 一 个 值 返 回 。

#### 5 、MONTH（），DAY（），YEAR（），WEEK（），WEEKDAY（） – 从 日 期

#### 值 中 提 取 给 定 数 据 。

#### 6 、HOUR（ ） ，MINUTE（ ） ，SECOND（ ） – 从 时 间 值 中 提 取 给 定 数 据 。

#### 7 、DATEDIFF（A，B） – 确 定 两 个 日 期 之 间 的 差 异 ， 通 常 用 于 计 算 年 龄

#### 8 、SUBTIMES（A，B） – 确 定 两 次 之 间 的 差 异 。

#### 9 、FROMDAYS（INT） – 将 整 数 天 数 转 换 为 日 期 值 。

### 21 、MySQL支持事务吗？....................................................................

在 缺 省 模 式 下，MySQL是autocommit模 式 的，所 有 的 数 据 库 更 新 操 作 都 会 即 时
提 交 ， 所 以 在 缺 省 情 况 下 ，MySQL是 不 支 持 事 务 的 。

但 是 如 果 你 的MySQL表 类 型 是 使 用InnoDBTables 或 BDBtables的 话 ， 你的
MySQL就 可 以 使 用 事 务 处 理,使 用SET
AUTOCOMMIT=0就 可 以 使MySQL允 许 在 非autocommit模 式 ， 在非
autocommit模 式 下，你 必 须 使 用COMMIT来 提 交 你 的 更 改，或 者 用ROLLBACK
来 回 滚 你 的 更 改 。


### 22 、MySQL里记录货币用什么字段类型好........................................

NUMERIC和DECIMAL类 型 被MySQL实 现 为 同 样 的 类 型 ， 这 在SQL92标 准 允
许 。 他 们 被 用 于 保 存 值 ， 该 值 的 准 确 精 度 是 极 其 重 要 的 值 ， 例 如 与 金 钱 有 关 的 数
据 。 当 声 明 一 个 类 是 这 些 类 型 之 一 时 ， 精 度 和 规 模 的 能 被(并 且 通 常 是)指 定 。

例 如 ：

salaryDECIMAL(9,2)

在 这 个 例 子 中，9(precision)代 表 将 被 用 于 存 储 值 的 总 的 小 数 位 数，而2(scale)代
表 将 被 用 于 存 储 小 数 点 后 的 位 数 。

因 此 ， 在 这 种 情 况 下 ， 能 被 存 储 在salary列 中 的 值 的 范 围 是 从-9999999.99到
9999999.99。

### 23 、MySQL有关权限的表都有哪几个？............................................

MySQL服 务 器 通 过 权 限 表 来 控 制 用 户 对 数 据 库 的 访 问 ， 权 限 表 存 放 在MySQL数
据 库 里，由MySQL_install_db脚 本 初 始 化。这 些 权 限 表 分别user，db，table_priv，
columns_priv和host。

### 24 、列的字符串类型可以是什么？.......................................................

#### 字 符 串 类 型 是 ：

#### 1 、SET


#### 2 、BLOB

#### 3 、ENUM

#### 4 、CHAR

#### 5 、TEXT

### 25 、MySQL数据库作发布系统的存储，一天五万条以上的增量，

### 预计运维三年,怎么优化？

1 、 设 计 良 好 的 数 据 库 结 构 ， 允 许 部 分 数 据 冗 余 ， 尽 量 避 免join查 询 ， 提 高 效 率。

#### 2 、 选 择 合 适 的 表 字 段 数 据 类 型 和 存 储 引 擎 ， 适 当 的 添 加 索 引 。

3 、MySQL库 主 从 读 写 分 离 。

4 、 找 规 律 分 表 ， 减 少 单 表 中 的 数 据 量 提 高 查 询 速 度 。

5 、 添 加 缓 存 机 制 ， 比 如memcached，apc等 。

#### 6 、 不 经 常 改 动 的 页 面 ， 生 成 静 态 页 面 。

7 、 书 写 高 效 率 的SQL。 比 如 SELECT*FROMTABEL 改 为 SELECTfield_1,
field_2,field_3FROMTABLE.

### 26 、锁的优化策略...................................................................................


#### 1 、 读 写 分 离

#### 2 、 分 段 加 锁

#### 3 、 减 少 锁 持 有 的 时 间

#### 4.多 个 线 程 尽 量 以 相 同 的 顺 序 去 获 取 资 源

#### 不 能 将 锁 的 粒 度 过 于 细 化 ， 不 然 可 能 会 出 现 线 程 的 加 锁 和 释 放 次 数 过 多 ， 反 而 效

#### 率 不 如 一 次 加 一 把 大 锁 。

### 27 、索引的底层实现原理和优化...........................................................

#### B+树 ， 经 过 优 化 的B+树

主 要 是 在 所 有 的 叶 子 结 点 中 增 加 了 指 向 下 一 个 叶 子 节 点 的 指 针 ， 因 此InnoDB建
议 为 大 部 分 表 使 用 默 认 自 增 的 主 键 作 为 主 索 引 。

### 28 、什么情况下设置了索引但无法使用...............................................

#### 1 、 以“%”开 头 的LIKE语 句 ， 模 糊 匹 配

#### 2 、OR语 句 前 后 没 有 同 时 使 用 索 引

3 、数 据 类 型 出 现 隐 式 转 化（如varchar不 加 单 引 号 的 话 可 能 会 自 动 转 换 为int型）

### 29 、实践中如何优化MySQL................................................................


#### 最 好 是 按 照 以 下 顺 序 优 化 ：

#### 1 、SQL语 句 及 索 引 的 优 化

#### 2 、 数 据 库 表 结 构 的 优 化

#### 3 、 系 统 配 置 的 优 化

#### 4 、 硬 件 的 优 化

详 细 可 以 查 看 阿 里P8架 构 师 谈：MySQL慢 查 询 优 化、索 引 优 化、以 及 表 等 优 化
总 结

### 30 、优化数据库的方法...........................................................................

#### 1 、选 取 最 适 用 的 字 段 属 性，尽 可 能 减 少 定 义 字 段 宽 度，尽 量 把 字 段 设置NOTNULL，

#### 例 如’省 份’、’性 别’最 好 适 用ENUM

#### 2 、 使 用 连 接(JOIN)来 代 替 子 查 询

#### 3 、 适 用 联 合(UNION)来 代 替 手 动 创 建 的 临 时 表

#### 4 、 事 务 处 理

#### 5 、 锁 定 表 、 优 化 事 务 处 理

#### 6 、 适 用 外 键 ， 优 化 锁 定 表

#### 7 、 建 立 索 引

#### 8 、 优 化 查 询 语 句


### 31 、简单描述MySQL中，索引，主键，唯一索引，联合索引

### 的区别，对数据库的性能有什么影响（从读写两方面）

索 引 是 一 种 特 殊 的 文 件(InnoDB数 据 表 上 的 索 引 是 表 空 间 的 一 个 组 成 部 分)， 它 们
包 含 着 对 数 据 表 里 所 有 记 录 的 引 用 指 针 。

#### 普 通 索 引(由 关 键 字KEY或INDEX定 义 的 索 引)的 唯 一 任 务 是 加 快 对 数 据 的 访 问 速

#### 度 。

#### 普 通 索 引 允 许 被 索 引 的 数 据 列 包 含 重 复 的 值 。 如 果 能 确 定 某 个 数 据 列 将 只 包 含 彼

#### 此 各 不 相 同 的 值 ， 在 为 这 个 数 据 列 创 建 索 引 的 时 候 就 应 该 用 关 键 字UN IQUE把 它

#### 定 义 为 一 个 唯 一 索 引 。 也 就 是 说 ， 唯 一 索 引 可 以 保 证 数 据 记 录 的 唯 一 性 。

#### 主 键 ， 是 一 种 特 殊 的 唯 一 索 引 ， 在 一 张 表 中 只 能 定 义 一 个 主 键 索 引 ， 主 键 用 于 唯

#### 一 标 识 一 条 记 录 ， 使 用 关 键 字 PRIMARYKEY 来 创 建 。

索 引 可 以 覆 盖 多 个 数 据 列，如 像INDEX(columnA,columnB)索 引，这 就 是 联 合 索
引 。

#### 索 引 可 以 极 大 的 提 高 数 据 的 查 询 速 度 ， 但 是 会 降 低 插 入 、 删 除 、 更 新 表 的 速 度 ，

#### 因 为 在 执 行 这 些 写 操 作 时 ， 还 要 操 作 索 引 文 件 。

### 32 、数据库中的事务是什么?.................................................................

事 务 （transaction） 是 作 为 一 个 单 元 的 一 组 有 序 的 数 据 库 操 作 。 如 果 组 中 的 所 有
操 作 都 成 功 ， 则 认 为 事 务 成 功 ， 即 使 只 有 一 个 操 作 失 败 ， 事 务 也 不 成 功 。 如 果 所


#### 有 操 作 完 成 ， 事 务 则 提 交 ， 其 修 改 将 作 用 于 所 有 其 他 数 据 库 进 程 。 如 果 一 个 操 作

#### 失 败 ， 则 事 务 将 回 滚 ， 该 事 务 所 有 操 作 的 影 响 都 将 取 消 。

#### 事 务 特 性 ：

#### 1 、 原 子 性 ： 即 不 可 分 割 性 ， 事 务 要 么 全 部 被 执 行 ， 要 么 就 全 部 不 被 执 行 。

#### 2 、一 致 性 或 可 串 性。事 务 的 执 行 使 得 数 据 库 从 一 种 正 确 状 态 转 换 成 另 一 种 正 确 状

#### 态

#### 3 、隔 离 性。在 事 务 正 确 提 交 之 前，不 允 许 把 该 事 务 对 数 据 的 任 何 改 变 提 供 给 任 何

#### 其 他 事 务 ，

#### 4 、持 久 性。事 务 正 确 提 交 后，其 结 果 将 永 久 保 存 在 数 据 库 中，即 使 在 事 务 提 交 后

#### 有 了 其 他 故 障 ， 事 务 的 处 理 结 果 也 会 得 到 保 存 。

#### 或 者 这 样 理 解 ：

#### 事 务 就 是 被 绑 定 在 一 起 作 为 一 个 逻 辑 工 作 单 元 的SQL语 句 分 组 ， 如 果 任 何 一 个 语

#### 句 操 作 失 败 那 么 整 个 操 作 就 被 失 败 ， 以 后 操 作 就 会 回 滚 到 操 作 前 状 态 ， 或 者 是 上

#### 有 个 节 点 。 为 了 确 保 要 么 执 行 ， 要 么 不 执 行 ， 就 可 以 使 用 事 务 。 要 将 有 组 语 句 作

#### 为 事 务 考 虑 ， 就 需 要 通 过ACID测 试 ， 即 原 子 性 ， 一 致 性 ， 隔 离 性 和 持 久 性 。

### 33 、SQL注入漏洞产生的原因？如何防止？......................................

SQL注 入 产 生 的 原 因 ： 程 序 开 发 过 程 中 不 注 意 规 范 书 写sql语 句 和 对 特 殊 字 符 进
行 过 滤，导 致 客 户 端 可 以 通 过 全 局 变 量POST和GET提 交 一 些sql语 句 正 常 执 行。

#### 防 止SQL注 入 的 方 式 ：

开 启 配 置 文 件 中 的magic_quotes_gpc 和 magic_quotes_runtime设 置


执 行sql语 句 时 使 用addslashes进 行sql语 句 转 换

Sql语 句 书 写 尽 量 不 要 省 略 双 引 号 和 单 引 号 。

过 滤 掉sql语 句 中 的 一 些 关 键 词 ：update、insert、delete、select、 * 。

提 高 数 据 库 表 和 字 段 的 命 名 技 巧 ， 对 一 些 重 要 的 字 段 根 据 程 序 的 特 点 命 名 ， 取 不
易 被 猜 到 的 。

### 34 、为表中得字段选择合适得数据类型...............................................

字 段 类 型 优 先 级: 整 形>date,time>enum,char>varchar>blob,text
优 先 考 虑 数 字 类 型 ， 其 次 是 日 期 或 者 二 进 制 类 型 ， 最 后 是 字 符 串 类 型 ， 同 级 别 得
数 据 类 型 ， 应 该 优 先 选 择 占 用 空 间 小 的 数 据 类 型

### 35 、存储时期...........................................................................................

Datatime:以 YYYY-MM-DDHH:MM:SS 格 式 存 储 时 期 时 间 ， 精 确 到 秒 ，
占 用 8 个 字 节 得 存 储 空 间 ，datatime类 型 与 时 区 无 关
Timestamp:以 时 间 戳 格 式 存 储，占 用 4 个 字 节，范 围 小1970-1-1到2038-1-19，
显 示 依 赖 于 所 指 定 得 时 区 ， 默 认 在 第 一 个 列 行 的 数 据 修 改 时 可 以 自 动 得 修改
timestamp列 得 值
Date:（ 生 日 ） 占 用 得 字 节 数 比 使 用 字 符 串.datatime.int储 存 要 少 ， 使 用date只
需 要 3 个 字 节 ， 存 储 日 期 月 份 ， 还 可 以 利 用 日 期 时 间 函 数 进 行 日 期 间 得 计 算
Time:存 储 时 间 部 分 得 数 据
注 意:不 要 使 用 字 符 串 类 型 来 存 储 日 期 时 间 数 据（通 常 比 字 符 串 占 用 得 储 存 空 间 小，
在 进 行 查 找 过 滤 可 以 利 用 日 期 得 函 数 ）
使 用int存 储 日 期 时 间 不 如 使 用timestamp类 型


### 36 、对于关系型数据库而言，索引是相当重要的概念，请回答

### 有关索引的几个问题：

#### 1 、 索 引 的 目 的 是 什 么 ？

#### 快 速 访 问 数 据 表 中 的 特 定 信 息 ， 提 高 检 索 速 度

#### 创 建 唯 一 性 索 引 ， 保 证 数 据 库 表 中 每 一 行 数 据 的 唯 一 性 。

#### 加 速 表 和 表 之 间 的 连 接

#### 使 用 分 组 和 排 序 子 句 进 行 数 据 检 索 时 ， 可 以 显 著 减 少 查 询 中 分 组 和 排 序 的 时 间

#### 2 、 索 引 对 数 据 库 系 统 的 负 面 影 响 是 什 么 ？

#### 负 面 影 响 ：

#### 创 建 索 引 和 维 护 索 引 需 要 耗 费 时 间 ， 这 个 时 间 随 着 数 据 量 的 增 加 而 增 加 ； 索 引 需

#### 要 占 用 物 理 空 间 ， 不 光 是 表 需 要 占 用 数 据 空 间 ， 每 个 索 引 也 需 要 占 用 物 理 空 间 ；

#### 当 对 表 进 行 增 、 删 、 改 、 的 时 候 索 引 也 要 动 态 维 护 ， 这 样 就 降 低 了 数 据 的 维 护 速

#### 度 。

#### 3 、 为 数 据 表 建 立 索 引 的 原 则 有 哪 些 ？

#### 在 最 频 繁 使 用 的 、 用 以 缩 小 查 询 范 围 的 字 段 上 建 立 索 引 。

#### 在 频 繁 使 用 的 、 需 要 排 序 的 字 段 上 建 立 索 引

#### 4 、 什 么 情 况 下 不 宜 建 立 索 引 ？


#### 对 于 查 询 中 很 少 涉 及 的 列 或 者 重 复 值 比 较 多 的 列 ， 不 宜 建 立 索 引 。

对 于 一 些 特 殊 的 数 据 类 型 ， 不 宜 建 立 索 引 ， 比 如 文 本 字 段 （text） 等

### 37 、解释MySQL外连接、内连接与自连接的区别...........................

#### 先 说 什 么 是 交 叉 连 接: 交 叉 连 接 又 叫 笛 卡 尔 积，它 是 指 不 使 用 任 何 条 件，直 接 将 一

#### 个 表 的 所 有 记 录 和 另 一 个 表 中 的 所 有 记 录 一 一 匹 配 。

#### 内 连 接 则 是 只 有 条 件 的 交 叉 连 接，根 据 某 个 条 件 筛 选 出 符 合 条 件 的 记 录，不 符 合

#### 条 件 的 记 录 不 会 出 现 在 结 果 集 中 ， 即 内 连 接 只 连 接 匹 配 的 行 。

#### 外 连 接 其 结 果 集 中 不 仅 包 含 符 合 连 接 条 件 的 行，而 且 还 会 包 括 左 表、右 表 或 两 个

#### 表 中

#### 的 所 有 数 据 行 ， 这 三 种 情 况 依 次 称 之 为 左 外 连 接 ， 右 外 连 接 ， 和 全 外 连 接 。

#### 左 外 连 接 ， 也 称 左 连 接 ， 左 表 为 主 表 ， 左 表 中 的 所 有 记 录 都 会 出 现 在 结 果 集 中 ，

#### 对 于 那 些 在 右 表 中 并 没 有 匹 配 的 记 录 ， 仍 然 要 显 示 ， 右 边 对 应 的 那 些 字 段 值以

#### NULL来 填 充。右 外 连 接，也 称 右 连 接，右 表 为 主 表，右 表 中 的 所 有 记 录 都 会 出 现

在 结 果 集 中 。 左 连 接 和 右 连 接 可 以 互 换 ，MySQL目 前 还 不 支 持 全 外 连 接 。

### 38 、Myql中的事务回滚机制概述........................................................

#### 事 务 是 用 户 定 义 的 一 个 数 据 库 操 作 序 列 ， 这 些 操 作 要 么 全 做 要 么 全 不 做 ， 是 一 个

#### 不 可 分 割 的 工 作 单 位 ， 事 务 回 滚 是 指 将 该 事 务 已 经 完 成 的 对 数 据 库 的 更 新 操 作 撤

#### 销 。

#### 要 同 时 修 改 数 据 库 中 两 个 不 同 表 时 ， 如 果 它 们 不 是 一 个 事 务 的 话 ， 当 第 一 个 表 修

#### 改 完 ， 可 能 第 二 个 表 修 改 过 程 中 出 现 了 异 常 而 没 能 修 改 ， 此 时 就 只 有 第 二 个 表 依

#### 旧 是 未 修 改 之 前 的 状 态 ， 而 第 一 个 表 已 经 被 修 改 完 毕 。 而 当 你 把 它 们 设 定 为 一 个


#### 事 务 的 时 候 ， 当 第 一 个 表 修 改 完 ， 第 二 表 修 改 出 现 异 常 而 没 能 修 改 ， 第 一 个 表 和

#### 第 二 个 表 都 要 回 到 未 修 改 的 状 态 ， 这 就 是 所 谓 的 事 务 回 滚

### 39 、SQL语言包括哪几部分？每部分都有哪些操作关键字？..........

#### SQL语 言 包 括 数 据 定 义(DDL)、数 据 操 纵(DML),数 据 控 制(DCL)和 数 据 查 询（DQL）

#### 四 个 部 分 。

数 据 定 义 ：CreateTable,AlterTable,DropTable,Craete/DropIndex等

数 据 操 纵 ：Select,insert,update,delete,

数 据 控 制 ：grant,revoke

数 据 查 询 ：select

### 40 、完整性约束包括哪些？...................................................................

数 据 完 整 性(DataIntegrity)是 指 数 据 的 精 确(Accuracy)和 可 靠 性(Reliability)。

#### 分 为 以 下 四 类 ：

#### 1 、 实 体 完 整 性 ： 规 定 表 的 每 一 行 在 表 中 是 惟 一 的 实 体 。

#### 2 、域 完 整 性：是 指 表 中 的 列 必 须 满 足 某 种 特 定 的 数 据 类 型 约 束，其 中 约 束 又 包 括

#### 取 值 范 围 、 精 度 等 规 定 。

#### 3 、参 照 完 整 性：是 指 两 个 表 的 主 关 键 字 和 外 关 键 字 的 数 据 应 一 致，保 证 了 表 之 间

#### 的 数 据 的 一 致 性 ， 防 止 了 数 据 丢 失 或 无 意 义 的 数 据 在 数 据 库 中 扩 散 。


#### 4 、用 户 定 义 的 完 整 性：不 同 的 关 系 数 据 库 系 统 根 据 其 应 用 环 境 的 不 同，往 往 还 需

#### 要 一 些 特 殊 的 约 束 条 件 。 用 户 定 义 的 完 整 性 即 是 针 对 某 个 特 定 关 系 数 据 库 的 约 束

#### 条 件 ， 它 反 映 某 一 具 体 应 用 必 须 满 足 的 语 义 要 求 。

#### 与 表 有 关 的 约 束：包 括 列 约 束(NOTNULL（非 空 约 束）)和 表 约 束(PRIMARYKEY、

foreignkey、check、UNIQUE) 。

### 41 、什么是锁？.......................................................................................

#### 答 ： 数 据 库 是 一 个 多 用 户 使 用 的 共 享 资 源 。 当 多 个 用 户 并 发 地 存 取 数 据 时 ， 在 数

#### 据 库 中 就 会 产 生 多 个 事 务 同 时 存 取 同 一 数 据 的 情 况 。 若 对 并 发 操 作 不 加 控 制 就 可

#### 能 会 读 取 和 存 储 不 正 确 的 数 据 ， 破 坏 数 据 库 的 一 致 性 。

#### 加 锁 是 实 现 数 据 库 并 发 控 制 的 一 个 非 常 重 要 的 技 术 。 当 事 务 在 对 某 个 数 据 对 象 进

#### 行 操 作 前 ， 先 向 系 统 发 出 请 求 ， 对 其 加 锁 。 加 锁 后 事 务 就 对 该 数 据 对 象 有 了 一 定

#### 的 控 制 ， 在 该 事 务 释 放 锁 之 前 ， 其 他 的 事 务 不 能 对 此 数 据 对 象 进 行 更 新 操 作 。

#### 基 本 锁 类 型 ： 锁 包 括 行 级 锁 和 表 级 锁

### 42 、什么叫视图？游标是什么？...........................................................

#### 答 ： 视 图 是 一 种 虚 拟 的 表 ， 具 有 和 物 理 表 相 同 的 功 能 。 可 以 对 视 图 进 行 增 ， 改 ，

#### 查 ， 操 作 ， 视 图 通 常 是 有 一 个 表 或 者 多 个 表 的 行 或 列 的 子 集 。 对 视 图 的 修 改 不 影

#### 响 基 本 表 。 它 使 得 我 们 获 取 数 据 更 容 易 ， 相 比 多 表 查 询 。

#### 游 标 ： 是 对 查 询 出 来 的 结 果 集 作 为 一 个 单 元 来 有 效 的 处 理 。 游 标 可 以 定 在 该 单 元

#### 中 的 特 定 行 ， 从 结 果 集 的 当 前 行 检 索 一 行 或 多 行 。 可 以 对 结 果 集 当 前 行 做 修 改 。

#### 一 般 不 使 用 游 标 ， 但 是 需 要 逐 条 处 理 数 据 的 时 候 ， 游 标 显 得 十 分 重 要 。


### 43 、什么是存储过程？用什么来调用？...............................................

#### 答 ： 存 储 过 程 是 一 个 预 编 译 的SQL语 句 ， 优 点 是 允 许 模 块 化 的 设 计 ， 就 是 说 只 需

#### 创 建 一 次 ， 以 后 在 该 程 序 中 就 可 以 调 用 多 次 。 如 果 某 次 操 作 需 要 执 行 多 次SQL，

#### 使 用 存 储 过 程 比 单 纯SQL语 句 执 行 要 快 。 可 以 用 一 个 命 令 对 象 来 调 用 存 储 过 程 。

### 44 、如何通俗地理解三个范式？...........................................................

#### 答：第 一 范 式：1NF是 对 属 性 的 原 子 性 约 束，要 求 属 性 具 有 原 子 性，不 可 再 分 解；

#### 第 二 范 式：2NF是 对 记 录 的 惟 一 性 约 束，要 求 记 录 有 惟 一 标 识，即 实 体 的 惟 一 性；

#### 第 三 范 式 ：3NF是 对 字 段 冗 余 性 的 约 束 ， 即 任 何 字 段 不 能 由 其 他 字 段 派 生 出 来 ，

#### 它 要 求 字 段 没 有 冗 余 。 。

#### 范 式 化 设 计 优 缺 点:

#### 优 点:

#### 可 以 尽 量 得 减 少 数 据 冗 余 ， 使 得 更 新 快 ， 体 积 小

#### 缺 点:对 于 查 询 需 要 多 个 表 进 行 关 联 ， 减 少 写 得 效 率 增 加 读 得 效 率 ， 更 难 进 行 索 引

#### 优 化

#### 反 范 式 化:

#### 优 点:可 以 减 少 表 得 关 联 ， 可 以 更 好 得 进 行 索 引 优 化


#### 缺 点:数 据 冗 余 以 及 数 据 异 常 ， 数 据 得 修 改 需 要 更 多 的 成 本

### 45 、什么是基本表？什么是视图？.......................................................

#### 答：基 本 表 是 本 身 独 立 存 在 的 表，在 SQL 中 一 个 关 系 就 对 应 一 个 表。 视 图 是 从

#### 一 个 或 几 个 基 本 表 导 出 的 表 。 视 图 本 身 不 独 立 存 储 在 数 据 库 中 ， 是 一 个 虚 表

### 46 、试述视图的优点？...........................................................................

#### 答 ：(1) 视 图 能 够 简 化 用 户 的 操 作 (2) 视 图 使 用 户 能 以 多 种 角 度 看 待 同 一 数 据；

#### (3) 视 图 为 数 据 库 提 供 了 一 定 程 度 的 逻 辑 独 立 性 ； (4) 视 图 能 够 对 机 密 数 据 提 供

#### 安 全 保 护 。

### 47 、 NULL是什么意思.........................................................................

#### 答 ：NULL这 个 值 表 示UNKNOWN(未 知):它 不 表 示“ ”(空 字 符 串)。 对NULL这

#### 个 值 的 任 何 比 较 都 会 生 产 一 个NULL值 。 您 不 能 把 任 何 值 与 一 个 NULL值 进 行 比

#### 较 ， 并 在 逻 辑 上 希 望 获 得 一 个 答 案 。

#### 使 用IS NULL来 进 行NULL判 断

### 48 、主键、外键和索引的区别？...........................................................

#### 主 键 、 外 键 和 索 引 的 区 别

#### 定 义 ：


#### 主 键–唯 一 标 识 一 条 记 录 ， 不 能 有 重 复 的 ， 不 允 许 为 空

#### 外 键–表 的 外 键 是 另 一 表 的 主 键, 外 键 可 以 有 重 复 的, 可 以 是 空 值

#### 索 引–该 字 段 没 有 重 复 值 ， 但 可 以 有 一 个 空 值

#### 作 用 ：

#### 主 键–用 来 保 证 数 据 完 整 性

#### 外 键–用 来 和 其 他 表 建 立 联 系 用 的

#### 索 引–是 提 高 查 询 排 序 的 速 度

#### 个 数 ：

#### 主 键–主 键 只 能 有 一 个

#### 外 键–一 个 表 可 以 有 多 个 外 键

#### 索 引–一 个 表 可 以 有 多 个 唯 一 索 引

### 49 、你可以用什么来确保表格里的字段只接受特定范围里的值?.....

答 ：Check限 制 ， 它 在 数 据 库 表 格 里 被 定 义 ， 用 来 限 制 输 入 该 列 的 值 。

触 发 器 也 可 以 被 用 来 限 制 数 据 库 表 格 里 的 字 段 能 够 接 受 的 值 ， 但 是 这 种 办 法 要 求
触 发 器 在 表 格 里 被 定 义 ， 这 可 能 会 在 某 些 情 况 下 影 响 到 性 能 。


### 50 、说说对SQL语句优化有哪些方法？（选择几条）.....................

1 、Where子 句 中：where表 之 间 的 连 接 必 须 写 在 其 他Where条 件 之 前，那 些 可
以 过 滤 掉 最 大 数 量 记 录 的 条 件 必 须 写 在Where子 句 的 末 尾.HAVING最 后 。

2 、 用EXISTS替 代IN、 用NOTEXISTS替 代NOTIN。

#### 3 、 避 免 在 索 引 列 上 使 用 计 算

#### 4 、 避 免 在 索 引 列 上 使 用ISNULL和ISNOTNULL

5 、对 查 询 进 行 优 化，应 尽 量 避 免 全 表 扫 描，首 先 应 考 虑 在 where 及 orderby 涉
及 的 列 上 建 立 索 引 。

6 、 应 尽 量 避 免 在 where 子 句 中 对 字 段 进 行 null 值 判 断 ， 否 则 将 导 致 引 擎 放 弃
使 用 索 引 而 进 行 全 表 扫 描

7 、应 尽 量 避 免 在 where 子 句 中 对 字 段 进 行 表 达 式 操 作，这 将 导 致 引 擎 放 弃 使 用
索 引 而 进 行 全 表 扫 描

## Java 并发编程（一）.............................................................................................

### 1 、在java中守护线程和本地线程区别？............................................

java中 的 线 程 分 为 两 种 ： 守 护 线 程 （Daemon） 和 用 户 线 程 （User） 。


任 何 线 程 都 可 以 设 置 为 守 护 线 程 和 用 户 线 程，通 过 方 法Thread.setDaemon(bool
on)；true则 把 该 线 程 设 置 为 守 护 线 程，反 之 则 为 用 户 线 程。Thread.setDaemon()
必 须 在Thread.start()之 前 调 用 ， 否 则 运 行 时 会 抛 出 异 常 。

**两 者 的 区 别** ：
唯 一 的 区 别 是 判 断 虚 拟 机(JVM)何 时 离 开，Daemon是 为 其 他 线 程 提 供 服 务，如 果
全 部 的UserThread已 经 撤 离 ，Daemon 没 有 可 服 务 的 线 程 ，JVM撤 离 。 也 可
以 理 解 为 守 护 线 程 是JVM自 动 创 建 的 线 程（但 不 一 定），用 户 线 程 是 程 序 创 建 的
线 程；比 如JVM的 垃 圾 回 收 线 程 是 一 个 守 护 线 程，当 所 有 线 程 已 经 撤 离，不 再 产
生 垃 圾，守 护 线 程 自 然 就 没 事 可 干 了，当 垃 圾 回 收 线 程 是Java虚 拟 机 上 仅 剩 的 线
程 时 ，Java虚 拟 机 会 自 动 离 开 。

**扩 展** ：ThreadDump打 印 出 来 的 线 程 信 息 ， 含 有daemon字 样 的 线 程 即 为 守 护
进 程，可 能 会 有：服 务 守 护 进 程、编 译 守 护 进 程、windows下 的 监 听Ctrl+break
的 守 护 进 程 、Finalizer守 护 进 程 、 引 用 处 理 守 护 进 程 、GC守 护 进 程 。

### 2 、线程与进程的区别？.........................................................................

#### 进 程 是 操 作 系 统 分 配 资 源 的 最 小 单 元 ， 线 程 是 操 作 系 统 调 度 的 最 小 单 元 。

#### 一 个 程 序 至 少 有 一 个 进 程,一 个 进 程 至 少 有 一 个 线 程 。

### 3 、什么是多线程中的上下文切换？.....................................................

#### 多 线 程 会 共 同 使 用 一 组 计 算 机 上的CPU，而 线 程 数 大 于 给 程 序 分 配的CPU数 量 时，

#### 为 了 让 各 个 线 程 都 有 执 行 的 机 会，就 需 要 轮 转 使 用CPU。不 同 的 线 程 切 换 使 用CPU

#### 发 生 的 切 换 数 据 等 就 是 上 下 文 切 换 。


### 4 、死锁与活锁的区别，死锁与饥饿的区别？.....................................

#### 死 锁 ： 是 指 两 个 或 两 个 以 上 的 进 程 （ 或 线 程 ） 在 执 行 过 程 中 ， 因 争 夺 资 源 而 造 成

#### 的 一 种 互 相 等 待 的 现 象 ， 若 无 外 力 作 用 ， 它 们 都 将 无 法 推 进 下 去 。

#### 产 生 死 锁 的 必 要 条 件 ：

#### 1 、 互 斥 条 件 ： 所 谓 互 斥 就 是 进 程 在 某 一 时 间 内 独 占 资 源 。

#### 2 、 请 求 与 保 持 条 件 ： 一 个 进 程 因 请 求 资 源 而 阻 塞 时 ， 对 已 获 得 的 资 源 保 持 不 放。

#### 3 、 不 剥 夺 条 件:进 程 已 获 得 资 源 ， 在 末 使 用 完 之 前 ， 不 能 强 行 剥 夺 。

#### 4 、 循 环 等 待 条 件:若 干 进 程 之 间 形 成 一 种 头 尾 相 接 的 循 环 等 待 资 源 关 系 。

#### 活 锁 ：任 务 或 者 执 行 者 没 有 被 阻 塞，由 于 某 些 条 件 没 有 满 足，导 致 一 直 重 复 尝 试，

#### 失 败 ， 尝 试 ， 失 败 。

#### 活 锁 和 死 锁 的 区 别 在 于，处 于 活 锁 的 实 体 是 在 不 断 的 改 变 状 态，所 谓 的“活”，而

#### 处 于 死 锁 的 实 体 表 现 为 等 待 ； 活 锁 有 可 能 自 行 解 开 ， 死 锁 则 不 能 。

#### 饥 饿 ： 一 个 或 者 多 个 线 程 因 为 种 种 原 因 无 法 获 得 所 需 要 的 资 源 ， 导 致 一 直 无 法 执

#### 行 的 状 态 。

**Java中 导 致 饥 饿 的 原 因** ：
1 、 高 优 先 级 线 程 吞 噬 所 有 的 低 优 先 级 线 程 的CPU时 间 。
2 、线 程 被 永 久 堵 塞 在 一 个 等 待 进 入 同 步 块 的 状 态，因 为 其 他 线 程 总 是 能 在 它 之 前
持 续 地 对 该 同 步 块 进 行 访 问 。
3 、 线 程 在 等 待 一 个 本 身 也 处 于 永 久 等 待 完 成 的 对 象(比 如 调 用 这 个 对 象 的wait方
法)， 因 为 其 他 线 程 总 是 被 持 续 地 获 得 唤 醒 。

### 5 、Java中用到的线程调度算法是什么？............................................

#### 采 用 时 间 片 轮 转 的 方 式 。 可 以 设 置 线 程 的 优 先 级 ， 会 映 射 到 下 层 的 系 统 上 面 的 优

#### 先 级 上 ， 如 非 特 别 需 要 ， 尽 量 不 要 用 ， 防 止 线 程 饥 饿 。


### 6 、什么是线程组，为什么在Java中不推荐使用？...........................

ThreadGroup类，可 以 把 线 程 归 属 到 某 一 个 线 程 组 中，线 程 组 中 可 以 有 线 程 对 象，
也 可 以 有 线 程 组 ， 组 中 还 可 以 有 线 程 ， 这 样 的 组 织 结 构 有 点 类 似 于 树 的 形 式 。

为 什 么 不 推 荐 使 用 ？ 因 为 使 用 有 很 多 的 安 全 隐 患 吧 ， 没 有 具 体 追 究 ， 如 果 需 要 使
用 ， 推 荐 使 用 线 程 池 。

## 7 、为什么使用Executor框架？...........................................................

每 次 执 行 任 务 创 建 线 程 newThread()比 较 消 耗 性 能 ， 创 建 一 个 线 程 是 比 较 耗 时、
耗 资 源 的 。
调 用 newThread()创 建 的 线 程 缺 乏 管 理，被 称 为 野 线 程，而 且 可 以 无 限 制 的 创 建，
线 程 之 间 的 相 互 竞 争 会 导 致 过 多 占 用 系 统 资 源 而 导 致 系 统 瘫 痪 ， 还 有 线 程 之 间 的
频 繁 交 替 也 会 消 耗 很 多 系 统 资 源 。
接 使 用newThread() 启 动 的 线 程 不 利 于 扩 展 ， 比 如 定 时 执 行 、 定 期 执 行 、 定 时
定 期 执 行 、 线 程 中 断 等 都 不 便 实 现 。

## 8 、在Java中Executor和Executors的区别？................................

Executors 工 具 类 的 不 同 方 法 按 照 我 们 的 需 求 创 建 了 不 同 的 线 程 池 ， 来 满 足 业 务
的 需 求 。
Executor 接 口 对 象 能 执 行 我 们 的 线 程 任 务 。
ExecutorService接 口 继 承 了Executor接 口 并 进 行 了 扩 展 ， 提 供 了 更 多 的 方 法 我
们 能 获 得 任 务 执 行 的 状 态 并 且 可 以 获 取 任 务 的 返 回 值 。
使 用ThreadPoolExecutor 可 以 创 建 自 定 义 线 程 池 。


Future 表 示 异 步 计 算 的 结 果，他 提 供 了 检 查 计 算 是 否 完 成 的 方 法，以 等 待 计 算 的
完 成 ， 并 可 以 使 用get()方 法 获 取 计 算 的 结 果 。

## 9 、如何在Windows和Linux上查找哪个线程使用的CPU时间最长？

#### 参 考 ：

[http://daiguahub.com/2016/07/31/使用jstack找](http://daiguahub.com/2016/07/31/使用jstack找) 出 消耗CPU最 多 的 线 程 代 码
/

### 10 、什么是原子操作？在JavaConcurrencyAPI中有哪些原

### 子类(atomicclasses)？

原 子 操 作 （atomicoperation） 意 为”不 可 被 中 断 的 一 个 或 一 系 列 操 作” 。
处 理 器 使 用 基 于 对 缓 存 加 锁 或 总 线 加 锁 的 方 式 来 实 现 多 处 理 器 之 间 的 原 子 操 作 。
在Java中 可 以 通 过 锁 和 循 环CAS的 方 式 来 实 现 原 子 操 作 。 CAS操 作— —
Compare&Set，或 是 Compare&Swap，现 在 几 乎 所 有 的CPU指 令 都 支 持CAS
的 原 子 操 作 。

#### 原 子 操 作 是 指 一 个 不 受 其 他 操 作 影 响 的 操 作 任 务 单 元 。 原 子 操 作 是 在 多 线 程 环 境

#### 下 避 免 数 据 不 一 致 必 须 的 手 段 。

int++并 不 是 一 个 原 子 操 作，所 以 当 一 个 线 程 读 取 它 的 值 并 加 1 时，另 外 一 个 线 程
有 可 能 会 读 到 之 前 的 值 ， 这 就 会 引 发 错 误 。
为 了 解 决 这 个 问 题，必 须 保 证 增 加 操 作 是 原 子 的，在JDK1.5之 前 我 们 可 以 使 用 同
步 技 术 来 做 到 这 一 点 。 到JDK1.5，java.util.concurrent.atomic包 提 供 了int和
long类 型 的 原 子 包 装 类 ， 它 们 可 以 自 动 的 保 证 对 于 他 们 的 操 作 是 原 子 的 并 且 不 需
要 使 用 同 步 。


java.util.concurrent这 个 包 里 面 提 供 了 一 组 原 子 类 。 其 基 本 的 特 性 就 是 在 多 线 程
环 境 下 ， 当 有 多 个 线 程 同 时 执 行 这 些 类 的 实 例 包 含 的 方 法 时 ， 具 有 排 他 性 ， 即 当
某 个 线 程 进 入 方 法 ， 执 行 其 中 的 指 令 时 ， 不 会 被 其 他 线 程 打 断 ， 而 别 的 线 程 就 像
自 旋 锁 一 样，一 直 等 到 该 方 法 执 行 完 成，才 由JVM从 等 待 队 列 中 选 择 一 个 另 一 个
线 程 进 入 ， 这 只 是 一 种 逻 辑 上 的 理 解 。

原 子 类 ：AtomicBoolean，AtomicInteger，AtomicLong，AtomicReference
原 子 数 组 ：AtomicIntegerArray，AtomicLongArray，AtomicReferenceArray
原 子 属 性 更 新 器 ：AtomicLongFieldUpdater，AtomicIntegerFieldUpdater，
AtomicReferenceFieldUpdater
解 决ABA问 题 的 原 子 类 ：AtomicMarkableReference（ 通 过 引 入 一 个boolean
来 反 映 中 间 有 没 有 变 过 ） ，AtomicStampedReference（ 通 过 引 入 一 个int来 累
加 来 反 映 中 间 有 没 有 变 过 ）

### 11 、JavaConcurrencyAPI中的Lock接口(Lockinterface)

### 是什么？对比同步它有什么优势？

Lock接 口 比 同 步 方 法 和 同 步 块 提 供 了 更 具 扩 展 性 的 锁 操 作 。
他 们 允 许 更 灵 活 的 结 构 ， 可 以 具 有 完 全 不 同 的 性 质 ， 并 且 可 以 支 持 多 个 相 关 类 的
条 件 对 象 。

**它 的 优 势 有** ：

可 以 使 锁 更 公 平
可 以 使 线 程 在 等 待 锁 的 时 候 响 应 中 断
可 以 让 线 程 尝 试 获 取 锁 ， 并 在 无 法 获 取 锁 的 时 候 立 即 返 回 或 者 等 待 一 段 时 间
可 以 在 不 同 的 范 围 ， 以 不 同 的 顺 序 获 取 和 释 放 锁


整 体 上 来 说Lock是synchronized的 扩 展 版 ，Lock提 供 了 无 条 件 的 、 可 轮 询 的
(tryLock方 法)、定 时 的(tryLock带 参 方 法)、可 中 断 的(lockInterruptibly)、可 多
条 件 队 列 的(newCondition方 法)锁 操 作 。 另 外Lock的 实 现 类 基 本 都 支 持 非 公 平
锁(默 认)和 公 平 锁 ，synchronized只 支 持 非 公 平 锁 ， 当 然 ， 在 大 部 分 情 况 下 ， 非
公 平 锁 是 高 效 的 选 择 。

## 12 、什么是Executors框架？..............................................................

Executor框 架 是 一 个 根 据 一 组 执 行 策 略 调 用 ， 调 度 ， 执 行 和 控 制 的 异 步 任 务 的 框
架 。

无 限 制 的 创 建 线 程 会 引 起 应 用 程 序 内 存 溢 出 。 所 以 创 建 一 个 线 程 池 是 个 更 好 的 的
解 决 方 案 ， 因 为 可 以 限 制 线 程 的 数 量 并 且 可 以 回 收 再 利 用 这 些 线 程 。 利用
Executors框 架 可 以 非 常 方 便 的 创 建 一 个 线 程 池 。

### 13 、什么是阻塞队列？阻塞队列的实现原理是什么？如何使用

### 阻塞队列来实现生产者-消费者模型？

阻 塞 队 列 （BlockingQueue） 是 一 个 支 持 两 个 附 加 操 作 的 队 列 。

#### 这 两 个 附 加 的 操 作 是 ： 在 队 列 为 空 时 ， 获 取 元 素 的 线 程 会 等 待 队 列 变 为 非 空 。 当

#### 队 列 满 时 ， 存 储 元 素 的 线 程 会 等 待 队 列 可 用 。

#### 阻 塞 队 列 常 用 于 生 产 者 和 消 费 者 的 场 景 ， 生 产 者 是 往 队 列 里 添 加 元 素 的 线 程 ， 消

#### 费 者 是 从 队 列 里 拿 元 素 的 线 程 。 阻 塞 队 列 就 是 生 产 者 存 放 元 素 的 容 器 ， 而 消 费 者

#### 也 只 从 容 器 里 拿 元 素 。

#### JDK7提 供 了 7 个 阻 塞 队 列 。 分 别 是 ：


ArrayBlockingQueue ： 一 个 由 数 组 结 构 组 成 的 有 界 阻 塞 队 列 。
LinkedBlockingQueue ： 一 个 由 链 表 结 构 组 成 的 有 界 阻 塞 队 列 。
PriorityBlockingQueue ： 一 个 支 持 优 先 级 排 序 的 无 界 阻 塞 队 列 。
DelayQueue： 一 个 使 用 优 先 级 队 列 实 现 的 无 界 阻 塞 队 列 。
SynchronousQueue： 一 个 不 存 储 元 素 的 阻 塞 队 列 。
LinkedTransferQueue： 一 个 由 链 表 结 构 组 成 的 无 界 阻 塞 队 列 。
LinkedBlockingDeque： 一 个 由 链 表 结 构 组 成 的 双 向 阻 塞 队 列 。

Java 5 之 前 实 现 同 步 存 取 时 ， 可 以 使 用 普 通 的 一 个 集 合 ， 然 后 在 使 用 线 程 的 协 作
和 线 程 同 步 可 以 实 现 生 产 者 ， 消 费 者 模 式 ， 主 要 的 技 术 就 是 用 好 ，
wait,notify,notifyAll,sychronized这 些 关 键 字 。 而 在java 5 之 后 ， 可 以 使 用 阻
塞 队 列 来 实 现 ， 此 方 式 大 大 简 少 了 代 码 量 ， 使 得 多 线 程 编 程 更 加 容 易 ， 安 全 方 面
也 有 保 障 。
BlockingQueue接 口 是Queue的 子 接 口 ， 它 的 主 要 用 途 并 不 是 作 为 容 器 ， 而 是
作 为 线 程 同 步 的 的 工 具 ， 因 此 他 具 有 一 个 很 明 显 的 特 性 ， 当 生 产 者 线 程 试 图向
BlockingQueue放 入 元 素 时 ， 如 果 队 列 已 满 ， 则 线 程 被 阻 塞 ， 当 消 费 者 线 程 试 图
从 中 取 出 一 个 元 素 时 ， 如 果 队 列 为 空 ， 则 该 线 程 会 被 阻 塞 ， 正 是 因 为 它 所 具 有 这
个 特 性 ， 所 以 在 程 序 中 多 个 线 程 交 替 向BlockingQueue中 放 入 元 素 ， 取 出 元 素，
它 可 以 很 好 的 控 制 线 程 之 间 的 通 信 。

阻 塞 队 列 使 用 最 经 典 的 场 景 就 是socket客 户 端 数 据 的 读 取 和 解 析，读 取 数 据 的 线
程 不 断 将 数 据 放 入 队 列 ， 然 后 解 析 线 程 不 断 从 队 列 取 数 据 解 析 。

## 14 、什么是Callable和Future?..........................................................

Callable接 口 类 似 于Runnable，从 名 字 就 可 以 看 出 来 了，但 是Runnable不 会 返
回 结 果 ， 并 且 无 法 抛 出 返 回 结 果 的 异 常 ， 而Callable功 能 更 强 大 一 些 ， 被 线 程 执
行 后，可 以 返 回 值，这 个 返 回 值 可 以 被Future拿 到，也 就 是 说，Future可 以 拿 到
异 步 执 行 任 务 的 返 回 值 。
可 以 认 为 是 带 有 回 调 的Runnable。


Future接 口 表 示 异 步 任 务，是 还 没 有 完 成 的 任 务 给 出 的 未 来 结 果。所 以 说Callable
用 于 产 生 结 果 ，Future用 于 获 取 结 果 。

## 15 、什么是FutureTask?使用ExecutorService启动任务。...........

在Java并 发 程 序 中FutureTask表 示 一 个 可 以 取 消 的 异 步 运 算 。 它 有 启 动 和 取 消
运 算 、 查 询 运 算 是 否 完 成 和 取 回 运 算 结 果 等 方 法 。 只 有 当 运 算 完 成 的 时 候 结 果 才
能 取 回，如 果 运 算 尚 未 完 成get方 法 将 会 阻 塞。一 个FutureTask对 象 可 以 对 调 用
了Callable和Runnable的 对 象 进 行 包 装，由于FutureTask也 是 调 用了Runnable
接 口 所 以 它 可 以 提 交 给Executor来 执 行 。

## 16 、什么是并发容器的实现？...............................................................

何 为 同 步 容 器：可 以 简 单 地 理 解 为 通 过synchronized来 实 现 同 步 的 容 器，如 果 有
多 个 线 程 调 用 同 步 容 器 的 方 法 ， 它 们 将 会 串 行 执 行 。 比 如Vector，Hashtable，
以 及Collections.synchroniz edSet，synchronizedList等 方 法 返 回 的 容 器 。
可 以 通 过 查 看Vector，Hashtable等 这 些 同 步 容 器 的 实 现 代 码 ， 可 以 看 到 这 些 容
器 实 现 线 程 安 全 的 方 式 就 是 将 它 们 的 状 态 封 装 起 来 ， 并 在 需 要 同 步 的 方 法 上 加 上
关 键 字synchronized。

#### 并 发 容 器 使 用 了 与 同 步 容 器 完 全 不 同 的 加 锁 策 略 来 提 供 更 高 的 并 发 性 和 伸 缩 性 ，

例 如 在ConcurrentHashMap中 采 用 了 一 种 粒 度 更 细 的 加 锁 机 制 ， 可 以 称 为 分 段
锁 ， 在 这 种 锁 机 制 下 ， 允 许 任 意 数 量 的 读 线 程 并 发 地 访 问map， 并 且 执 行 读 操 作
的 线 程 和 写 操 作 的 线 程 也 可 以 并 发 的 访 问map， 同 时 允 许 一 定 数 量 的 写 操 作 线 程
并 发 地 修 改map， 所 以 它 可 以 在 并 发 环 境 下 实 现 更 高 的 吞 吐 量 。

## 17 、多线程同步和互斥有几种实现方法，都是什么？.......................


#### 线 程 同 步 是 指 线 程 之 间 所 具 有 的 一 种 制 约 关 系 ， 一 个 线 程 的 执 行 依 赖 另 一 个 线 程

#### 的 消 息 ， 当 它 没 有 得 到 另 一 个 线 程 的 消 息 时 应 等 待 ， 直 到 消 息 到 达 时 才 被 唤 醒 。

#### 线 程 互 斥 是 指 对 于 共 享 的 进 程 系 统 资 源 ， 在 各 单 个 线 程 访 问 时 的 排 它 性 。 当 有 若

#### 干 个 线 程 都 要 使 用 某 一 共 享 资 源 时 ， 任 何 时 刻 最 多 只 允 许 一 个 线 程 去 使 用 ， 其 它

#### 要 使 用 该 资 源 的 线 程 必 须 等 待 ， 直 到 占 用 资 源 者 释 放 该 资 源 。 线 程 互 斥 可 以 看 成

#### 是 一 种 特 殊 的 线 程 同 步 。

#### 线 程 间 的 同 步 方 法 大 体 可 分 为 两 类 ： 用 户 模 式 和 内 核 模 式 。 顾 名 思 义 ， 内 核 模 式

#### 就 是 指 利 用 系 统 内 核 对 象 的 单 一 性 来 进 行 同 步，使 用 时 需 要 切 换 内 核 态 与 用 户 态，

#### 而 用 户 模 式 就 是 不 需 要 切 换 到 内 核 态 ， 只 在 用 户 态 完 成 操 作 。

#### 用 户 模 式 下 的 方 法 有 ： 原 子 操 作 （ 例 如 一 个 单 一 的 全 局 变 量 ） ， 临 界 区 。 内 核 模

#### 式 下 的 方 法 有 ： 事 件 ， 信 号 量 ， 互 斥 量 。

## 18 、什么是竞争条件？你怎样发现和解决竞争？...............................

#### 当 多 个 进 程 都 企 图 对 共 享 数 据 进 行 某 种 处 理 ， 而 最 后 的 结 果 又 取 决 于 进 程 运 行 的

顺 序 时 ， 则 我 们 认 为 这 发 生 了 竞 争 条 件 （racecondition） 。

## 19 、你将如何使用threaddump？你将如何分析Threaddump？

**新 建 状 态 （New）**

用new语 句 创 建 的 线 程 处 于 新 建 状 态，此 时 它 和 其 他Java对 象 一 样，仅 仅 在 堆 区
中 被 分 配 了 内 存 。
**就 绪 状 态 （Runnable）**


当 一 个 线 程 对 象 创 建 后，其 他 线 程 调 用 它 的start()方 法，该 线 程 就 进 入 就 绪 状 态，
Java虚 拟 机 会 为 它 创 建 方 法 调 用 栈 和 程 序 计 数 器 。 处 于 这 个 状 态 的 线 程 位 于 可 运
行 池 中 ， 等 待 获 得CPU的 使 用 权 。

**运 行 状 态 （Running）**

处 于 这 个 状 态 的 线 程 占 用CPU， 执 行 程 序 代 码 。 只 有 处 于 就 绪 状 态 的 线 程 才 有 机
会 转 到 运 行 状 态 。
**阻 塞 状 态 （Blocked）**

阻 塞 状 态 是 指 线 程 因 为 某 些 原 因 放 弃CPU， 暂 时 停 止 运 行 。 当 线 程 处 于 阻 塞 状 态
时，Java虚 拟 机 不 会 给 线 程 分 配CPU。直 到 线 程 重 新 进 入 就 绪 状 态，它 才 有 机 会
转 到 运 行 状 态 。

**阻 塞 状 态 可 分 为 以 下 3 种 ：**

**位 于 对 象 等 待 池 中 的 阻 塞 状 态 （Blockedinobject’swaitpool）** ：

当 线 程 处 于 运 行 状 态 时 ， 如 果 执 行 了 某 个 对 象 的wait()方 法 ，Java虚 拟 机 就 会 把
线 程 放 到 这 个 对 象 的 等 待 池 中 ， 这 涉 及 到“线 程 通 信”的 内 容 。

**位 于 对 象 锁 池 中 的 阻 塞 状 态 （Blockedinobject’slockpool）** ：

#### 当 线 程 处 于 运 行 状 态 时 ， 试 图 获 得 某 个 对 象 的 同 步 锁 时 ， 如 果 该 对 象 的 同 步 锁 已

经 被 其 他 线 程 占 用 ，Java虚 拟 机 就 会 把 这 个 线 程 放 到 这 个 对 象 的 锁 池 中 ， 这 涉 及
到“线 程 同 步”的 内 容 。

**其 他 阻 塞 状 态 （OtherwiseBlocked）** ：

当 前 线 程 执 行 了sleep()方 法，或 者 调 用 了 其 他 线 程 的join()方 法，或 者 发 出 了I/O
请 求 时 ， 就 会 进 入 这 个 状 态 。


死 亡 状 态 （Dead）
当 线 程 退 出run()方 法 时 ， 就 进 入 死 亡 状 态 ， 该 线 程 结 束 生 命 周 期 。
我 们 运 行 之 前 的 那 个 死 锁 代 码SimpleDeadLock.java， 然 后 尝 试 输 出 信 息(

/* 时间，jvm信息 */
2017-11-0117:36:28
FullthreaddumpJavaHotSpot(TM)64-BitServerVM(25.144-b01mixed
mode):

/* 线程名称：DestroyJavaVM
编号：#13
优先级： 5
系统优先级： 0
jvm内部线程id：0x0000000001c88800
对应系统线程id（NativeThreadID）：0x1c18
线程状态：waitingoncondition[0x0000000000000000] （等待某个条件）
线程详细状态：java.lang.Thread.State:RUNNABLE 及之后所有*/
"DestroyJavaVM"#13prio=5os_prio=0tid=0x0000000001c88800
nid=0x1c18waitingoncondition[0x0000000000000000]
java.lang.Thread.State:RUNNABLE

"Thread-1"#12prio=5os_prio=0tid=0x0000000018d49000
nid=0x17b8waitingformonitorentry[0x0000000019d7f000]
/* 线程状态：阻塞（在对象同步上）
代码位置：at
com.leo.interview.SimpleDeadLock$B.run(SimpleDeadLock.java:56)
等待锁：0x00000000d629b4d8
已经获得锁：0x00000000d629b4e8*/
java.lang.Thread.State:BLOCKED(onobjectmonitor)
at
com.leo.interview.SimpleDeadLock$B.run(SimpleDeadLock.java:56)


- waitingtolock<0x00000000d629b4d8>(ajava.lang.Object)
- locked<0x00000000d629b4e8>(ajava.lang.Object)

"Thread-0"#11prio=5os_prio=0tid=0x0000000018d44000nid=0x1ebc
waitingformonitorentry[0x000000001907f000]
java.lang.Thread.State:BLOCKED(onobjectmonitor)
at
com.leo.interview.SimpleDeadLock$A.run(SimpleDeadLock.java:34)

- waitingtolock<0x00000000d629b4e8>(ajava.lang.Object)
- locked<0x00000000d629b4d8>(ajava.lang.Object)

"ServiceThread"#10daemonprio=9os_prio=0
tid=0x0000000018ca5000nid=0x1264runnable[0x0000000000000000]
java.lang.Thread.State:RUNNABLE

"C1CompilerThread2"#9daemonprio=9os_prio=2
tid=0x0000000018c46000nid=0xb8cwaitingoncondition
[0x0000000000000000]
java.lang.Thread.State:RUNNABLE

"C2CompilerThread1"#8daemonprio=9os_prio=2
tid=0x0000000018be4800nid=0x1db4waitingoncondition
[0x0000000000000000]
java.lang.Thread.State:RUNNABLE

"C2CompilerThread0"#7daemonprio=9os_prio=2
tid=0x0000000018be3800nid=0x810waitingoncondition
[0x0000000000000000]
java.lang.Thread.State:RUNNABLE


"MonitorCtrl-Break"#6daemonprio=5os_prio=0
tid=0x0000000018bcc800nid=0x1c24runnable[0x00000000193ce000]
java.lang.Thread.State:RUNNABLE
atjava.net.SocketInputStream.socketRead0(NativeMethod)
at
java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
atjava.net.SocketInputStream.read(SocketInputStream.java:171)
atjava.net.SocketInputStream.read(SocketInputStream.java:141)
atsun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)
atsun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
atsun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)

- locked<0x00000000d632b928>(ajava.io.InputStreamReader)
  atjava.io.InputStreamReader.read(InputStreamReader.java:184)
  atjava.io.BufferedReader.fill(BufferedReader.java:161)
  atjava.io.BufferedReader.readLine(BufferedReader.java:324)
- locked<0x00000000d632b928>(ajava.io.InputStreamReader)
  atjava.io.BufferedReader.readLine(BufferedReader.java:389)
  at
  com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:6
  4)

"AttachListener"#5daemonprio=5os_prio=2
tid=0x0000000017781800nid=0x524runnable[0x0000000000000000]
java.lang.Thread.State:RUNNABLE

"SignalDispatcher"#4daemonprio=9os_prio=2
tid=0x000000001778f800nid=0x1b08waitingoncondition
[0x0000000000000000]
java.lang.Thread.State:RUNNABLE


"Finalizer"#3daemonprio=8os_prio=1tid=0x000000001776a800
nid=0xdacinObject.wait()[0x0000000018b6f000]
java.lang.Thread.State:WAITING(onobjectmonitor)
atjava.lang.Object.wait(NativeMethod)

- waitingon<0x00000000d6108ec8>(a
  java.lang.ref.ReferenceQueue$Lock)
  atjava.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)
- locked<0x00000000d6108ec8>(a
  java.lang.ref.ReferenceQueue$Lock)
  atjava.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)
  atjava.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)

"ReferenceHandler"#2daemonprio=10os_prio=2
tid=0x0000000017723800nid=0x1670inObject.wait()
[0x00000000189ef000]
java.lang.Thread.State:WAITING(onobjectmonitor)
atjava.lang.Object.wait(NativeMethod)

- waitingon<0x00000000d6106b68>(a
  java.lang.ref.Reference$Lock)
  atjava.lang.Object.wait(Object.java:502)
  atjava.lang.ref.Reference.tryHandlePending(Reference.java:191)
- locked<0x00000000d6106b68>(ajava.lang.ref.Reference$Lock)
  atjava.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)

"VMThread"os_prio=2tid=0x000000001771b800nid=0x604runnable

"GCtaskthread#0(ParallelGC)"os_prio=0tid=0x0000000001c9d800
nid=0x9f0runnable

"GCtaskthread#1(ParallelGC)"os_prio=0tid=0x0000000001c9f000
nid=0x154crunnable


"GCtaskthread#2(ParallelGC)"os_prio=0tid=0x0000000001ca0800
nid=0xcd0runnable

"GCtaskthread#3(ParallelGC)"os_prio=0tid=0x0000000001ca2000
nid=0x1e58runnable

"VMPeriodicTaskThread"os_prio=2tid=0x0000000018c5a000
nid=0x1b58waitingoncondition

JNIglobalreferences: 33

/* 此处可以看待死锁的相关信息！ */

FoundoneJava-leveldeadlock:
=============================

"Thread-1":
waitingtolockmonitor0x0000000017729fc8(object
0x00000000d629b4d8,ajava.lang.Object),
whichisheldby"Thread-0"
"Thread-0":
waitingtolockmonitor0x0000000017727738(object
0x00000000d629b4e8,ajava.lang.Object),
whichisheldby"Thread-1"

Javastackinformationforthethreadslistedabove:
==============================================

=====
"Thread-1":
at
com.leo.interview.SimpleDeadLock$B.run(SimpleDeadLock.java:56)


- waitingtolock<0x00000000d629b4d8>(ajava.lang.Object)
- locked<0x00000000d629b4e8>(ajava.lang.Object)
  "Thread-0":
  at
  com.leo.interview.SimpleDeadLock$A.run(SimpleDeadLock.java:34)
- waitingtolock<0x00000000d629b4e8>(ajava.lang.Object)
- locked<0x00000000d629b4d8>(ajava.lang.Object)

Found 1 deadlock.

/* 内存使用状况，详情得看JVM方面的书 */
Heap
PSYoungGen total37888K,used4590K[0x00000000d6100000,
0x00000000d8b00000,0x0000000100000000)
edenspace32768K,14%used
[0x00000000d6100000,0x00000000d657b968,0x00000000d8100000)
fromspace5120K,0%used
[0x00000000d8600000,0x00000000d8600000,0x00000000d8b00000)
to space5120K,0%used
[0x00000000d8100000,0x00000000d8100000,0x00000000d8600000)
ParOldGen total86016K,used0K[0x0000000082200000,
0x0000000087600000,0x00000000d6100000)
objectspace86016K,0%used
[0x0000000082200000,0x0000000082200000,0x0000000087600000)
Metaspace used3474K,capacity4500K,committed4864K,
reserved1056768K
classspace used382K,capacity388K,committed512K,reserved
1048576K


### 20 、为什么我们调用start()方法时会执行run()方法，为什么

### 我们不能直接调用run()方法？

当 你 调 用start()方 法 时 你 将 创 建 新 的 线 程 ， 并 且 执 行 在run()方 法 里 的 代 码 。
但 是 如 果 你 直 接 调用run()方 法，它 不 会 创 建 新 的 线 程 也 不 会 执 行 调 用 线 程 的 代 码，
只 会 把run方 法 当 作 普 通 方 法 去 执 行 。

## 21 、Java中你怎样唤醒一个阻塞的线程？..........................................

在Java发 展 史 上 曾 经 使 用suspend()、resume()方 法 对 于 线 程 进 行 阻 塞 唤 醒，但
随 之 出 现 很 多 问 题 ， 比 较 典 型 的 还 是 死 锁 问 题 。
解 决 方 案 可 以 使 用 以 对 象 为 目 标 的 阻 塞 ， 即 利 用Object类 的wait()和notify()方
法 实 现 线 程 阻 塞 。
首 先，wait、notify方 法 是 针 对 对 象 的，调 用 任 意 对 象 的wait()方 法 都 将 导 致 线 程
阻 塞，阻 塞 的 同 时 也 将 释 放 该 对 象 的 锁，相 应 地，调 用 任 意 对 象 的notify()方 法 则
将 随 机 解 除 该 对 象 阻 塞 的 线 程 ， 但 它 需 要 重 新 获 取 改 对 象 的 锁 ， 直 到 获 取 成 功 才
能 往 下 执 行 ； 其 次 ，wait、notify方 法 必 须 在synchronized块 或 方 法 中 被 调 用，
并 且 要 保 证 同 步 块 或 方 法 的 锁 对 象 与 调 用wait、notify方 法 的 对 象 是 同 一 个 ， 如
此 一 来 在 调 用wait之 前 当 前 线 程 就 已 经 成 功 获 取 某 对 象 的 锁，执 行wait阻 塞 后 当
前 线 程 就 将 之 前 获 取 的 对 象 锁 释 放 。

## 22 、在Java中CycliBarriar和CountdownLatch有什么区别？...

CyclicBarrier可 以 重 复 使 用 ， 而CountdownLatch不 能 重 复 使 用 。


Java的concurrent包 里 面 的CountDownLatch其 实 可 以 把 它 看 作 一 个 计 数 器，
只 不 过 这 个 计 数 器 的 操 作 是 原 子 操 作 ， 同 时 只 能 有 一 个 线 程 去 操 作 这 个 计 数 器 ，
也 就 是 同 时 只 能 有 一 个 线 程 去 减 这 个 计 数 器 里 面 的 值 。
你 可 以 向CountDownLatch对 象 设 置 一 个 初 始 的 数 字 作 为 计 数 值，任 何 调 用 这 个
对 象 上 的await()方 法 都 会 阻 塞，直 到 这 个 计 数 器 的 计 数 值 被 其 他 的 线 程 减 为 0 为
止 。
所 以 在 当 前 计 数 到 达 零 之 前 ，await 方 法 会 一 直 受 阻 塞 。 之 后 ， 会 释 放 所 有 等 待
的 线 程，await的 所 有 后 续 调 用 都 将 立 即 返 回。这 种 现 象 只 出 现 一 次— —计 数 无 法
被 重 置 。 如 果 需 要 重 置 计 数 ， 请 考 虑 使 用 CyclicBarrier。
CountDownLatch的 一 个 非 常 典 型 的 应 用 场 景 是 ： 有 一 个 任 务 想 要 往 下 执 行 ， 但
必 须 要 等 到 其 他 的 任 务 执 行 完 毕 后 才 可 以 继 续 往 下 执 行 。 假 如 我 们 这 个 想 要 继 续
往 下 执 行 的 任 务 调 用 一 个CountDownLatch对 象 的await()方 法 ， 其 他 的 任 务 执
行 完 自 己 的 任 务 后 调 用 同 一 个CountDownLatch对 象 上 的countDow n()方 法 ，
这 个 调 用await()方 法 的 任 务 将 一 直 阻 塞 等 待 ， 直 到 这 个CountDownLatch对 象
的 计 数 值 减 到 0 为 止 。

CyclicBarrier一 个 同 步 辅 助 类 ， 它 允 许 一 组 线 程 互 相 等 待 ， 直 到 到 达 某 个 公 共 屏
障 点 (commonbarrierpoint)。在 涉 及 一 组 固 定 大 小 的 线 程 的 程 序 中，这 些 线 程
必 须 不 时 地 互 相 等 待 ， 此 时 CyclicBarrier 很 有 用 。 因 为 该 barrier 在 释 放 等 待
线 程 后 可 以 重 用 ， 所 以 称 它 为 循 环 的 barrier。

## 23 、什么是不可变对象，它对写并发应用有什么帮助？...................

不 可 变 对 象(ImmutableObjects)即 对 象 一 旦 被 创 建 它 的 状 态（对 象 的 数 据，也 即
对 象 属 性 值 ） 就 不 能 改 变 ， 反 之 即 为 可 变 对 象(MutableObjects)。
不 可 变 对 象 的 类 即 为 不 可 变 类(ImmutableClass)。Java平 台 类 库 中 包 含 许 多 不 可
变 类 ， 如String、 基 本 类 型 的 包 装 类 、BigInteger和BigDecimal等 。
不 可 变 对 象 天 生 是 线 程 安 全 的 。 它 们 的 常 量 （ 域 ） 是 在 构 造 函 数 中 创 建 的 。 既 然
它 们 的 状 态 无 法 修 改 ， 这 些 常 量 永 远 不 会 变 。


#### 不 可 变 对 象 永 远 是 线 程 安 全 的 。

#### 只 有 满 足 如 下 状 态 ， 一 个 对 象 才 是 不 可 变 的 ；

#### 它 的 状 态 不 能 在 创 建 后 再 被 修 改 ；

所 有 域 都 是final类 型 ； 并 且 ，
它 被 正 确 创 建 （ 创 建 期 间 没 有 发 生this引 用 的 逸 出 ） 。

## 24 、什么是多线程中的上下文切换？...................................................

#### 在 上 下 文 切 换 过 程 中 ，CPU会 停 止 处 理 当 前 运 行 的 程 序 ， 并 保 存 当 前 程 序 运 行 的

#### 具 体 位 置 以 便 之 后 继 续 运 行 。 从 这 个 角 度 来 看 ， 上 下 文 切 换 有 点 像 我 们 同 时 阅 读

#### 几 本 书，在 来 回 切 换 书 本 的 同 时 我 们 需 要 记 住 每 本 书 当 前 读 到 的 页 码。在 程 序 中，

#### 上 下 文 切 换 过 程 中 的“页 码”信 息 是 保 存 在 进 程 控 制 块 （PCB） 中 的 。PCB还 经

常 被 称 作“切 换 桢”（switchframe） 。“页 码”信 息 会 一 直 保 存 到CPU的 内 存
中 ， 直 到 他 们 被 再 次 使 用 。
上 下 文 切 换 是 存 储 和 恢 复CPU状 态 的 过 程，它 使 得 线 程 执 行 能 够 从 中 断 点 恢 复 执
行 。 上 下 文 切 换 是 多 任 务 操 作 系 统 和 多 线 程 环 境 的 基 本 特 征 。

## 25 、Java中用到的线程调度算法是什么？..........................................

#### 计 算 机 通 常 只 有 一 个CPU,在 任 意 时 刻 只 能 执 行 一 条 机 器 指 令,每 个 线 程 只 有 获得

#### CPU的 使 用 权 才 能 执 行 指 令.所 谓 多 线 程 的 并 发 运 行,其 实 是 指 从 宏 观 上 看,各 个 线

#### 程 轮 流 获 得CPU的 使 用 权,分 别 执 行 各 自 的 任 务.在 运 行 池 中,会 有 多 个 处 于 就 绪 状

#### 态 的 线 程 在 等 待CPU,JAVA虚 拟 机 的 一 项 任 务 就 是 负 责 线 程 的 调 度,线 程 调 度 是 指

#### 按 照 特 定 机 制 为 多 个 线 程 分 配CPU的 使 用 权.

#### 有 两 种 调 度 模 型 ： 分 时 调 度 模 型 和 抢 占 式 调 度 模 型 。

分 时 调 度 模 型 是 指 让 所 有 的 线 程 轮 流 获得cpu的 使 用 权,并 且 平 均 分 配 每 个 线 程 占
用 的CPU的 时 间 片 这 个 也 比 较 好 理 解 。


java虚 拟 机 采 用 抢 占 式 调 度 模 型 ， 是 指 优 先 让 可 运 行 池 中 优 先 级 高 的 线 程 占用
CPU， 如 果 可 运 行 池 中 的 线 程 优 先 级 相 同 ， 那 么 就 随 机 选 择 一 个 线 程 ， 使 其 占用
CPU。 处 于 运 行 状 态 的 线 程 会 一 直 运 行 ， 直 至 它 不 得 不 放 弃CPU。

## 26 、什么是线程组，为什么在Java中不推荐使用？.........................

#### 线 程 组 和 线 程 池 是 两 个 不 同 的 概 念 ， 他 们 的 作 用 完 全 不 同 ， 前 者 是 为 了 方 便 线 程

#### 的 管 理，后 者 是 为 了 管 理 线 程 的 生 命 周 期，复 用 线 程，减 少 创 建 销 毁 线 程 的 开 销。

## 27 、为什么使用Executor框架比使用应用创建和管理线程好？....

为 什 么 要 使 用Executor线 程 池 框 架
1 、 每 次 执 行 任 务 创 建 线 程 newThread()比 较 消 耗 性 能 ， 创 建 一 个 线 程 是 比 较 耗
时 、 耗 资 源 的 。
2 、 调 用 newThread()创 建 的 线 程 缺 乏 管 理 ， 被 称 为 野 线 程 ， 而 且 可 以 无 限 制 的
创 建 ， 线 程 之 间 的 相 互 竞 争 会 导 致 过 多 占 用 系 统 资 源 而 导 致 系 统 瘫 痪 ， 还 有 线 程
之 间 的 频 繁 交 替 也 会 消 耗 很 多 系 统 资 源 。
3 、 直 接 使 用newThread() 启 动 的 线 程 不 利 于 扩 展 ， 比 如 定 时 执 行 、 定 期 执 行、
定 时 定 期 执 行 、 线 程 中 断 等 都 不 便 实 现 。

**使 用Executor线 程 池 框 架 的 优 点**

1 、能 复 用 已 存 在 并 空 闲 的 线 程 从 而 减 少 线 程 对 象 的 创 建 从 而 减 少 了 消 亡 线 程 的 开
销 。
2 、 可 有 效 控 制 最 大 并 发 线 程 数 ， 提 高 系 统 资 源 使 用 率 ， 同 时 避 免 过 多 资 源 竞 争。
3 、 框 架 中 已 经 有 定 时 、 定 期 、 单 线 程 、 并 发 数 控 制 等 功 能 。
综 上 所 述 使 用 线 程 池 框 架Executor能 更 好 的 管 理 线 程 、 提 供 系 统 资 源 使 用 率 。


## 28 、java中有几种方法可以实现一个线程？......................................

继 承 Thread 类
实 现 Runnable 接 口
实 现 Callable 接 口 ， 需 要 实 现 的 是 call() 方 法

## 29 、如何停止一个正在运行的线程？...................................................

#### 使 用 共 享 变 量 的 方 式

#### 在 这 种 方 式 中 ， 之 所 以 引 入 共 享 变 量 ， 是 因 为 该 变 量 可 以 被 多 个 执 行 相 同 任 务 的

#### 线 程 用 来 作 为 是 否 中 断 的 信 号 ， 通 知 中 断 线 程 的 执 行 。

**使 用interrupt方 法 终 止 线 程**

#### 如 果 一 个 线 程 由 于 等 待 某 些 事 件 的 发 生 而 被 阻 塞 ， 又 该 怎 样 停 止 该 线 程 呢 ？ 这 种

#### 情 况 经 常 会 发 生 ， 比 如 当 一 个 线 程 由 于 需 要 等 候 键 盘 输 入 而 被 阻 塞 ， 或 者 调用

Thread.join()方 法 ， 或 者Thread.sleep()方 法 ， 在 网 络 中 调用
ServerSocket.accept()方 法，或 者 调 用 了DatagramSocket.receive()方 法 时，都
有 可 能 导 致 线 程 阻 塞 ， 使 线 程 处 于 处 于 不 可 运 行 状 态 时 ， 即 使 主 程 序 中 将 该 线 程
的 共 享 变 量 设 置 为true， 但 该 线 程 此 时 根 本 无 法 检 查 循 环 标 志 ， 当 然 也 就 无 法 立
即 中 断。这 里 我 们 给 出 的 建 议 是，不 要 使 用stop()方 法，而 是 使 用Thread提 供的
interrupt()方 法，因 为 该 方 法 虽 然 不 会 中 断 一 个 正 在 运 行 的 线 程，但 是 它 可 以 使 一
个 被 阻 塞 的 线 程 抛 出 一 个 中 断 异 常 ， 从 而 使 线 程 提 前 结 束 阻 塞 状 态 ， 退 出 堵 塞 代
码 。

## 30 、notify()和notifyAll()有什么区别？.............................................


当 一 个 线 程 进 入wait之 后，就 必 须 等 其 他 线 程notify/notifyall,使 用notifyall,可
以 唤 醒 所 有 处 于wait状 态 的 线 程，使 其 重 新 进 入 锁 的 争 夺 队 列 中，而notify只 能
唤 醒 一 个 。

如 果 没 把 握 ， 建 议notifyAll， 防 止notigy因 为 信 号 丢 失 而 造 成 程 序 异 常 。

## 31 、什么是Daemon线程？它有什么意义？.....................................

所 谓 后 台(daemon)线 程 ， 是 指 在 程 序 运 行 的 时 候 在 后 台 提 供 一 种 通 用 服 务 的 线
程 ， 并 且 这 个 线 程 并 不 属 于 程 序 中 不 可 或 缺 的 部 分 。 因 此 ， 当 所 有 的 非 后 台 线 程
结 束 时 ， 程 序 也 就 终 止 了 ， 同 时 会 杀 死 进 程 中 的 所 有 后 台 线 程 。 反 过 来 说 ，
只 要 有 任 何 非 后 台 线 程 还 在 运 行 ， 程 序 就 不 会 终 止 。 必 须 在 线 程 启 动 之 前 调用
setDaemon()方 法 ， 才 能 把 它 设 置 为 后 台 线 程 。 注 意 ： 后 台 进 程 在 不 执 行finally
子 句 的 情 况 下 就 会 终 止 其run()方 法 。

比 如 ：JVM的 垃 圾 回 收 线 程 就 是Daemon线 程 ，Finalizer也 是 守 护 线 程 。

## 32 、java如何实现多线程之间的通讯和协作？..................................

#### 中 断 和 共 享 变 量

## 33 、什么是可重入锁（ReentrantLock）？.......................................

#### 举 例 来 说 明 锁 的 可 重 入 性

publicclassUnReentrant{
Locklock=newLock();
publicvoidouter(){


lock.lock();
inner();
lock.unlock();
}
publicvoidinner(){
lock.lock();
//dosomething
lock.unlock();
}
}

outer中 调 用 了inner，outer先 锁 住 了lock，这 样inner就 不 能 再 获 取lock。其
实 调 用outer的 线 程 已 经 获 取 了lock锁，但 是 不 能 在inner中 重 复 利 用 已 经 获 取
的 锁 资 源，这 种 锁 即 称 之 为 不 可 重 入 可 重 入 就 意 味 着：线 程 可 以 进 入 任 何 一 个 它
已 经 拥 有 的 锁 所 同 步 着 的 代 码 块 。

synchronized、ReentrantLock都 是 可 重 入 的 锁 ， 可 重 入 锁 相 对 来 说 简 化 了 并 发
编 程 的 开 发 。

### 34 、当一个线程进入某个对象的一个synchronized的实例方

### 法后，其它线程是否可进入此对象的其它方法？

如 果 其 他 方 法 没 有synchronized的 话 ， 其 他 线 程 是 可 以 进 入 的 。

所 以 要 开 放 一 个 线 程 安 全 的 对 象 时 ， 得 保 证 每 个 方 法 都 是 线 程 安 全 的 。

## 35 、乐观锁和悲观锁的理解及如何实现，有哪些实现方式？...........


#### 悲 观 锁 ： 总 是 假 设 最 坏 的 情 况 ， 每 次 去 拿 数 据 的 时 候 都 认 为 别 人 会 修 改 ， 所 以 每

#### 次 在 拿 数 据 的 时 候 都 会 上 锁 ， 这 样 别 人 想 拿 这 个 数 据 就 会 阻 塞 直 到 它 拿 到 锁 。 传

#### 统 的 关 系 型 数 据 库 里 边 就 用 到 了 很 多 这 种 锁 机 制 ， 比 如 行 锁 ， 表 锁 等 ， 读 锁 ， 写

锁 等 ， 都 是 在 做 操 作 之 前 先 上 锁 。 再 比 如Java里 面 的 同 步 原 语synchronized关
键 字 的 实 现 也 是 悲 观 锁 。

**乐 观 锁** ： 顾 名 思 义 ， 就 是 很 乐 观 ， 每 次 去 拿 数 据 的 时 候 都 认 为 别 人 不 会 修 改 ， 所
以 不 会 上 锁，但 是 在 更 新 的 时 候 会 判 断 一 下 在 此 期 间 别 人 有 没 有 去 更 新 这 个 数 据，
可 以 使 用 版 本 号 等 机 制 。 乐 观 锁 适 用 于 多 读 的 应 用 类 型 ， 这 样 可 以 提 高 吞 吐 量 ，
像 数 据 库 提 供 的 类 似 于write_condition机 制 ， 其 实 都 是 提 供 的 乐 观 锁 。 在Java
中java.util.concurrent.atomic包 下 面 的 原 子 变 量 类 就 是 使 用 了 乐 观 锁 的 一 种 实
现 方 式CAS实 现 的 。

**乐 观 锁 的 实 现 方 式** ：
1 、使 用 版 本 标 识 来 确 定 读 到 的 数 据 与 提 交 时 的 数 据 是 否 一 致。提 交 后 修 改 版 本 标
识 ， 不 一 致 时 可 以 采 取 丢 弃 和 再 次 尝 试 的 策 略 。
2 、java中 的CompareandSwap即CAS ， 当 多 个 线 程 尝 试 使 用CAS同 时 更 新
同 一 个 变 量 时 ， 只 有 其 中 一 个 线 程 能 更 新 变 量 的 值 ， 而 其 它 线 程 都 失 败 ， 失 败 的
线 程 并 不 会 被 挂 起 ， 而 是 被 告 知 这 次 竞 争 中 失 败 ， 并 可 以 再 次 尝 试 。 CAS 操 作
中 包 含 三 个 操 作 数 — — 需 要 读 写 的 内 存 位 置 （V） 、 进 行 比 较 的 预 期 原 值 （A）
和 拟 写 入 的 新 值(B)。如 果 内 存 位 置V的 值 与 预 期 原 值A相 匹 配，那 么 处 理 器 会 自
动 将 该 位 置 值 更 新 为 新 值B。 否 则 处 理 器 不 做 任 何 操 作 。

#### CAS缺 点 ：

#### 1 、 ABA问 题 ：

比 如 说 一 个 线 程one从 内 存 位 置V中 取 出A，这 时 候 另 一 个 线 程two也 从 内 存 中
取 出A，并 且two进 行 了 一 些 操 作 变 成 了B，然 后two又 将V位 置 的 数 据 变 成A，
这 时 候 线 程one进 行CAS操 作 发 现 内 存 中 仍 然 是A，然 后one操 作 成 功。尽 管 线
程one的CAS操 作 成 功，但 可 能 存 在 潜 藏 的 问 题。从Java1.5开 始JDK的atomic
包 里 提 供 了 一 个 类AtomicStampedReference来 解 决ABA问 题 。


#### 2 、 循 环 时 间 长 开 销 大 ：

#### 对 于 资 源 竞 争 严 重 （ 线 程 冲 突 严 重 ） 的 情 况 ，CAS自 旋 的 概 率 会 比 较 大 ， 从 而 浪

费 更 多 的CPU资 源 ， 效 率 低 于synchronized。
3 、 **只 能 保 证 一 个 共 享 变 量 的 原 子 操 作** ：
当 对 一 个 共 享 变 量 执 行 操 作 时 ， 我 们 可 以 使 用 循 环CAS的 方 式 来 保 证 原 子 操 作 ，
但 是 对 多 个 共 享 变 量 操 作 时 ， 循 环CAS就 无 法 保 证 操 作 的 原 子 性 ， 这 个 时 候 就 可
以 用 锁 。

## 36 、SynchronizedMap和ConcurrentHashMap有什么区别？..

SynchronizedMap一 次 锁 住 整 张 表 来 保 证 线 程 安 全，所 以 每 次 只 能 有 一 个 线 程 来
访 为map。

ConcurrentHashMap使 用 分 段 锁 来 保 证 在 多 线 程 下 的 性 能 。
ConcurrentHashMap中 则 是 一 次 锁 住 一 个 桶 。ConcurrentHashMap默 认将
hash表 分 为 16 个 桶 ， 诸 如get,put,remove等 常 用 操 作 只 锁 当 前 需 要 用 到 的 桶。
这 样，原 来 只 能 一 个 线 程 进 入，现 在 却 能 同 时 有 16 个 写 线 程 执 行，并 发 性 能 的 提
升 是 显 而 易 见 的 。
另 外ConcurrentHashMap使 用 了 一 种 不 同 的 迭 代 方 式 。 在 这 种 迭 代 方 式 中 ，当
iterator被 创 建 后 集 合 再 发 生 改 变 就 不 再 是 抛出
ConcurrentModificationException， 取 而 代 之 的 是 在 改 变 时new新 的 数 据 从 而
不 影 响 原 有 的 数 据 ，iterator完 成 后 再 将 头 指 针 替 换 为 新 的 数 据 ，这 样iterator
线 程 可 以 使 用 原 来 老 的 数 据 ， 而 写 线 程 也 可 以 并 发 的 完 成 改 变 。

## 37 、CopyOnWriteArrayList可以用于什么应用场景？...................


CopyOnWriteArrayList(免 锁 容 器)的 好 处 之 一 是 当 多 个 迭 代 器 同 时 遍 历 和 修 改 这
个 列 表 时 ， 不 会 抛 出ConcurrentModificationException。在
CopyOnWriteArrayList中，写 入 将 导 致 创 建 整 个 底 层 数 组 的 副 本，而 源 数 组 将 保
留 在 原 地 ， 使 得 复 制 的 数 组 在 被 修 改 时 ， 读 取 操 作 可 以 安 全 地 执 行 。

1 、由 于 写 操 作 的 时 候，需 要 拷 贝 数 组，会 消 耗 内 存，如 果 原 数 组 的 内 容 比 较 多 的
情 况 下 ， 可 能 导 致younggc或 者fullgc；
2 、不 能 用 于 实 时 读 的 场 景，像 拷 贝 数 组、新 增 元 素 都 需 要 时 间，所 以 调 用 一 个set
操 作 后，读 取 到 数 据 可 能 还 是 旧 的,虽 然CopyOnWriteArrayList 能 做 到 最 终 一 致
性,但 是 还 是 没 法 满 足 实 时 性 要 求 ；

**CopyOnWriteArrayList透 露 的 思 想**
1 、 读 写 分 离 ， 读 和 写 分 开
2 、 最 终 一 致 性
3 、 使 用 另 外 开 辟 空 间 的 思 路 ， 来 解 决 并 发 冲 突

## 38 、什么叫线程安全？servlet是线程安全吗?...................................

#### 线 程 安 全 是 编 程 中 的 术 语 ， 指 某 个 函 数 、 函 数 库 在 多 线 程 环 境 中 被 调 用 时 ， 能 够

#### 正 确 地 处 理 多 个 线 程 之 间 的 共 享 变 量 ， 使 程 序 功 能 正 确 完 成 。

Servlet不 是 线 程 安 全 的，servlet是 单 实 例 多 线 程 的，当 多 个 线 程 同 时 访 问 同 一 个
方 法 ， 是 不 能 保 证 共 享 变 量 的 线 程 安 全 性 的 。
Struts2的action是 多 实 例 多 线 程 的，是 线 程 安 全 的，每 个 请 求 过 来 都 会new一
个 新 的action分 配 给 这 个 请 求 ， 请 求 完 成 后 销 毁 。
SpringMVC的Controller是 线 程 安 全 的 吗 ？ 不 是 的，和Servlet类 似 的 处 理 流 程。

Struts2好 处 是 不 用 考 虑 线 程 安 全 问 题 ；Servlet和SpringMVC需 要 考 虑 线 程 安
全 问 题，但 是 性 能 可 以 提 升 不 用 处 理 太 多 的gc，可 以 使 用ThreadLocal来 处 理 多
线 程 的 问 题 。


## 39 、volatile有什么用？能否用一句话说明下volatile的应用场景？

volatile保 证 内 存 可 见 性 和 禁 止 指 令 重 排 。

volatile用 于 多 线 程 环 境 下 的 单 次 操 作(单 次 读 或 者 单 次 写)。

## 40 、为什么代码会重排序？...................................................................

#### 在 执 行 程 序 时 ， 为 了 提 供 性 能 ， 处 理 器 和 编 译 器 常 常 会 对 指 令 进 行 重 排 序 ， 但 是

#### 不 能 随 意 重 排 序 ， 不 是 你 想 怎 么 排 序 就 怎 么 排 序 ， 它 需 要 满 足 以 下 两 个 条 件 ：

#### 在 单 线 程 环 境 下 不 能 改 变 程 序 运 行 的 结 果 ；

#### 存 在 数 据 依 赖 关 系 的 不 允 许 重 排 序

#### 需 要 注 意 的 是 ： 重 排 序 不 会 影 响 单 线 程 环 境 的 执 行 结 果 ， 但 是 会 破 坏 多 线 程 的 执

#### 行 语 义 。

## 41 、在java中wait和sleep方法的不同？.......................................

最 大 的 不 同 是 在 等 待 时wait会 释 放 锁，而sleep一 直 持 有 锁。Wait通 常 被 用 于 线
程 间 交 互 ，sleep通 常 被 用 于 暂 停 执 行 。

直 接 了 解 的 深 入 一 点 吧 ：

**在Java中 线 程 的 状 态 一 共 被 分 成 6 种** ：


#### 初 始 态 ：NEW

创 建 一 个Thread对 象 ， 但 还 未 调 用start()启 动 线 程 时 ， 线 程 处 于 初 始 态 。

运 行 态 ：RUNNABLE
在Java中 ， 运 行 态 包 括 就 绪 态 和 运 行 态 。
就 绪 态 该 状 态 下 的 线 程 已 经 获 得 执 行 所 需 的 所 有 资 源 ， 只 要CPU分 配 执 行 权 就
能 运 行 。 所 有 就 绪 态 的 线 程 存 放 在 就 绪 队 列 中 。
运 行 态 获 得CPU执 行 权，正 在 执 行 的 线 程。由 于 一 个CPU同 一 时 刻 只 能 执 行 一
条 线 程 ， 因 此 每 个CPU每 个 时 刻 只 有 一 条 运 行 态 的 线 程 。

**阻 塞 态**

当 一 条 正 在 执 行 的 线 程 请 求 某 一 资 源 失 败 时，就 会 进 入 阻 塞 态。而 在Java中，阻
塞 态 专 指 请 求 锁 失 败 时 进 入 的 状 态 。 由 一 个 阻 塞 队 列 存 放 所 有 阻 塞 态 的 线 程 。 处
于 阻 塞 态 的 线 程 会 不 断 请 求 资 源，一 旦 请 求 成 功，就 会 进 入 就 绪 队 列，等 待 执 行。
PS： 锁 、IO、Socket等 都 资 源 。

**等 待 态**

当 前 线 程 中 调 用wait、join、park函 数 时 ， 当 前 线 程 就 会 进 入 等 待 态 。 也 有 一 个
等 待 队 列 存 放 所 有 等 待 态 的 线 程 。 线 程 处 于 等 待 态 表 示 它 需 要 等 待 其 他 线 程 的 指
示 才 能 继 续 运 行 。 进 入 等 待 态 的 线 程 会 释 放CPU执 行 权 ， 并 释 放 资 源 （ 如 ： 锁）

**超 时 等 待 态**

当 运 行 中 的 线 程 调 用sleep(time)、wait、join、parkNanos、parkUntil时 ， 就
会 进 入 该 状 态 ； 它 和 等 待 态 一 样 ， 并 不 是 因 为 请 求 不 到 资 源 ， 而 是 主 动 进 入 ， 并
且 进 入 后 需 要 其 他 线 程 唤 醒；进 入 该 状 态 后 释 放CPU执 行 权 和 占 有 的 资 源。与
等 待 态 的 区 别 ： 到 了 超 时 时 间 后 自 动 进 入 阻 塞 队 列 ， 开 始 竞 争 锁 。


#### 终 止 态

#### 线 程 执 行 结 束 后 的 状 态 。

#### 注 意 ：

wait()方 法 会 释 放CPU执 行 权 和 占 有 的 锁 。
sleep(long)方 法 仅 释 放CPU使 用 权，锁 仍 然 占 用；线 程 被 放 入 超 时 等 待 队 列，与
yield相 比 ， 它 会 使 线 程 较 长 时 间 得 不 到 运 行 。
yield()方 法 仅 释 放CPU执 行 权 ， 锁 仍 然 占 用 ， 线 程 会 被 放 入 就 绪 队 列 ， 会 在 短 时
间 内 再 次 执 行 。
wait和notify必 须 配 套 使 用 ， 即 必 须 使 用 同 一 把 锁 调 用 ；
wait和notify必 须 放 在 一 个 同 步 块 中 调 用wait和notify的 对 象 必 须 是 他 们 所 处
同 步 块 的 锁 对 象 。

## 42 、用Java实现阻塞队列.....................................................................

参 考java中 的 阻 塞 队 列 的 内 容 吧 ， 直 接 实 现 有 点 烦 ：
[http://www](http://www) .infoq.com/cn/articles/java-blocking-queue

## 43 、一个线程运行时发生异常会怎样？...............................................

如 果 异 常 没 有 被 捕 获 该 线 程 将 会 停 止 执 行。Thread.UncaughtExceptionHandler
是 用 于 处 理 未 捕 获 异 常 造 成 线 程 突 然 中 断 情 况 的 一 个 内 嵌 接 口 。 当 一 个 未 捕 获 异
常 将 造 成 线 程 中 断 的 时候JVM会 使用Thread.getUncaughtExceptionHandler()
来 查 询 线 程 的UncaughtExceptionHandler并 将 线 程 和 异 常 作 为 参 数 传 递给
handler的uncaughtException()方 法 进 行 处 理 。


## 44 、如何在两个线程间共享数据？.......................................................

#### 在 两 个 线 程 间 共 享 变 量 即 可 实 现 共 享 。

#### 一 般 来 说 ， 共 享 变 量 要 求 变 量 本 身 是 线 程 安 全 的 ， 然 后 在 线 程 内 使 用 的 时 候 ， 如

#### 果 有 对 共 享 变 量 的 复 合 操 作 ， 那 么 也 得 保 证 复 合 操 作 的 线 程 安 全 性 。

## 45 、Java中notify 和 notifyAll有什么区别？.................................

notify() 方 法 不 能 唤 醒 某 个 具 体 的 线 程 ， 所 以 只 有 一 个 线 程 在 等 待 的 时 候 它 才 有
用 武 之 地 。 而notifyAll()唤 醒 所 有 线 程 并 允 许 他 们 争 夺 锁 确 保 了 至 少 有 一 个 线 程
能 继 续 运 行 。

## 46 、为什么wait,notify 和 notifyAll这些方法不在thread类里面？

#### 一 个 很 明 显 的 原 因 是JAVA提 供 的 锁 是 对 象 级 的 而 不 是 线 程 级 的 ， 每 个 对 象 都 有

锁，通 过 线 程 获 得。由 于wait，notify和notifyAll都 是 锁 级 别 的 操 作，所 以 把 他
们 定 义 在Object类 中 因 为 锁 属 于 对 象 。

## 47 、什么是ThreadLocal变量？..........................................................

ThreadLocal是Java里 一 种 特 殊 的 变 量。每 个 线 程 都 有 一 个ThreadLocal就 是 每
个 线 程 都 拥 有 了 自 己 独 立 的 一 个 变 量 ， 竞 争 条 件 被 彻 底 消 除 了 。 它 是 为 创 建 代 价
高 昂 的 对 象 获 取 线 程 安 全 的 好 方 法 ， 比 如 你 可 以 用ThreadLocal让
SimpleDateFormat变 成 线 程 安 全 的 ， 因 为 那 个 类 创 建 代 价 高 昂 且 每 次 调 用 都 需
要 创 建 不 同 的 实 例 所 以 不 值 得 在 局 部 范 围 使 用 它 ， 如 果 为 每 个 线 程 提 供 一 个 自 己


#### 独 有 的 变 量 拷 贝 ， 将 大 大 提 高 效 率 。 首 先 ， 通 过 复 用 减 少 了 代 价 高 昂 的 对 象 的 创

#### 建 个 数。其 次，你 在 没 有 使 用 高 代 价 的 同 步 或 者 不 变 性 的 情 况 下 获 得 了 线 程 安 全。

## 48 、Java中interrupted 和 isInterrupted方法的区别？.............

**interrupt**

interrupt方 法 用 于 中 断 线 程。调 用 该 方 法 的 线 程 的 状 态 为 将 被 置 为”中 断”状 态。
注 意 ： 线 程 中 断 仅 仅 是 置 线 程 的 中 断 状 态 位 ， 不 会 停 止 线 程 。 需 要 用 户 自 己 去 监
视 线 程 的 状 态 为 并 做 处 理 。 支 持 线 程 中 断 的 方 法 （ 也 就 是 线 程 中 断 后 会 抛出
interruptedException的 方 法 ） 就 是 在 监 视 线 程 的 中 断 状 态 ， 一 旦 线 程 的 中 断 状
态 被 置 为“中 断 状 态”， 就 会 抛 出 中 断 异 常 。

**interrupted**

#### 查 询 当 前 线 程 的 中 断 状 态 ， 并 且 清 除 原 状 态 。 如 果 一 个 线 程 被 中 断 了 ， 第 一 次 调

用interrupted则 返 回true， 第 二 次 和 后 面 的 就 返 回false了 。

**isInterrupted**

仅 仅 是 查 询 当 前 线 程 的 中 断 状 态

## 49 、为什么wait和notify方法要在同步块中调用？........................

JavaAPI强 制 要 求 这 样 做 ， 如 果 你 不 这 么 做 ， 你 的 代 码 会 抛出
IllegalMonitorStateException异 常 。 还 有 一 个 原 因 是 为 了 避 免wait和notify
之 间 产 生 竞 态 条 件 。


## 50 、为什么你应该在循环中检查等待条件?.........................................

#### 处 于 等 待 状 态 的 线 程 可 能 会 收 到 错 误 警 报 和 伪 唤 醒 ， 如 果 不 在 循 环 中 检 查 等 待 条

#### 件 ， 程 序 就 会 在 没 有 满 足 结 束 条 件 的 情 况 下 退 出 。

## 51 、Java中的同步集合与并发集合有什么区别？..............................

#### 同 步 集 合 与 并 发 集 合 都 为 多 线 程 和 并 发 提 供 了 合 适 的 线 程 安 全 的 集 合 ， 不 过 并 发

集 合 的 可 扩 展 性 更 高。在Java1.5之 前 程 序 员 们 只 有 同 步 集 合 来 用 且 在 多 线 程 并 发
的 时 候 会 导 致 争 用 ， 阻 碍 了 系 统 的 扩 展 性 。Java5介 绍 了 并 发 集 合像
ConcurrentHashMap，不 仅 提 供 线 程 安 全 还 用 锁 分 离 和 内 部 分 区 等 现 代 技 术 提 高
了 可 扩 展 性 。

## 52 、什么是线程池？ 为什么要使用它？.............................................

#### 创 建 线 程 要 花 费 昂 贵 的 资 源 和 时 间 ， 如 果 任 务 来 了 才 创 建 线 程 那 么 响 应 时 间 会 变

#### 长 ， 而 且 一 个 进 程 能 创 建 的 线 程 数 有 限 。 为 了 避 免 这 些 问 题 ， 在 程 序 启 动 的 时 候

#### 就 创 建 若 干 线 程 来 响 应 处 理 ， 它 们 被 称 为 线 程 池 ， 里 面 的 线 程 叫 工 作 线 程 。从

JDK1.5开 始 ，JavaAPI提 供 了Executor框 架 让 你 可 以 创 建 不 同 的 线 程 池 。

## 53 、怎么检测一个线程是否拥有锁？...................................................

在java.lang.Thread中 有 一 个 方 法 叫holdsLock()，它 返 回true如 果 当 且 仅 当 当
前 线 程 拥 有 某 个 具 体 对 象 的 锁 。

## 54 、你如何在Java中获取线程堆栈？.................................................


kill-3[javapid]
不 会 在 当 前 终 端 输 出 ， 它 会 输 出 到 代 码 执 行 的 或 指 定 的 地 方 去 。 比 如 ，kill-3
tomcatpid, 输 出 堆 栈 到log目 录 下 。
Jstack[javapid]
这 个 比 较 简 单 ， 在 当 前 终 端 显 示 ， 也 可 以 重 定 向 到 指 定 文 件 中 。
-JvisualVM：ThreadDump
不 做 说 明 ， 打 开JvisualVM后 ， 都 是 界 面 操 作 ， 过 程 还 是 很 简 单 的 。
55 、JVM中 哪 个 参 数 是 用 来 控 制 线 程 的 栈 堆 栈 小 的?
-Xss 每 个 线 程 的 栈 大 小

## 56 、Thread类中的yield方法有什么作用？.....................................

#### 使 当 前 线 程 从 执 行 状 态 （ 运 行 状 态 ） 变 为 可 执 行 态 （ 就 绪 状 态 ） 。

#### 当 前 线 程 到 了 就 绪 状 态 ， 那 么 接 下 来 哪 个 线 程 会 从 就 绪 状 态 变 成 执 行 状 态 呢 ？ 可

#### 能 是 当 前 线 程 ， 也 可 能 是 其 他 线 程 ， 看 系 统 的 分 配 了 。

## 57 、Java中ConcurrentHashMap的并发度是什么？....................

ConcurrentHashMap把 实际map划 分 成 若 干 部 分 来 实 现 它 的 可 扩 展 性 和 线 程 安
全 。 这 种 划 分 是 使 用 并 发 度 获 得 的 ， 它 是ConcurrentHashMap类 构 造 函 数 的 一
个 可 选 参 数 ， 默 认 值 为 16 ， 这 样 在 多 线 程 情 况 下 就 能 避 免 争 用 。

在JDK8后 ， 它 摒 弃 了Segment（ 锁 段 ） 的 概 念 ， 而 是 启 用 了 一 种 全 新 的 方 式 实
现,利 用CAS算 法。同 时 加 入 了 更 多 的 辅 助 变 量 来 提 高 并 发 度，具 体 内 容 还 是 查 看
源 码 吧 。


## 58 、Java中Semaphore是什么？......................................................

Java中 的Semaphore是 一 种 新 的 同 步 类 ， 它 是 一 个 计 数 信 号 。 从 概 念 上 讲 ， 从
概 念 上 讲 ， 信 号 量 维 护 了 一 个 许 可 集 合 。 如 有 必 要 ， 在 许 可 可 用 前 会 阻 塞 每 一 个
acquire()，然 后 再 获 取 该 许 可。每 个 release()添 加 一 个 许 可，从 而 可 能 释 放 一 个
正 在 阻 塞 的 获 取 者。但 是，不 使 用 实 际 的 许 可 对 象，Semaphore只 对 可 用 许 可 的
号 码 进 行 计 数 ， 并 采 取 相 应 的 行 动 。 信 号 量 常 常 用 于 多 线 程 的 代 码 中 ， 比 如 数 据
库 连 接 池 。

## 59 、Java线程池中submit() 和 execute()方法有什么区别？.......

两 个 方 法 都 可 以 向 线 程 池 提 交 任 务，execute()方 法 的 返 回 类 型 是void，它 定 义在
Executor接 口 中 。

而submit()方 法 可 以 返 回 持 有 计 算 结 果 的Future对 象 ， 它 定 义在
ExecutorService接 口 中 ， 它 扩 展 了Executor接 口 ， 其 它 线 程 池 类像
ThreadPoolExecutor和ScheduledThreadPoolExecutor都 有 这 些 方 法 。

## 60 、什么是阻塞式方法？.......................................................................

阻 塞 式 方 法 是 指 程 序 会 一 直 等 待 该 方 法 完 成 期 间 不 做 其 他 事 情 ，ServerSocket的
accept()方 法 就 是 一 直 等 待 客 户 端 连 接。这 里 的 阻 塞 是 指 调 用 结 果 返 回 之 前，当 前
线 程 会 被 挂 起 ， 直 到 得 到 结 果 之 后 才 会 返 回 。 此 外 ， 还 有 异 步 和 非 阻 塞 式 方 法 在
任 务 完 成 前 就 返 回 。

## 61 、Java中的ReadWriteLock是什么？...........................................


#### 读 写 锁 是 用 来 提 升 并 发 程 序 性 能 的 锁 分 离 技 术 的 成 果 。

## 62 、volatile 变量和 atomic 变量有什么不同？..............................

Volatile变 量 可 以 确 保 先 行 关 系，即 写 操 作 会 发 生 在 后 续 的 读 操 作 之 前, 但 它 并 不
能 保 证 原 子 性。例 如 用volatile修 饰count变 量 那 么 count++ 操 作 就 不 是 原 子
性 的 。

而AtomicInteger类 提 供 的atomic方 法 可 以 让 这 种 操 作 具 有 原 子 性如
getAndIncrement()方 法 会 原 子 性 的 进 行 增 量 操 作 把 当 前 值 加 一 ， 其 它 数 据 类 型
和 引 用 变 量 也 可 以 进 行 相 似 操 作 。

### 63 、可以直接调用Thread类的run()方法么？................................

当 然 可 以 。 但 是 如 果 我 们 调 用 了Thread的run()方 法 ， 它 的 行 为 就 会 和 普 通 的 方
法 一 样 ， 会 在 当 前 线 程 中 执 行 。 为 了 在 新 的 线 程 中 执 行 我 们 的 代 码 ， 必 须 使用
Thread.start()方 法 。

### 64 、如何让正在运行的线程暂停一段时间？.......................................

我 们 可 以 使 用Thread类 的Sleep()方 法 让 线 程 暂 停 一 段 时 间 。 需 要 注 意 的 是 ， 这
并 不 会 让 线 程 终 止，一 旦 从 休 眠 中 唤 醒 线 程，线 程 的 状 态 将 会 被 改 变 为Runnable，
并 且 根 据 线 程 调 度 ， 它 将 得 到 执 行 。

### 65 、你对线程优先级的理解是什么？...................................................


#### 每 一 个 线 程 都 是 有 优 先 级 的，一 般 来 说，高 优 先 级 的 线 程 在 运 行 时 会 具 有 优 先 权，

但 这 依 赖 于 线 程 调 度 的 实 现 ， 这 个 实 现 是 和 操 作 系 统 相 关 的(OSdependent)。 我
们 可 以 定 义 线 程 的 优 先 级 ， 但 是 这 并 不 能 保 证 高 优 先 级 的 线 程 会 在 低 优 先 级 的 线
程 前 执 行 。 线 程 优 先 级 是 一 个int变 量(从1-10)， 1 代 表 最 低 优 先 级 ， 10 代 表 最
高 优 先 级 。

java的 线 程 优 先 级 调 度 会 委 托 给 操 作 系 统 去 处 理 ， 所 以 与 具 体 的 操 作 系 统 优 先 级
有 关 ， 如 非 特 别 需 要 ， 一 般 无 需 设 置 线 程 优 先 级 。

### 66 、什么是线程调度器(ThreadScheduler)和时间分片(Time

### Slicing)？

线 程 调 度 器 是 一 个 操 作 系 统 服 务，它 负 责 为Runnable状 态 的 线 程 分 配CPU时 间。
一 旦 我 们 创 建 一 个 线 程 并 启 动 它 ， 它 的 执 行 便 依 赖 于 线 程 调 度 器 的 实 现 。
同 上 一 个 问 题，线 程 调 度 并 不 受 到Java虚 拟 机 控 制，所 以 由 应 用 程 序 来 控 制 它 是
更 好 的 选 择 （ 也 就 是 说 不 要 让 你 的 程 序 依 赖 于 线 程 的 优 先 级 ） 。

时 间 分 片 是 指 将 可 用 的CPU时 间 分 配 给 可 用 的Runnable线 程 的 过 程。分 配CPU
时 间 可 以 基 于 线 程 优 先 级 或 者 线 程 等 待 的 时 间 。

### 67 、你如何确保main()方法所在的线程是Java 程序最后结束的线程？

我 们 可 以 使用Thread类的join()方 法 来 确 保 所 有 程 序 创 建 的 线 程在main()方 法 退
出 前 结 束 。


### 68 、线程之间是如何通信的？...............................................................

当 线 程 间 是 可 以 共 享 资 源 时 ， 线 程 间 通 信 是 协 调 它 们 的 重 要 的 手 段 。Object类中
wait()\notify()\notifyAll()方 法 可 以 用 于 线 程 间 通 信 关 于 资 源 的 锁 的 状 态 。

### 69 、为什么线程通信的方法wait(),notify()和notifyAll()被定

### 义在Object 类里？

Java的 每 个 对 象 中 都 有 一 个 锁(monitor，也 可 以 成 为 监 视 器) 并 且wait()，notify()
等 方 法 用 于 等 待 对 象 的 锁 或 者 通 知 其 他 线 程 对 象 的 监 视 器 可 用。在Java的 线 程 中
并 没 有 可 供 任 何 对 象 使 用 的 锁 和 同 步 器。这 就 是 为 什 么 这 些 方 法 是Object类 的 一
部 分 ， 这 样Java的 每 一 个 类 都 有 用 于 线 程 间 通 信 的 基 本 方 法 。

### 70 、为什么wait(),notify()和notifyAll()必须在同步方法或

### 者同步块中被调用？

当 一 个 线 程 需 要 调 用 对 象 的wait()方 法 的 时 候，这 个 线 程 必 须 拥 有 该 对 象 的 锁，接
着 它 就 会 释 放 这 个 对 象 锁 并 进 入 等 待 状 态 直 到 其 他 线 程 调 用 这 个 对 象 上 的notify()
方 法。同 样 的，当 一 个 线 程 需 要 调 用 对 象 的notify()方 法 时，它 会 释 放 这 个 对 象 的
锁 ， 以 便 其 他 在 等 待 的 线 程 就 可 以 得 到 这 个 对 象 锁 。 由 于 所 有 的 这 些 方 法 都 需 要
线 程 持 有 对 象 的 锁 ， 这 样 就 只 能 通 过 同 步 来 实 现 ， 所 以 他 们 只 能 在 同 步 方 法 或 者
同 步 块 中 被 调 用 。

### 71 、为什么Thread类的sleep()和yield()方法是静态的？............


Thread类 的sleep()和yield()方 法 将 在 当 前 正 在 执 行 的 线 程 上 运 行 。 所 以 在 其 他
处 于 等 待 状 态 的 线 程 上 调 用 这 些 方 法 是 没 有 意 义 的 。 这 就 是 为 什 么 这 些 方 法 是 静
态 的 。 它 们 可 以 在 当 前 正 在 执 行 的 线 程 中 工 作 ， 并 避 免 程 序 员 错 误 的 认 为 可 以 在
其 他 非 运 行 线 程 调 用 这 些 方 法 。

### 72 、如何确保线程安全？.......................................................................

在Java中 可 以 有 很 多 方 法 来 保 证 线 程 安 全— —同 步 ， 使 用 原 子 类(atomic
concurrentclasses)， 实 现 并 发 锁 ， 使 用volatile关 键 字 ， 使 用 不 变 类 和 线 程 安
全 类 。

### 73 、同步方法和同步块，哪个是更好的选择？...................................

#### 同 步 块 是 更 好 的 选 择 ， 因 为 它 不 会 锁 住 整 个 对 象 （ 当 然 你 也 可 以 让 它 锁 住 整 个 对

#### 象 ） 。 同 步 方 法 会 锁 住 整 个 对 象 ， 哪 怕 这 个 类 中 有 多 个 不 相 关 联 的 同 步 块 ， 这 通

#### 常 会 导 致 他 们 停 止 执 行 并 需 要 等 待 获 得 这 个 对 象 上 的 锁 。

#### 同 步 块 更 要 符 合 开 放 调 用 的 原 则 ， 只 在 需 要 锁 住 的 代 码 块 锁 住 相 应 的 对 象 ， 这 样

#### 从 侧 面 来 说 也 可 以 避 免 死 锁 。

### 74 、如何创建守护线程？.......................................................................

使 用Thread类 的setDaemon(true)方 法 可 以 将 线 程 设 置 为 守 护 线 程 ， 需 要 注 意
的 是 ， 需 要 在 调 用start()方 法 前 调 用 这 个 方 法 ， 否 则 会 抛出
IllegalThreadStateException异 常 。


### 75 、什么是JavaTimer 类？如何创建一个有特定时间间隔的任务？

java.util.Timer是 一 个 工 具 类 ， 可 以 用 于 安 排 一 个 线 程 在 未 来 的 某 个 特 定 时 间 执
行 。Timer类 可 以 用 安 排 一 次 性 任 务 或 者 周 期 任 务 。
java.util.TimerTask是 一 个 实 现 了Runnable接 口 的 抽 象 类 ， 我 们 需 要 去 继 承 这
个 类 来 创 建 我 们 自 己 的 定 时 任 务 并 使 用Timer去 安 排 它 的 执 行 。

## Java 并发编程（二）.............................................................................................

### 1 、并发编程三要素？.............................................................................

#### 1 、 原 子 性

#### 原 子 性 指 的 是 一 个 或 者 多 个 操 作 ， 要 么 全 部 执 行 并 且 在 执 行 的 过 程 中 不 被 其 他 操

#### 作 打 断 ， 要 么 就 全 部 都 不 执 行 。

#### 2 、 可 见 性

#### 可 见 性 指 多 个 线 程 操 作 一 个 共 享 变 量 时 ， 其 中 一 个 线 程 对 变 量 进 行 修 改 后 ， 其 他

#### 线 程 可 以 立 即 看 到 修 改 的 结 果 。

#### 3 、 有 序 性

#### 有 序 性 ， 即 程 序 的 执 行 顺 序 按 照 代 码 的 先 后 顺 序 来 执 行 。

### 2 、实现可见性的方法有哪些？.............................................................

synchronized或 者Lock：保 证 同 一 个 时 刻 只 有 一 个 线 程 获 取 锁 执 行 代 码，锁 释 放
之 前 把 最 新 的 值 刷 新 到 主 内 存 ， 实 现 可 见 性 。


### 3 、多线程的价值？.................................................................................

#### 1 、 发 挥 多 核CPU的 优 势

#### 多 线 程，可 以 真 正 发 挥 出 多 核CPU的 优 势 来，达 到 充 分 利 用CPU的 目 的，采 用 多

#### 线 程 的 方 式 去 同 时 完 成 几 件 事 情 而 不 互 相 干 扰 。

#### 2 、 防 止 阻 塞

#### 从 程 序 运 行 效 率 的 角 度 来 看，单 核CPU不 但 不 会 发 挥 出 多 线 程 的 优 势，反 而 会 因

#### 为 在 单 核CPU上 运 行 多 线 程 导 致 线 程 上 下 文 的 切 换，而 降 低 程 序 整 体 的 效 率。但

#### 是 单 核CPU我 们 还 是 要 应 用 多 线 程，就 是 为 了 防 止 阻 塞。试 想，如 果 单 核CPU使

#### 用 单 线 程 ， 那 么 只 要 这 个 线 程 阻 塞 了 ， 比 方 说 远 程 读 取 某 个 数 据 吧 ， 对 端 迟 迟 未

#### 返 回 又 没 有 设 置 超 时 时 间，那 么 你 的 整 个 程 序 在 数 据 返 回 回 来 之 前 就 停 止 运 行 了。

#### 多 线 程 可 以 防 止 这 个 问 题 ， 多 条 线 程 同 时 运 行 ， 哪 怕 一 条 线 程 的 代 码 执 行 读 取 数

#### 据 阻 塞 ， 也 不 会 影 响 其 它 任 务 的 执 行 。

#### 3 、 便 于 建 模

#### 这 是 另 外 一 个 没 有 这 么 明 显 的 优 点 了。假 设 有 一 个 大 的 任 务A，单 线 程 编 程，那 么

#### 就 要 考 虑 很 多 ， 建 立 整 个 程 序 模 型 比 较 麻 烦 。 但 是 如 果 把 这 个 大 的 任 务A分 解 成

#### 几 个 小 任 务，任 务B、任 务C、任 务D，分 别 建 立 程 序 模 型，并 通 过 多 线 程 分 别 运

#### 行 这 几 个 任 务 ， 那 就 简 单 很 多 了 。

### 4 、创建线程的有哪些方式？.................................................................

1 、 继 承Thread类 创 建 线 程 类
2 、 通 过Runnable接 口 创 建 线 程 类
3 、 通 过Callable和Future创 建 线 程
4 、 通 过 线 程 池 创 建

### 5 、创建线程的三种方式的对比？.........................................................


**1 、 采 用 实 现Runnable、Callable接 口 的 方 式 创 建 多 线 程 。
优 势 是 ：**
线 程 类 只 是 实 现 了Runnable接 口 或Callable接 口 ， 还 可 以 继 承 其 他 类 。
在 这 种 方 式 下 ， 多 个 线 程 可 以 共 享 同 一 个target对 象 ， 所 以 非 常 适 合 多 个 相 同 线
程 来 处 理 同 一 份 资 源 的 情 况 ， 从 而 可 以 将CPU、 代 码 和 数 据 分 开 ， 形 成 清 晰 的 模
型 ， 较 好 地 体 现 了 面 向 对 象 的 思 想 。
**劣 势 是 ：**
编 程 稍 微 复 杂，如 果 要 访 问 当 前 线 程，则 必 须 使 用Thread.currentThread()方 法。
**2 、 使 用 继 承Thread类 的 方 式 创 建 多 线 程
优 势 是 ：**
编 写 简 单 ， 如 果 需 要 访 问 当 前 线 程 ， 则 无 需 使 用Thread.currentThread()方 法 ，
直 接 使 用this即 可 获 得 当 前 线 程 。
**劣 势 是 ：**
线 程 类 已 经 继 承 了Thread类 ， 所 以 不 能 再 继 承 其 他 父 类 。
**3 、Runnable和Callable的 区 别**
1 、Callable规 定（重 写）的 方 法 是call()，Runnable规 定（重 写）的 方 法 是run()。
2 、Callable的 任 务 执 行 后 可 返 回 值 ， 而Runnable的 任 务 是 不 能 返 回 值 的 。
3 、Call方 法 可 以 抛 出 异 常 ，run方 法 不 可 以 。
4 、 运 行Callable任 务 可 以 拿 到 一 个Future对 象 ， 表 示 异 步 计 算 的 结 果 。 它 提 供
了 检 查 计 算 是 否 完 成 的 方 法，以 等 待 计 算 的 完 成，并 检 索 计 算 的 结 果。通 过Future
对 象 可 以 了 解 任 务 执 行 情 况 ， 可 取 消 任 务 的 执 行 ， 还 可 获 取 执 行 结 果 。

### 6 、线程的状态流转图.............................................................................

#### 线 程 的 生 命 周 期 及 五 种 基 本 状 态 ：

![img_2.png][img_2.png]

### 7 、Java线程具有五中基本状态............................................................


**1 、新 建 状 态（New）** ：当 线 程 对 象 对 创 建 后，即 进 入 了 新 建 状 态，如：Threadt
=newMyThread()；
**2 、 就 绪 状 态 （Runnable）** ： 当 调 用 线 程 对 象 的start()方 法 （t.start();） ， 线 程
即 进 入 就 绪 状 态 。 处 于 就 绪 状 态 的 线 程 ， 只 是 说 明 此 线 程 已 经 做 好 了 准 备 ， 随 时
等 待CPU调 度 执 行 ， 并 不 是 说 执 行 了t.start()此 线 程 立 即 就 会 执 行 ；
**3 、 运 行 状 态 （Running）** ： 当CPU开 始 调 度 处 于 就 绪 状 态 的 线 程 时 ， 此 时 线 程
才 得 以 真 正 执 行，即 进 入 到 运 行 状 态。注：就 绪 状 态 是 进 入 到 运 行 状 态 的 唯 一 入
口 ， 也 就 是 说 ， 线 程 要 想 进 入 运 行 状 态 执 行 ， 首 先 必 须 处 于 就 绪 状 态 中 ；
**4 、阻 塞 状 态（Blocked）** ：处 于 运 行 状 态 中 的 线 程 由 于 某 种 原 因，暂 时 放 弃 对CPU
的 使 用 权，停 止 执 行，此 时 进 入 阻 塞 状 态，直 到 其 进 入 到 就 绪 状 态，才 有 机 会 再
次 被CPU调 用 以 进 入 到 运 行 状 态 。
**根 据 阻 塞 产 生 的 原 因 不 同 ， 阻 塞 状 态 又 可 以 分 为 三 种 ：**
1 、等 待 阻 塞：运 行 状 态 中 的 线 程 执 行wait()方 法，使 本 线 程 进 入 到 等 待 阻 塞 状 态；
2 、同 步 阻 塞：线 程 在 获 取synchronized同 步 锁 失 败(因 为 锁 被 其 它 线 程 所 占 用)，
它 会 进 入 同 步 阻 塞 状 态 ；
3 、其 他 阻 塞：通 过 调 用 线 程 的sleep()或join()或 发 出 了I/O请 求 时，线 程 会 进 入
到 阻 塞 状 态 。 当sleep()状 态 超 时 、join()等 待 线 程 终 止 或 者 超 时 、 或 者I/O处 理
完 毕 时 ， 线 程 重 新 转 入 就 绪 状 态 。
**5 、死 亡 状 态（Dead）** ：线 程 执 行 完 了 或 者 因 异 常 退 出 了run()方 法，该 线 程 结 束
生 命 周 期 。

### 8 、什么是线程池？有哪几种创建方式？.............................................

#### 线 程 池 就 是 提 前 创 建 若 干 个 线 程 ， 如 果 有 任 务 需 要 处 理 ， 线 程 池 里 的 线 程 就 会 处

#### 理 任 务 ， 处 理 完 之 后 线 程 并 不 会 被 销 毁 ， 而 是 等 待 下 一 个 任 务 。 由 于 创 建 和 销 毁

#### 线 程 都 是 消 耗 系 统 资 源 的 ， 所 以 当 你 想 要 频 繁 的 创 建 和 销 毁 线 程 的 时 候 就 可 以 考

#### 虑 使 用 线 程 池 来 提 升 系 统 的 性 能 。

java 提 供 了 一 个 java.util.concurrent.Executor接 口 的 实 现 用 于 创 建 线 程 池 。


### 9 、四种线程池的创建：.........................................................................

1 、newCachedThreadPool创 建 一 个 可 缓 存 线 程 池
2 、newFixedThreadPool 创 建 一 个 定 长 线 程 池 ， 可 控 制 线 程 最 大 并 发 数 。
3 、newScheduledThreadPool 创 建 一 个 定 长 线 程 池 ， 支 持 定 时 及 周 期 性 任 务 执
行 。
4 、newSingleThreadExecutor 创 建 一 个 单 线 程 化 的 线 程 池 ， 它 只 会 用 唯 一 的 工
作 线 程 来 执 行 任 务 。

### 10 、线程池的优点？...............................................................................

#### 1 、 重 用 存 在 的 线 程 ， 减 少 对 象 创 建 销 毁 的 开 销 。

#### 2 、可 有 效 的 控 制 最 大 并 发 线 程 数，提 高 系 统 资 源 的 使 用 率，同 时 避 免 过 多 资 源 竞

#### 争 ， 避 免 堵 塞 。

#### 3 、 提 供 定 时 执 行 、 定 期 执 行 、 单 线 程 、 并 发 数 控 制 等 功 能 。

### 11 、常用的并发工具类有哪些？...........................................................

1 、CountDownLatch
2 、CyclicBarrier
3 、Semaphore
4 、Exchanger

### 12 、CyclicBarrier和CountDownLatch的区别...............................

1 、CountDownLatch简 单 的 说 就 是 一 个 线 程 等 待，直 到 他 所 等 待 的 其 他 线 程 都 执
行 完 成 并 且 调 用countDown()方 法 发 出 通 知 后 ， 当 前 线 程 才 可 以 继 续 执 行 。


2 、cyclicBarrier是 所 有 线 程 都 进 行 等 待 ， 直 到 所 有 线 程 都 准 备 好 进 入await()方
法 之 后 ， 所 有 线 程 同 时 开 始 执 行 ！
3 、CountDownLatch的 计 数 器 只 能 使 用 一 次 。 而CyclicBarrier的 计 数 器 可 以 使
用reset() 方 法 重 置 。 所 以CyclicBarrier能 处 理 更 为 复 杂 的 业 务 场 景 ， 比 如 如 果
计 算 发 生 错 误 ， 可 以 重 置 计 数 器 ， 并 让 线 程 们 重 新 执 行 一 次 。
4 、CyclicBarrier还 提 供 其 他 有 用 的 方 法 ， 比 如getNumberWaiting方 法 可 以 获
得CyclicBarrier阻 塞 的 线 程 数 量。isBroken方 法 用 来 知 道 阻 塞 的 线 程 是 否 被 中 断。
如 果 被 中 断 返 回true， 否 则 返 回false。

### 13 、synchronized的作用？.................................................................

在Java中 ，synchronized关 键 字 是 用 来 控 制 线 程 同 步 的 ， 就 是 在 多 线 程 的 环 境
下 ， 控 制synchronized代 码 段 不 被 多 个 线 程 同 时 执 行 。
synchronized既 可 以 加 在 一 段 代 码 上 ， 也 可 以 加 在 方 法 上 。

## 14 、volatile关键字的作用....................................................................

对 于 可 见 性 ，Java提 供 了volatile关 键 字 来 保 证 可 见 性 。
当 一 个 共 享 变 量 被volatile修 饰 时 ， 它 会 保 证 修 改 的 值 会 立 即 被 更 新 到 主 存 ， 当
有 其 他 线 程 需 要 读 取 时 ， 它 会 去 内 存 中 读 取 新 值 。
从 实 践 角 度 而 言 ，volatile的 一 个 重 要 作 用 就 是 和CAS结 合 ， 保 证 了 原 子 性 ， 详
细 的 可 以 参 见java.util.concurrent.atomic包 下 的 类 ， 比 如AtomicInteger。

## 15 、什么是CAS......................................................................................

CAS是compareandswap的 缩 写 ， 即 我 们 所 说 的 比 较 交 换 。
cas是 一 种 基 于 锁 的 操 作 ， 而 且 是 乐 观 锁 。 在java中 锁 分 为 乐 观 锁 和 悲 观 锁 。 悲
观 锁 是 将 资 源 锁 住 ， 等 一 个 之 前 获 得 锁 的 线 程 释 放 锁 之 后 ， 下 一 个 线 程 才 可 以 访


#### 问 。 而 乐 观 锁 采 取 了 一 种 宽 泛 的 态 度 ， 通 过 某 种 方 式 不 加 锁 来 处 理 资 源 ， 比 如 通

过 给 记 录 加version来 获 取 数 据 ， 性 能 较 悲 观 锁 有 很 大 的 提 高 。
CAS 操 作 包 含 三 个 操 作 数 — — 内 存 位 置 （V） 、 预 期 原 值 （A） 和 新 值(B)。 如
果 内 存 地 址 里 面 的 值 和A的 值 是 一 样 的 ， 那 么 就 将 内 存 里 面 的 值 更 新 成B。CAS
是 通 过 无 限 循 环 来 获 取 数 据 的，若 果 在 第 一 轮 循 环 中，a线 程 获 取 地 址 里 面 的 值被
b线 程 修 改 了 ， 那 么a线 程 需 要 自 旋 ， 到 下 次 循 环 才 有 可 能 机 会 执 行 。
java.util.concurrent.atomic 包 下 的 类 大 多 是 使 用CAS操 作 来 实 现 的
(AtomicInteger,AtomicBoolean,AtomicLong)。

## 16 、CAS的问题......................................................................................

#### 1 、CAS容 易 造 成ABA问 题

一 个 线 程a将 数 值 改 成 了b， 接 着 又 改 成 了a， 此 时CAS认 为 是 没 有 变 化 ， 其 实
是 已 经 变 化 过 了 ， 而 这 个 问 题 的 解 决 方 案 可 以 使 用 版 本 号 标 识 ， 每 操 作 一次
version加 1 。在java5中，已 经 提 供 了AtomicStampedReference来 解 决 问 题。
**2 、 不 能 保 证 代 码 块 的 原 子 性**
CAS机 制 所 保 证 的 知 识 一 个 变 量 的 原 子 性 操 作，而 不 能 保 证 整 个 代 码 块 的 原 子 性。
比 如 需 要 保 证 3 个 变 量 共 同 进 行 原 子 性 的 更 新 ， 就 不 得 不 使 用synchronized了。
**3 、CAS造 成CPU利 用 率 增 加**
之 前 说 过 了CAS里 面 是 一 个 循 环 判 断 的 过 程，如 果 线 程 一 直 没 有 获 取 到 状 态，cpu
资 源 会 一 直 被 占 用 。

## 17 、什么是Future？.............................................................................

#### 在 并 发 编 程 中 ， 我 们 经 常 用 到 非 阻 塞 的 模 型 ， 在 之 前 的 多 线 程 的 三 种 实 现 中 ， 不

管 是 继 承thread类 还 是 实 现runnable接 口，都 无 法 保 证 获 取 到 之 前 的 执 行 结 果。
通 过 实 现Callback接 口 ， 并 用Future可 以 来 接 收 多 线 程 的 执 行 结 果 。
Future表 示 一 个 可 能 还 没 有 完 成 的 异 步 任 务 的 结 果 ， 针 对 这 个 结 果 可 以 添加
Callback以 便 在 任 务 执 行 成 功 或 失 败 后 作 出 相 应 的 操 作 。


## 18 、什么是AQS.....................................................................................

AQS是AbustactQueuedSynchronizer的 简 称 ， 它 是 一 个Java提 高 的 底 层 同 步
工 具 类 ， 用 一 个int类 型 的 变 量 表 示 同 步 状 态 ， 并 提 供 了 一 系 列 的CAS操 作 来 管
理 这 个 同 步 状 态 。
AQS是 一 个 用 来 构 建 锁 和 同 步 器 的 框 架，使 用AQS能 简 单 且 高 效 地 构 造 出 应 用 广
泛 的 大 量 的 同 步 器，比 如 我 们 提 到 的ReentrantLock，Semaphore，其 他 的 诸如
ReentrantReadWriteLock，SynchronousQueue，FutureTask等 等 皆 是 基于
AQS的 。

## 19 、AQS支持两种同步方式：.............................................................

#### 1 、 独 占 式

#### 2 、 共 享 式

这 样 方 便 使 用 者 实 现 不 同 类 型 的 同 步 组 件 ， 独 占 式 如ReentrantLock， 共 享 式如
Semaphore，CountDownLatch，组 合 式 的 如ReentrantReadWriteLock。总 之，
AQS为 使 用 提 供 了 底 层 支 撑 ， 如 何 组 装 实 现 ， 使 用 者 可 以 自 由 发 挥 。

## 20 、ReadWriteLock是什么.................................................................

首 先 明 确 一 下，不 是 说ReentrantLock不 好，只 是ReentrantLock某 些 时 候 有 局
限 。 如 果 使 用ReentrantLock， 可 能 本 身 是 为 了 防 止 线 程A在 写 数 据 、 线 程B在
读 数 据 造 成 的 数 据 不 一 致 ， 但 这 样 ， 如 果 线 程C在 读 数 据 、 线 程D也 在 读 数 据 ，
读 数 据 是 不 会 改 变 数 据 的，没 有 必 要 加 锁，但 是 还 是 加 锁 了，降 低 了 程 序 的 性 能。
因 为 这 个，才 诞 生 了 读 写 锁ReadWriteLock。ReadWriteLock是 一 个 读 写 锁 接 口，
ReentrantReadWriteLock是ReadWriteLock接 口 的 一 个 具 体 实 现，实 现 了 读 写


#### 的 分 离，读 锁 是 共 享 的，写 锁 是 独 占 的，读 和 读 之 间 不 会 互 斥，读 和 写、写 和 读、

#### 写 和 写 之 间 才 会 互 斥 ， 提 升 了 读 写 的 性 能 。

## 21 、FutureTask是什么.........................................................................

这 个 其 实 前 面 有 提 到 过，FutureTask表 示 一 个 异 步 运 算 的 任 务。FutureTask里 面
可 以 传 入 一 个Callable的 具 体 实 现 类 ， 可 以 对 这 个 异 步 运 算 的 任 务 的 结 果 进 行 等
待 获 取 、 判 断 是 否 已 经 完 成 、 取 消 任 务 等 操 作 。 当 然 ， 由 于FutureTask也是
Runnable接 口 的 实 现 类 ， 所 以FutureTask也 可 以 放 入 线 程 池 中 。

## 22 、synchronized和ReentrantLock的区别...................................

synchronized是 和if、else、for、while一 样 的 关 键 字 ，ReentrantLock是 类，
这 是 二 者 的 本 质 区 别 。 既 然ReentrantLock是 类 ， 那 么 它 就 提 供 了比
synchronized更 多 更 灵 活 的 特 性，可 以 被 继 承、可 以 有 方 法、可 以 有 各 种 各 样 的
类 变 量 ，ReentrantLock比synchronized的 扩 展 性 体 现 在 几 点 上 ：
1 、ReentrantLock可 以 对 获 取 锁 的 等 待 时 间 进 行 设 置 ， 这 样 就 避 免 了 死 锁
2 、ReentrantLock可 以 获 取 各 种 锁 的 信 息
3 、ReentrantLock可 以 灵 活 地 实 现 多 路 通 知
另 外，二 者 的 锁 机 制 其 实 也 是 不 一 样 的。ReentrantLock底 层 调 用 的 是Unsafe的
park方 法 加 锁 ，synchronized操 作 的 应 该 是 对 象 头 中markword， 这 点 我 不 能
确 定 。

## 23 、什么是乐观锁和悲观锁...................................................................

#### 1 、乐 观 锁： 就 像 它 的 名 字 一 样，对 于 并 发 间 操 作 产 生 的 线 程 安 全 问 题 持 乐 观 状 态，

#### 乐 观 锁 认 为 竞 争 不 总 是 会 发 生 ， 因 此 它 不 需 要 持 有 锁 ， 将 比 较-替 换 这 两 个 动 作 作


#### 为 一 个 原 子 操 作 尝 试 去 修 改 内 存 中 的 变 量 ， 如 果 失 败 则 表 示 发 生 冲 突 ， 那 么 就 应

#### 该 有 相 应 的 重 试 逻 辑 。

#### 2 、悲 观 锁： 还 是 像 它 的 名 字 一 样，对 于 并 发 间 操 作 产 生 的 线 程 安 全 问 题 持 悲 观 状

#### 态 ， 悲 观 锁 认 为 竞 争 总 是 会 发 生 ， 因 此 每 次 对 某 资 源 进 行 操 作 时 ， 都 会 持 有 一 个

独 占 的 锁 ， 就 像synchronized， 不 管 三 七 二 十 一 ， 直 接 上 了 锁 就 操 作 资 源 了 。

## 24 、线程B怎么知道线程A修改了变量..............................................

1 、volatile修 饰 变 量
2 、synchronized修 饰 修 改 变 量 的 方 法
3 、wait/notify
4 、while轮 询

## 25 、synchronized、volatile、CAS比较...........................................

1 、synchronized是 悲 观 锁 ， 属 于 抢 占 式 ， 会 引 起 其 他 线 程 阻 塞 。
2 、volatile提 供 多 线 程 共 享 变 量 可 见 性 和 禁 止 指 令 重 排 序 优 化 。
3 、CAS是 基 于 冲 突 检 测 的 乐 观 锁 （ 非 阻 塞 ）

## 26 、sleep方法和wait方法有什么区别?............................................

这 个 问 题 常 问，sleep方 法 和wait方 法 都 可 以 用 来 放 弃CPU一 定 的 时 间，不 同 点
在 于 如 果 线 程 持 有 某 个 对 象 的 监 视 器 ，sleep方 法 不 会 放 弃 这 个 对 象 的 监 视 器 ，
wait方 法 会 放 弃 这 个 对 象 的 监 视 器

## 27 、ThreadLocal是什么？有什么用？...............................................


ThreadLocal是 一 个 本 地 线 程 副 本 变 量 工 具 类 。 主 要 用 于 将 私 有 线 程 和 该 线 程 存
放 的 副 本 对 象 做 一 个 映 射 ， 各 个 线 程 之 间 的 变 量 互 不 干 扰 ， 在 高 并 发 场 景 下 ， 可
以 实 现 无 状 态 的 调 用 ， 特 别 适 用 于 各 个 线 程 依 赖 不 通 的 变 量 值 完 成 操 作 的 场 景 。
简 单 说ThreadLocal就 是 一 种 以 空 间 换 时 间 的 做 法 ， 在 每 个Thread里 面 维 护 了
一 个 以 开 地 址 法 实 现 的ThreadLocal.ThreadLocalMap， 把 数 据 进 行 隔 离 ， 数 据
不 共 享 ， 自 然 就 没 有 线 程 安 全 方 面 的 问 题 了 。

## 28 、为什么wait()方法和notify()/notifyAll()方法要在同步块中被调用

这 是JDK强 制 的，wait()方 法 和notify()/notifyAll()方 法 在 调 用 前 都 必 须 先 获 得 对
象 的 锁

## 29 、多线程同步有哪几种方法？...........................................................

Synchronized关 键 字 ，Lock锁 实 现 ， 分 布 式 锁 等 。

## 30 、线程的调度策略...............................................................................

#### 线 程 调 度 器 选 择 优 先 级 最 高 的 线 程 运 行 ， 但 是 ， 如 果 发 生 以 下 情 况 ， 就 会 终 止 线

#### 程 的 运 行 ：

1 、 线 程 体 中 调 用 了yield方 法 让 出 了 对cpu的 占 用 权 利
2 、 线 程 体 中 调 用 了sleep方 法 使 线 程 进 入 睡 眠 状 态
3 、 线 程 由 于IO操 作 受 到 阻 塞
4 、 另 外 一 个 更 高 优 先 级 线 程 出 现
5 ） 在 支 持 时 间 片 的 系 统 中 ， 该 线 程 的 时 间 片 用 完


## 31 、ConcurrentHashMap的并发度是什么......................................

ConcurrentHashMap的 并 发 度 就 是segment的 大 小 ， 默 认 为 16 ， 这 意 味 着 最
多 同 时 可 以 有 16 条 线 程 操 作ConcurrentHashMap， 这 也是
ConcurrentHashMap对Hashtable的 最 大 优 势 ， 任 何 情 况 下 ，Hashtable能 同
时 有 两 条 线 程 获 取Hashtable中 的 数 据 吗 ？

## 32 、Linux环境下如何查找哪个线程使用CPU最长..........................

1 、 获 取 项 目 的pid，jps或 者ps-ef|grepjava， 这 个 前 面 有 讲 过
2 、top-H-ppid， 顺 序 不 能 改 变

## 33 、Java死锁以及如何避免？..............................................................

Java中 的 死 锁 是 一 种 编 程 情 况，其 中 两 个 或 多 个 线 程 被 永 久 阻 塞，Java死 锁 情 况
出 现 至 少 两 个 线 程 和 两 个 或 更 多 资 源 。
Java发 生 死 锁 的 根 本 原 因 是 ： 在 申 请 锁 时 发 生 了 交 叉 闭 环 申 请 。

## 34 、死锁的原因.......................................................................................

#### 1 、是 多 个 线 程 涉 及 到 多 个 锁，这 些 锁 存 在 着 交 叉，所 以 可 能 会 导 致 了 一 个 锁 依 赖

#### 的 闭 环 。

#### 例 如 ： 线 程 在 获 得 了 锁A并 且 没 有 释 放 的 情 况 下 去 申 请 锁B， 这 时 ， 另 一 个 线 程

#### 已 经 获 得 了 锁B，在 释 放 锁B之 前 又 要 先 获 得 锁A，因 此 闭 环 发 生，陷 入 死 锁 循 环。

#### 2 、 默 认 的 锁 申 请 操 作 是 阻 塞 的 。


#### 所 以 要 避 免 死 锁 ， 就 要 在 一 遇 到 多 个 对 象 锁 交 叉 的 情 况 ， 就 要 仔 细 审 查 这 几 个 对

#### 象 的 类 中 的 所 有 方 法 ， 是 否 存 在 着 导 致 锁 依 赖 的 环 路 的 可 能 性 。 总 之 是 尽 量 避 免

#### 在 一 个 同 步 方 法 中 调 用 其 它 对 象 的 延 时 方 法 和 同 步 方 法 。

## 35 、怎么唤醒一个阻塞的线程...............................................................

如 果 线 程 是 因 为 调 用 了wait()、sleep()或 者join()方 法 而 导 致 的 阻 塞，可 以 中 断 线
程 ， 并 且 通 过 抛 出InterruptedException来 唤 醒 它 ； 如 果 线 程 遇 到 了IO阻 塞 ，
无 能 为 力，因 为IO是 操 作 系 统 实 现 的，Java代 码 并 没 有 办 法 直 接 接 触 到 操 作 系 统。

## 36 、不可变对象对多线程有什么帮助...................................................

#### 前 面 有 提 到 过 的 一 个 问 题 ， 不 可 变 对 象 保 证 了 对 象 的 内 存 可 见 性 ， 对 不 可 变 对 象

#### 的 读 取 不 需 要 进 行 额 外 的 同 步 手 段 ， 提 升 了 代 码 执 行 效 率 。

## 37 、什么是多线程的上下文切换...........................................................

#### 多 线 程 的 上 下 文 切 换 是指CPU控 制 权 由 一 个 已 经 正 在 运 行 的 线 程 切 换 到 另 外 一 个

#### 就 绪 并 等 待 获 取CPU执 行 权 的 线 程 的 过 程 。

## 38 、如果你提交任务时，线程池队列已满，这时会发生什么...........

#### 这 里 区 分 一 下 ：

1 、 如 果 使 用 的 是 无 界 队 列LinkedBlockingQueue， 也 就 是 无 界 队 列 的 话 ， 没 关
系，继 续 添 加 任 务 到 阻 塞 队 列 中 等 待 执 行，因 为LinkedBlockingQueue可 以 近 乎
认 为 是 一 个 无 穷 大 的 队 列 ， 可 以 无 限 存 放 任 务


2 、 如 果 使 用 的 是 有 界 队 列 比 如ArrayBlockingQueue， 任 务 首 先 会 被 添 加到
ArrayBlockingQueue中 ，ArrayBlockingQueue满 了 ， 会 根据
maximumPoolSize的 值 增 加 线 程 数 量 ， 如 果 增 加 了 线 程 数 量 还 是 处 理 不 过 来 ，
ArrayBlockingQueue继 续 满 ， 那 么 则 会 使 用 拒 绝 策略
RejectedExecutionHandler处 理 满 了 的 任 务 ， 默 认 是AbortPolicy

## 39 、Java中用到的线程调度算法是什么..............................................

#### 抢 占 式。一 个 线 程 用 完CPU之 后，操 作 系 统 会 根 据 线 程 优 先 级、线 程 饥 饿 情 况 等

#### 数 据 算 出 一 个 总 的 优 先 级 并 分 配 下 一 个 时 间 片 给 某 个 线 程 执 行 。

### 40 、什么是线程调度器(ThreadScheduler)和时间分片(Time

### Slicing)？

线 程 调 度 器 是 一 个 操 作 系 统 服 务，它 负 责 为Runnable状 态 的 线 程 分 配CPU时 间。
一 旦 我 们 创 建 一 个 线 程 并 启 动 它 ， 它 的 执 行 便 依 赖 于 线 程 调 度 器 的 实 现 。 时 间 分
片 是 指 将 可 用 的CPU时 间 分 配 给 可 用 的Runnable线 程 的 过 程。分 配CPU时 间 可
以 基 于 线 程 优 先 级 或 者 线 程 等 待 的 时 间。线 程 调 度 并 不 受 到Java虚 拟 机 控 制，所
以 由 应 用 程 序 来 控 制 它 是 更 好 的 选 择 （ 也 就 是 说 不 要 让 你 的 程 序 依 赖 于 线 程 的 优
先 级 ） 。

## 41 、什么是自旋.......................................................................................

很 多synchronized里 面 的 代 码 只 是 一 些 很 简 单 的 代 码，执 行 时 间 非 常 快，此 时 等
待 的 线 程 都 加 锁 可 能 是 一 种 不 太 值 得 的 操 作 ， 因 为 线 程 阻 塞 涉 及 到 用 户 态 和 内 核
态 切 换 的 问 题。既 然synchronized里 面 的 代 码 执 行 得 非 常 快，不 妨 让 等 待 锁 的 线


程 不 要 被 阻 塞，而 是 在synchronized的 边 界 做 忙 循 环，这 就 是 自 旋。如 果 做 了 多
次 忙 循 环 发 现 还 没 有 获 得 锁 ， 再 阻 塞 ， 这 样 可 能 是 一 种 更 好 的 策 略 。

### 42 、JavaConcurrencyAPI中的Lock接口(Lockinterface)

### 是什么？对比同步它有什么优势？

Lock接 口 比 同 步 方 法 和 同 步 块 提 供 了 更 具 扩 展 性 的 锁 操 作 。 他 们 允 许 更 灵 活 的 结
构 ， 可 以 具 有 完 全 不 同 的 性 质 ， 并 且 可 以 支 持 多 个 相 关 类 的 条 件 对 象 。
它 的 优 势 有 ：
1 、 可 以 使 锁 更 公 平
2 、 可 以 使 线 程 在 等 待 锁 的 时 候 响 应 中 断
3 、 可 以 让 线 程 尝 试 获 取 锁 ， 并 在 无 法 获 取 锁 的 时 候 立 即 返 回 或 者 等 待 一 段 时 间
4 、 可 以 在 不 同 的 范 围 ， 以 不 同 的 顺 序 获 取 和 释 放 锁

### 43 、单例模式的线程安全性...................................................................

#### 老 生 常 谈 的 问 题 了 ， 首 先 要 说 的 是 单 例 模 式 的 线 程 安 全 意 味 着 ： 某 个 类 的 实 例 在

#### 多 线 程 环 境 下 只 会 被 创 建 一 次 出 来 。 单 例 模 式 有 很 多 种 的 写 法 ， 我 总 结 一 下 ：

#### 1 、 饿 汉 式 单 例 模 式 的 写 法 ： 线 程 安 全

#### 2 、 懒 汉 式 单 例 模 式 的 写 法 ： 非 线 程 安 全

#### 3 、 双 检 锁 单 例 模 式 的 写 法 ： 线 程 安 全

### 44 、Semaphore有什么作用................................................................

Semaphore就 是 一 个 信 号 量，它 的 作 用 是 限 制 某 段 代 码 块 的 并 发 数。Semaphore
有 一 个 构 造 函 数，可 以 传 入 一 个int型 整 数n，表 示 某 段 代 码 最 多 只 有n个 线 程 可
以 访 问，如 果 超 出 了n，那 么 请 等 待，等 到 某 个 线 程 执 行 完 毕 这 段 代 码 块，下 一 个


线 程 再 进 入 。 由 此 可 以 看 出 如 果Semaphore构 造 函 数 中 传 入 的int型 整 数n=1，
相 当 于 变 成 了 一 个synchronized了 。

### 45 、Executors类是什么？...................................................................

Executors为Executor，ExecutorService，ScheduledExecutorService，
ThreadFactory和Callable类 提 供 了 一 些 工 具 方 法 。
Executors可 以 用 于 方 便 的 创 建 线 程 池

### 46 、线程类的构造方法、静态块是被哪个线程调用的.......................

这 是 一 个 非 常 刁 钻 和 狡 猾 的 问 题 。 请 记 住 ： 线 程 类 的 构 造 方 法 、 静 态 块 是 被new
这 个 线 程 类 所 在 的 线 程 所 调 用 的 ， 而run方 法 里 面 的 代 码 才 是 被 线 程 自 身 所 调 用
的 。
如 果 说 上 面 的 说 法 让 你 感 到 困 惑 ， 那 么 我 举 个 例 子 ， 假 设Thread2中new了
Thread1，main函 数 中new了Thread2， 那 么 ：
1 、Thread2的 构 造 方 法 、 静 态 块 是main线 程 调 用 的 ，Thread2的run()方 法是
Thread2自 己 调 用 的
2 、Thread1的 构 造 方 法 、 静 态 块 是Thread2调 用 的 ，Thread1的run()方 法是
Thread1自 己 调 用 的

### 47 、同步方法和同步块，哪个是更好的选择?.....................................

#### 同 步 块 ， 这 意 味 着 同 步 块 之 外 的 代 码 是 异 步 执 行 的 ， 这 比 同 步 整 个 方 法 更 提 升 代

#### 码 的 效 率 。 请 知 道 一 条 原 则 ： 同 步 的 范 围 越 小 越 好 。

### 48 、Java线程数过多会造成什么异常？..............................................


#### 1 、 线 程 的 生 命 周 期 开 销 非 常 高

#### 2 、 消 耗 过 多 的CPU资 源

#### 如 果 可 运 行 的 线 程 数 量 多 于 可 用 处 理 器 的 数 量 ， 那 么 有 线 程 将 会 被 闲 置 。 大 量 空

#### 闲 的 线 程 会 占 用 许 多 内 存 ， 给 垃 圾 回 收 器 带 来 压 力 ， 而 且 大 量 的 线 程 在 竞 争CPU

#### 资 源 时 还 将 产 生 其 他 性 能 的 开 销 。

#### 3 、 降 低 稳 定 性

#### JVM在 可 创 建 线 程 的 数 量 上 存 在 一 个 限 制，这 个 限 制 值 将 随 着 平 台 的 不 同 而 不 同，

```
并 且 承 受 着 多 个 因 素 制 约 ， 包 括JVM的 启 动 参 数 、Thread构 造 函 数 中 请 求 栈 的
大 小 ， 以 及 底 层 操 作 系 统 对 线 程 的 限 制 等 。 如 果 破 坏 了 这 些 限 制 ， 那 么 可 能 抛出
OutOfMemoryError异 常 。
```

## Java 面试题（一）.................................................................................................

### 1 、面向对象的特征有哪些方面？.........................................................

#### 答 ：

#### 面 向 对 象 的 特 征 主 要 有 以 下 几 个 方 面 ：

 抽象：抽象是将一类对象的共同特征总结出来构造类的过程，包括数据抽
象和行为抽象两方面。抽象只关注对象有哪些属性和行为，并不关注这些行为的
细节是什么。
 继承：继承是从已有类得到继承信息创建新类的过程。提供继承信息的类
被称为父类（超类、基类）；得到继承信息的类被称为子类（派生类）。继承让
变化中的软件系统有了一定的延续性，同时继承也是封装程序中可变因素的重要
手段（如果不能理解请阅读阎宏博士的《Java与模式》或《设计模式精解》中
关于桥梁模式的部分）。


 封装：通常认为封装是把数据和操作数据的方法绑定起来，对数据的访问
只能通过已定义的接口。面向对象的本质就是将现实世界描绘成一系列完全自
治、封闭的对象。我们在类中编写的方法就是对实现细节的一种封装；我们编写
一个类就是对数据和数据操作的封装。可以说，封装就是隐藏一切可隐藏的东西，
只向外界提供最简单的编程接口（可以想想普通洗衣机和全自动洗衣机的差别，
明显全自动洗衣机封装更好因此操作起来更简单；我们现在使用的智能手机也是
封装得足够好的，因为几个按键就搞定了所有的事情）。
 多态性：多态性是指允许不同子类型的对象对同一消息作出不同的响应。
简单的说就是用同样的对象引用调用同样的方法但是做了不同的事情。多态性分
为编译时的多态性和运行时的多态性。如果将对象的方法视为对象向外界提供的
服务，那么运行时的多态性可以解释为：当A系统访问B系统提供的服务时，B
系统有多种提供服务的方式，但一切对A系统来说都是透明的（就像电动剃须
刀是A系统，它的供电系统是B系统，B系统可以使用电池供电或者用交流电，
甚至还有可能是太阳能，A系统只会通过B类对象调用供电的方法，但并不知道
供电系统的底层实现是什么，究竟通过何种方式获得了动力）。方法重载
（overload）实现的是编译时的多态性（也称为前绑定），而方法重写（override）
实现的是运行时的多态性（也称为后绑定）。运行时的多态是面向对象最精髓的
东西，要实现多态需要做两件事：1). 方法重写（子类继承父类并重写父类中已
有的或抽象的方法）；2). 对象造型（用父类型引用引用子类型对象，这样同样
的引用调用同样的方法就会根据子类对象的不同而表现出不同的行为）。

### 2 、访问修饰符public,private,protected,以及不写（默认）时的区别？

#### 答 ：

#### 修饰符 当前类 同包 子 类 其他包

```
public √ √ √ √
```

```
protecte
d
```

#### √ √ √ ×

```
default √ √ × ×
```

```
private √ × × ×
```

类 的 成 员 不 写 访 问 修 饰 时 默 认 为default。默 认 对 于 同 一 个 包 中 的 其 他 类 相 当 于 公
开 （public） ， 对 于 不 是 同 一 个 包 中 的 其 他 类 相 当 于 私 有 （private） 。 受 保 护
（protected）对 子 类 相 当 于 公 开，对 不 是 同 一 包 中 的 没 有 父 子 关 系 的 类 相 当 于 私
有。Java中，外 部 类 的 修 饰 符 只 能 是public或 默 认，类 的 成 员（包 括 内 部 类）的
修 饰 符 可 以 是 以 上 四 种 。

### 3 、String 是最基本的数据类型吗？....................................................

#### 答 ：

不 是。Java中 的 基 本 数 据 类 型 只 有 8 个：byte、short、int、long、float、double、
char、boolean；除 了 基 本 类 型（primitivetype），剩 下 的 都 是 引 用 类 型（reference
type） ，Java 5 以 后 引 入 的 枚 举 类 型 也 算 是 一 种 比 较 特 殊 的 引 用 类 型 。

### 4 、floatf=3.4;是否正确？....................................................................

答:不 正 确。3.4是 双 精 度 数，将 双 精 度 型（double）赋 值 给 浮 点 型（float）属 于
下 转 型（down-casting，也 称 为 窄 化）会 造 成 精 度 损 失，因 此 需 要 强 制 类 型 转换
floatf=(float)3.4; 或 者 写 成floatf=3.4F;。


### 5 、shorts1=1;s1=s1+1;有错吗?shorts1=1;s1+=1;有错吗？

#### 答 ：

对 于shorts1=1;s1=s1+1;由 于 1 是int类 型 ， 因 此s1+1运 算 结 果 也 是int
型 ， 需 要 强 制 转 换 类 型 才 能 赋 值 给short型 。 而shorts1=1;s1+=1;可 以 正 确
编 译 ， 因 为s1+=1;相 当 于s1=(short)(s1+1);其 中 有 隐 含 的 强 制 类 型 转 换 。

### 6 、Java有没有goto？..........................................................................

#### 答 ：

goto 是Java中 的 保 留 字，在 目 前 版 本 的Java中 没 有 使 用。（根 据JamesGosling
（Java之 父 ） 编 写 的 《TheJavaProgrammingLanguage》 一 书 的 附 录 中 给 出
了 一 个Java关 键 字 列 表 ， 其 中 有goto和const， 但 是 这 两 个 是 目 前 无 法 使 用 的
关 键 字 ， 因 此 有 些 地 方 将 其 称 之 为 保 留 字 ， 其 实 保 留 字 这 个 词 应 该 有 更 广 泛 的 意
义 ， 因 为 熟 悉C语 言 的 程 序 员 都 知 道 ， 在 系 统 类 库 中 使 用 过 的 有 特 殊 意 义 的 单 词
或 单 词 的 组 合 都 被 视 为 保 留 字 ）

### 7 、int和Integer有什么区别？...........................................................

#### 答 ：

Java是 一 个 近 乎 纯 洁 的 面 向 对 象 编 程 语 言 ， 但 是 为 了 编 程 的 方 便 还 是 引 入 了 基 本
数 据 类 型 ， 但 是 为 了 能 够 将 这 些 基 本 数 据 类 型 当 成 对 象 操 作 ，Java为 每 一 个 基 本


```
数 据 类 型 都 引 入 了 对 应 的 包 装 类 型（wrapperclass），int的 包 装 类 就 是Integer，
从Java 5 开 始 引 入 了 自 动 装 箱/拆 箱 机 制 ， 使 得 二 者 可 以 相 互 转 换 。
Java 为 每 个 原 始 类 型 提 供 了 包 装 类 型 ：
```

 原始类型:boolean，char，byte，short，int，long，float，double
 包装类型：Boolean，Character，Byte，Short，Integer，Long，Float，
Double

classAutoUnboxingTest{

```
publicstaticvoidmain(String[]args){
Integera=newInteger(3);
Integerb=3; // 将 3 自动装箱成Integer类型
intc=3;
System.out.println(a==b); //false 两个引用没有引用同一对
象
System.out.println(a==c); //truea自动拆箱成int类型再和c
比较
}
}
```

```
最 近 还 遇 到 一 个 面 试 题 ， 也 是 和 自 动 装 箱 和 拆 箱 有 点 关 系 的 ， 代 码 如 下 所 示 ：
```

publicclassTest03{

```
publicstaticvoidmain(String[]args){
Integerf1=100,f2=100,f3=150,f4=150;
```

```
System.out.println(f1==f2);
System.out.println(f3==f4);
```

}
}

如 果 不 明 就 里 很 容 易 认 为 两 个 输 出 要 么 都 是true要 么 都 是false。首 先 需 要 注 意 的
是f1、f2、f3、f4四 个 变 量 都 是Integer对 象 引 用，所 以 下 面 的==运 算 比 较 的 不
是 值 而 是 引 用。装 箱 的 本 质 是 什 么 呢 ？ 当 我 们 给 一 个Integer对 象 赋 一 个int值 的
时 候 ， 会 调 用Integer类 的 静 态 方 法valueOf， 如 果 看 看valueOf的 源 代 码 就 知
道 发 生 了 什 么 。

publicstaticIntegervalueOf(inti){
if(i>=IntegerCache.low&&i<=IntegerCache.high)
returnIntegerCache.cache[i+(-IntegerCache.low)];
returnnewInteger(i);
}

IntegerCache是Integer的 内 部 类 ， 其 代 码 如 下 所 示 ：

/**
*Cachetosupporttheobjectidentitysemanticsofautoboxingfor
valuesbetween
*-128and 127 (inclusive)asrequiredbyJLS.
*
*Thecacheisinitializedonfirstusage. Thesizeofthecache
*maybecontrolledbythe{@code-XX:AutoBoxCacheMax=<size>}
option.
*DuringVMinitialization,java.lang.Integer.IntegerCache.high
property
*maybesetandsavedintheprivatesystempropertiesinthe
*sun.misc.VMclass.
*/


```
privatestaticclassIntegerCache{
staticfinalintlow=-128;
staticfinalinthigh;
staticfinalIntegercache[];
```

```
static{
//highvaluemaybeconfiguredbyproperty
inth=127;
StringintegerCacheHighPropValue=
```

sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");
if(integerCacheHighPropValue!=null){
try{
inti=parseInt(integerCacheHighPropValue);
i=Math.max(i,127);
//MaximumarraysizeisInteger.MAX_VALUE
h=Math.min(i,Integer.MAX_VALUE-(-low)-1);
}catch(NumberFormatExceptionnfe){
//Ifthepropertycannotbeparsedintoanint,
ignoreit.
}
}
high=h;

```
cache=newInteger[(high-low)+1];
intj=low;
for(intk=0;k<cache.length;k++)
cache[k]=newInteger(j++);
```

```
//range[-128,127]mustbeinterned(JLS75.1.7)
assertIntegerCache.high>=127;
```

}

```
privateIntegerCache(){}
}
```

简 单 的 说，如 果 整 型 字 面 量 的 值 在-128到 127 之 间，那 么 不 会new新 的Integer
对 象 ， 而 是 直 接 引 用 常 量 池 中 的Integer对 象 ， 所 以 上 面 的 面 试 题 中f1f4的 结 果
是false。

#### 提 醒： 越 是 貌 似 简 单 的 面 试 题 其 中 的 玄 机 就 越 多，需 要 面 试 者 有 相 当 深 厚 的 功 力。

### 8 、&和&&的区别？...............................................................................

#### 答 ：

#### &运 算 符 有 两 种 用 法 ：(1)按 位 与 ；(2)逻 辑 与 。&&运 算 符 是 短 路 与 运 算 。 逻 辑 与

#### 跟 短 路 与 的 差 别 是 非 常 巨 大 的 ， 虽 然 二 者 都 要 求 运 算 符 左 右 两 端 的 布 尔 值 都是

true整 个 表 达 式 的 值 才 是true。&&之 所 以 称 为 短 路 运 算 是 因 为，如 果&&左 边 的
表 达 式 的 值 是false，右 边 的 表 达 式 会 被 直 接 短 路 掉，不 会 进 行 运 算。很 多 时 候 我
们 可 能 都 需 要 用&&而 不 是&，例 如 在 验 证 用 户 登 录 时 判 定 用 户 名 不 是null而 且 不
是 空 字 符 串 ， 应 当 写 为 ：username!=null&&!username.equals(“ ”)， 二 者
的 顺 序 不 能 交 换，更 不 能 用&运 算 符，因 为 第 一 个 条 件 如 果 不 成 立，根 本 不 能 进 行
字 符 串 的equals比 较 ， 否 则 会 产 生NullPointerException异 常 。 注 意 ： 逻 辑 或
运 算 符 （|） 和 短 路 或 运 算 符 （||） 的 差 别 也 是 如 此 。

**补 充 ：** 如 果 你 熟 悉JavaScript， 那 你 可 能 更 能 感 受 到 短 路 运 算 的 强 大 ， 想 成为
JavaScript的 高 手 就 先 从 玩 转 短 路 运 算 开 始 吧 。


### 9 、解释内存中的栈(stack)、堆(heap)和方法区(methodarea)的用法。

#### 答 ：

#### 通 常 我 们 定 义 一 个 基 本 数 据 类 型 的 变 量 ， 一 个 对 象 的 引 用 ， 还 有 就 是 函 数 调 用 的

现 场 保 存 都 使 用JVM中 的 栈 空 间；而 通 过new关 键 字 和 构 造 器 创 建 的 对 象 则 放 在
堆 空 间 ， 堆 是 垃 圾 收 集 器 管 理 的 主 要 区 域 ， 由 于 现 在 的 垃 圾 收 集 器 都 采 用 分 代 收
集 算 法 ， 所 以 堆 空 间 还 可 以 细 分 为 新 生 代 和 老 生 代 ， 再 具 体 一 点 可 以 分 为Eden、
Survivor（又 可 分 为FromSurvivor和ToSurvivor）、Tenured；方 法 区 和 堆 都
是 各 个 线 程 共 享 的 内 存 区 域，用 于 存 储 已 经 被JVM加 载 的 类 信 息、常 量、静 态 变
量、JIT编 译 器 编 译 后 的 代 码 等 数 据；程 序 中 的 字 面 量（literal）如 直 接 书 写 的 100 、”
hello”和 常 量 都 是 放 在 常 量 池 中 ， 常 量 池 是 方 法 区 的 一 部 分 ， 。 栈 空 间 操 作 起 来
最 快 但 是 栈 很 小，通 常 大 量 的 对 象 都 是 放 在 堆 空 间，栈 和 堆 的 大 小 都 可 以 通 过JVM
的 启 动 参 数 来 进 行 调 整 ， 栈 空 间 用 光 了 会 引 发StackOverflowError， 而 堆 和 常 量
池 空 间 不 足 则 会 引 发OutOfMemoryError。

Stringstr=newString("hello");

上 面 的 语 句 中 变 量str放 在 栈 上 ， 用new创 建 出 来 的 字 符 串 对 象 放 在 堆 上 ， 而”
hello”这 个 字 面 量 是 放 在 方 法 区 的 。

**补 充 1 ：** 较 新 版 本 的Java（ 从Java 6 的 某 个 更 新 开 始 ） 中 ， 由 于JIT编 译 器 的 发
展 和”逃 逸 分 析”技 术 的 逐 渐 成 熟 ， 栈 上 分 配 、 标 量 替 换 等 优 化 技 术 使 得 对 象 一
定 分 配 在 堆 上 这 件 事 情 已 经 变 得 不 那 么 绝 对 了 。
**补 充 2** ： 运 行 时 常 量 池 相 当 于Class文 件 常 量 池 具 有 动 态 性 ，Java语 言 并 不 要 求
常 量 一 定 只 有 编 译 期 间 才 能 产 生 ， 运 行 期 间 也 可 以 将 新 的 常 量 放 入 池 中 ，String
类 的intern()方 法 就 是 这 样 的 。


看 看 下 面 代 码 的 执 行 结 果 是 什 么 并 且 比 较 一 下Java 7 以 前 和 以 后 的 运 行 结 果 是 否
一 致 。

Strings1=newStringBuilder("go")
.append("od").toString();
System.out.println(s1.intern()==s1);
Strings2=newStringBuilder("ja")
.append("va").toString();
System.out.println(s2.intern()==s2);

### 10 、Math.round(11.5) 等于多少？Math.round(-11.5)等于多少？

#### 答 ：

Math.round(11.5)的 返 回 值 是 12 ，Math.round(-11.5)的 返 回 值 是-11。 四 舍 五
入 的 原 理 是 在 参 数 上 加0.5然 后 进 行 下 取 整 。

### 作用在String上？.................................................................................. 11 、switch 是否能作用在byte 上，是否能作用在long 上，是否能

### 是否能作用在String上？

#### 答 ：

在Java 5 以 前，switch(expr)中，expr只 能 是byte、short、char、int。从Java
5 开 始 ，Java中 引 入 了 枚 举 类 型 ，expr也 可 以 是enum类 型 ， 从Java 7 开 始 ，
expr还 可 以 是 字 符 串 （String） ， 但 是 长 整 型 （long） 在 目 前 所 有 的 版 本 中 都 是
不 可 以 的 。


### 12 、用最有效率的方法计算 2 乘以 8 ？...............................................

#### 答 ：

#### 2 << 3 （ 左 移 3 位 相 当 于 乘 以 2 的 3 次 方 ， 右 移 3 位 相 当 于 除 以 2 的 3 次 方 ）。

**补 充 ：** 我 们 为 编 写 的 类 重 写hashCode方 法 时 ， 可 能 会 看 到 如 下 所 示 的 代 码 ， 其
实 我 们 不 太 理 解 为 什 么 要 使 用 这 样 的 乘 法 运 算 来 产 生 哈 希 码 （ 散 列 码 ） ， 而 且 为
什 么 这 个 数 是 个 素 数，为 什 么 通 常 选 择 31 这 个 数 ？ 前 两 个 问 题 的 答 案 你 可 以 自 己
百 度 一 下，选 择 31 是 因 为 可 以 用 移 位 和 减 法 运 算 来 代 替 乘 法，从 而 得 到 更 好 的 性
能 。 说 到 这 里 你 可 能 已 经 想 到 了 ： 31 *num 等 价 于(num<<5)-num， 左 移 5
位 相 当 于 乘 以 2 的 5 次 方 再 减 去 自 身 就 相 当 于 乘 以 31 ，现 在 的VM都 能 自 动 完 成
这 个 优 化 。

publicclassPhoneNumber{
privateintareaCode;
privateStringprefix;
privateStringlineNumber;

```
@Override
publicinthashCode(){
finalintprime=31;
intresult=1;
result=prime*result+areaCode;
result=prime*result
+((lineNumber==null)? 0 :lineNumber.hashCode());
result=prime*result+((prefix==null)? 0 :prefix.hashCode());
returnresult;
}
```

```
@Override
publicbooleanequals(Objectobj){
if(this==obj)
returntrue;
if(obj==null)
returnfalse;
if(getClass()!=obj.getClass())
returnfalse;
PhoneNumberother=(PhoneNumber)obj;
if(areaCode!=other.areaCode)
returnfalse;
if(lineNumber==null){
if(other.lineNumber!=null)
returnfalse;
}elseif(!lineNumber.equals(other.lineNumber))
returnfalse;
if(prefix==null){
if(other.prefix!=null)
returnfalse;
}elseif(!prefix.equals(other.prefix))
returnfalse;
returntrue;
}
```

}

### 13 、数组有没有length()方法？String有没有length()方法？......

#### 答 ：


数 组 没 有length()方 法，有length 的 属 性。String 有length()方 法。JavaScript
中 ， 获 得 字 符 串 的 长 度 是 通 过length属 性 得 到 的 ， 这 一 点 容 易 和Java混 淆 。

### 14 、在Java中，如何跳出当前的多重嵌套循环？.............................

#### 答 ：

在 最 外 层 循 环 前 加 一 个 标 记 如A， 然 后 用breakA;可 以 跳 出 多 重 循 环 。 （Java中
支 持 带 标 签 的break和continue语 句 ， 作 用 有 点 类 似 于C和C++中 的goto语
句，但 是 就 像 要 避 免 使 用goto一 样，应 该 避 免 使 用 带 标 签 的break和continue，
因 为 它 不 会 让 你 的 程 序 变 得 更 优 雅 ， 很 多 时 候 甚 至 有 相 反 的 作 用 ， 所 以 这 种 语 法
其 实 不 知 道 更 好 ）

### 15 、构造器（constructor）是否可被重写（override）？.............

#### 答 ：

#### 构 造 器 不 能 被 继 承 ， 因 此 不 能 被 重 写 ， 但 可 以 被 重 载 。

### 16 、两个对象值相同(x.equals(y)==true)，但却可有不同的

### hashcode，这句话对不对？

#### 答 ：

不 对，如 果 两 个 对 象x和y满 足x.equals(y)==true，它 们 的 哈 希 码（hashcode）
应 当 相 同 。Java对 于eqauls方 法 和hashCode方 法 是 这 样 规 定 的 ：(1)如 果 两 个


对 象 相 同 （equals方 法 返 回true） ， 那 么 它 们 的hashCode值 一 定 要 相 同 ；(2)
如 果 两 个 对 象 的hashCode相 同 ， 它 们 并 不 一 定 相 同 。 当 然 ， 你 未 必 要 按 照 要 求
去 做 ， 但 是 如 果 你 违 背 了 上 述 原 则 就 会 发 现 在 使 用 容 器 时 ， 相 同 的 对 象 可 以 出 现
在Set集 合 中 ， 同 时 增 加 新 元 素 的 效 率 会 大 大 下 降 （ 对 于 使 用 哈 希 存 储 的 系 统 ，
如 果 哈 希 码 频 繁 的 冲 突 将 会 造 成 存 取 性 能 急 剧 下 降 ） 。

**补 充 ：** 关 于equals和hashCode方 法 ， 很 多Java程 序 都 知 道 ， 但 很 多 人 也 就 是
仅 仅 知 道 而 已 ， 在JoshuaBloch的 大 作 《EffectiveJava》 （ 很 多 软 件 公 司 ，
《EffectiveJava》、《Java编 程 思 想》以 及《重 构：改 善 既 有 代 码 质 量》是Java
程 序 员 必 看 书 籍 ， 如 果 你 还 没 看 过 ， 那 就 赶 紧 去亚 马 逊买 一 本 吧 ） 中 是 这 样 介绍
equals方 法 的：首 先equals方 法 必 须 满 足 自 反 性（x.equals(x)必 须 返 回true）、
对 称 性 （x.equals(y)返 回true时 ，y.equals(x)也 必 须 返 回true） 、 传 递 性
（x.equals(y)和y.equals(z)都 返 回true时 ，x.equals(z)也 必 须 返 回true） 和 一
致 性 （ 当x和y引 用 的 对 象 信 息 没 有 被 修 改 时 ， 多 次 调 用x.equals(y)应 该 得 到 同
样 的 返 回 值 ） ， 而 且 对 于 任 何 非null值 的 引 用x，x.equals(null)必 须 返 回false。
实 现 高 质 量 的equals方 法 的 诀 窍 包 括 ：1. 使 用==操 作 符 检 查”参 数 是 否 为 这 个
对 象 的 引 用”；2. 使 用instanceof操 作 符 检 查”参 数 是 否 为 正 确 的 类 型”；3. 对
于 类 中 的 关 键 属 性，检 查 参 数 传 入 对 象 的 属 性 是 否 与 之 相 匹 配；4. 编 写 完equals
方 法 后 ， 问 自 己 它 是 否 满 足 对 称 性 、 传 递 性 、 一 致 性 ；5. 重 写equals时 总 是 要
重写hashCode；6. 不 要将equals方 法 参 数 中的Object对 象 替 换 为 其 他 的 类 型，
在 重 写 时 不 要 忘 掉@Override注 解 。

### 17 、是否可以继承String类？.............................................................

#### 答 ：

String 类 是final类 ， 不 可 以 被 继 承 。

**补 充：** 继 承String本 身 就 是 一 个 错 误 的 行 为，对String类 型 最 好 的 重 用 方 式 是 关
联 关 系 （Has-A） 和 依 赖 关 系 （Use-A） 而 不 是 继 承 关 系 （Is-A） 。


### 18 、当一个对象被当作参数传递到一个方法后，此方法可改变

### 这个对象的属性，并可返回变化后的结果，那么这里到底是值传

### 递还是引用传递？

#### 答 ：

是 值 传 递 。Java语 言 的 方 法 调 用 只 支 持 参 数 的 值 传 递 。 当 一 个 对 象 实 例 作 为 一 个
参 数 被 传 递 到 方 法 中 时 ， 参 数 的 值 就 是 对 该 对 象 的 引 用 。 对 象 的 属 性 可 以 在 被 调
用 过 程 中 被 改 变，但 对 对 象 引 用 的 改 变 是 不 会 影 响 到 调 用 者 的。C++和C#中 可 以
通 过 传 引 用 或 传 输 出 参 数 来 改 变 传 入 的 参 数 的 值。在C#中 可 以 编 写 如 下 所 示 的 代
码 ， 但 是 在Java中 却 做 不 到 。

usingSystem;

namespaceCS01{

```
classProgram{
publicstaticvoidswap(refintx,refinty){
inttemp=x;
x=y;
y=temp;
}
```

```
publicstaticvoidMain(string[]args){
inta=5,b=10;
swap(refa,refb);
//a=10,b=5;
```

Console.WriteLine("a={0},b={1}",a,b);
}
}
}

说 明：Java中 没 有 传 引 用 实 在 是 非 常 的 不 方 便，这 一 点 在Java 8 中 仍 然 没 有 得 到
改 进 ， 正 是 如 此 在Java编 写 的 代 码 中 才 会 出 现 大 量 的Wrapper类 （ 将 需 要 通 过
方 法 调 用 修 改 的 引 用 置 于 一 个Wrapper类 中 ， 再 将Wrapper对 象 传 入 方 法 ） ，
这 样 的 做 法 只 会 让 代 码 变 得 臃 肿 ， 尤 其 是 让 从C和C++转 型 为Java程 序 员 的 开
发 者 无 法 容 忍 。

### 19 、String和StringBuilder、StringBuffer的区别？

#### 答 ：

Java平 台 提 供 了 两 种 类 型 的 字 符 串 ：String和StringBuffer/StringBuilder， 它
们 可 以 储 存 和 操 作 字 符 串。其 中String是 只 读 字 符 串，也 就 意 味 着String引 用 的
字 符 串 内 容 是 不 能 被 改 变 的。而StringBuffer/StringBuilder类 表 示 的 字 符 串 对 象
可 以 直 接 进 行 修 改 。StringBuilder是Java 5 中 引 入 的 ， 它 和StringBuffer的 方
法 完 全 相 同 ， 区 别 在 于 它 是 在 单 线 程 环 境 下 使 用 的 ， 因 为 它 的 所 有 方 面 都 没 有被
synchronized修 饰 ， 因 此 它 的 效 率 也 比StringBuffer要 高 。

#### 面 试 题 1 - 什 么 情 况 下 用+运 算 符 进 行 字 符 串 连 接 比 调用

StringBuffer/StringBuilder对 象 的append方 法 连 接 字 符 串 性 能 更 好 ？
**面 试 题 2** - 请 说 出 下 面 程 序 的 输 出 。

classStringEqualTest{

```
publicstaticvoidmain(String[]args){
Strings1="Programming";
```

Strings2=newString("Programming");
Strings3="Program";
Strings4="ming";
Strings5="Program"+"ming";
Strings6=s3+s4;
System.out.println(s1==s2);
System.out.println(s1==s5);
System.out.println(s1==s6);
System.out.println(s1==s6.intern());
System.out.println(s2==s2.intern());
}
}

补 充：解 答 上 面 的 面 试 题 需 要 清 除 两 点：1.String对 象 的intern方 法 会 得 到 字 符
串 对 象 在 常 量 池 中 对 应 的 版 本 的 引 用 （ 如 果 常 量 池 中 有 一 个 字 符 串 与String对 象
的equals结 果 是true），如 果 常 量 池 中 没 有 对 应 的 字 符 串，则 该 字 符 串 将 被 添 加
到 常 量 池 中 ， 然 后 返 回 常 量 池 中 字 符 串 的 引 用 ；2. 字 符 串 的+操 作 其 本 质 是 创 建
了StringBuilder对 象 进 行append操 作，然 后 将 拼 接 后 的StringBuilder对 象用
toString方 法 处 理 成String对 象，这 一 点 可 以 用javap-cStringEqualTest.class
命 令 获 得class文 件 对 应 的JVM字 节 码 指 令 就 可 以 看 出 来 。

### 20 、重载（Overload）和重写（Override）的区别。重载的

### 方法能否根据返回类型进行区分？

#### 答 ：

#### 方 法 的 重 载 和 重 写 都 是 实 现 多 态 的 方 式，区 别 在 于 前 者 实 现 的 是 编 译 时 的 多 态 性，

#### 而 后 者 实 现 的 是 运 行 时 的 多 态 性 。 重 载 发 生 在 一 个 类 中 ， 同 名 的 方 法 如 果 有 不 同

#### 的 参 数 列 表 （ 参 数 类 型 不 同 、 参 数 个 数 不 同 或 者 二 者 都 不 同 ） 则 视 为 重 载 ； 重 写


#### 发 生 在 子 类 与 父 类 之 间 ， 重 写 要 求 子 类 被 重 写 方 法 与 父 类 被 重 写 方 法 有 相 同 的 返

#### 回 类 型，比 父 类 被 重 写 方 法 更 好 访 问，不 能 比 父 类 被 重 写 方 法 声 明 更 多 的 异 常（里

#### 氏 代 换 原 则 ） 。 重 载 对 返 回 类 型 没 有 特 殊 的 要 求 。

#### 面 试 题： 华 为 的 面 试 题 中 曾 经 问 过 这 样 一 个 问 题 - “为 什 么 不 能 根 据 返 回 类 型 来

#### 区 分 重 载”， 快 说 出 你 的 答 案 吧 ！

### 21 、描述一下JVM加载class文件的原理机制？

#### 答 ：

JVM中 类 的 装 载 是 由 类 加 载 器 （ClassLoader） 和 它 的 子 类 来 实 现 的 ，Java中 的
类 加 载 器 是 一 个 重 要 的Java运 行 时 系 统 组 件，它 负 责 在 运 行 时 查 找 和 装 入 类 文 件
中 的 类 。
由 于Java的 跨 平 台 性 ， 经 过 编 译 的Java源 程 序 并 不 是 一 个 可 执 行 程 序 ， 而 是 一
个 或 多 个 类 文 件。当Java程 序 需 要 使 用 某 个 类 时，JVM会 确 保 这 个 类 已 经 被 加 载、
连 接（验 证、准 备 和 解 析）和 初 始 化。类 的 加 载 是 指 把 类 的.class文 件 中 的 数 据 读
入 到 内 存 中，通 常 是 创 建 一 个 字 节 数 组 读 入.class文 件，然 后 产 生 与 所 加 载 类 对 应
的Class对 象。加 载 完 成 后，Class对 象 还 不 完 整，所 以 此 时 的 类 还 不 可 用。当 类
被 加 载 后 就 进 入 连 接 阶 段 ， 这 一 阶 段 包 括 验 证 、 准 备 （ 为 静 态 变 量 分 配 内 存 并 设
置 默 认 的 初 始 值）和 解 析（将 符 号 引 用 替 换 为 直 接 引 用）三 个 步 骤。最 后JVM对
类 进 行 初 始 化，包 括：1)如 果 类 存 在 直 接 的 父 类 并 且 这 个 类 还 没 有 被 初 始 化，那 么
就 先 初 始 化 父 类 ；2)如 果 类 中 存 在 初 始 化 语 句 ， 就 依 次 执 行 这 些 初 始 化 语 句 。
类 的 加 载 是 由 类 加 载 器 完 成 的，类 加 载 器 包 括：根 加 载 器（BootStrap）、扩 展 加
载 器 （Extension） 、 系 统 加 载 器 （System） 和 用 户 自 定 义 类 加 载 器
（java.lang.ClassLoader的 子 类 ） 。 从Java 2 （JDK1.2） 开 始 ， 类 加 载 过 程 采
取 了 父 亲 委 托 机 制 （PDM） 。PDM更 好 的 保 证 了Java平 台 的 安 全 性 ， 在 该 机 制
中 ，JVM自 带 的Bootstrap是 根 加 载 器 ， 其 他 的 加 载 器 都 有 且 仅 有 一 个 父 类 加 载
器 。 类 的 加 载 首 先 请 求 父 类 加 载 器 加 载 ， 父 类 加 载 器 无 能 为 力 时 才 由 其 子 类 加 载


```
器 自 行 加 载。JVM不 会 向Java程 序 提 供 对Bootstrap的 引 用。下 面 是 关 于 几 个 类
加 载 器 的 说 明 ：
```

 Bootstrap：一般用本地代码实现，负责加载JVM基础核心类库（rt.jar）；
 Extension：从java.ext.dirs系统属性所指定的目录中加载类库，它的父
加载器是Bootstrap；
 System：又叫应用类加载器，其父类是Extension。它是应用最广泛的
类加载器。它从环境变量classpath或者系统属性java.class.path所指定的目
录中记载类，是用户自定义加载器的默认父加载器。

### 22 、char 型变量中能不能存贮一个中文汉字，为什么？

#### 答 ：

```
char类 型 可 以 存 储 一 个 中 文 汉 字 ， 因 为Java中 使 用 的 编 码 是Unicode（ 不 选 择
任 何 特 定 的 编 码 ， 直 接 使 用 字 符 在 字 符 集 中 的 编 号 ， 这 是 统 一 的 唯 一 方 法 ） ， 一
个char类 型 占 2 个 字 节 （ 16 比 特 ） ， 所 以 放 一 个 中 文 是 没 问 题 的 。
```

```
补 充 ： 使 用Unicode意 味 着 字 符 在JVM内 部 和 外 部 有 不 同 的 表 现 形 式 ， 在JVM
内 部 都 是Unicode，当 这 个 字 符 被 从JVM内 部 转 移 到 外 部 时（例 如 存 入 文 件 系 统
中），需 要 进 行 编 码 转 换。所 以Java中 有 字 节 流 和 字 符 流，以 及 在 字 符 流 和 字 节
流 之 间 进 行 转 换 的 转 换 流 ， 如InputStreamReader和OutputStreamReader，
这 两 个 类 是 字 节 流 和 字 符 流 之 间 的 适 配 器 类 ， 承 担 了 编 码 转 换 的 任 务 ； 对 于C程
序 员 来 说 ， 要 完 成 这 样 的 编 码 转 换 恐 怕 要 依 赖 于union（ 联 合 体/共 用 体 ） 共 享 内
存 的 特 征 来 实 现 了 。
```

### 23 、抽象类（abstractclass）和接口（interface）有什么异

### 同？

#### 答 ：

#### 抽 象 类 和 接 口 都 不 能 够 实 例 化 ， 但 可 以 定 义 抽 象 类 和 接 口 类 型 的 引 用 。 一 个 类 如

#### 果 继 承 了 某 个 抽 象 类 或 者 实 现 了 某 个 接 口 都 需 要 对 其 中 的 抽 象 方 法 全 部 进 行 实

#### 现 ， 否 则 该 类 仍 然 需 要 被 声 明 为 抽 象 类 。 接 口 比 抽 象 类 更 加 抽 象 ， 因 为 抽 象 类 中

#### 可 以 定 义 构 造 器 ， 可 以 有 抽 象 方 法 和 具 体 方 法 ， 而 接 口 中 不 能 定 义 构 造 器 而 且 其

中 的 方 法 全 部 都 是 抽 象 方 法。抽 象 类 中 的 成 员 可 以 是private、默 认、protected、
public的，而 接 口 中 的 成 员 全 都 是public的。抽 象 类 中 可 以 定 义 成 员 变 量，而 接
口 中 定 义 的 成 员 变 量 实 际 上 都 是 常 量 。 有 抽 象 方 法 的 类 必 须 被 声 明 为 抽 象 类 ， 而
抽 象 类 未 必 要 有 抽 象 方 法 。

### 24 、静态嵌套类(StaticNestedClass)和内部类（InnerClass）

### 的不同？

#### 答 ：

StaticNestedClass是 被 声 明 为 静 态（static）的 内 部 类，它 可 以 不 依 赖 于 外 部 类
实 例 被 实 例 化 。 而 通 常 的 内 部 类 需 要 在 外 部 类 实 例 化 后 才 能 实 例 化 ， 其 语 法 看 起
来 挺 诡 异 的 ， 如 下 所 示 。

/**

* 扑克类（一副扑克）
  *@author骆昊
  *


*/
publicclassPoker{
privatestaticString[]suites={"黑桃","红桃","草花","方块"};
privatestaticint[]faces={1,2,3,4,5,6,7,8,9,10,11,12,13};

privateCard[]cards;

```
/**
* 构造器
*
*/
publicPoker(){
cards=newCard[52];
for(inti=0;i<suites.length;i++){
for(intj=0;j<faces.length;j++){
cards[i* 13 +j]=newCard(suites[i],faces[j]);
}
}
}
```

```
/**
* 洗牌 （随机乱序）
*
*/
publicvoidshuffle(){
for(inti=0,len=cards.length;i<len;i++){
intindex=(int)(Math.random()*len);
Cardtemp=cards[index];
cards[index]=cards[i];
cards[i]=temp;
}
```

}

/**

* 发牌
  *@paramindex 发牌的位置
  *
  */
  publicCarddeal(intindex){
  returncards[index];
  }

/**

* 卡片类（一张扑克）
  *[内部类]
  *@author骆昊
  *
  */
  publicclassCard{
  privateStringsuite; // 花色
  privateintface; // 点数

```
publicCard(Stringsuite,intface){
this.suite=suite;
this.face=face;
}
```

```
@Override
publicStringtoString(){
StringfaceStr="";
switch(face){
case1:faceStr="A";break;
```

case11:faceStr="J";break;
case12:faceStr="Q";break;
case13:faceStr="K";break;
default:faceStr=String.valueOf(face);
}
returnsuite+faceStr;
}
}
}

测 试 代 码 ：

classPokerTest{

```
publicstaticvoidmain(String[]args){
Pokerpoker=newPoker();
poker.shuffle(); // 洗牌
Poker.Cardc1=poker.deal(0); // 发第一张牌
// 对于非静态内部类Card
// 只有通过其外部类Poker对象才能创建Card对象
Poker.Cardc2=poker.newCard("红心",1); // 自己创建一张牌
```

System.out.println(c1); // 洗牌后的第一张
System.out.println(c2); // 打印: 红心A
}
}

面 试 题 - 下 面 的 代 码 哪 些 地 方 会 产 生 编 译 错 误 ？

classOuter{


classInner{}

publicstaticvoidfoo(){newInner();}

publicvoidbar(){newInner();}

publicstaticvoidmain(String[]args){
newInner();
}
}

注 意：Java中 非 静 态 内 部 类 对 象 的 创 建 要 依 赖 其 外 部 类 对 象，上 面 的 面 试 题 中foo
和main方 法 都 是 静 态 方 法，静 态 方 法 中 没 有this，也 就 是 说 没 有 所 谓 的 外 部 类 对
象 ， 因 此 无 法 创 建 内 部 类 对 象 ， 如 果 要 在 静 态 方 法 中 创 建 内 部 类 对 象 ， 可 以 这 样
做 ：

newOuter().newInner();

### 25 、Java 中会存在内存泄漏吗，请简单描述。

#### 答 ：

理 论 上Java因 为 有 垃 圾 回 收 机 制 （GC） 不 会 存 在 内 存 泄 露 问 题 （ 这 也 是Java被
广 泛 使 用 于 服 务 器 端 编 程 的 一 个 重 要 原 因 ） ； 然 而 在 实 际 开 发 中 ， 可 能 会 存 在 无
用 但 可 达 的 对 象，这 些 对 象 不 能 被GC回 收，因 此 也 会 导 致 内 存 泄 露 的 发 生。例如
Hibernate的Session（一 级 缓 存）中 的 对 象 属 于 持 久 态，垃 圾 回 收 器 是 不 会 回 收
这 些 对 象 的，然 而 这 些 对 象 中 可 能 存 在 无 用 的 垃 圾 对 象，如 果 不 及 时 关 闭（close）
或 清 空 （flush） 一 级 缓 存 就 可 能 导 致 内 存 泄 露 。 下 面 例 子 中 的 代 码 也 会 导 致 内 存
泄 露 。


importjava.util.Arrays;
importjava.util.EmptyStackException;

publicclassMyStack<T>{
privateT[]elements;
privateintsize=0;

privatestaticfinalintINIT_CAPACITY=16;

```
publicMyStack(){
elements=(T[])newObject[INIT_CAPACITY];
}
```

```
publicvoidpush(Telem){
ensureCapacity();
elements[size++]=elem;
}
```

```
publicTpop(){
if(size==0)
thrownewEmptyStackException();
returnelements[--size];
}
```

privatevoidensureCapacity(){
if(elements.length==size){
elements=Arrays.copyOf(elements, 2 *size+1);
}
}
}


#### 上 面 的 代 码 实 现 了 一 个 栈 （ 先 进 后 出 （FILO） ） 结 构 ， 乍 看 之 下 似 乎 没 有 什 么 明

显 的 问 题 ， 它 甚 至 可 以 通 过 你 编 写 的 各 种 单 元 测 试 。 然 而 其 中 的pop方 法 却 存 在
内 存 泄 露 的 问 题 ， 当 我 们 用pop方 法 弹 出 栈 中 的 对 象 时 ， 该 对 象 不 会 被 当 作 垃 圾
回 收 ， 即 使 使 用 栈 的 程 序 不 再 引 用 这 些 对 象 ， 因 为 栈 内 部 维 护 着 对 这 些 对 象 的 过
期 引 用（obsoletereference）。在 支 持 垃 圾 回 收 的 语 言 中，内 存 泄 露 是 很 隐 蔽 的，
这 种 内 存 泄 露 其 实 就 是 无 意 识 的 对 象 保 持 。 如 果 一 个 对 象 引 用 被 无 意 识 的 保 留 起
来 了 ， 那 么 垃 圾 回 收 器 不 会 处 理 这 个 对 象 ， 也 不 会 处 理 该 对 象 引 用 的 其 他 对 象 ，
即 使 这 样 的 对 象 只 有 少 数 几 个，也 可 能 会 导 致 很 多 的 对 象 被 排 除 在 垃 圾 回 收 之 外，
从 而 对 性 能 造 成 重 大 影 响，极 端 情 况 下 会 引 发DiskPaging（物 理 内 存 与 硬 盘 的 虚
拟 内 存 交 换 数 据 ） ， 甚 至 造 成OutOfMemoryError。

### 26 、抽象的（abstract）方法是否可同时是静态的（static）,

### 是否可同时是本地方法（native），是否可同时被synchronized

### 修饰？

#### 答 ：

#### 都 不 能 。 抽 象 方 法 需 要 子 类 重 写 ， 而 静 态 的 方 法 是 无 法 被 重 写 的 ， 因 此 二 者 是 矛

#### 盾 的 。 本 地 方 法 是 由 本 地 代 码 （ 如C代 码 ） 实 现 的 方 法 ， 而 抽 象 方 法 是 没 有 实 现

的，也 是 矛 盾 的。synchronized和 方 法 的 实 现 细 节 有 关，抽 象 方 法 不 涉 及 实 现 细
节 ， 因 此 也 是 相 互 矛 盾 的 。

### 27 、阐述静态变量和实例变量的区别。

#### 答 ：


静 态 变 量 是 被static修 饰 符 修 饰 的 变 量 ， 也 称 为 类 变 量 ， 它 属 于 类 ， 不 属 于 类 的
任 何 一 个 对 象 ， 一 个 类 不 管 创 建 多 少 个 对 象 ， 静 态 变 量 在 内 存 中 有 且 仅 有 一 个 拷
贝；实 例 变 量 必 须 依 存 于 某 一 实 例，需 要 先 创 建 对 象 然 后 通 过 对 象 才 能 访 问 到 它。
静 态 变 量 可 以 实 现 让 多 个 对 象 共 享 内 存 。

**补 充 ：** 在Java开 发 中 ， 上 下 文 类 和 工 具 类 中 通 常 会 有 大 量 的 静 态 成 员 。

### 28 、是否可以从一个静态（static）方法内部发出对非静态

### （non-static）方法的调用？

#### 答 ：

#### 不 可 以 ， 静 态 方 法 只 能 访 问 静 态 成 员 ， 因 为 非 静 态 方 法 的 调 用 要 先 创 建 对 象 ， 在

#### 调 用 静 态 方 法 时 可 能 对 象 并 没 有 被 初 始 化 。

### 29 、如何实现对象克隆？

#### 答 ：

#### 有 两 种 方 式 ：

1). 实 现Cloneable接 口 并 重 写Object类 中 的clone()方 法 ；
2). 实 现Serializable接 口，通 过 对 象 的 序 列 化 和 反 序 列 化 实 现 克 隆，可 以 实 现 真
正 的 深 度 克 隆 ， 代 码 如 下 。

importjava.io.ByteArrayInputStream;
importjava.io.ByteArrayOutputStream;
importjava.io.ObjectInputStream;
importjava.io.ObjectOutputStream;


importjava.io.Serializable;

publicclassMyUtil{

```
privateMyUtil(){
thrownewAssertionError();
}
```

@SuppressWarnings("unchecked")
publicstatic<TextendsSerializable>Tclone(Tobj)throws
Exception{
ByteArrayOutputStreambout=newByteArrayOutputStream();
ObjectOutputStreamoos=newObjectOutputStream(bout);
oos.writeObject(obj);

ByteArrayInputStreambin=new
ByteArrayInputStream(bout.toByteArray());
ObjectInputStreamois=newObjectInputStream(bin);
return(T)ois.readObject();

// 说明：调用ByteArrayInputStream或ByteArrayOutputStream
对象的close方法没有任何意义
// 这两个基于内存的流只要垃圾回收器清理对象就能够释放资源，这
一点不同于对外部资源（如文件流）的释放
}
}

下 面 是 测 试 代 码 ：

importjava.io.Serializable;


/**

* 人类
  *@author骆昊
  *
  */
  classPersonimplementsSerializable{
  privatestaticfinallongserialVersionUID=-9102017020286042305L;

```
privateStringname; // 姓名
privateintage; // 年龄
privateCarcar; // 座驾
```

```
publicPerson(Stringname,intage,Carcar){
this.name=name;
this.age=age;
this.car=car;
}
```

```
publicStringgetName(){
returnname;
}
```

```
publicvoidsetName(Stringname){
this.name=name;
}
```

```
publicintgetAge(){
returnage;
}
```

publicvoidsetAge(intage){


```
this.age=age;
}
```

```
publicCargetCar(){
returncar;
}
```

```
publicvoidsetCar(Carcar){
this.car=car;
}
```

@Override
publicStringtoString(){
return"Person[name="+name+",age="+age+",car="+
car+"]";
}

}

/**

* 小汽车类
  *@author骆昊
  *
  */
  classCarimplementsSerializable{
  privatestaticfinallongserialVersionUID=-5713945027627603702L;

```
privateStringbrand; // 品牌
privateintmaxSpeed; // 最高时速
```

publicCar(Stringbrand,intmaxSpeed){


```
this.brand=brand;
this.maxSpeed=maxSpeed;
}
```

```
publicStringgetBrand(){
returnbrand;
}
```

```
publicvoidsetBrand(Stringbrand){
this.brand=brand;
}
```

```
publicintgetMaxSpeed(){
returnmaxSpeed;
}
```

```
publicvoidsetMaxSpeed(intmaxSpeed){
this.maxSpeed=maxSpeed;
}
```

@Override
publicStringtoString(){
return"Car[brand="+brand+",maxSpeed="+maxSpeed+
"]";
}

}

classCloneTest{

publicstaticvoidmain(String[]args){


try{
Personp1=newPerson("HaoLUO",33,newCar("Benz",
300));
Personp2=MyUtil.clone(p1); // 深度克隆
p2.getCar().setBrand("BYD");
// 修改克隆的Person对象p2关联的汽车对象的品牌属性
// 原来的Person对象p1关联的汽车不会受到任何影响
// 因为在克隆Person对象时其关联的汽车对象也被克隆了
System.out.println(p1);
}catch(Exceptione){
e.printStackTrace();
}
}
}

**注 意 ：** 基 于 序 列 化 和 反 序 列 化 实 现 的 克 隆 不 仅 仅 是 深 度 克 隆 ， 更 重 要 的 是 通 过 泛
型 限 定 ， 可 以 检 查 出 要 克 隆 的 对 象 是 否 支 持 序 列 化 ， 这 项 检 查 是 编 译 器 完 成 的 ，
不 是 在 运 行 时 抛 出 异 常，这 种 是 方 案 明 显 优 于 使 用Object类 的clone方 法 克 隆 对
象 。 让 问 题 在 编 译 的 时 候 暴 露 出 来 总 是 好 过 把 问 题 留 到 运 行 时 。

### 30 、GC是什么？为什么要有GC？

#### 答 ：

#### GC是 垃 圾 收 集 的 意 思，内 存 处 理 是 编 程 人 员 容 易 出 现 问 题 的 地 方，忘 记 或 者 错 误

的 内 存 回 收 会 导 致 程 序 或 系 统 的 不 稳 定 甚 至 崩 溃 ，Java提 供 的GC功 能 可 以 自 动
监 测 对 象 是 否 超 过 作 用 域 从 而 达 到 自 动 回 收 内 存 的 目 的 ，Java语 言 没 有 提 供 释 放
已 分 配 内 存 的 显 示 操 作 方 法 。Java程 序 员 不 用 担 心 内 存 管 理 ， 因 为 垃 圾 收 集 器 会
自 动 进 行 管 理 。 要 请 求 垃 圾 收 集 ， 可 以 调 用 下 面 的 方 法 之 一 ：System.gc() 或
Runtime.getRuntime().gc() ， 但JVM可 以 屏 蔽 掉 显 示 的 垃 圾 回 收 调 用 。


#### 垃 圾 回 收 可 以 有 效 的 防 止 内 存 泄 露 ， 有 效 的 使 用 可 以 使 用 的 内 存 。 垃 圾 回 收 器 通

#### 常 是 作 为 一 个 单 独 的 低 优 先 级 的 线 程 运 行 ， 不 可 预 知 的 情 况 下 对 内 存 堆 中 已 经 死

#### 亡 的 或 者 长 时 间 没 有 使 用 的 对 象 进 行 清 除 和 回 收 ， 程 序 员 不 能 实 时 的 调 用 垃 圾 回

```
收 器 对 某 个 对 象 或 所 有 对 象 进 行 垃 圾 回 收 。 在Java诞 生 初 期 ， 垃 圾 回 收 是Java
最 大 的 亮 点 之 一 ， 因 为 服 务 器 端 的 编 程 需 要 有 效 的 防 止 内 存 泄 露 问 题 ， 然 而 时 过
境 迁，如 今Java的 垃 圾 回 收 机 制 已 经 成 为 被 诟 病 的 东 西。移 动 智 能 终 端 用 户 通 常
觉 得iOS的 系 统 比Android系 统 有 更 好 的 用 户 体 验，其 中 一 个 深 层 次 的 原 因 就 在
于Android系 统 中 垃 圾 回 收 的 不 可 预 知 性 。
```

#### 补 充 ： 垃 圾 回 收 机 制 有 很 多 种 ， 包 括 ： 分 代 复 制 垃 圾 回 收 、 标 记 垃 圾 回 收 、 增 量

```
垃 圾 回 收 等 方 式。标 准 的Java进 程 既 有 栈 又 有 堆。栈 保 存 了 原 始 型 局 部 变 量，堆
保 存 了 要 创 建 的 对 象 。Java平 台 对 堆 内 存 回 收 和 再 利 用 的 基 本 算 法 被 称 为 标 记 和
清 除，但 是Java对 其 进 行 了 改 进，采 用“分 代 式 垃 圾 收 集”。这 种 方 法 会 跟Java
对 象 的 生 命 周 期 将 堆 内 存 划 分 为 不 同 的 区 域 ， 在 垃 圾 收 集 过 程 中 ， 可 能 会 将 对 象
移 动 到 不 同 区 域 ：
```

 伊甸园（Eden）：这是对象最初诞生的区域，并且对大多数对象来说，
这里是它们唯一存在过的区域。
 幸存者乐园（Survivor）：从伊甸园幸存下来的对象会被挪到这里。
 终身颐养园（Tenured）：这是足够老的幸存对象的归宿。年轻代收集
（Minor-GC）过程是不会触及这个地方的。当年轻代收集不能把对象放进终身
颐养园时，就会触发一次完全收集（Major-GC），这里可能还会牵扯到压缩，
以便为大对象腾出足够的空间。

#### 与 垃 圾 回 收 相 关 的JVM参 数 ：

 -Xms/-Xmx — 堆的初始大小 / 堆的最大大小
 -Xmn —堆中年轻代的大小
 -XX:-DisableExplicitGC — 让System.gc()不产生任何作用
 -XX:+PrintGCDetails — 打印GC的细节


 -XX:+PrintGCDateStamps — 打印GC操作的时间戳
 -XX:NewSize/XX:MaxNewSize— 设置新生代大小/新生代最大大小
 -XX:NewRatio — 可以设置老生代和新生代的比例
 -XX:PrintTenuringDistribution — 设置每次新生代GC后输出幸存者
乐园中对象年龄的分布
 -XX:InitialTenuringThreshold/-XX:MaxTenuringThreshold：设置老
年代阀值的初始值和最大值
 -XX:TargetSurvivorRatio：设置幸存区的目标使用率

### 31 、Strings=newString(“xyz”);创建了几个字符串对象？

#### 答 ：

```
两 个 对 象 ， 一 个 是 静 态 区 的”xyz”， 一 个 是 用new创 建 在 堆 上 的 对 象 。
```

### 32 、接口是否可继承（extends）接口？抽象类是否可实现

### （implements）接口？抽象类是否可继承具体类（concrete

### class）？

#### 答 ：

```
接 口 可 以 继 承 接 口 ， 而 且 支 持 多 重 继 承 。 抽 象 类 可 以 实 现(implements)接 口 ， 抽
象 类 可 继 承 具 体 类 也 可 以 继 承 抽 象 类 。
```

### 33 、一个”.java”源文件中是否可以包含多个类（不是内部类）？

### 有什么限制？

#### 答 ：

可 以 ， 但 一 个 源 文 件 中 最 多 只 能 有 一 个 公 开 类 （publicclass） 而 且 文 件 名 必 须 和
公 开 类 的 类 名 完 全 保 持 一 致 。

### 34 、AnonymousInnerClass(匿名内部类)是否可以继承其它

### 类？是否可以实现接口？

#### 答 ：

可 以 继 承 其 他 类 或 实 现 其 他 接 口，在Swing编 程 和Android开 发 中 常 用 此 方 式 来
实 现 事 件 监 听 和 回 调 。

### 35 、内部类可以引用它的包含类（外部类）的成员吗？有没有

### 什么限制？

#### 答 ：

#### 一 个 内 部 类 对 象 可 以 访 问 创 建 它 的 外 部 类 对 象 的 成 员 ， 包 括 私 有 成 员 。

### 36 、Java 中的final关键字有哪些用法？


#### 答 ：

#### (1)修 饰 类：表 示 该 类 不 能 被 继 承；(2)修 饰 方 法：表 示 方 法 不 能 被 重 写；(3)修 饰 变

#### 量 ： 表 示 变 量 只 能 一 次 赋 值 以 后 值 不 能 被 修 改 （ 常 量 ） 。

### 37 、指出下面程序的运行结果

classA{

```
static{
System.out.print("1");
}
```

publicA(){
System.out.print("2");
}
}

classBextendsA{

```
static{
System.out.print("a");
}
```

publicB(){
System.out.print("b");
}
}


publicclassHello{

```
publicstaticvoidmain(String[]args){
Aab=newB();
ab=newB();
}
```

}

```
答 ：
```

```
执 行 结 果：1a2b2b。创 建 对 象 时 构 造 器 的 调 用 顺 序 是：先 初 始 化 静 态 成 员，然 后
调 用 父 类 构 造 器 ， 再 初 始 化 非 静 态 成 员 ， 最 后 调 用 自 身 构 造 器 。
```

```
提 示 ： 如 果 不 能 给 出 此 题 的 正 确 答 案 ， 说 明 之 前 第 21 题Java类 加 载 机 制 还 没 有
完 全 理 解 ， 赶 紧 再 看 看 吧 。
```

### 38 、数据类型之间的转换：

 如何将字符串转换为基本数据类型？
 如何将基本数据类型转换为字符串？

#### 答 ：

 调用基本数据类型对应的包装类中的方法parseXXX(String)或
valueOf(String)即可返回相应基本类型；


 一种方法是将基本数据类型与空字符串（”“）连接（+）即可获得其所
对应的字符串；另一种方法是调用String 类中的valueOf()方法返回相应字符
串

## 39 、如何实现字符串的反转及替换？...................................................

#### 答 ：

```
方 法 很 多 ， 可 以 自 己 写 实 现 也 可 以 使 用String或StringBuffer/StringBuilder中
的 方 法 。 有 一 道 很 常 见 的 面 试 题 是 用 递 归 实 现 字 符 串 反 转 ， 代 码 如 下 所 示 ：
```

```
publicstaticStringreverse(StringoriginStr){
if(originStr==null||originStr.length()<=1)
returnoriginStr;
returnreverse(originStr.substring(1))+originStr.charAt(0);
}
```

### 40 、怎样将GB2312编码的字符串转换为ISO-8859-1编码的

### 字符串？

#### 答 ：

#### 代 码 如 下 所 示 ：

```
Strings1="你好";
Strings2=newString(s1.getBytes("GB2312"),"ISO-8859-1");
```

## 41 、日期和时间：...................................................................................

 如何取得年月日、小时分钟秒？
 如何取得从 1970 年 1 月 1 日 0 时 0 分 0 秒到现在的毫秒数？
 如何取得某月的最后一天？
 如何格式化日期？

#### 答 ：

```
问 题 1 ： 创 建java.util.Calendar 实 例 ， 调 用 其get()方 法 传 入 不 同 的 参 数 即 可 获
得 参 数 所 对 应 的 值。Java 8 中 可 以 使 用java.time.LocalDateTimel来 获 取，代 码
如 下 所 示 。
```

```
publicclassDateTimeTest{
publicstaticvoidmain(String[]args){
Calendarcal=Calendar.getInstance();
System.out.println(cal.get(Calendar.YEAR));
System.out.println(cal.get(Calendar.MONTH)); // 0 - 11
System.out.println(cal.get(Calendar.DATE));
System.out.println(cal.get(Calendar.HOUR_OF_DAY));
System.out.println(cal.get(Calendar.MINUTE));
System.out.println(cal.get(Calendar.SECOND));
```

```
//Java 8
LocalDateTimedt=LocalDateTime.now();
System.out.println(dt.getYear());
System.out.println(dt.getMonthValue()); // 1 - 12
System.out.println(dt.getDayOfMonth());
System.out.println(dt.getHour());
```

System.out.println(dt.getMinute());
System.out.println(dt.getSecond());
}
}

问 题 2 ： 以 下 方 法 均 可 获 得 该 毫 秒 数 。

Calendar.getInstance().getTimeInMillis();
System.currentTimeMillis();
Clock.systemDefaultZone().millis();//Java 8

问 题 3 ： 代 码 如 下 所 示 。

Calendartime=Calendar.getInstance();
time.getActualMaximum(Calendar.DAY_OF_MONTH);

问 题 4 ： 利 用java.text.DataFormat 的 子 类 （ 如SimpleDateFormat类 ） 中的
format(Date)方 法 可 将 日 期 格 式 化 。Java 8 中 可 以用
java.time.format.DateTimeFormatter来 格 式 化 时 间 日 期 ， 代 码 如 下 所 示 。

importjava.text.SimpleDateFormat;
importjava.time.LocalDate;
importjava.time.format.DateTimeFormatter;
importjava.util.Date;

classDateFormatTest{

publicstaticvoidmain(String[]args){
SimpleDateFormatoldFormatter=new
SimpleDateFormat("yyyy/MM/dd");
Datedate1=newDate();


System.out.println(oldFormatter.format(date1));

//Java 8
DateTimeFormatternewFormatter=
DateTimeFormatter.ofPattern("yyyy/MM/dd");
LocalDatedate2=LocalDate.now();
System.out.println(date2.format(newFormatter));
}
}

补 充：Java的 时 间 日 期API一 直 以 来 都 是 被 诟 病 的 东 西，为 了 解 决 这 一 问 题，Java
8 中 引 入 了 新 的 时 间 日 期API，其 中 包 括LocalDate、LocalTime、LocalDateTime、
Clock、Instant等 类 ， 这 些 的 类 的 设 计 都 使 用 了 不 变 模 式 ， 因 此 是 线 程 安 全 的 设
计。如 果 不 理 解 这 些 内 容，可 以 参 考 我 的 另 一 篇 文 章《关 于Java并 发 编 程 的 总 结
和 思 考 》。

## 42 、打印昨天的当前时刻。...................................................................

#### 答 ：

importjava.util.Calendar;

classYesterdayCurrent{
publicstaticvoidmain(String[]args){
Calendarcal=Calendar.getInstance();
cal.add(Calendar.DATE,-1);
System.out.println(cal.getTime());
}
}


```
在Java 8 中 ， 可 以 用 下 面 的 代 码 实 现 相 同 的 功 能 。
```

importjava.time.LocalDateTime;

classYesterdayCurrent{

```
publicstaticvoidmain(String[]args){
LocalDateTimetoday=LocalDateTime.now();
LocalDateTimeyesterday=today.minusDays(1);
```

```
System.out.println(yesterday);
}
}
```

## 43 、比较一下Java和JavaSciprt。.....................................................

#### 答 ：

```
JavaScript 与Java是 两 个 公 司 开 发 的 不 同 的 两 个 产 品 。Java 是 原Sun
Microsystems公 司 推 出 的 面 向 对 象 的 程 序 设 计 语 言，特 别 适 合 于 互 联 网 应 用 程 序
开 发 ； 而JavaScript是Netscape公 司 的 产 品 ， 为 了 扩 展Netscape浏 览 器 的 功
能 而 开 发 的 一 种 可 以 嵌 入Web页 面 中 运 行 的 基 于 对 象 和 事 件 驱 动 的 解 释 性 语 言。
JavaScript的 前 身 是LiveScript； 而Java的 前 身 是Oak语 言 。
下 面 对 两 种 语 言 间 的 异 同 作 如 下 比 较 ：
```

 基于对象和面向对象：Java是一种真正的面向对象的语言，即使是开发
简单的程序，必须设计对象；JavaScript是种脚本语言，它可以用来制作与网络
无关的，与用户交互作用的复杂软件。它是一种基于对象（Object-Based）和


事件驱动（Event-Driven）的编程语言，因而它本身提供了非常丰富的内部对
象供设计人员使用。
 解释和编译：Java的源代码在执行之前，必须经过编译。JavaScript是
一种解释性编程语言，其源代码不需经过编译，由浏览器解释执行。（目前的浏
览器几乎都使用了JIT（即时编译）技术来提升JavaScript的运行效率）
 强类型变量和类型弱变量：Java采用强类型变量检查，即所有变量在编
译之前必须作声明；JavaScript中变量是弱类型的，甚至在使用变量前可以不作
声明，JavaScript的解释器在运行时检查推断其数据类型。
 代码格式不一样。

```
补 充 ： 上 面 列 出 的 四 点 是 网 上 流 传 的 所 谓 的 标 准 答 案 。 其 实Java和JavaScript
最 重 要 的 区 别 是 一 个 是 静 态 语 言 ， 一 个 是 动 态 语 言 。 目 前 的 编 程 语 言 的 发 展 趋 势
是 函 数 式 语 言 和 动 态 语 言 。 在Java中 类 （class） 是 一 等 公 民 ， 而JavaScript中
函 数（function）是 一 等 公 民，因 此JavaScript支 持 函 数 式 编 程，可 以 使 用Lambda
函 数 和 闭 包（closure），当 然Java 8 也 开 始 支 持 函 数 式 编 程，提 供 了 对Lambda
表 达 式 以 及 函 数 式 接 口 的 支 持 。 对 于 这 类 问 题 ， 在 面 试 的 时 候 最 好 还 是 用 自 己 的
语 言 回 答 会 更 加 靠 谱 ， 不 要 背 网 上 所 谓 的 标 准 答 案 。
```

## 44 、什么时候用断言（assert）？........................................................

#### 答 ：

#### 断 言 在 软 件 开 发 中 是 一 种 常 用 的 调 试 方 式 ， 很 多 开 发 语 言 中 都 支 持 这 种 机 制 。 一

#### 般 来 说 ， 断 言 用 于 保 证 程 序 最 基 本 、 关 键 的 正 确 性 。 断 言 检 查 通 常 在 开 发 和 测 试

#### 时 开 启 。 为 了 保 证 程 序 的 执 行 效 率 ， 在 软 件 发 布 后 断 言 检 查 通 常 是 关 闭 的 。 断 言

```
是 一 个 包 含 布 尔 表 达 式 的 语 句 ， 在 执 行 这 个 语 句 时 假 定 该 表 达 式 为true； 如 果 表
达 式 的 值 为false，那 么 系 统 会 报 告 一 个AssertionError。断 言 的 使 用 如 下 面 的 代
码 所 示 ：
```

assert(a>0);//throwsanAssertionErrorifa<= 0

断 言 可 以 有 两 种 形 式 ：
assertExpression1;
assertExpression1:Expression2;
Expression1 应 该 总 是 产 生 一 个 布 尔 值 。
Expression2 可 以 是 得 出 一 个 值 的 任 意 表 达 式 ； 这 个 值 用 于 生 成 显 示 更 多 调 试 信
息 的 字 符 串 消 息 。

要 在 运 行 时 启 用 断 言，可 以 在 启 动JVM时 使 用-enableassertions或 者-ea标 记。
要 在 运 行 时 选 择 禁 用 断 言 ， 可 以 在 启 动JVM时 使 用-da或 者-disableassertions
标 记。要 在 系 统 类 中 启 用 或 禁 用 断 言，可 使 用-esa或-dsa标 记。还 可 以 在 包 的 基
础 上 启 用 或 者 禁 用 断 言 。

**注 意 ：** 断 言 不 应 该 以 任 何 方 式 改 变 程 序 的 状 态 。 简 单 的 说 ， 如 果 希 望 在 不 满 足 某
些 条 件 时 阻 止 代 码 的 执 行 ， 就 可 以 考 虑 用 断 言 来 阻 止 它 。

## 45 、Error和Exception有什么区别？................................................

#### 答 ：

Error表 示 系 统 级 的 错 误 和 程 序 不 必 处 理 的 异 常，是 恢 复 不 是 不 可 能 但 很 困 难 的 情
况 下 的 一 种 严 重 问 题 ； 比 如 内 存 溢 出 ， 不 可 能 指 望 程 序 能 处 理 这 样 的 情 况 ；
Exception表 示 需 要 捕 捉 或 者 需 要 程 序 进 行 处 理 的 异 常 ， 是 一 种 设 计 或 实 现 问 题；
也 就 是 说 ， 它 表 示 如 果 程 序 运 行 正 常 ， 从 不 会 发 生 的 情 况 。

面 试 题： 2005 年 摩 托 罗 拉 的 面 试 中 曾 经 问 过 这 么 一 个 问 题“Ifaprocessreports
astackoverflowrun-timeerror,what’sthemostpossiblecause?”， 给 了
四 个 选 项a.lackofmemory;b.writeonaninvalidmemoryspace;c.
recursivefunctioncalling;d.arrayindexoutofboundary.Java程 序 在 运 行


时 也 可 能 会 遭 遇StackOverflowError， 这 是 一 个 无 法 恢 复 的 错 误 ， 只 能 重 新 修 改
代 码 了，这 个 面 试 题 的 答 案 是c。如 果 写 了 不 能 迅 速 收 敛 的 递 归，则 很 有 可 能 引 发
栈 溢 出 的 错 误 ， 如 下 所 示 ：

classStackOverflowErrorTest{

publicstaticvoidmain(String[]args){
main(null);
}
}

**提 示：** 用 递 归 编 写 程 序 时 一 定 要 牢 记 两 点：1. 递 归 公 式；2. 收 敛 条 件（什 么 时 候
就 不 再 继 续 递 归 ） 。

### 46 、try{}里有一个return语句，那么紧跟在这个try后的

### finally{}里的代码会不会被执行，什么时候被执行，在return

### 前还是后?

#### 答 ：

#### 会 执 行 ， 在 方 法 返 回 调 用 者 前 执 行 。

**注 意：** 在finally中 改 变 返 回 值 的 做 法 是 不 好 的，因 为 如 果 存 在finally代 码 块，try
中 的return语 句 不 会 立 马 返 回 调 用 者，而 是 记 录 下 返 回 值 待finally代 码 块 执 行 完
毕 之 后 再 向 调 用 者 返 回 其 值 ， 然 后 如 果 在finally中 修 改 了 返 回 值 ， 就 会 返 回 修 改
后 的 值。显 然，在finally中 返 回 或 者 修 改 返 回 值 会 对 程 序 造 成 很 大 的 困 扰，C#中
直 接 用 编 译 错 误 的 方 式 来 阻 止 程 序 员 干 这 种 龌 龊 的 事 情 ，Java中 也 可 以 通 过 提 升


编 译 器 的 语 法 检 查 级 别 来 产 生 警 告 或 错 误，Eclipse中 可 以 在 如 图 所 示 的 地 方 进 行
设 置 ， 强 烈 建 议 将 此 项 设 置 为 编 译 错 误 。

### 47 、Java语言如何进行异常处理，关键字：throws、throw、

### try、catch、finally分别如何使用？

#### 答 ：

Java通 过 面 向 对 象 的 方 法 进 行 异 常 处 理 ， 把 各 种 不 同 的 异 常 进 行 分 类 ， 并 提 供 了
良 好 的 接 口 。 在Java中 ， 每 个 异 常 都 是 一 个 对 象 ， 它 是Throwable类 或 其 子 类
的 实 例。当 一 个 方 法 出 现 异 常 后 便 抛 出 一 个 异 常 对 象，该 对 象 中 包 含 有 异 常 信 息，


```
调 用 这 个 对 象 的 方 法 可 以 捕 获 到 这 个 异 常 并 可 以 对 其 进 行 处 理 。Java的 异 常 处 理
是 通 过 5 个 关 键 词 来 实 现 的 ：try、catch、throw、throws和finally。 一 般 情 况
下 是 用try来 执 行 一 段 程 序，如 果 系 统 会 抛 出（throw）一 个 异 常 对 象，可 以 通 过
它 的 类 型 来 捕 获 （catch） 它 ， 或 通 过 总 是 执 行 代 码 块 （finally） 来 处 理 ；try用
来 指 定 一 块 预 防 所 有 异 常 的 程 序；catch子 句 紧 跟 在try块 后 面，用 来 指 定 你 想 要
捕 获 的 异 常 的 类 型；throw语 句 用 来 明 确 地 抛 出 一 个 异 常；throws用 来 声 明 一 个
方 法 可 能 抛 出 的 各 种 异 常 （ 当 然 声 明 异 常 时 允 许 无 病 呻 吟 ） ；finally为 确 保 一 段
代 码 不 管 发 生 什 么 异 常 状 况 都 要 被 执 行 ；try语 句 可 以 嵌 套 ， 每 当 遇 到 一 个try语
句，异 常 的 结 构 就 会 被 放 入 异 常 栈 中，直 到 所 有 的try语 句 都 完 成。如 果 下 一 级的
try语 句 没 有 对 某 种 异 常 进 行 处 理，异 常 栈 就 会 执 行 出 栈 操 作，直 到 遇 到 有 处 理 这
种 异 常 的try语 句 或 者 最 终 将 异 常 抛 给JVM。
```

## 48 、运行时异常与受检异常有何异同？...............................................

#### 答 ：

#### 异 常 表 示 程 序 运 行 过 程 中 可 能 出 现 的 非 正 常 状 态 ， 运 行 时 异 常 表 示 虚 拟 机 的 通 常

#### 操 作 中 可 能 遇 到 的 异 常 ， 是 一 种 常 见 运 行 错 误 ， 只 要 程 序 设 计 得 没 有 问 题 通 常 就

#### 不 会 发 生 。 受 检 异 常 跟 程 序 运 行 的 上 下 文 环 境 有 关 ， 即 使 程 序 设 计 无 误 ， 仍 然 可

```
能 因 使 用 的 问 题 而 引 发。Java编 译 器 要 求 方 法 必 须 声 明 抛 出 可 能 发 生 的 受 检 异 常，
但 是 并 不 要 求 必 须 声 明 抛 出 未 被 捕 获 的 运 行 时 异 常 。 异 常 和 继 承 一 样 ， 是 面 向 对
象 程 序 设 计 中 经 常 被 滥 用 的 东 西，在Ef f e c ti v eJa v a中 对 异 常 的 使 用 给 出 了 以 下 指
导 原 则 ：
```

 不要将异常处理用于正常的控制流（设计良好的API不应该强迫它的调
用者为了正常的控制流而使用异常）
 对可以恢复的情况使用受检异常，对编程错误使用运行时异常
 避免不必要的使用受检异常（可以通过一些状态检测手段来避免异常的发
生）


 优先使用标准的异常
 每个方法抛出的异常都要有文档
 保持异常的原子性
 不要在catch中忽略掉捕获到的异常

## 49 、列出一些你常见的运行时异常？...................................................

#### 答 ：

 ArithmeticException（算术异常）
 ClassCastException （类转换异常）
 IllegalArgumentException （非法参数异常）
 IndexOutOfBoundsException （下标越界异常）
 NullPointerException （空指针异常）
 SecurityException （安全异常）

## 50 、阐述final、finally、finalize的区别。........................................

#### 答 ：

 final：修饰符（关键字）有三种用法：如果一个类被声明为final，意味
着它不能再派生出新的子类，即不能被继承，因此它和abstract是反义词。将
变量声明为final，可以保证它们在使用中不被改变，被声明为final的变量必须
在声明时给定初值，而在以后的引用中只能读取不可修改。被声明为final的方
法也同样只能使用，不能在子类中被重写。


 finally：通常放在try...catch...的后面构造总是执行代码块，这就意味着
程序无论正常执行还是发生异常，这里的代码只要JVM不关闭都能执行，可以
将释放外部资源的代码写在finally块中。
 finalize：Object类中定义的方法，Java中允许使用finalize()方法在垃
圾收集器将对象从内存中清除出去之前做必要的清理工作。这个方法是由垃圾收
集器在销毁对象时调用的，通过重写finalize()方法可以整理系统资源或者执行
其他清理工作。

## 51 、类ExampleA继承Exception，类ExampleB继承ExampleA。

#### 有 如 下 代 码 片 断 ：

```
try{
thrownewExampleB("b")
}catch（ExampleAe）{
System.out.println("ExampleA");
}catch（Exceptione）{
System.out.println("Exception");
}
```

```
**请 问 执 行 此 段 代 码 的 输 出 是 什 么 ？
```

```
答 ：
```

```
输 出：ExampleA。（根 据 里 氏 代 换 原 则[能 使 用 父 类 型 的 地 方 一 定 能 使 用 子 类 型]，
抓 取ExampleA类 型 异 常 的catch块 能 够 抓 住try块 中 抛 出 的ExampleB类 型 的
异 常 ）
```

**面 试 题** - 说 出 下 面 代 码 的 运 行 结 果 。 （ 此 题 的 出 处 是 《Java编 程 思 想 》 一 书 ）

classAnnoyanceextendsException{}
classSneezeextendsAnnoyance{}

classHuman{

publicstaticvoidmain(String[]args)
throwsException{
try{
try{
thrownewSneeze();
}
catch(Annoyancea){
System.out.println("CaughtAnnoyance");
throwa;
}
}
catch(Sneezes){
System.out.println("CaughtSneeze");
return;
}
finally{
System.out.println("HelloWorld!");
}
}
}

## 52 、List、Set、Map是否继承自Collection接口？.......................


#### 答 ：

List、Set 是，Map 不 是。Map是 键 值 对 映 射 容 器，与List和Set有 明 显 的 区 别，
而Set存 储 的 零 散 的 元 素 且 不 允 许 有 重 复 元 素 （ 数 学 中 的 集 合 也 是 如 此 ） ，List
是 线 性 结 构 的 容 器 ， 适 用 于 按 数 值 索 引 访 问 元 素 的 情 形 。

## 53 、阐述ArrayList、Vector、LinkedList的存储性能和特性。.....

#### 答 ：

ArrayList 和Vector都 是 使 用 数 组 方 式 存 储 数 据 ， 此 数 组 元 素 数 大 于 实 际 存 储 的
数 据 以 便 增 加 和 插 入 元 素 ， 它 们 都 允 许 直 接 按 序 号 索 引 元 素 ， 但 是 插 入 元 素 要 涉
及 数 组 元 素 移 动 等 内 存 操 作 ， 所 以 索 引 数 据 快 而 插 入 数 据 慢 ，Vector中 的 方 法 由
于 添 加 了synchronized修 饰 ， 因 此Vector是 线 程 安 全 的 容 器 ， 但 性 能 上较
ArrayList差 ， 因 此 已 经 是Java中 的 遗 留 容 器 。LinkedList使 用 双 向 链 表 实 现 存
储 （ 将 内 存 中 零 散 的 内 存 单 元 通 过 附 加 的 引 用 关 联 起 来 ， 形 成 一 个 可 以 按 序 号 索
引 的 线 性 结 构 ， 这 种 链 式 存 储 方 式 与 数 组 的 连 续 存 储 方 式 相 比 ， 内 存 的 利 用 率 更
高 ） ， 按 序 号 索 引 数 据 需 要 进 行 前 向 或 后 向 遍 历 ， 但 是 插 入 数 据 时 只 需 要 记 录 本
项 的 前 后 项 即 可，所 以 插 入 速 度 较 快。Vector属 于 遗 留 容 器（Java早 期 的 版 本 中
提 供 的 容 器 ， 除 此 之 外 ，Hashtable、Dictionary、BitSet、Stack、Properties
都 是 遗 留 容 器 ） ， 已 经 不 推 荐 使 用 ， 但 是 由 于ArrayList和LinkedListed都 是 非
线 程 安 全 的 ， 如 果 遇 到 多 个 线 程 操 作 同 一 个 容 器 的 场 景 ， 则 可 以 通 过 工 具类
Collections中的synchronizedList方 法 将 其 转 换 成 线 程 安 全 的 容 器 后 再 使 用（这
是 对 装 潢 模 式 的 应 用 ， 将 已 有 对 象 传 入 另 一 个 类 的 构 造 器 中 创 建 新 的 对 象 来 增 强
实 现 ） 。

**补 充：** 遗 留 容 器 中 的Properties类 和Stack类 在 设 计 上 有 严 重 的 问 题，Properties
是 一 个 键 和 值 都 是 字 符 串 的 特 殊 的 键 值 对 映 射 ， 在 设 计 上 应 该 是 关 联 一个
Hashtable并 将 其 两 个 泛 型 参 数 设 置 为String类 型 ， 但 是JavaAPI中的
Properties直 接 继 承 了Hashtable， 这 很 明 显 是 对 继 承 的 滥 用 。 这 里 复 用 代 码 的


方 式 应 该 是Has-A关 系 而 不 是Is-A关 系，另 一 方 面 容 器 都 属 于 工 具 类，继 承 工 具
类 本 身 就 是 一 个 错 误 的 做 法 ， 使 用 工 具 类 最 好 的 方 式 是Has-A关 系 （ 关 联 ）或
Use-A关 系（依 赖）。同 理，Stack类 继 承Vector也 是 不 正 确 的。Sun公 司 的 工
程 师 们 也 会 犯 这 种 低 级 错 误 ， 让 人 唏 嘘 不 已 。

## 54 、Collection和Collections的区别？............................................

#### 答 ：

Collection是 一 个 接 口 ， 它 是Set、List等 容 器 的 父 接 口 ；Collections是 个 一 个
工 具 类，提 供 了 一 系 列 的 静 态 方 法 来 辅 助 容 器 操 作，这 些 方 法 包 括 对 容 器 的 搜 索、
排 序 、 线 程 安 全 化 等 等 。

## 55 、List、Map、Set三个接口存取元素时，各有什么特点？.........

#### 答 ：

List以 特 定 索 引 来 存 取 元 素，可 以 有 重 复 元 素。Set不 能 存 放 重 复 元 素（用 对 象的
equals()方 法 来 区 分 元 素 是 否 重 复 ） 。Map保 存 键 值 对 （key-valuepair） 映 射，
映 射 关 系 可 以 是 一 对 一 或 多 对 一 。Set和Map容 器 都 有 基 于 哈 希 存 储 和 排 序 树 的
两 种 实 现 版 本 ， 基 于 哈 希 存 储 的 版 本 理 论 存 取 时 间 复 杂 度 为O(1)， 而 基 于 排 序 树
版 本 的 实 现 在 插 入 或 删 除 元 素 时 会 按 照 元 素 或 元 素 的 键（key）构 成 排 序 树 从 而 达
到 排 序 和 去 重 的 效 果 。

### 56 、TreeMap和TreeSet在排序时如何比较元素？

### Collections工具类中的sort()方法如何比较元素？


#### 答 ：

TreeSet要 求 存 放 的 对 象 所 属 的 类 必 须 实 现Comparable接 口 ， 该 接 口 提 供 了 比
较 元 素 的compareTo()方 法 ， 当 插 入 元 素 时 会 回 调 该 方 法 比 较 元 素 的 大 小 。
TreeMap要 求 存 放 的 键 值 对 映 射 的 键 必 须 实现Comparable接 口 从 而 根 据 键 对 元
素 进 行 排 序。Collections工 具 类 的sort方 法 有 两 种 重 载 的 形 式，第 一 种 要 求 传 入
的 待 排 序 容 器 中 存 放 的 对 象 比 较 实 现Comparable接 口 以 实 现 元 素 的 比 较 ； 第 二
种 不 强 制 性 的 要 求 容 器 中 的 元 素 必 须 可 比 较 ， 但 是 要 求 传 入 第 二 个 参 数 ， 参 数是
Comparator接 口 的 子 类 型（需 要 重 写compare方 法 实 现 元 素 的 比 较），相 当 于
一 个 临 时 定 义 的 排 序 规 则 ， 其 实 就 是 通 过 接 口 注 入 比 较 元 素 大 小 的 算 法 ， 也 是 对
回 调 模 式 的 应 用 （Java中 对 函 数 式 编 程 的 支 持 ） 。
例 子 1 ：

publicclassStudentimplementsComparable<Student>{
privateStringname; // 姓名
privateintage; // 年龄

```
publicStudent(Stringname,intage){
this.name=name;
this.age=age;
}
```

```
@Override
publicStringtoString(){
return"Student[name="+name+",age="+age+"]";
}
```

```
@Override
publicintcompareTo(Studento){
returnthis.age-o.age;// 比较年龄(年龄的升序)
}
```

}

importjava.util.Set;
importjava.util.TreeSet;

classTest01{

publicstaticvoidmain(String[]args){
Set<Student>set=newTreeSet<>(); //Java 7 的钻石语法
(构造器后面的尖括号中不需要写类型)
set.add(newStudent("HaoLUO",33));
set.add(newStudent("XJWANG",32));
set.add(newStudent("BruceLEE",60));
set.add(newStudent("BobYANG",22));

for(Studentstu:set){
System.out.println(stu);
}
// 输出结果:
// Student[name=BobYANG,age=22]
// Student[name=XJWANG,age=32]
// Student[name=HaoLUO,age=33]
// Student[name=BruceLEE,age=60]
}
}

例 子 2 ：

publicclassStudent{
privateStringname; // 姓名


privateintage; // 年龄

```
publicStudent(Stringname,intage){
this.name=name;
this.age=age;
}
```

```
/**
* 获取学生姓名
*/
publicStringgetName(){
returnname;
}
```

```
/**
* 获取学生年龄
*/
publicintgetAge(){
returnage;
}
```

```
@Override
publicStringtoString(){
return"Student[name="+name+",age="+age+"]";
}
```

}

importjava.util.ArrayList;
importjava.util.Collections;
importjava.util.Comparator;


importjava.util.List;

classTest02{

publicstaticvoidmain(String[]args){
List<Student>list=newArrayList<>(); //Java 7 的钻石语法
(构造器后面的尖括号中不需要写类型)
list.add(newStudent("HaoLUO",33));
list.add(newStudent("XJWANG",32));
list.add(newStudent("BruceLEE",60));
list.add(newStudent("BobYANG",22));

```
// 通过sort方法的第二个参数传入一个Comparator接口对象
// 相当于是传入一个比较对象大小的算法到sort方法中
// 由于Java中没有函数指针、仿函数、委托这样的概念
// 因此要将一个算法传入一个方法中唯一的选择就是通过接口回调
Collections.sort(list,newComparator<Student>(){
```

@Override
publicintcompare(Studento1,Studento2){
returno1.getName().compareTo(o2.getName()); //
比较学生姓名
}
});

for(Studentstu:list){
System.out.println(stu);
}
// 输出结果:
// Student[name=BobYANG,age=22]
// Student[name=BruceLEE,age=60]


// Student[name=HaoLUO,age=33]
// Student[name=XJWANG,age=32]
}
}

### 57 、Thread类的sleep()方法和对象的wait()方法都可以让线

### 程暂停执行，它们有什么区别?

#### 答 ：

sleep()方 法（休 眠）是 线 程 类（Thread）的 静 态 方 法，调 用 此 方 法 会 让 当 前 线 程
暂 停 执 行 指 定 的 时 间 ， 将 执 行 机 会 （CPU） 让 给 其 他 线 程 ， 但 是 对 象 的 锁 依 然 保
持，因 此 休 眠 时 间 结 束 后 会 自 动 恢 复（线 程 回 到 就 绪 状 态，请 参 考 第 66 题 中 的 线
程 状 态 转 换 图 ） 。wait()是Object类 的 方 法 ， 调 用 对 象 的wait()方 法 导 致 当 前 线
程 放 弃 对 象 的 锁 （ 线 程 暂 停 执 行 ） ， 进 入 对 象 的 等 待 池 （waitpool） ， 只 有 调 用
对 象 的notify()方 法（或notifyAll()方 法）时 才 能 唤 醒 等 待 池 中 的 线 程 进 入 等 锁 池
（lockpool） ， 如 果 线 程 重 新 获 得 对 象 的 锁 就 可 以 进 入 就 绪 状 态 。

**补 充 ：** 可 能 不 少 人 对 什 么 是 进 程 ， 什 么 是 线 程 还 比 较 模 糊 ， 对 于 为 什 么 需 要 多 线
程 编 程 也 不 是 特 别 理 解 。 简 单 的 说 ： 进 程 是 具 有 一 定 独 立 功 能 的 程 序 关 于 某 个 数
据 集 合 上 的 一 次 运 行 活 动 ， 是 操 作 系 统 进 行 资 源 分 配 和 调 度 的 一 个 独 立 单 位 ； 线
程 是 进 程 的 一 个 实 体，是CPU调 度 和 分 派 的 基 本 单 位，是 比 进 程 更 小 的 能 独 立 运
行 的 基 本 单 位 。 线 程 的 划 分 尺 度 小 于 进 程 ， 这 使 得 多 线 程 程 序 的 并 发 性 高 ； 进 程
在 执 行 时 通 常 拥 有 独 立 的 内 存 单 元 ， 而 线 程 之 间 可 以 共 享 内 存 。 使 用 多 线 程 的 编
程 通 常 能 够 带 来 更 好 的 性 能 和 用 户 体 验 ， 但 是 多 线 程 的 程 序 对 于 其 他 程 序 是 不 友
好 的，因 为 它 可 能 占 用 了 更 多 的CPU资 源。当 然，也 不 是 线 程 越 多，程 序 的 性 能
就 越 好 ， 因 为 线 程 之 间 的 调 度 和 切 换 也 会 浪 费CPU时 间 。 时 下 很 时 髦 的Node.js
就 采 用 了 单 线 程 异 步I/O的 工 作 模 式 。


## 58 、线程的sleep()方法和yield()方法有什么区别？........................

#### 答 ：

① sleep()方 法 给 其 他 线 程 运 行 机 会 时 不 考 虑 线 程 的 优 先 级，因 此 会 给 低 优 先 级 的
线 程 以 运 行 的 机 会 ；yield()方 法 只 会 给 相 同 优 先 级 或 更 高 优 先 级 的 线 程 以 运 行 的
机 会 ；
② 线 程 执 行sleep()方 法 后 转 入 阻 塞 （blocked） 状 态 ， 而 执 行yield()方 法 后 转
入 就 绪 （ready） 状 态 ；
③ sleep()方 法 声 明 抛 出InterruptedException， 而yield()方 法 没 有 声 明 任 何 异
常 ；
④ sleep()方 法 比yield()方 法（跟 操 作 系 统CPU调 度 相 关）具 有 更 好 的 可 移 植 性。

### 59 、当一个线程进入一个对象的synchronized方法A之后，

### 其它线程是否可进入此对象的synchronized方法B？

#### 答 ：

#### 不 能 。 其 它 线 程 只 能 访 问 该 对 象 的 非 同 步 方 法 ， 同 步 方 法 则 不 能 进 入 。 因 为 非 静

态 方 法 上 的synchronized修 饰 符 要 求 执 行 方 法 时 要 获 得 对 象 的 锁，如 果 已 经 进入
A方 法 说 明 对 象 锁 已 经 被 取 走 ， 那 么 试 图 进 入B方 法 的 线 程 就 只 能 在 等 锁 池 （ **注
意 不 是 等 待 池 哦** ） 中 等 待 对 象 的 锁 。

## 60 、请说出与线程同步以及线程调度相关的方法。...........................

#### 答 ：


 wait()：使一个线程处于等待（阻塞）状态，并且释放所持有的对象的锁；
 sleep()：使一个正在运行的线程处于睡眠状态，是一个静态方法，调用
此方法要处理InterruptedException异常；
 notify()：唤醒一个处于等待状态的线程，当然在调用此方法的时候，并
不能确切的唤醒某一个等待状态的线程，而是由JVM确定唤醒哪个线程，而且
与优先级无关；
 notityAll()：唤醒所有处于等待状态的线程，该方法并不是将对象的锁给
所有线程，而是让它们竞争，只有获得锁的线程才能进入就绪状态；

```
提 示： 关 于Java多 线 程 和 并 发 编 程 的 问 题，建 议 大 家 看 我 的 另 一 篇 文 章《关 于Java
并 发 编 程 的 总 结 和 思 考 》。
补 充 ：Java 5 通 过Lock接 口 提 供 了 显 式 的 锁 机 制 （explicitlock） ， 增 强 了 灵 活
性 以 及 对 线 程 的 协 调。Lock接 口 中 定 义 了 加 锁（lock()）和 解 锁（unlock()）的 方
法，同 时 还 提 供 了newCondition()方 法 来 产 生 用 于 线 程 之 间 通 信 的Condition对
象 ； 此 外 ，Java 5 还 提 供 了 信 号 量 机 制 （semaphore） ， 信 号 量 可 以 用 来 限 制 对
某 个 共 享 资 源 进 行 访 问 的 线 程 的 数 量 。 在 对 资 源 进 行 访 问 之 前 ， 线 程 必 须 得 到 信
号 量 的 许 可（调 用Semaphore对 象 的acquire()方 法）；在 完 成 对 资 源 的 访 问 后，
线 程 必 须 向 信 号 量 归 还 许 可 （ 调 用Semaphore对 象 的release()方 法 ） 。
```

```
下 面 的 例 子 演 示 了 100 个 线 程 同 时 向 一 个 银 行 账 户 中 存 入 1 元 钱 ， 在 没 有 使 用 同
步 机 制 和 使 用 同 步 机 制 情 况 下 的 执 行 情 况 。
```

 银行账户类：

```
/**
* 银行账户
*@author骆昊
*
*/
```

```
publicclassAccount{
privatedoublebalance; // 账户余额
```

```
/**
* 存款
*@parammoney 存入金额
*/
publicvoiddeposit(doublemoney){
doublenewBalance=balance+money;
try{
Thread.sleep(10); // 模拟此业务需要一段处理时间
}
catch(InterruptedExceptionex){
ex.printStackTrace();
}
balance=newBalance;
}
```

```
/**
* 获得账户余额
*/
publicdoublegetBalance(){
returnbalance;
}
}
```

 存钱线程类：

```
/**
* 存钱线程
```

```
*@author骆昊
*
*/
publicclassAddMoneyThreadimplementsRunnable{
privateAccountaccount; // 存入账户
privatedoublemoney; // 存入金额
```

```
publicAddMoneyThread(Accountaccount,doublemoney){
this.account=account;
this.money=money;
}
```

```
@Override
publicvoidrun(){
account.deposit(money);
}
```

}

 测试类：

```
importjava.util.concurrent.ExecutorService;
importjava.util.concurrent.Executors;
```

publicclassTest01{

```
publicstaticvoidmain(String[]args){
Accountaccount=newAccount();
ExecutorServiceservice=Executors.newFixedThreadPool(100);
```

```
for(inti=1;i<=100;i++){
service.execute(newAddMoneyThread(account,1));
}
```

service.shutdown();

while(!service.isTerminated()){}

```
System.out.println("账户余额:"+account.getBalance());
}
}
```

```
在 没 有 同 步 的 情 况 下，执 行 结 果 通 常 是 显 示 账 户 余 额 在 10 元 以 下，出 现 这 种 状 况
的 原 因 是 ， 当 一 个 线 程A试 图 存 入 1 元 的 时 候 ， 另 外 一 个 线 程B也 能 够 进 入 存 款
的 方 法 中 ， 线 程B读 取 到 的 账 户 余 额 仍 然 是 线 程A存 入 1 元 钱 之 前 的 账 户 余 额 ，
因 此 也 是 在 原 来 的 余 额 0 上 面 做 了 加 1 元 的 操 作，同 理 线 程C也 会 做 类 似 的 事 情，
所 以 最 后 100 个 线 程 执 行 结 束 时 ， 本 来 期 望 账 户 余 额 为 100 元 ， 但 实 际 得 到 的 通
常 在 10 元 以 下（很 可 能 是 1 元 哦）。解 决 这 个 问 题 的 办 法 就 是 同 步，当 一 个 线 程
对 银 行 账 户 存 钱 时 ， 需 要 将 此 账 户 锁 定 ， 待 其 操 作 完 成 后 才 允 许 其 他 的 线 程 进 行
操 作 ， 代 码 有 如 下 几 种 调 整 方 案 ：
```

 在银行账户的存款（deposit）方法上同步（synchronized）关键字

```
/**
* 银行账户
*@author骆昊
*
*/
publicclassAccount{
privatedoublebalance; // 账户余额
```

```
/**
* 存款
*@parammoney 存入金额
*/
publicsynchronizedvoiddeposit(doublemoney){
doublenewBalance=balance+money;
try{
Thread.sleep(10); // 模拟此业务需要一段处理时间
}
catch(InterruptedExceptionex){
ex.printStackTrace();
}
balance=newBalance;
}
```

```
/**
* 获得账户余额
*/
publicdoublegetBalance(){
returnbalance;
}
}
```

 在线程调用存款方法时对银行账户进行同步

```
/**
* 存钱线程
*@author骆昊
*
```

```
*/
publicclassAddMoneyThreadimplementsRunnable{
privateAccountaccount; // 存入账户
privatedoublemoney; // 存入金额
```

```
publicAddMoneyThread(Accountaccount,doublemoney){
this.account=account;
this.money=money;
}
```

```
@Override
publicvoidrun(){
synchronized(account){
account.deposit(money);
}
}
```

}

 通过Java 5 显示的锁机制，为每个银行账户创建一个锁对象，在存款操
作进行加锁和解锁的操作

```
importjava.util.concurrent.locks.Lock;
importjava.util.concurrent.locks.ReentrantLock;
```

```
/**
* 银行账户
*
*@author骆昊
*
```

*/
publicclassAccount{
privateLockaccountLock=newReentrantLock();
privatedoublebalance;// 账户余额

```
/**
* 存款
*
*@parammoney
* 存入金额
*/
publicvoiddeposit(doublemoney){
accountLock.lock();
try{
doublenewBalance=balance+money;
try{
Thread.sleep(10);// 模拟此业务需要一段处理时间
}
catch(InterruptedExceptionex){
ex.printStackTrace();
}
balance=newBalance;
}
finally{
accountLock.unlock();
}
}
```

```
/**
* 获得账户余额
*/
```

publicdoublegetBalance(){
returnbalance;
}
}

按 照 上 述 三 种 方 式 对 代 码 进 行 修 改 后 ， 重 写 执 行 测 试 代 码Test01， 将 看 到 最 终 的
账 户 余 额 为 100 元。当 然 也 可 以 使 用Semaphore或CountdownLatch来 实 现 同
步 。

## 61 、编写多线程程序有几种实现方式？...............................................

#### 答 ：

Java 5 以 前 实 现 多 线 程 有 两 种 实 现 方 法 ： 一 种 是 继 承Thread类 ； 另 一 种 是 实现
Runnable接 口 。 两 种 方 式 都 要 通 过 重 写run()方 法 来 定 义 线 程 的 行 为 ， 推 荐 使 用
后 者 ， 因 为Java中 的 继 承 是 单 继 承 ， 一 个 类 有 一 个 父 类 ， 如 果 继 承 了Thread类
就 无 法 再 继 承 其 他 类 了 ， 显 然 使 用Runnable接 口 更 为 灵 活 。

补 充：Java 5 以 后 创 建 线 程 还 有 第 三 种 方 式：实 现Callable接 口，该 接 口 中 的call
方 法 可 以 在 线 程 执 行 结 束 时 产 生 一 个 返 回 值 ， 代 码 如 下 所 示 ：

importjava.util.ArrayList;
importjava.util.List;
importjava.util.concurrent.Callable;
importjava.util.concurrent.ExecutorService;
importjava.util.concurrent.Executors;
importjava.util.concurrent.Future;

classMyTaskimplementsCallable<Integer>{


privateintupperBounds;

```
publicMyTask(intupperBounds){
this.upperBounds=upperBounds;
}
```

```
@Override
publicIntegercall()throwsException{
intsum=0;
for(inti=1;i<=upperBounds;i++){
sum+=i;
}
returnsum;
}
```

}

classTest{

publicstaticvoidmain(String[]args)throwsException{
List<Future<Integer>>list=newArrayList<>();
ExecutorServiceservice=Executors.newFixedThreadPool(10);
for(inti=0;i<10;i++){
list.add(service.submit(newMyTask((int)(Math.random()*
100))));
}

```
intsum=0;
for(Future<Integer>future:list){
//while(!future.isDone());
sum+=future.get();
```

}

System.out.println(sum);
}
}

## 62 、synchronized关键字的用法？.....................................................

#### 答 ：

synchronized关 键 字 可 以 将 对 象 或 者 方 法 标 记 为 同 步，以 实 现 对 对 象 和 方 法 的 互
斥 访 问 ， 可 以 用synchronized(对 象){ ... }定 义 同 步 代 码 块 ， 或 者 在 声 明 方 法 时
将synchronized作 为 方 法 的 修 饰 符 。 在 第 60 题 的 例 子 中 已 经 展 示了
synchronized关 键 字 的 用 法 。

## 63 、举例说明同步和异步。...................................................................

#### 答 ：

#### 如 果 系 统 中 存 在 临 界 资 源 （ 资 源 数 量 少 于 竞 争 资 源 的 线 程 数 量 的 资 源 ） ， 例 如 正

#### 在 写 的 数 据 以 后 可 能 被 另 一 个 线 程 读 到 ， 或 者 正 在 读 的 数 据 可 能 已 经 被 另 一 个 线

#### 程 写 过 了 ， 那 么 这 些 数 据 就 必 须 进 行 同 步 存 取 （ 数 据 库 操 作 中 的 排 他 锁 就 是 最 好

#### 的 例 子 ） 。 当 应 用 程 序 在 对 象 上 调 用 了 一 个 需 要 花 费 很 长 时 间 来 执 行 的 方 法 ， 并

#### 且 不 希 望 让 程 序 等 待 方 法 的 返 回 时 ， 就 应 该 使 用 异 步 编 程 ， 在 很 多 情 况 下 采 用 异

#### 步 途 径 往 往 更 有 效 率 。 事 实 上 ， 所 谓 的 同 步 就 是 指 阻 塞 式 操 作 ， 而 异 步 就 是 非 阻

#### 塞 式 操 作 。

## 64 、启动一个线程是调用run()还是start()方法？............................


#### 答 ：

```
启 动 一 个 线 程 是 调 用start()方 法 ， 使 线 程 所 代 表 的 虚 拟 处 理 机 处 于 可 运 行 状 态 ，
这 意 味 着 它 可 以 由JVM 调 度 并 执 行 ， 这 并 不 意 味 着 线 程 就 会 立 即 运 行 。run()方
法 是 线 程 启 动 后 要 进 行 回 调 （callback） 的 方 法 。
```

## 65 、什么是线程池（threadpool）？................................................

#### 答 ：

#### 在 面 向 对 象 编 程 中 ， 创 建 和 销 毁 对 象 是 很 费 时 间 的 ， 因 为 创 建 一 个 对 象 要 获 取 内

```
存 资 源 或 者 其 它 更 多 资 源 。 在Java中 更 是 如 此 ， 虚 拟 机 将 试 图 跟 踪 每 一 个 对 象，
以 便 能 够 在 对 象 销 毁 后 进 行 垃 圾 回 收 。 所 以 提 高 服 务 程 序 效 率 的 一 个 手 段 就 是 尽
可 能 减 少 创 建 和 销 毁 对 象 的 次 数 ， 特 别 是 一 些 很 耗 资 源 的 对 象 创 建 和 销 毁 ， 这 就
是”池 化 资 源”技 术 产 生 的 原 因 。 线 程 池 顾 名 思 义 就 是 事 先 创 建 若 干 个 可 执 行 的
线 程 放 入 一 个 池 （ 容 器 ） 中 ， 需 要 的 时 候 从 池 中 获 取 线 程 不 用 自 行 创 建 ， 使 用 完
毕 不 需 要 销 毁 线 程 而 是 放 回 池 中 ， 从 而 减 少 创 建 和 销 毁 线 程 对 象 的 开 销 。
Java5+中 的Executor接 口 定 义 一 个 执 行 线 程 的 工 具 。 它 的 子 类 型 即 线 程 池 接 口
是ExecutorService。要 配 置 一 个 线 程 池 是 比 较 复 杂 的，尤 其 是 对 于 线 程 池 的 原 理
不 是 很 清 楚 的 情 况 下 ， 因 此 在 工 具 类Executors面 提 供 了 一 些 静 态 工 厂 方 法 ， 生
成 一 些 常 用 的 线 程 池 ， 如 下 所 示 ：
```

 newSingleThreadExecutor：创建一个单线程的线程池。这个线程池只
有一个线程在工作，也就是相当于单线程串行执行所有任务。如果这个唯一的线
程因为异常结束，那么会有一个新的线程来替代它。此线程池保证所有任务的执
行顺序按照任务的提交顺序执行。


 newFixedThreadPool：创建固定大小的线程池。每次提交一个任务就创
建一个线程，直到线程达到线程池的最大大小。线程池的大小一旦达到最大值就
会保持不变，如果某个线程因为执行异常而结束，那么线程池会补充一个新线程。
 newCachedThreadPool：创建一个可缓存的线程池。如果线程池的大小
超过了处理任务所需要的线程，那么就会回收部分空闲（ 60 秒不执行任务）的
线程，当任务数增加时，此线程池又可以智能的添加新线程来处理任务。此线程
池不会对线程池大小做限制，线程池大小完全依赖于操作系统（或者说JVM）
能够创建的最大线程大小。
 newScheduledThreadPool：创建一个大小无限的线程池。此线程池支
持定时以及周期性执行任务的需求。
 newSingleThreadExecutor：创建一个单线程的线程池。此线程池支持
定时以及周期性执行任务的需求。

```
第 60 题 的 例 子 中 演 示 了 通过Executors工 具 类 创 建 线 程 池 并 使 用 线 程 池 执 行 线 程
的 代 码 。 如 果 希 望 在 服 务 器 上 使 用 线 程 池 ， 强 烈 建 议 使 用newFixedThreadPool
方 法 来 创 建 线 程 池 ， 这 样 能 获 得 更 好 的 性 能 。
```

## 66 、线程的基本状态以及状态之间的关系？.......................................

#### 答 ：


**说 明 ：** 其 中Running表 示 运 行 状 态 ，Runnable表 示 就 绪 状 态 （ 万 事 俱 备 ， 只欠
CPU），Blocked表 示 阻 塞 状 态，阻 塞 状 态 又 有 多 种 情 况，可 能 是 因 为 调 用wait()
方 法 进 入 等 待 池 ， 也 可 能 是 执 行 同 步 方 法 或 同 步 代 码 块 进 入 等 锁 池 ， 或 者 是 调 用
了sleep()方 法 或join()方 法 等 待 休 眠 或 其 他 线 程 结 束，或 是 因 为 发 生 了I/O中 断。

## 67 、简述synchronized 和java.util.concurrent.locks.Lock的异同？

#### 答 ：

Lock是Java 5 以 后 引 入 的 新 的API， 和 关 键 字synchronized相 比 主 要 相 同 点：
Lock 能 完 成synchronized所 实 现 的 所 有 功 能 ； 主 要 不 同 点 ：Lock有比
synchronized更 精 确 的 线 程 语 义 和 更 好 的 性 能，而 且 不 强 制 性 的 要 求 一 定 要 获 得
锁 。synchronized会 自 动 释 放 锁 ， 而Lock一 定 要 求 程 序 员 手 工 释 放 ， 并 且 最 好
在finally 块 中 释 放 （ 这 是 释 放 外 部 资 源 的 最 好 的 地 方 ） 。


## 68 、Java中如何实现序列化，有什么意义？......................................

#### 答 ：

#### 序 列 化 就 是 一 种 用 来 处 理 对 象 流 的 机 制 ， 所 谓 对 象 流 也 就 是 将 对 象 的 内 容 进 行 流

#### 化 。 可 以 对 流 化 后 的 对 象 进 行 读 写 操 作 ， 也 可 将 流 化 后 的 对 象 传 输 于 网 络 之 间 。

#### 序 列 化 是 为 了 解 决 对 象 流 读 写 操 作 时 可 能 引 发 的 问 题 （ 如 果 不 进 行 序 列 化 可 能 会

#### 存 在 数 据 乱 序 的 问 题 ） 。

要 实 现 序 列 化 ， 需 要 让 一 个 类 实 现Serializable接 口 ， 该 接 口 是 一 个 标 识 性 接 口，
标 注 该 类 对 象 是 可 被 序 列 化 的 ， 然 后 使 用 一 个 输 出 流 来 构 造 一 个 对 象 输 出 流 并 通
过writeObject(Object)方 法 就 可 以 将 实 现 对 象 写 出（即 保 存 其 状 态）；如 果 需 要
反 序 列 化 则 可 以 用 一 个 输 入 流 建 立 对 象 输 入 流，然 后 通 过readObject方 法 从 流 中
读 取 对 象 。 序 列 化 除 了 能 够 实 现 对 象 的 持 久 化 之 外 ， 还 能 够 用 于 对 象 的 深 度 克 隆
（ 可 以 参 考 第 29 题 ） 。

## 69 、Java中有几种类型的流？..............................................................

#### 答 ：

字 节 流 和 字 符 流 。 字 节 流 继 承 于InputStream、OutputStream， 字 符 流 继 承于
Reader、Writer。 在java.io 包 中 还 有 许 多 其 他 的 流 ， 主 要 是 为 了 提 高 性 能 和 使
用 方 便。关 于Java的I/O需 要 注 意 的 有 两 点：一 是 两 种 对 称 性（输 入 和 输 出 的 对
称 性 ， 字 节 和 字 符 的 对 称 性 ） ； 二 是 两 种 设 计 模 式 （ 适 配 器 模 式 和 装 潢 模 式 ） 。
另 外Java中 的 流 不 同 于C#的 是 它 只 有 一 个 维 度 一 个 方 向 。

**面 试 题** - 编 程 实 现 文 件 拷 贝。（这 个 题 目 在 笔 试 的 时 候 经 常 出 现，下 面 的 代 码 给
出 了 两 种 实 现 方 案 ）

importjava.io.FileInputStream;


importjava.io.FileOutputStream;
importjava.io.IOException;
importjava.io.InputStream;
importjava.io.OutputStream;
importjava.nio.ByteBuffer;
importjava.nio.channels.FileChannel;

publicfinalclassMyUtil{

```
privateMyUtil(){
thrownewAssertionError();
}
```

publicstaticvoidfileCopy(Stringsource,Stringtarget)throws
IOException{
try(InputStreamin=newFileInputStream(source)){
try(OutputStreamout=newFileOutputStream(target)){
byte[]buffer=newbyte[4096];
intbytesToRead;
while((bytesToRead=in.read(buffer))!=-1){
out.write(buffer,0,bytesToRead);
}
}
}
}

publicstaticvoidfileCopyNIO(Stringsource,Stringtarget)throws
IOException{
try(FileInputStreamin=newFileInputStream(source)){
try(FileOutputStreamout=newFileOutputStream(target)){
FileChannelinChannel=in.getChannel();


FileChanneloutChannel=out.getChannel();
ByteBufferbuffer=ByteBuffer.allocate(4096);
while(inChannel.read(buffer)!=-1){
buffer.flip();
outChannel.write(buffer);
buffer.clear();
}
}
}
}
}

**注 意：** 上 面 用到Java 7 的TWR，使用TWR后 可 以 不 用在finally中 释 放 外 部 资 源 ，
从 而 让 代 码 更 加 优 雅 。

### 70 、写一个方法，输入一个文件名和一个字符串，统计这个字

### 符串在这个文件中出现的次数。

#### 答 ：

#### 代 码 如 下 ：

importjava.io.BufferedReader;
importjava.io.FileReader;

publicfinalclassMyUtil{

// 工具类中的方法都是静态方式访问的因此将构造器私有不允许创建对象
(绝对好习惯)


```
privateMyUtil(){
thrownewAssertionError();
}
```

/**

* 统计给定文件中给定字符串的出现次数
  *
  *@paramfilename 文件名
  *@paramword 字符串
  *@return 字符串在文件中出现的次数
  */
  publicstaticintcountWordInFile(Stringfilename,Stringword){
  intcounter=0;
  try(FileReaderfr=newFileReader(filename)){
  try(BufferedReaderbr=newBufferedReader(fr)){
  Stringline=null;
  while((line=br.readLine())!=null){
  intindex=-1;
  while(line.length()>=word.length()&&(index=
  line.indexOf(word))>=0){
  counter++;
  line=line.substring(index+word.length());
  }
  }
  }
  }catch(Exceptionex){
  ex.printStackTrace();
  }
  returncounter;
  }


}

## 71 、如何用Java代码列出一个目录下所有的文件？.........................

#### 答 ：

#### 如 果 只 要 求 列 出 当 前 文 件 夹 下 的 文 件 ， 代 码 如 下 所 示 ：

importjava.io.File;

classTest12{

publicstaticvoidmain(String[]args){
Filef=newFile("/Users/Hao/Downloads");
for(Filetemp:f.listFiles()){
if(temp.isFile()){
System.out.println(temp.getName());
}
}
}
}

如 果 需 要 对 文 件 夹 继 续 展 开 ， 代 码 如 下 所 示 ：

importjava.io.File;

classTest12{

```
publicstaticvoidmain(String[]args){
showDirectory(newFile("/Users/Hao/Downloads"));
```

}

```
publicstaticvoidshowDirectory(Filef){
_walkDirectory(f,0);
}
```

privatestaticvoid_walkDirectory(Filef,intlevel){
if(f.isDirectory()){
for(Filetemp:f.listFiles()){
_walkDirectory(temp,level+1);
}
}
else{
for(inti=0;i<level-1;i++){
System.out.print("\t");
}
System.out.println(f.getName());
}
}
}

在Java 7 中 可 以 使 用NIO.2的API来 做 同 样 的 事 情 ， 代 码 如 下 所 示 ：

classShowFileTest{

```
publicstaticvoidmain(String[]args)throwsIOException{
PathinitPath=Paths.get("/Users/Hao/Downloads");
Files.walkFileTree(initPath,newSimpleFileVisitor<Path>(){
```

@Override


publicFileVisitResultvisitFile(Pathfile,BasicFileAttributes
attrs)
throwsIOException{
System.out.println(file.getFileName().toString());
returnFileVisitResult.CONTINUE;
}

});
}
}

## 72 、用Java的套接字编程实现一个多线程的回显（echo）服务器。

#### 答 ：

importjava.io.BufferedReader;
importjava.io.IOException;
importjava.io.InputStreamReader;
importjava.io.PrintWriter;
importjava.net.ServerSocket;
importjava.net.Socket;

publicclassEchoServer{

privatestaticfinalintECHO_SERVER_PORT=6789;

publicstaticvoidmain(String[]args){


try(ServerSocketserver=new
ServerSocket(ECHO_SERVER_PORT)){
System.out.println("服务器已经启动...");
while(true){
Socketclient=server.accept();
newThread(newClientHandler(client)).start();
}
}catch(IOExceptione){
e.printStackTrace();
}
}

```
privatestaticclassClientHandlerimplementsRunnable{
privateSocketclient;
```

```
publicClientHandler(Socketclient){
this.client=client;
}
```

@Override
publicvoidrun(){
try(BufferedReaderbr=newBufferedReader(new
InputStreamReader(client.getInputStream()));
PrintWriterpw=new
PrintWriter(client.getOutputStream())){
Stringmsg=br.readLine();
System.out.println("收到"+client.getInetAddress()+"
发送的:"+msg);
pw.println(msg);
pw.flush();
}catch(Exceptionex){


```
ex.printStackTrace();
}finally{
try{
client.close();
}catch(IOExceptione){
e.printStackTrace();
}
}
}
}
```

}

**注 意 ：** 上 面 的 代 码 使 用 了Java 7 的TWR语 法 ， 由 于 很 多 外 部 资 源 类 都 间 接 的 实
现 了AutoCloseable接 口 （ 单 方 法 回 调 接 口 ） ， 因 此 可 以 利 用TWR语 法 在try
结 束 的 时 候 通 过 回 调 的 方 式 自 动 调 用 外 部 资 源 类 的close()方 法 ， 避 免 书 写 冗 长的
finally代 码 块 。 此 外 ， 上 面 的 代 码 用 一 个 静 态 内 部 类 实 现 线 程 的 功 能 ， 使 用 多 线
程 可 以 避 免 一 个 用 户I/O操 作 所 产 生 的 中 断 影 响 其 他 用 户 对 服 务 器 的 访 问 ， 简 单
的 说 就 是 一 个 用 户 的 输 入 操 作 不 会 造 成 其 他 用 户 的 阻 塞 。 当 然 ， 上 面 的 代 码 使 用
线 程 池 可 以 获 得 更 好 的 性 能 ， 因 为 频 繁 的 创 建 和 销 毁 线 程 所 造 成 的 开 销 也 是 不 可
忽 视 的 。

#### 下 面 是 一 段 回 显 客 户 端 测 试 代 码 ：

importjava.io.BufferedReader;
importjava.io.InputStreamReader;
importjava.io.PrintWriter;
importjava.net.Socket;
importjava.util.Scanner;

publicclassEchoClient{


publicstaticvoidmain(String[]args)throwsException{
Socketclient=newSocket("localhost",6789);
Scannersc=newScanner(System.in);
System.out.print("请输入内容:");
Stringmsg=sc.nextLine();
sc.close();
PrintWriterpw=newPrintWriter(client.getOutputStream());
pw.println(msg);
pw.flush();
BufferedReaderbr=newBufferedReader(new
InputStreamReader(client.getInputStream()));
System.out.println(br.readLine());
client.close();
}
}

如 果 希 望 用NIO的 多 路 复 用 套 接 字 实 现 服 务 器，代 码 如 下 所 示。NIO的 操 作 虽 然
带 来 了 更 好 的 性 能 ， 但 是 有 些 操 作 是 比 较 底 层 的 ， 对 于 初 学 者 来 说 还 是 有 些 难 于
理 解 。

importjava.io.IOException;
importjava.net.InetSocketAddress;
importjava.nio.ByteBuffer;
importjava.nio.CharBuffer;
importjava.nio.channels.SelectionKey;
importjava.nio.channels.Selector;
importjava.nio.channels.ServerSocketChannel;
importjava.nio.channels.SocketChannel;
importjava.util.Iterator;


publicclassEchoServerNIO{

```
privatestaticfinalintECHO_SERVER_PORT=6789;
privatestaticfinalintECHO_SERVER_TIMEOUT=5000;
privatestaticfinalintBUFFER_SIZE=1024;
```

```
privatestaticServerSocketChannelserverChannel=null;
privatestaticSelectorselector=null; // 多路复用选择器
privatestaticByteBufferbuffer=null; // 缓冲区
```

```
publicstaticvoidmain(String[]args){
init();
listen();
}
```

privatestaticvoidinit(){
try{
serverChannel=ServerSocketChannel.open();
buffer=ByteBuffer.allocate(BUFFER_SIZE);
serverChannel.socket().bind(new
InetSocketAddress(ECHO_SERVER_PORT));
serverChannel.configureBlocking(false);
selector=Selector.open();
serverChannel.register(selector,SelectionKey.OP_ACCEPT);
}catch(Exceptione){
thrownewRuntimeException(e);
}
}

```
privatestaticvoidlisten(){
while(true){
```

try{
if(selector.select(ECHO_SERVER_TIMEOUT)!=0){
Iterator<SelectionKey>it=
selector.selectedKeys().iterator();
while(it.hasNext()){
SelectionKeykey=it.next();
it.remove();
handleKey(key);
}
}
}catch(Exceptione){
e.printStackTrace();
}
}
}

```
privatestaticvoidhandleKey(SelectionKeykey)throwsIOException{
SocketChannelchannel=null;
```

try{
if(key.isAcceptable()){
ServerSocketChannelserverChannel=
(ServerSocketChannel)key.channel();
channel=serverChannel.accept();
channel.configureBlocking(false);
channel.register(selector,SelectionKey.OP_READ);
}elseif(key.isReadable()){
channel=(SocketChannel)key.channel();
buffer.clear();
if(channel.read(buffer)>0){
buffer.flip();


CharBuffercharBuffer=
CharsetHelper.decode(buffer);
Stringmsg=charBuffer.toString();
System.out.println("收到"+
channel.getRemoteAddress()+"的消息："+msg);

channel.write(CharsetHelper.encode(CharBuffer.wrap(msg)));
}else{
channel.close();
}
}
}catch(Exceptione){
e.printStackTrace();
if(channel!=null){
channel.close();
}
}
}

}

importjava.nio.ByteBuffer;
importjava.nio.CharBuffer;
importjava.nio.charset.CharacterCodingException;
importjava.nio.charset.Charset;
importjava.nio.charset.CharsetDecoder;
importjava.nio.charset.CharsetEncoder;

publicfinalclassCharsetHelper{
privatestaticfinalStringUTF_8="UTF-8";


privatestaticCharsetEncoderencoder=
Charset.forName(UTF_8).newEncoder();
privatestaticCharsetDecoderdecoder=
Charset.forName(UTF_8).newDecoder();

```
privateCharsetHelper(){
}
```

publicstaticByteBufferencode(CharBufferin)throws
CharacterCodingException{
returnencoder.encode(in);
}

publicstaticCharBufferdecode(ByteBufferin)throws
CharacterCodingException{
returndecoder.decode(in);
}
}

### 73 、XML文档定义有几种形式？它们之间有何本质区别？解析

### XML文档有哪几种方式？

#### 答 ：

XML文 档 定 义 分 为DTD和Schema两 种 形 式，二 者 都 是 对XML语 法 的 约 束，其
本 质 区 别 在 于Schema本 身 也 是 一 个XML文 件 ， 可 以 被XML解 析 器 解 析 ， 而 且
可 以 为XML承 载 的 数 据 定 义 类 型，约 束 能 力 较 之DTD更 强 大。对XML的 解 析 主
要 有DOM（文 档 对 象 模 型，DocumentObjectModel）、SAX（SimpleAPIfor
XML）和StAX（Java 6 中 引 入 的 新 的 解 析XML的 方 式，StreamingAPIforXML），


#### 其 中DOM处 理 大 型 文 件 时 其 性 能 下 降 的 非 常 厉 害，这 个 问 题 是 由DOM树 结 构 占

#### 用 的 内 存 较 多 造 成 的，而 且DOM解 析 方 式 必 须 在 解 析 文 件 之 前 把 整 个 文 档 装 入 内

#### 存，适 合 对XML的 随 机 访 问（典 型 的 用 空 间 换 取 时 间 的 策 略）；SAX是 事 件 驱 动

#### 型 的XML解 析 方 式 ， 它 顺 序 读 取XML文 件 ， 不 需 要 一 次 全 部 装 载 整 个 文 件 。 当

#### 遇 到 像 文 件 开 头 ， 文 档 结 束 ， 或 者 标 签 开 头 与 标 签 结 束 时 ， 它 会 触 发 一 个 事 件 ，

#### 用 户 通 过 事 件 回 调 代 码 来 处 理XML文 件 ， 适 合 对XML的 顺 序 访 问 ； 顾 名 思 义 ，

StAX把 重 点 放 在 流 上 ， 实 际 上StAX与 其 他 解 析 方 式 的 本 质 区 别 就 在 于 应 用 程 序
能 够 把XML作 为 一 个 事 件 流 来 处 理 。 将XML作 为 一 组 事 件 来 处 理 的 想 法 并 不 新
颖（SAX就 是 这 样 做 的），但 不 同 之 处 在 于StAX允 许 应 用 程 序 代 码 把 这 些 事 件 逐
个 拉 出 来 ， 而 不 用 提 供 在 解 析 器 方 便 时 从 解 析 器 中 接 收 事 件 的 处 理 程 序 。

## 74 、你在项目中哪些地方用到了XML？.............................................

#### 答 ：

#### XML的 主 要 作 用 有 两 个 方 面：数 据 交 换 和 信 息 配 置。在 做 数 据 交 换 时，XML将 数

#### 据 用 标 签 组 装 成 起 来 ， 然 后 压 缩 打 包 加 密 后 通 过 网 络 传 送 给 接 收 者 ， 接 收 解 密 与

#### 解 压 缩 后 再 从XML文 件 中 还 原 相 关 信 息 进 行 处 理，XML曾 经 是 异 构 系 统 间 交 换 数

据 的 事 实 标 准 ， 但 此 项 功 能 几 乎 已 经 被JSON（JavaScriptObjectNotation） 取
而 代 之。当 然，目 前 很 多 软 件 仍 然 使 用XML来 存 储 配 置 信 息，我 们 在 很 多 项 目 中
通 常 也 会 将 作 为 配 置 信 息 的 硬 代 码 写 在XML文 件 中，Java的 很 多 框 架 也 是 这 么 做
的 ， 而 且 这 些 框 架 都 选 择 了dom4j作 为 处 理XML的 工 具 ， 因 为Sun公 司 的 官方
API实 在 不 怎 么 好 用 。

**补 充 ：** 现 在 有 很 多 时 髦 的 软 件 （ 如Sublime） 已 经 开 始 将 配 置 文 件 书 写 成JSON
格 式 ， 我 们 已 经 强 烈 的 感 受 到XML的 另 一 项 功 能 也 将 逐 渐 被 业 界 抛 弃 。

## 75 、阐述JDBC操作数据库的步骤。...................................................


#### 答 ：

```
下 面 的 代 码 以 连 接 本 机 的Oracle数 据 库 为 例 ， 演 示JDBC操 作 数 据 库 的 步 骤 。
```

 加载驱动。

Class.forName("oracle.jdbc.driver.OracleDriver");

 创建连接。

```
Connectioncon=
DriverManager.getConnection("jdbc:oracle:thin:@localhost:1521:orcl",
"scott","tiger");
```

 创建语句。

```
PreparedStatementps=con.prepareStatement("select*fromemp
wheresalbetween?and?");
ps.setInt(1,1000);
ps.setInt(2,3000);
```

 执行语句。

ResultSetrs=ps.executeQuery();


 处理结果。

```
while(rs.next()){
System.out.println(rs.getInt("empno")+"-"+
rs.getString("ename"));
}
```

 关闭资源。

```
finally{
if(con!=null){
try{
con.close();
}catch(SQLExceptione){
e.printStackTrace();
}
}
}
```

```
提 示 ： 关 闭 外 部 资 源 的 顺 序 应 该 和 打 开 的 顺 序 相 反 ， 也 就 是 说 先 关 闭ResultSet、
再 关 闭Statement、在 关 闭Connection。上 面 的 代 码 只 关 闭 了Connection（连
接），虽 然 通 常 情 况 下 在 关 闭 连 接 时，连 接 上 创 建 的 语 句 和 打 开 的 游 标 也 会 关 闭，
但 不 能 保 证 总 是 如 此 ， 因 此 应 该 按 照 刚 才 说 的 顺 序 分 别 关 闭 。 此 外 ， 第 一 步 加 载
驱 动 在JDBC4.0中 是 可 以 省 略 的（自 动 从 类 路 径 中 加 载 驱 动），但 是 我 们 建 议 保
留 。
```

## 76 、Statement和PreparedStatement有什么区别？哪个性能更好？


#### 答 ：

与Statement相 比，①PreparedStatement接 口 代 表 预 编 译 的 语 句，它 主 要 的 优
势 在 于 可 以 减 少SQL的 编 译 错 误 并 增 加SQL的 安 全 性 （ 减 少SQL注 射 攻 击 的 可
能 性）；②PreparedStatement中 的SQL语 句 是 可 以 带 参 数 的，避 免 了 用 字 符 串
连 接 拼接SQL语 句 的 麻 烦 和 不 安 全；③当 批 量 处理SQL或 频 繁 执 行 相 同 的 查 询 时，
PreparedStatement有 明 显 的 性 能 上 的 优 势 ， 由 于 数 据 库 可 以 将 编 译 优 化 后的
SQL语 句 缓 存 起 来 ， 下 次 执 行 相 同 结 构 的 语 句 时 就 会 很 快 （ 不 用 再 次 编 译 和 生 成
执 行 计 划 ） 。

**补 充：** 为 了 提 供 对 存 储 过 程 的 调 用，JDBCAPI中 还 提 供 了CallableStatement接
口。存 储 过 程（StoredProcedure）是 数 据 库 中 一 组 为 了 完 成 特 定 功 能 的SQL语
句 的 集 合 ， 经 编 译 后 存 储 在 数 据 库 中 ， 用 户 通 过 指 定 存 储 过 程 的 名 字 并 给 出 参 数
（ 如 果 该 存 储 过 程 带 有 参 数 ） 来 执 行 它 。 虽 然 调 用 存 储 过 程 会 在 网 络 开 销 、 安 全
性、性 能 上 获 得 很 多 好 处，但 是 存 在 如 果 底 层 数 据 库 发 生 迁 移 时 就 会 有 很 多 麻 烦，
因 为 每 种 数 据 库 的 存 储 过 程 在 书 写 上 存 在 不 少 的 差 别 。

### 77 、使用JDBC操作数据库时，如何提升读取数据的性能？如

### 何提升更新数据的性能？

#### 答 ：

要 提 升 读 取 数 据 的 性 能，可 以 指 定 通 过 结 果 集（ResultSet）对 象 的setFetchSize()
方 法 指 定 每 次 抓 取 的 记 录 数 （ 典 型 的 空 间 换 时 间 策 略 ） ； 要 提 升 更 新 数 据 的 性 能
可 以 使 用PreparedStatement语 句 构 建 批 处 理 ， 将 若 干SQL语 句 置 于 一 个 批 处
理 中 执 行 。


## 78 、在进行数据库编程时，连接池有什么作用？...............................

#### 答 ：

#### 由 于 创 建 连 接 和 释 放 连 接 都 有 很 大 的 开 销 （ 尤 其 是 数 据 库 服 务 器 不 在 本 地 时 ， 每

#### 次 建 立 连 接 都 需 要 进 行TCP的 三 次 握 手，释 放 连 接 需 要 进 行TCP四 次 握 手，造 成

#### 的 开 销 是 不 可 忽 视 的 ） ， 为 了 提 升 系 统 访 问 数 据 库 的 性 能 ， 可 以 事 先 创 建 若 干 连

#### 接 置 于 连 接 池 中 ， 需 要 时 直 接 从 连 接 池 获 取 ， 使 用 结 束 时 归 还 连 接 池 而 不 必 关 闭

#### 连 接 ， 从 而 避 免 频 繁 创 建 和 释 放 连 接 所 造 成 的 开 销 ， 这 是 典 型 的 用 空 间 换 取 时 间

#### 的 策 略 （ 浪 费 了 空 间 存 储 连 接 ， 但 节 省 了 创 建 和 释 放 连 接 的 时 间 ） 。 池 化 技 术在

Java开 发 中 是 很 常 见 的，在 使 用 线 程 时 创 建 线 程 池 的 道 理 与 此 相 同。基 于Java的
开 源 数 据 库 连 接 池 主 要 有 ：C3P0、Proxool、DBCP、BoneCP、Druid等 。

**补 充 ：** 在 计 算 机 系 统 中 时 间 和 空 间 是 不 可 调 和 的 矛 盾 ， 理 解 这 一 点 对 设 计 满 足 性
能 要 求 的 算 法 是 至 关 重 要 的 。 大 型 网 站 性 能 优 化 的 一 个 关 键 就 是 使 用 缓 存 ， 而 缓
存 跟 上 面 讲 的 连 接 池 道 理 非 常 类 似 ， 也 是 使 用 空 间 换 时 间 的 策 略 。 可 以 将 热 点 数
据 置 于 缓 存 中 ， 当 用 户 查 询 这 些 数 据 时 可 以 直 接 从 缓 存 中 得 到 ， 这 无 论 如 何 也 快
过 去 数 据 库 中 查 询 。 当 然 ， 缓 存 的 置 换 策 略 等 也 会 对 系 统 性 能 产 生 重 要 影 响 ， 对
于 这 个 问 题 的 讨 论 已 经 超 出 了 这 里 要 阐 述 的 范 围 。

## 79 、什么是DAO模式？........................................................................

#### 答 ：

DAO（DataAccessObject） 顾 名 思 义 是 一 个 为 数 据 库 或 其 他 持 久 化 机 制 提 供 了
抽 象 接 口 的 对 象 ， 在 不 暴 露 底 层 持 久 化 方 案 实 现 细 节 的 前 提 下 提 供 了 各 种 数 据 访
问 操 作 。 在 实 际 的 开 发 中 ， 应 该 将 所 有 对 数 据 源 的 访 问 操 作 进 行 抽 象 化 后 封 装 在
一 个 公 共API中 。 用 程 序 设 计 语 言 来 说 ， 就 是 建 立 一 个 接 口 ， 接 口 中 定 义 了 此 应
用 程 序 中 将 会 用 到 的 所 有 事 务 方 法 。 在 这 个 应 用 程 序 中 ， 当 需 要 和 数 据 源 进 行 交


#### 互 的 时 候 则 使 用 这 个 接 口 ， 并 且 编 写 一 个 单 独 的 类 来 实 现 这 个 接 口 ， 在 逻 辑 上 该

```
类 对 应 一 个 特 定 的 数 据 存 储 。DAO模 式 实 际 上 包 含 了 两 个 模 式 ， 一 是Data
Accessor（ 数 据 访 问 器 ） ， 二 是DataObject（ 数 据 对 象 ） ， 前 者 要 解 决 如 何 访
问 数 据 的 问 题 ， 而 后 者 要 解 决 的 是 如 何 用 对 象 封 装 数 据 。
```

## 80 、事务的ACID是指什么？...............................................................

#### 答 ：

 原子性(Atomic)：事务中各项操作，要么全做要么全不做，任何一项操作
的失败都会导致整个事务的失败；
 一致性(Consistent)：事务结束后系统状态是一致的；
 隔离性(Isolated)：并发执行的事务彼此无法看到对方的中间状态；
 持久性(Durable)：事务完成后所做的改动都会被持久化，即使发生灾难
性的失败。通过日志和同步备份可以在故障发生后重建数据。

#### 补 充 ： 关 于 事 务 ， 在 面 试 中 被 问 到 的 概 率 是 很 高 的 ， 可 以 问 的 问 题 也 是 很 多 的 。

#### 首 先 需 要 知 道 的 是 ， 只 有 存 在 并 发 数 据 访 问 时 才 需 要 事 务 。 当 多 个 事 务 访 问 同 一

#### 数 据 时 ， 可 能 会 存 在 5 类 问 题 ， 包 括 3 类 数 据 读 取 问 题 （ 脏 读 、 不 可 重 复 读 和 幻

#### 读 ） 和 2 类 数 据 更 新 问 题 （ 第 1 类 丢 失 更 新 和 第 2 类 丢 失 更 新 ） 。

```
脏 读（DirtyRead）：A事 务 读 取B事 务 尚 未 提 交 的 数 据 并 在 此 基 础 上 操 作，而B
事 务 执 行 回 滚 ， 那 么A读 取 到 的 数 据 就 是 脏 数 据 。
时间 转账事务A 取款事务B
T1 开始事务
```

```
T2 开始事务
T3 查询账户余额为 1000 元
```

#### T4 取出 500 元余额修改为 500

#### 元

#### T5 查询账户余额为 500 元（脏读）

#### T6 撤销事务余额恢复为 1000 元

#### T7 汇入 100 元把余额修改为 600

#### 元

#### T8 提交事务

不 可 重 复 读 （UnrepeatableRead） ： 事 务A重 新 读 取 前 面 读 取 过 的 数 据 ， 发 现
该 数 据 已 经 被 另 一 个 已 提 交 的 事 务B修 改 过 了 。

时间 转账事务A 取款事务B

T1 开始事务

T2 开始事务

T3 查询账户余额为 1000 元

T4 查询账户余额为 1000 元

T5 取出 100 元修改余额为 900
元

T6 提交事务

T7 查询账户余额为 900 元（不可重复读）

幻 读 （PhantomRead） ： 事 务A重 新 执 行 一 个 查 询 ， 返 回 一 系 列 符 合 查 询 条 件
的 行 ， 发 现 其 中 插 入 了 被 事 务B提 交 的 行 。


#### 时间 统计金额事务A 转账事务B

#### T1 开始事务

#### T2 开始事务

#### T3 统计总存款为 10000 元

#### T4 新增一个存款账户存入 100

#### 元

#### T5 提交事务

#### T6 再次统计总存款为 10100 元（幻读）

#### 第 1 类 丢 失 更 新 ： 事 务A撤 销 时 ， 把 已 经 提 交 的 事 务B的 更 新 数 据 覆 盖 了 。

#### 时间 取款事务A 转账事务B

#### T1 开始事务

#### T2 开始事务

#### T3 查询账户余额为 1000 元

#### T4 查询账户余额为 1000 元

#### T5 汇入 100 元修改余额为 1100

#### 元

#### T6 提交事务

#### T7 取出 100 元将余额修改为 900 元

#### T8 撤销事务

#### T9 余额恢复为 1000 元（丢失更新）


#### 第 2 类 丢 失 更 新：事 务A覆 盖 事 务B已 经 提 交 的 数 据，造 成 事 务B所 做 的 操 作 丢

#### 失 。

#### 时间 转账事务A 取款事务B

#### T1 开始事务

#### T2 开始事务

#### T3 查询账户余额为 1000 元

#### T4 查询账户余额为 1000 元

#### T5 取出 100 元将余额修改为 900

#### 元

#### T6 提交事务

#### T7 汇入 100 元将余额修改为 1100 元

#### T8 提交事务

#### T9 查询账户余额为 1100 元（丢失更新）

#### 数 据 并 发 访 问 所 产 生 的 问 题 ， 在 有 些 场 景 下 可 能 是 允 许 的 ， 但 是 有 些 场 景 下 可 能

#### 就 是 致 命 的 ， 数 据 库 通 常 会 通 过 锁 机 制 来 解 决 数 据 并 发 访 问 问 题 ， 按 锁 定 对 象 不

#### 同 可 以 分 为 表 级 锁 和 行 级 锁 ； 按 并 发 事 务 锁 定 关 系 可 以 分 为 共 享 锁 和 独 占 锁 ， 具

#### 体 的 内 容 大 家 可 以 自 行 查 阅 资 料 进 行 了 解 。

#### 直 接 使 用 锁 是 非 常 麻 烦 的 ， 为 此 数 据 库 为 用 户 提 供 了 自 动 锁 机 制 ， 只 要 用 户 指 定

#### 会 话 的 事 务 隔 离 级 别 ， 数 据 库 就 会 通 过 分 析SQL语 句 然 后 为 事 务 访 问 的 资 源 加 上

#### 合 适 的 锁 ， 此 外 ， 数 据 库 还 会 维 护 这 些 锁 通 过 各 种 手 段 提 高 系 统 的 性 能 ， 这 些 对

#### 用 户 来 说 都 是 透 明 的 （ 就 是 说 你 不 用 理 解 ， 事 实 上 我 确 实 也 不 知 道 ） 。ANSI/ISO

#### SQL 92 标 准 定 义 了 4 个 等 级 的 事 务 隔 离 级 别 ， 如 下 表 所 示 ：

#### 隔离级别 脏读 不可重复读 幻读 第一类丢失更新 第二类丢失更新


#### READ

#### UNCOMMITED

#### 允许 允许 允许 不允许 允许

#### READ

#### COMMITTED

#### 不允许 允许 允许 不允许 允许

#### REPEATABLE

#### READ

#### 不允许 不允许 允许 不允许 不允许

#### SERIALIZABLE 不允许 不允许 不允许 不允许 不允许

#### 需 要 说 明 的 是 ， 事 务 隔 离 级 别 和 数 据 访 问 的 并 发 性 是 对 立 的 ， 事 务 隔 离 级 别 越 高

#### 并 发 性 就 越 差 。 所 以 要 根 据 具 体 的 应 用 来 确 定 合 适 的 事 务 隔 离 级 别 ， 这 个 地 方 没

#### 有 万 能 的 原 则 。

#### **81、JDBC中 如 何 进 行 事 务 处 理 ？

#### 答 ：

Connection提 供 了 事 务 处 理 的 方 法 ， 通 过 调 用setAutoCommit(false)可 以 设 置
手 动 提 交 事 务；当 事 务 完 成 后 用commit()显 式 提 交 事 务；如 果 在 事 务 处 理 过 程 中
发 生 异 常 则 通 过rollback()进 行 事 务 回 滚 。 除 此 之 外 ， 从JDBC3.0中 还 引 入了
Savepoint（保 存 点）的 概 念，允 许 通 过 代 码 设 置 保 存 点 并 让 事 务 回 滚 到 指 定 的 保
存 点 。


## 82 、JDBC能否处理Blob和Clob？....................................................

#### 答 ：

Blob是 指 二 进 制 大 对 象 （BinaryLargeObject） ， 而Clob是 指 大 字 符 对 象
（CharacterLargeObjec），因 此 其 中Blob是 为 存 储 大 的 二 进 制 数 据 而 设 计 的，
而Clob是 为 存 储 大 的 文 本 数 据 而 设 计 的 。JDBC的PreparedStatement和
ResultSet都 提 供 了 相 应 的 方 法 来 支 持Blob和Clob操 作 。 下 面 的 代 码 展 示 了 如
何 使 用JDBC操 作LOB：
下 面 以MySQL数 据 库 为 例 ， 创 建 一 个 张 有 三 个 字 段 的 用 户 表 ， 包 括 编 号 （id）、
姓 名 （name） 和 照 片 （photo） ， 建 表 语 句 如 下 ：

createtabletb_user
(
idintprimarykeyauto_increment,
namevarchar(20)uniquenotnull,
photolongblob
);

下 面 的Java代 码 向 数 据 库 中 插 入 一 条 记 录 ：

importjava.io.FileInputStream;
importjava.io.IOException;
importjava.io.InputStream;
importjava.sql.Connection;
importjava.sql.DriverManager;
importjava.sql.PreparedStatement;
importjava.sql.SQLException;

classJdbcLobTest{


publicstaticvoidmain(String[]args){
Connectioncon=null;
try{
//1. 加载驱动（Java6以上版本可以省略）
Class.forName("com.mysql.jdbc.Driver");
//2. 建立连接
con=
DriverManager.getConnection("jdbc:mysql://localhost:3306/test","root",
"123456");
//3. 创建语句对象
PreparedStatementps=con.prepareStatement("insertinto
tb_uservalues(default,?,?)");
ps.setString(1,"骆昊"); // 将SQL语句中第一个
占位符换成字符串
try(InputStreamin=newFileInputStream("test.jpg"))
{ //Java 7 的TWR
ps.setBinaryStream(2,in); // 将SQL语句中第二个占
位符换成二进制流
//4. 发出SQL语句获得受影响行数
System.out.println(ps.executeUpdate()== 1 ?"插入成功
":"插入失败");
}catch(IOExceptione){
System.out.println("读取照片失败!");
}
}catch(ClassNotFoundException|SQLExceptione){ //Java
7 的多异常捕获
e.printStackTrace();
}finally{// 释放外部资源的代码都应当放在finally中保证其能够得
到执行
try{


if(con!=null&&!con.isClosed()){
con.close(); //5. 释放数据库连接
con=null; // 指示垃圾回收器可以回收该对象
}
}catch(SQLExceptione){
e.printStackTrace();
}
}
}
}

## 83 、简述正则表达式及其用途。...........................................................

#### 答 ：

#### 在 编 写 处 理 字 符 串 的 程 序 时 ， 经 常 会 有 查 找 符 合 某 些 复 杂 规 则 的 字 符 串 的 需 要 。

#### 正 则 表 达 式 就 是 用 于 描 述 这 些 规 则 的 工 具 。 换 句 话 说 ， 正 则 表 达 式 就 是 记 录 文 本

#### 规 则 的 代 码 。

#### 说 明 ： 计 算 机 诞 生 初 期 处 理 的 信 息 几 乎 都 是 数 值 ， 但 是 时 过 境 迁 ， 今 天 我 们 使 用

#### 计 算 机 处 理 的 信 息 更 多 的 时 候 不 是 数 值 而 是 字 符 串 ， 正 则 表 达 式 就 是 在 进 行 字 符

#### 串 匹 配 和 处 理 的 时 候 最 为 强 大 的 工 具 ， 绝 大 多 数 语 言 都 提 供 了 对 正 则 表 达 式 的 支

#### 持 。

## 84 、Java中是如何支持正则表达式操作的？......................................

#### 答 ：


Java中 的String类 提 供 了 支 持 正 则 表 达 式 操 作 的 方 法 ， 包 括 ：matches()、
replaceAll()、replaceFirst()、split()。此 外，Java中 可 以 用Pattern类 表 示 正 则
表 达 式 对 象 ， 它 提 供 了 丰 富 的API进 行 各 种 正 则 表 达 式 操 作 ， 请 参 考 下 面 面 试 题
的 代 码 。

**面 试 题：** - 如 果 要 从 字 符 串 中 截 取 第 一 个 英 文 左 括 号 之 前 的 字 符 串，例 如：北 京
市(朝 阳 区)(西 城 区)(海 淀 区)， 截 取 结 果 为 ： 北 京 市 ， 那 么 正 则 表 达 式 怎 么 写 ？

importjava.util.regex.Matcher;
importjava.util.regex.Pattern;

classRegExpTest{

publicstaticvoidmain(String[]args){
Stringstr="北京市(朝阳区)(西城区)(海淀区)";
Patternp=Pattern.compile(".*?(?=\\()");
Matcherm=p.matcher(str);
if(m.find()){
System.out.println(m.group());
}
}
}

**说 明 ：** 上 面 的 正 则 表 达 式 中 使 用 了 懒 惰 匹 配 和 前 瞻 ， 如 果 不 清 楚 这 些 内 容 ， 推 荐
读 一 下 网 上 很 有 名 的《 正 则 表 达 式 30 分 钟 入 门 教 程 》。

## 85 、获得一个类的类对象有哪些方式？...............................................

#### 答 ：


 方法 1 ：类型.class，例如：String.class
 方法 2 ：对象.getClass()，例如：”hello”.getClass()
 方法 3 ：Class.forName()，例如：Class.forName(“java.lang.String”)

#### **86、 如 何 通 过 反 射 创 建 对 象 ？

#### 答 ：

 方法 1 ：通过类对象调用newInstance()方法，例如：
String.class.newInstance()
 方法 2 ：通过类对象的getConstructor()或getDeclaredConstructor()
方法获得构造器（Constructor）对象并调用其newInstance()方法创建对象，
例如：String.class.getConstructor(String.class).newInstance(“Hello”);

#### **87、 如 何 通 过 反 射 获 取 和 设 置 对 象 私 有 字 段 的 值 ？

#### 答 ：

```
可 以 通 过 类 对 象 的getDeclaredField()方 法 字 段 （Field） 对 象 ， 然 后 再 通 过 字 段
对 象 的setAccessible(true)将 其 设 置 为 可 以 访 问 ， 接 下 来 就 可 以 通 过get/set方
法 来 获 取/设 置 字 段 的 值 了 。 下 面 的 代 码 实 现 了 一 个 反 射 的 工 具 类 ， 其 中 的 两 个 静
态 方 法 分 别 用 于 获 取 和 设 置 私 有 字 段 的 值 ， 字 段 可 以 是 基 本 类 型 也 可 以 是 对 象 类
型 且 支 持 多 级 对 象 操 作，例 如ReflectionUtil.get(dog,“owner.car.engine.id”);
可 以 获 得dog对 象 的 主 人 的 汽 车 的 引 擎 的ID号 。
```

```
importjava.lang.reflect.Constructor;
importjava.lang.reflect.Field;
importjava.lang.reflect.Modifier;
importjava.util.ArrayList;
```

importjava.util.List;

/**

* 反射工具类
  *@author骆昊
  *
  */
  publicclassReflectionUtil{

```
privateReflectionUtil(){
thrownewAssertionError();
}
```

```
/**
* 通过反射取对象指定字段(属性)的值
*@paramtarget目标对象
*@paramfieldName 字段的名字
*@throws 如果取不到对象指定字段的值则抛出异常
*@return 字段的值
*/
publicstaticObjectgetValue(Objecttarget,StringfieldName){
Class<?>clazz=target.getClass();
String[]fs=fieldName.split("\\.");
```

```
try{
for(inti=0;i<fs.length-1;i++){
Fieldf=clazz.getDeclaredField(fs[i]);
f.setAccessible(true);
target=f.get(target);
clazz=target.getClass();
}
```

```
Fieldf=clazz.getDeclaredField(fs[fs.length-1]);
f.setAccessible(true);
returnf.get(target);
}
catch(Exceptione){
thrownewRuntimeException(e);
}
}
```

/**

* 通过反射给对象的指定字段赋值
  *@paramtarget目标对象
  *@paramfieldName 字段的名称
  *@paramvalue 值
  */
  publicstaticvoidsetValue(Objecttarget,StringfieldName,Object
  value){
  Class<?>clazz=target.getClass();
  String[]fs=fieldName.split("\\.");
  try{
  for(inti=0;i<fs.length-1;i++){
  Fieldf=clazz.getDeclaredField(fs[i]);
  f.setAccessible(true);
  Objectval=f.get(target);
  if(val==null){
  Constructor<?>c=
  f.getType().getDeclaredConstructor();
  c.setAccessible(true);
  val=c.newInstance();
  f.set(target,val);


```
}
target=val;
clazz=target.getClass();
}
```

```
Fieldf=clazz.getDeclaredField(fs[fs.length-1]);
f.setAccessible(true);
f.set(target,value);
}
catch(Exceptione){
thrownewRuntimeException(e);
}
}
```

}

## 88 、如何通过反射调用对象的方法？...................................................

#### 答 ：

#### 请 看 下 面 的 代 码 ：

importjava.lang.reflect.Method;

classMethodInvokeTest{

```
publicstaticvoidmain(String[]args)throwsException{
Stringstr="hello";
Methodm=str.getClass().getMethod("toUpperCase");
System.out.println(m.invoke(str)); //HELLO
```

```
}
}
```

```
**89、 简 述 一 下 面 向 对 象 的”六 原 则 一 法 则”。
```

```
答 ：
```

 单一职责原则：一个类只做它该做的事情。（单一职责原则想表达的就是”
高内聚”，写代码最终极的原则只有六个字”高内聚、低耦合”，就如同葵花宝
典或辟邪剑谱的中心思想就八个字”欲练此功必先自宫”，所谓的高内聚就是一
个代码模块只完成一项功能，在面向对象中，如果只让一个类完成它该做的事，
而不涉及与它无关的领域就是践行了高内聚的原则，这个类就只有单一职责。我
们都知道一句话叫”因为专注，所以专业”，一个对象如果承担太多的职责，那
么注定它什么都做不好。这个世界上任何好的东西都有两个特征，一个是功能单
一，好的相机绝对不是电视购物里面卖的那种一个机器有一百多种功能的，它基
本上只能照相；另一个是模块化，好的自行车是组装车，从减震叉、刹车到变速
器，所有的部件都是可以拆卸和重新组装的，好的乒乓球拍也不是成品拍，一定
是底板和胶皮可以拆分和自行组装的，一个好的软件系统，它里面的每个功能模
块也应该是可以轻易的拿到其他系统中使用的，这样才能实现软件复用的目标。）
 开闭原则：软件实体应当对扩展开放，对修改关闭。（在理想的状态下，
当我们需要为一个软件系统增加新功能时，只需要从原来的系统派生出一些新类
就可以，不需要修改原来的任何一行代码。要做到开闭有两个要点：①抽象是关
键，一个系统中如果没有抽象类或接口系统就没有扩展点；②封装可变性，将系
统中的各种可变因素封装到一个继承结构中，如果多个可变因素混杂在一起，系
统将变得复杂而换乱，如果不清楚如何封装可变性，可以参考《设计模式精解》
一书中对桥梁模式的讲解的章节。）
 依赖倒转原则：面向接口编程。（该原则说得直白和具体一些就是声明方
法的参数类型、方法的返回类型、变量的引用类型时，尽可能使用抽象类型而不
用具体类型，因为抽象类型可以被它的任何一个子类型所替代，请参考下面的里
氏替换原则。）


里氏替换原则：任何时候都可以用子类型替换掉父类型。（关于里氏替换原则的
描述，BarbaraLiskov女士的描述比这个要复杂得多，但简单的说就是能用父
类型的地方就一定能使用子类型。里氏替换原则可以检查继承关系是否合理，如
果一个继承关系违背了里氏替换原则，那么这个继承关系一定是错误的，需要对
代码进行重构。例如让猫继承狗，或者狗继承猫，又或者让正方形继承长方形都
是错误的继承关系，因为你很容易找到违反里氏替换原则的场景。需要注意的是：
子类一定是增加父类的能力而不是减少父类的能力，因为子类比父类的能力更
多，把能力多的对象当成能力少的对象来用当然没有任何问题。）
 接口隔离原则：接口要小而专，绝不能大而全。（臃肿的接口是对接口的
污染，既然接口表示能力，那么一个接口只应该描述一种能力，接口也应该是高
度内聚的。例如，琴棋书画就应该分别设计为四个接口，而不应设计成一个接口
中的四个方法，因为如果设计成一个接口中的四个方法，那么这个接口很难用，
毕竟琴棋书画四样都精通的人还是少数，而如果设计成四个接口，会几项就实现
几个接口，这样的话每个接口被复用的可能性是很高的。Java中的接口代表能
力、代表约定、代表角色，能否正确的使用接口一定是编程水平高低的重要标识。）
 合成聚合复用原则：优先使用聚合或合成关系复用代码。（通过继承来复
用代码是面向对象程序设计中被滥用得最多的东西，因为所有的教科书都无一例
外的对继承进行了鼓吹从而误导了初学者，类与类之间简单的说有三种关系，
Is-A关系、Has-A关系、Use-A关系，分别代表继承、关联和依赖。其中，关
联关系根据其关联的强度又可以进一步划分为关联、聚合和合成，但说白了都是
Has-A关系，合成聚合复用原则想表达的是优先考虑Has-A关系而不是Is-A关
系复用代码，原因嘛可以自己从百度上找到一万个理由，需要说明的是，即使在
Java的API中也有不少滥用继承的例子，例如Properties类继承了Hashtable
类，Stack类继承了Vector类，这些继承明显就是错误的，更好的做法是在
Properties类中放置一个Hashtable类型的成员并且将其键和值都设置为字符
串来存储数据，而Stack类的设计也应该是在Stack类中放一个Vector对象来
存储数据。记住：任何时候都不要继承工具类，工具是可以拥有并可以使用的，
而不是拿来继承的。）
 迪米特法则：迪米特法则又叫最少知识原则，一个对象应当对其他对象有
尽可能少的了解。（迪米特法则简单的说就是如何做到”低耦合”，门面模式和


调停者模式就是对迪米特法则的践行。对于门面模式可以举一个简单的例子，你
去一家公司洽谈业务，你不需要了解这个公司内部是如何运作的，你甚至可以对
这个公司一无所知，去的时候只需要找到公司入口处的前台美女，告诉她们你要
做什么，她们会找到合适的人跟你接洽，前台的美女就是公司这个系统的门面。
再复杂的系统都可以为用户提供一个简单的门面，JavaWeb开发中作为前端控
制器的Servlet或Filter不就是一个门面吗，浏览器对服务器的运作方式一无所
知，但是通过前端控制器就能够根据你的请求得到相应的服务。调停者模式也可
以举一个简单的例子来说明，例如一台计算机，CPU、内存、硬盘、显卡、声卡
各种设备需要相互配合才能很好的工作，但是如果这些东西都直接连接到一起，
计算机的布线将异常复杂，在这种情况下，主板作为一个调停者的身份出现，它
将各个设备连接在一起而不需要每个设备之间直接交换数据，这样就减小了系统
的耦合度和复杂度，如下图所示。迪米特法则用通俗的话来将就是不要和陌生人
打交道，如果真的需要，找一个自己的朋友，让他替你和陌生人打交道。）


## 90 、简述一下你了解的设计模式。.......................................................

#### 答 ：

#### 所 谓 设 计 模 式 ， 就 是 一 套 被 反 复 使 用 的 代 码 设 计 经 验 的 总 结 （ 情 境 中 一 个 问 题 经

#### 过 证 实 的 一 个 解 决 方 案 ） 。 使 用 设 计 模 式 是 为 了 可 重 用 代 码 、 让 代 码 更 容 易 被 他

#### 人 理 解 、 保 证 代 码 可 靠 性 。 设 计 模 式 使 人 们 可 以 更 加 简 单 方 便 的 复 用 成 功 的 设 计

#### 和 体 系 结 构 。 将 已 证 实 的 技 术 表 述 成 设 计 模 式 也 会 使 新 系 统 开 发 者 更 加 容 易 理 解

#### 其 设 计 思 路 。

在GoF的 《DesignPatterns:ElementsofReusableObject-Oriented
Software》 中 给 出 了 三 类 （ 创 建 型[对 类 的 实 例 化 过 程 的 抽 象 化]、 结 构 型[描 述 如
何 将 类 或 对 象 结 合 在 一 起 形 成 更 大 的 结 构]、行 为 型[对 在 不 同 的 对 象 之 间 划 分 责 任
和 算 法 的 抽 象 化]）共 23 种 设 计 模 式，包 括：AbstractFactory（抽 象 工 厂 模 式），
Builder（建 造 者 模 式），FactoryMethod（工 厂 方 法 模 式），Prototype（原 始
模 型 模 式），Singleton（单 例 模 式）；Facade（门 面 模 式），Adapter（适 配 器
模 式 ） ，Bridge（ 桥 梁 模 式 ） ，Composite（ 合 成 模 式 ） ，Decorator（ 装 饰 模
式），Flyw eight（享 元 模 式），Proxy（代 理 模 式）；Command（命 令 模 式），


```
Interpreter（ 解 释 器 模 式 ） ，Visitor（ 访 问 者 模 式 ） ，Iterator（ 迭 代 子 模 式 ），
Mediator（调 停 者 模 式），Memento（备 忘 录 模 式），Observer（观 察 者 模 式），
State（状 态 模 式），Strategy（策 略 模 式），TemplateMethod（模 板 方 法 模 式），
ChainOfResponsibility（ 责 任 链 模 式 ） 。
面 试 被 问 到 关 于 设 计 模 式 的 知 识 时 ， 可 以 拣 最 常 用 的 作 答 ， 例 如 ：
```

 工厂模式：工厂类可以根据条件生成不同的子类实例，这些子类有一个公
共的抽象父类并且实现了相同的方法，但是这些方法针对不同的数据进行了不同
的操作（多态方法）。当得到子类的实例后，开发人员可以调用基类中的方法而
不必考虑到底返回的是哪一个子类的实例。
 代理模式：给一个对象提供一个代理对象，并由代理对象控制原对象的引
用。实际开发中，按照使用目的的不同，代理可以分为：远程代理、虚拟代理、
保护代理、Cache代理、防火墙代理、同步化代理、智能引用代理。
 适配器模式：把一个类的接口变换成客户端所期待的另一种接口，从而使
原本因接口不匹配而无法在一起使用的类能够一起工作。
 模板方法模式：提供一个抽象类，将部分逻辑以具体方法或构造器的形式
实现，然后声明一些抽象方法来迫使子类实现剩余的逻辑。不同的子类可以以不
同的方式实现这些抽象方法（多态实现），从而实现不同的业务逻辑。

```
除此之外，还可以讲讲上面提到的门面模式、桥梁模式、单例模式、装潢模式
（Collections工具类和I/O系统中都使用装潢模式）等，反正基本原则就是拣
自己最熟悉的、用得最多的作答，以免言多必失。
```

## 91 、用Java写一个单例类。.................................................................

#### 答 ：

 饿汉式单例


```
publicclassSingleton{
privateSingleton(){}
privatestaticSingletoninstance=newSingleton();
publicstaticSingletongetInstance(){
returninstance;
}
}
```

 懒汉式单例

```
publicclassSingleton{
privatestaticSingletoninstance=null;
privateSingleton(){}
publicstaticsynchronizedSingletongetInstance(){
if(instance==null)instance ＝ newSingleton();
returninstance;
}
}
```

```
注 意 ： 实 现 一 个 单 例 有 两 点 注 意 事 项 ，①将 构 造 器 私 有 ， 不 允 许 外 界 通 过 构 造 器
创 建 对 象 ；②通 过 公 开 的 静 态 方 法 向 外 界 返 回 类 的 唯 一 实 例 。 这 里 有 一 个 问 题 可
以 思 考 ：Spring的IoC容 器 可 以 为 普 通 的 类 创 建 单 例 ， 它 是 怎 么 做 到 的 呢 ？
```

## 92 、什么是UML？.................................................................................

#### 答 ：


UML是 统 一 建 模 语 言 （UnifiedModelingLanguage） 的 缩 写 ， 它 发 表 于 1997
年 ， 综 合 了 当 时 已 经 存 在 的 面 向 对 象 的 建 模 语 言 、 方 法 和 过 程 ， 是 一 个 支 持 模 型
化 和 软 件 系 统 开 发 的 图 形 化 语 言 ， 为 软 件 开 发 的 所 有 阶 段 提 供 模 型 化 和 可 视 化 支
持。使 用UML可 以 帮 助 沟 通 与 交 流，辅 助 应 用 设 计 和 文 档 的 生 成，还 能 够 阐 释 系
统 的 结 构 和 行 为 。

## 93 、UML中有哪些常用的图？.............................................................

#### 答 ：

#### UML定 义 了 多 种 图 形 化 的 符 号 来 描 述 软 件 系 统 部 分 或 全 部 的 静 态 结 构 和 动 态 结

构，包 括：用 例 图（usecasediagram）、类 图（classdiagram）、时 序 图（sequence
diagram）、协 作 图（collaborationdiagram）、状 态 图（statechartdiagram）、
活 动 图（activitydiagram）、构 件 图（componentdiagram）、部 署 图（deployment
diagram）等。在 这 些 图 形 化 符 号 中，有 三 种 图 最 为 重 要，分 别 是：用 例 图（用 来
捕 获 需 求，描 述 系 统 的 功 能，通 过 该 图 可 以 迅 速 的 了 解 系 统 的 功 能 模 块 及 其 关 系）、
类 图（描 述 类 以 及 类 与 类 之 间 的 关 系，通 过 该 图 可 以 快 速 了 解 系 统）、时 序 图（描
述 执 行 特 定 任 务 时 对 象 之 间 的 交 互 关 系 以 及 执 行 顺 序 ， 通 过 该 图 可 以 了 解 对 象 能
接 收 的 消 息 也 就 是 说 对 象 能 够 向 外 界 提 供 的 服 务 ） 。
用 例 图 ：


#### 类 图 ：

#### 时 序 图 ：


**94、 用Java写 一 个 冒 泡 排 序 。

答 ：

#### 冒 泡 排 序 几 乎 是 个 程 序 员 都 写 得 出 来 ， 但 是 面 试 的 时 候 如 何 写 一 个 逼 格 高 的 冒 泡

#### 排 序 却 不 是 每 个 人 都 能 做 到 ， 下 面 提 供 一 个 参 考 代 码 ：

importjava.util.Comparator;

/**

* 排序器接口(策略模式: 将算法封装到具有共同接口的独立的类中使得它们可
  以相互替换)
  *@author骆昊
  *
  */
  publicinterfaceSorter{

```
/**
* 排序
```

```
*@paramlist 待排序的数组
*/
public<TextendsComparable<T>>voidsort(T[]list);
```

/**

* 排序
  *@paramlist 待排序的数组
  *@paramcomp比较两个对象的比较器
  */
  public<T>voidsort(T[]list,Comparator<T>comp);
  }

importjava.util.Comparator;

/**

* 冒泡排序
  *
  *@author骆昊
  *
  */
  publicclassBubbleSorterimplementsSorter{

```
@Override
public<TextendsComparable<T>>voidsort(T[]list){
booleanswapped=true;
for(inti=1,len=list.length;i<len&&swapped;++i){
swapped=false;
for(intj=0;j<len-i;++j){
if(list[j].compareTo(list[j+1])>0){
Ttemp=list[j];
list[j]=list[j+1];
```

```
list[j+1]=temp;
swapped=true;
}
}
}
}
```

@Override
public<T>voidsort(T[]list,Comparator<T>comp){
booleanswapped=true;
for(inti=1,len=list.length;i<len&&swapped;++i){
swapped=false;
for(intj=0;j<len-i;++j){
if(comp.compare(list[j],list[j+1])>0){
Ttemp=list[j];
list[j]=list[j+1];
list[j+1]=temp;
swapped=true;
}
}
}
}
}

### 95 、用Java写一个折半查找。.............................................................

#### 答 ：

#### 折 半 查 找 ， 也 称 二 分 查 找 、 二 分 搜 索 ， 是 一 种 在 有 序 数 组 中 查 找 某 一 特 定 元 素 的

#### 搜 索 算 法。搜 素 过 程 从 数 组 的 中 间 元 素 开 始，如 果 中 间 元 素 正 好 是 要 查 找 的 元 素，


#### 则 搜 素 过 程 结 束 ； 如 果 某 一 特 定 元 素 大 于 或 者 小 于 中 间 元 素 ， 则 在 数 组 大 于 或 小

#### 于 中 间 元 素 的 那 一 半 中 查 找 ， 而 且 跟 开 始 一 样 从 中 间 元 素 开 始 比 较 。 如 果 在 某 一

#### 步 骤 数 组 已 经 为 空 ， 则 表 示 找 不 到 指 定 的 元 素 。 这 种 搜 索 算 法 每 一 次 比 较 都 使 搜

索 范 围 缩 小 一 半 ， 其 时 间 复 杂 度 是O(logN)。

importjava.util.Comparator;

publicclassMyUtil{

publicstatic<TextendsComparable<T>>intbinarySearch(T[]x,T
key){
returnbinarySearch(x,0,x.length-1,key);
}

// 使用循环实现的二分查找
publicstatic<T>intbinarySearch(T[]x,Tkey,Comparator<T>comp)
{
intlow=0;
inthigh=x.length-1;
while(low<=high){
intmid=(low+high)>>>1;
intcmp=comp.compare(x[mid],key);
if(cmp<0){
low=mid+1;
}
elseif(cmp>0){
high=mid-1;
}
else{
returnmid;
}


```
}
return-1;
}
```

// 使用递归实现的二分查找
privatestatic<TextendsComparable<T>>intbinarySearch(T[]x,int
low,inthigh,Tkey){
if(low<=high){
intmid=low+((high-low)>>1);
if(key.compareTo(x[mid])==0){
returnmid;
}
elseif(key.compareTo(x[mid])<0){
returnbinarySearch(x,low,mid-1,key);
}
else{
returnbinarySearch(x,mid+1,high,key);
}
}
return-1;
}
}

**说 明 ：** 上 面 的 代 码 中 给 出 了 折 半 查 找 的 两 个 版 本 ， 一 个 用 递 归 实 现 ， 一 个 用 循 环
实 现 。 需 要 注 意 的 是 计 算 中 间 位 置 时 不 应 该 使 用(high+low)/ 2 的 方 式 ， 因 为 加
法 运 算 可 能 导 致 整 数 越 界 ， 这 里 应 该 使 用 以 下 三 种 方 式 之 一 ：low+(high-low)
/ 2 或low+(high – low)>> 1 或(low+high)>>> 1 （>>>是 逻 辑 右 移 ， 是
不 带 符 号 位 的 右 移 ）

## Java 面试题（二）.................................................................................................


```
下 面 列 出 这 份 Java 面 试 问 题 列 表 包 含 的 主 题
```

 多线程，并发及线程基础
 数据类型转换的基本原则
 垃圾回收（GC）
 Java 集合框架
 数组
 字符串
 GOF 设计模式
 SOLID
 抽象类与接口
 Java 基础，如 equals 和 hashcode
 泛型与枚举
 JavaIO 与 NIO
 常用网络协议
 Java 中的数据结构和算法
 正则表达式
 JVM 底层
 Java 最佳实践
 JDBC
 Date,Time 与 Calendar
 Java 处理 XML
 JUnit
 编程

#### 现 在 是 时 候 给 你 展 示 我 近 5 年 从 各 种 面 试 中 收 集 来 的 133 个 问 题 了。我 确 定 你

#### 在 自 己 的 面 试 中 见 过 很 多 这 些 问 题 ， 很 多 问 题 你 也 能 正 确 回 答 。


### 多线程、并发及线程的基础问题............................................................

### 1 、Java 中能创建 volatile 数组吗？.................................................

能 ，Java 中 可 以 创 建 volatile 类 型 数 组 ， 不 过 只 是 一 个 指 向 数 组 的 引 用 ， 而 不
是 整 个 数 组。我 的 意 思 是，如 果 改 变 引 用 指 向 的 数 组，将 会 受 到 volatile 的 保 护，
但 是 如 果 多 个 线 程 同 时 改 变 数 组 的 元 素 ，volatile 标 示 符 就 不 能 起 到 之 前 的 保 护
作 用 了 。

### 2 、volatile 能使得一个非原子操作变成原子操作吗？.....................

一 个 典 型 的 例 子 是 在 类 中 有 一 个 long 类 型 的 成 员 变 量 。 如 果 你 知 道 该 成 员 变 量
会 被 多 个 线 程 访 问，如 计 数 器、价 格 等，你 最 好 是 将 其 设 置 为 volatile。为 什 么 ？
因 为 Java 中 读 取 long 类 型 变 量 不 是 原 子 的 ， 需 要 分 成 两 步 ， 如 果 一 个 线 程 正
在 修 改 该 long 变 量 的 值 ， 另 一 个 线 程 可 能 只 能 看 到 该 值 的 一 半 （ 前 32 位 ）。
但 是 对 一 个 volatile 型 的 long 或 double 变 量 的 读 写 是 原 子 。

### 3 、volatile 修饰符的有过什么实践？.................................................

一 种 实 践 是 用 volatile 修 饰 long 和 double 变 量，使 其 能 按 原 子 类 型 来 读 写。
double 和 long 都 是 64 位 宽，因 此 对 这 两 种 类 型 的 读 是 分 为 两 部 分 的，第 一 次
读 取 第 一 个 32 位，然 后 再 读 剩 下 的 32 位，这 个 过 程 不 是 原 子 的，但 Java 中
volatile 型 的 long 或 double 变 量 的 读 写 是 原 子 的。volatile 修 复 符 的 另 一 个
作 用 是 提 供 内 存 屏 障 （memorybarrier） ， 例 如 在 分 布 式 框 架 中 的 应 用 。 简 单 的
说，就 是 当 你 写 一 个 volatile 变 量 之 前，Java 内 存 模 型 会 插 入 一 个 写 屏 障（write
barrier） ， 读 一 个 volatile 变 量 之 前 ， 会 插 入 一 个 读 屏 障 （readbarrier） 。 意
思 就 是 说，在 你 写 一 个 volatile 域 时，能 保 证 任 何 线 程 都 能 看 到 你 写 的 值，同 时，


#### 在 写 之 前 ， 也 能 保 证 任 何 数 值 的 更 新 对 所 有 线 程 是 可 见 的 ， 因 为 内 存 屏 障 会 将 其

#### 他 所 有 写 的 值 更 新 到 缓 存 。

### 4 、volatile 类型变量提供什么保证？.................................................

volatile 变 量 提 供 顺 序 和 可 见 性 保 证，例 如，JVM 或 者 JIT为 了 获 得 更 好 的 性 能
会 对 语 句 重 排 序，但 是 volatile 类 型 变 量 即 使 在 没 有 同 步 块 的 情 况 下 赋 值 也 不 会
与 其 他 语 句 重 排 序 。 volatile 提 供 happens-before 的 保 证 ， 确 保 一 个 线 程 的
修 改 能 对 其 他 线 程 是 可 见 的。某 些 情 况 下，volatile 还 能 提 供 原 子 性，如 读 64 位
数 据 类 型，像 long 和 double 都 不 是 原 子 的，但 volatile 类 型 的 double 和
long 就 是 原 子 的 。

### 5 、 10 个线程和 2 个线程的同步代码，哪个更容易写？................

#### 从 写 代 码 的 角 度 来 说 ， 两 者 的 复 杂 度 是 相 同 的 ， 因 为 同 步 代 码 与 线 程 数 量 是 相 互

#### 独 立 的 。 但 是 同 步 策 略 的 选 择 依 赖 于 线 程 的 数 量 ， 因 为 越 多 的 线 程 意 味 着 更 大 的

#### 竞 争 ， 所 以 你 需 要 利 用 同 步 技 术 ， 如 锁 分 离 ， 这 要 求 更 复 杂 的 代 码 和 专 业 知 识 。

### 6 、你是如何调用 wait（）方法的？使用 if 块还是循环？为什么？

wait() 方 法 应 该 在 循 环 调 用 ， 因 为 当 线 程 获 取 到 CPU 开 始 执 行 的 时 候 ， 其 他 条
件 可 能 还 没 有 满 足 ， 所 以 在 处 理 前 ， 循 环 检 测 条 件 是 否 满 足 会 更 好 。 下 面 是 一 段
标 准 的 使 用 wait 和 notify 方 法 的 代 码 ：

//Thestandardidiomforusingthewaitmethod
synchronized(obj){


while(conditiondoesnothold)
obj.wait();//(Releaseslock,andreacquiresonwakeup)
...//Performactionappropriatetocondition
}

参 见 [EffectiveJava]第 69 条 ， 获 取 更 多 关 于 为 什 么 应 该 在 循 环 中 来 调 用 wait
方 法 的 内 容 。

###7、 什 么 是 多 线 程 环 境 下 的 伪 共 享 （falsesharing） ？
伪 共 享 是 多 线 程 系 统 （ 每 个 处 理 器 有 自 己 的 局 部 缓 存 ） 中 一 个 众 所 周 知 的 性 能 问
题 。 伪 共 享 发 生 在 不 同 处 理 器 的 上 的 线 程 对 变 量 的 修 改 依 赖 于 相 同 的 缓 存 行 ， 如
下 图 所 示 ：

### 有经验程序员的 Java 面试题...............................................................

#### 伪 共 享 问 题 很 难 被 发 现 ， 因 为 线 程 可 能 访 问 完 全 不 同 的 全 局 变 量 ， 内 存 中 却 碰 巧

#### 在 很 相 近 的 位 置 上 。 如 其 他 诸 多 的 并 发 问 题 ， 避 免 伪 共 享 的 最 基 本 方 式 是 仔 细 审

#### 查 代 码 ， 根 据 缓 存 行 来 调 整 你 的 数 据 结 构 。

### 8 、什么是 Busyspin？我们为什么要使用它？.................................

Busyspin 是 一 种 在 不 释 放 CPU 的 基 础 上 等 待 事 件 的 技 术 。 它 经 常 用 于 避 免 丢
失 CPU 缓 存 中 的 数 据 （ 如 果 线 程 先 暂 停 ， 之 后 在 其 他CPU上 运 行 就 会 丢 失 ）。
所 以 ， 如 果 你 的 工 作 要 求 低 延 迟 ， 并 且 你 的 线 程 目 前 没 有 任 何 顺 序 ， 这 样 你 就 可
以 通 过 循 环 检 测 队 列 中 的 新 消 息 来 代 替 调 用 sleep() 或 wait() 方 法 。 它 唯 一 的
好 处 就 是 你 只 需 等 待 很 短 的 时 间 ， 如 几 微 秒 或 几 纳 秒 。LMAX 分 布 式 框 架 是 一 个
高 性 能 线 程 间 通 信 的 库，该 库 有 一 个 BusySpinWaitStrategy 类 就 是 基 于 这 个 概
念 实 现 的 ， 使 用 busyspin 循 环 EventProcessors 等 待 屏 障 。


### 9 、Java 中怎么获取一份线程 dump 文件？....................................

在 Linux 下，你 可 以 通 过 命 令 kill-3PID（Java 进 程 的 进 程 ID）来 获 取 Java
应 用 的 dump 文 件 。 在 Windows 下 ， 你 可 以 按 下 Ctrl+Break 来 获 取 。 这
样 JVM 就 会 将 线 程 的 dump 文 件 打 印 到 标 准 输 出 或 错 误 文 件 中，它 可 能 打 印 在
控 制 台 或 者 日 志 文 件 中 ， 具 体 位 置 依 赖 应 用 的 配 置 。 如 果 你 使 用Tomcat。

### 10 、Swing 是线程安全的？.................................................................

不 是 ，Swing 不 是 线 程 安 全 的 。 你 不 能 通 过 任 何 线 程 来 更 新 Swing 组 件 ， 如
JTable、JList 或 JPanel， 事 实 上 ， 它 们 只 能 通 过 GUI 或 AWT 线 程 来 更 新 。
这 就 是 为 什 么 Swing 提 供 invokeAndWait() 和 invokeLater() 方 法 来 获 取 其
他 线 程 的 GUI 更 新 请 求 。 这 些 方 法 将 更 新 请 求 放 入 AWT 的 线 程 队 列 中 ， 可 以
一 直 等 待 ， 也 可 以 通 过 异 步 更 新 直 接 返 回 结 果 。 你 也 可 以 在 参 考 答 案 中 查 看 和 学
习 到 更 详 细 的 内 容 。

### 11 、什么是线程局部变量？...................................................................

#### 线 程 局 部 变 量 是 局 限 于 线 程 内 部 的 变 量 ， 属 于 线 程 自 身 所 有 ， 不 在 多 个 线 程 间 共

享 。Java 提 供 ThreadLocal 类 来 支 持 线 程 局 部 变 量 ， 是 一 种 实 现 线 程 安 全 的 方
式。但 是 在 管 理 环 境 下（如 web 服 务 器）使 用 线 程 局 部 变 量 的 时 候 要 特 别 小 心，
在 这 种 情 况 下 ， 工 作 线 程 的 生 命 周 期 比 任 何 应 用 变 量 的 生 命 周 期 都 要 长 。 任 何 线
程 局 部 变 量 一 旦 在 工 作 完 成 后 没 有 释 放 ，Java 应 用 就 存 在 内 存 泄 露 的 风 险 。

### 12 、用 wait-notify 写一段代码来解决生产者-消费者问题？........

#### 答 案


[http://java67.blogspot.sg/2012/12/producer-consumer-problem-with-wai](http://java67.blogspot.sg/2012/12/producer-consumer-problem-with-wai)
t-and-notify-example.html

请 参 考 答 案 中 的 示 例 代 码。只 要 记 住 在 同 步 块 中 调 用 wait() 和 notify()方 法，如
果 阻 塞 ， 通 过 循 环 来 测 试 等 待 条 件 。

### 13 、用 Java 写一个线程安全的单例模式（Singleton）？.............

#### 答 案

[http://javarevisited.blogspot.in/2012/12/how-to-create-thread-safe-singl](http://javarevisited.blogspot.in/2012/12/how-to-create-thread-safe-singl)
eton-in-java-example.html

请 参 考 答 案 中 的 示 例 代 码 ， 这 里 面 一 步 一 步 教 你 创 建 一 个 线 程 安 全 的 Java 单 例
类 。 当 我 们 说 线 程 安 全 时 ， 意 思 是 即 使 初 始 化 是 在 多 线 程 环 境 中 ， 仍 然 能 保 证 单
个 实 例。Java 中，使 用 枚 举 作 为 单 例 类 是 最 简 单 的 方 式 来 创 建 线 程 安 全 单 例 模 式
的 方 式 。

### 14 、Java 中 sleep 方法和 wait 方法的区别？...............................

虽 然 两 者 都 是 用 来 暂 停 当 前 运 行 的 线 程 ， 但 是 sleep() 实 际 上 只 是 短 暂 停 顿 ， 因
为 它 不 会 释 放 锁，而 wait() 意 味 着 条 件 等 待，这 就 是 为 什 么 该 方 法 要 释 放 锁，因
为 只 有 这 样 ， 其 他 等 待 的 线 程 才 能 在 满 足 条 件 时 获 取 到 该 锁 。

### 个不可变对象？........................................................................................ 15 、什么是不可变对象（immutableobject）？Java 中怎么创建一

### 创建一个不可变对象？


#### 不 可 变 对 象 指 对 象 一 旦 被 创 建 ， 状 态 就 不 能 再 改 变 。 任 何 修 改 都 会 创 建 一 个 新 的

对 象，如 String、Integer及 其 它 包 装 类。详 情 参 见 答 案，一 步 一 步 指 导 你 在 Java
中 创 建 一 个 不 可 变 的 类 。

### 16 、我们能创建一个包含可变对象的不可变对象吗？.......................

#### 是 的 ， 我 们 是 可 以 创 建 一 个 包 含 可 变 对 象 的 不 可 变 对 象 的 ， 你 只 需 要 谨 慎 一 点 ，

#### 不 要 共 享 可 变 对 象 的 引 用 就 可 以 了，如 果 需 要 变 化 时，就 返 回 原 对 象 的 一 个 拷 贝。

#### 最 常 见 的 例 子 就 是 对 象 中 包 含 一 个 日 期 对 象 的 引 用 。

### 数据类型和 Java 基础面试问题...........................................................

### 17 、Java 中应该使用什么数据类型来代表价格？.............................

如 果 不 是 特 别 关 心 内 存 和 性 能 的 话 ， 使 用BigDecimal， 否 则 使 用 预 定 义 精 度 的
double 类 型 。

### 18 、怎么将 byte 转换为 String？.....................................................

可 以 使 用 String 接 收 byte[] 参 数 的 构 造 器 来 进 行 转 换，需 要 注 意 的 点 是 要 使 用
的 正 确 的 编 码 ， 否 则 会 使 用 平 台 默 认 编 码 ， 这 个 编 码 可 能 跟 原 来 的 编 码 相 同 ， 也
可 能 不 同 。

### 19 、Java 中怎样将 bytes 转换为 long 类型？..............................


#### 这 个 问 题 你 来 回 答 :-)

### byte 类型的范围，将会出现什么现象？............................................. 20 、我们能将 int 强制转换为 byte 类型的变量吗？如果该值大于

### 大于 byte 类型的范围，将会出现什么现象？

是 的，我 们 可 以 做 强 制 转 换，但 是 Java 中 int 是 32 位 的，而 byte 是 8 位
的，所 以，如 果 强 制 转 化 是，int 类 型 的 高 24 位 将 会 被 丢 弃，byte 类 型 的 范 围
是 从 -128 到 128 。

### 如 C=(C)B；........................................................................................ 21 、存在两个类，B 继承 A，C 继承 B，我们能将 B转换为 C 么？

### C 么？如 C=(C)B；

#### 答 案

[http://javarevisited.blogspot.sg/2012/12/what-is-type-casting-in-java-cla](http://javarevisited.blogspot.sg/2012/12/what-is-type-casting-in-java-cla)
ss-interface-example.html

### 22 、哪个类包含 clone 方法？是 Cloneable 还是 Object？.......

java.lang.Cloneable 是 一 个 标 示 性 接 口 ， 不 包 含 任 何 方 法 ，clone 方 法 在
object 类 中 定 义。并 且 需 要 知 道 clone() 方 法 是 一 个 本 地 方 法，这 意 味 着 它 是 由
c 或 c++ 或 其 他 本 地 语 言 实 现 的 。

### 23 、Java 中 ++ 操作符是线程安全的吗？.......................................


#### 答 案 ： 不 是 线 程 安 全 的 操 作 。 它 涉 及 到 多 个 指 令 ， 如 读 取 变 量 值 ， 增 加 ， 然 后 存

#### 储 回 内 存 ， 这 个 过 程 可 能 会 出 现 多 个 线 程 交 差 。

### 23 、不是线程安全的操作。它涉及到多个指令，如读取变量值，

### 增加，然后存储回内存，这个过程可能会出现多个线程交差。

## 24 、a=a+b 与 a+=b 的区别......................................................

#### += 隐 式 的 将 加 操 作 的 结 果 类 型 强 制 转 换 为 持 有 结 果 的 类 型 。 如 果 两 这 个 整 型 相

加，如 byte、short 或 者 int，首 先 会 将 它 们 提 升 到 int 类 型，然 后 在 执 行 加 法
操 作。如 果 加 法 操 作 的 结 果 比 a 的 最 大 值 要 大，则 a+b 会 出 现 编 译 错 误，但 是
a+=b 没 问 题 ， 如 下 ：

bytea= 127 ;
byteb= 127 ;
b=a+b;//error:cannotconvertfrominttobyte
b+=a;//ok

（ 译 者 注 ： 这 个 地 方 应 该 表 述 的 有 误 ， 其 实 无 论 a+b 的 值 为 多 少 ， 编 译 器 都 会
报 错，因 为 a+b 操 作 会 将 a、b 提 升 为 int 类 型，所 以 将 int 类 型 赋 值 给 byte
就 会 编 译 出 错 ）

## 类型的变量吗？........................................................................................ 25 、我能在不进行强制转换的情况下将一个 double 值赋值给 long

### long 类型的变量吗？


不 行，你 不 能 在 没 有 强 制 类 型 转 换 的 前 提 下 将 一 个 double 值 赋 值 给 long 类 型
的 变 量，因 为 double 类 型 的 范 围 比 long 类 型 更 广，所 以 必 须 要 进 行 强 制 转 换。

## 26 、3*0.1==0.3 将会返回什么？true 还是 false？.....................

false， 因 为 有 些 浮 点 数 不 能 完 全 精 确 的 表 示 出 来 。

## 27 、int 和 Integer 哪个会占用更多的内存？..................................

Integer 对 象 会 占 用 更 多 的 内 存。Integer 是 一 个 对 象，需 要 存 储 对 象 的 元 数 据。
但 是 int 是 一 个 原 始 类 型 的 数 据 ， 所 以 占 用 的 空 间 更 少 。

## 28 、为什么 Java 中的 String 是不可变的（Immutable）？.......

Java 中 的 String 不 可 变 是 因 为 Java 的 设 计 者 认 为 字 符 串 使 用 非 常 频 繁，将 字
符 串 设 置 为 不 可 变 可 以 允 许 多 个 客 户 端 之 间 共 享 相 同 的 字 符 串 。

29 、 我 们 能 在 Switch 中 使 用 String 吗 ？
从 Java 7 开 始 ， 我 们 可 以 在 switchcase 中 使 用 字 符 串 ， 但 这 仅 仅 是 一 个 语 法
糖 。 内 部 实 现 在 switch 中 使 用 字 符 串 的 hashcode。

30 、Java 中 的 构 造 器 链 是 什 么 ？

当 你 从 一 个 构 造 器 中 调 用 另 一 个 构 造 器，就 是Java 中 的 构 造 器 链。这 种 情 况 只 在
重 载 了 类 的 构 造 器 的 时 候 才 会 出 现 。

## JVM 底层 与 GC（GarbageCollection） 的面试问题.................


## 31 、 64 位 JVM 中，int 的长度是多数？.........................................

Java 中，int 类 型 变 量 的 长 度 是 一 个 固 定 值，与 平 台 无 关，都 是 32 位。意 思 就
是 说 ， 在 32 位 和 64 位 的Java 虚 拟 机 中 ，int 类 型 的 长 度 是 相 同 的 。

## 32 、Serial 与 ParallelGC之间的不同之处？...................................

Serial 与 Parallel 在GC执 行 的 时 候 都 会 引 起 stop-the-world。 它 们 之 间 主 要
不 同 serial 收 集 器 是 默 认 的 复 制 收 集 器 ， 执 行 GC 的 时 候 只 有 一 个 线 程 ， 而
parallel 收 集 器 使 用 多 个 GC 线 程 来 执 行 。

## 33 、 32 位和 64 位的 JVM，int 类型变量的长度是多数？..........

32 位 和 64 位 的 JVM 中 ，int 类 型 变 量 的 长 度 是 相 同 的 ， 都 是 32 位 或 者 4
个 字 节 。

## 34 、Java 中 WeakReference 与 SoftReference的区别？.........

虽 然 WeakReference 与 SoftReference 都 有 利 于 提 高 GC 和 内 存 的 效 率 ，
但 是 WeakReference ，一 旦 失 去 最 后 一 个 强 引 用，就 会 被 GC 回 收，而 软 引 用
虽 然 不 能 阻 止 被 回 收 ， 但 是 可 以 延 迟 到 JVM 内 存 不 足 的 时 候 。

## 35 、WeakHashMap 是怎么工作的？................................................


WeakHashMap 的 工 作 与 正 常 的 HashMap 类 似 ， 但 是 使 用 弱 引 用 作 为 key，
意 思 就 是 当 key 对 象 没 有 任 何 引 用 时 ，key/value 将 会 被 回 收 。

## 使用？........................................................................................................ 36 、JVM 选项 -XX:+UseCompressedOops 有什么作用？为什么要

### 为什么要使用？

#### 当 你 将 你 的 应 用 从 32 位 的 JVM 迁 移 到 64 位 的 JVM 时，由 于 对 象 的 指 针 从

#### 32 位 增 加 到 了 64 位，因 此 堆 内 存 会 突 然 增 加，差 不 多 要 翻 倍。这 也 会 对 CPU

#### 缓 存（容 量 比 内 存 小 很 多）的 数 据 产 生 不 利 的 影 响。因 为，迁 移 到 64 位 的 JVM

#### 主 要 动 机 在 于 可 以 指 定 最 大 堆 大 小 ， 通 过 压 缩 OOP 可 以 节 省 一 定 的 内 存 。 通 过

-XX:+UseCompressedOops 选 项，JVM 会 使 用 32 位 的 OOP，而 不 是 64 位
的 OOP。

## 37 、怎样通过 Java 程序来判断 JVM 是 32 位 还是 64 位？...

你 可 以 检 查 某 些 系 统 属 性 如 sun.arch.data.model 或 os.arch 来 获 取 该 信 息 。

## 38 、 32 位 JVM 和 64 位 JVM的最大堆内存分别是多数？.......

#### 理 论 上 说 上 32 位 的 JVM 堆 内 存 可 以 到 达 2^32，即 4GB，但 实 际 上 会 比 这 个

小 很 多。不 同 操 作 系 统 之 间 不 同，如 Windows 系 统 大 约 1.5GB，Solaris 大 约
3GB。 64 位 JVM允 许 指 定 最 大 的 堆 内 存 ， 理 论 上 可 以 达 到 2^64， 这 是 一 个 非
常 大 的 数 字，实 际 上 你 可 以 指 定 堆 内 存 大 小 到 100G B。甚 至 有 的 JVM，如 Azul，
堆 内 存 到 1000G 都 是 可 能 的 。


## 39 、JRE、JDK、JVM及 JIT 之间有什么不同？..............................

JRE 代 表 Java 运 行 时（Javarun-time），是 运 行 Java 引 用 所 必 须 的。JDK 代
表 Java 开 发 工 具（Javadevelopmentkit），是 Java 程 序 的 开 发 工 具，如 Java
编 译 器 ， 它 也 包 含 JRE。JVM 代 表 Java 虚 拟 机 （Javavirtualmachine） ， 它
的 责 任 是 运 行 Java 应 用。JIT 代 表 即 时 编 译（JustInTimecompilation），当
代 码 执 行 的 次 数 超 过 一 定 的 阈 值 时 ， 会 将 Java 字 节 码 转 换 为 本 地 代 码 ， 如 ， 主
要 的 热 点 代 码 会 被 准 换 为 本 地 代 码 ， 这 样 有 利 大 幅 度 提 高 Java 应 用 的 性 能 。

## 3 年工作经验的 Java 面试题...............................................................

## 40 、解释 Java 堆空间及 GC？...........................................................

当 通 过 Java 命 令 启 动 Java 进 程 的 时 候 ， 会 为 它 分 配 内 存 。 内 存 的 一 部 分 用 于
创 建 堆 空 间，当 程 序 中 创 建 对 象 的 时 候，就 从 对 空 间 中 分 配 内 存。GC 是 JVM 内
部 的 一 个 进 程 ， 回 收 无 效 对 象 的 内 存 用 于 将 来 的 分 配 。

## JVM 底层面试题及答案.........................................................................

## 41 、你能保证 GC 执行吗？.................................................................

不 能，虽 然 你 可 以 调 用 System.gc() 或 者 Runtime.gc()，但 是 没 有 办 法 保 证 GC
的 执 行 。

## 42 、怎么获取 Java 程序使用的内存？堆使用的百分比？...............


可 以 通 过 java.lang.Runtime 类 中 与 内 存 相 关 方 法 来 获 取 剩 余 的 内 存，总 内 存 及
最 大 堆 内 存。通 过 这 些 方 法 你 也 可 以 获 取 到 堆 使 用 的 百 分 比 及 堆 内 存 的 剩 余 空 间。
Runtime.freeMemory() 方 法 返 回 剩 余 空 间 的 字 节 数 ，Runtime.totalMemory()
方 法 总 内 存 的 字 节 数 ，Runtime.maxMemory() 返 回 最 大 内 存 的 字 节 数 。

## 43 、Java 中堆和栈有什么区别？.........................................................

#### JVM 中 堆 和 栈 属 于 不 同 的 内 存 区 域，使 用 目 的 也 不 同。栈 常 用 于 保 存 方 法 帧 和 局

#### 部 变 量，而 对 象 总 是 在 堆 上 分 配。栈 通 常 都 比 堆 小，也 不 会 在 多 个 线 程 之 间 共 享，

#### 而 堆 被 整 个 JVM 的 所 有 线 程 共 享 。

## 关于内存的的面试问题和答案................................................................

## Java 基本概念面试题.............................................................................

## 44 、“a==b”和”a.equals(b)”有什么区别？...............................

如 果 a 和 b 都 是 对 象 ， 则 a==b 是 比 较 两 个 对 象 的 引 用 ， 只 有 当 a 和 b 指
向 的 是 堆 中 的 同 一 个 对 象 才 会 返 回 true，而 a.equals(b) 是 进 行 逻 辑 比 较，所 以
通 常 需 要 重 写 该 方 法 来 提 供 逻 辑 一 致 性 的 比 较。例 如，String 类 重 写 equals() 方
法 ， 所 以 可 以 用 于 两 个 不 同 对 象 ， 但 是 包 含 的 字 母 相 同 的 比 较 。

## 45 、a.hashCode() 有什么用？与 a.equals(b) 有什么关系？.......


hashCode() 方 法 是 相 应 对 象 整 型 的 hash 值 。 它 常 用 于 基 于 hash 的 集 合 类，
如 Hashtable、HashMap、LinkedHashMap等 等。它 与 equals() 方 法 关 系 特
别 紧 密。根 据 Java 规 范，两 个 使 用 equal() 方 法 来 判 断 相 等 的 对 象，必 须 具 有
相 同 的 hashcode。

## 46 、final、finalize和 finally 的不同之处？....................................

final 是 一 个 修 饰 符，可 以 修 饰 变 量、方 法 和 类。如 果 final 修 饰 变 量，意 味 着 该
变 量 的 值 在 初 始 化 后 不 能 被 改 变。finalize 方 法 是 在 对 象 被 回 收 之 前 调 用 的 方 法，
给 对 象 自 己 最 后 一 个 复 活 的 机 会 ， 但 是 什 么 时 候 调 用 finalize 没 有 保 证 。finally
是 一 个 关 键 字，与 try 和 catch 一 起 用 于 异 常 的 处 理。finally 块 一 定 会 被 执 行，
无 论 在 try 块 中 是 否 有 发 生 异 常 。

## 47 、Java 中的编译期常量是什么？使用它又什么风险？.................

公 共 静 态 不 可 变（publicstaticfinal ）变 量 也 就 是 我 们 所 说 的 编 译 期 常 量，这 里
的 public 可 选 的 。 实 际 上 这 些 变 量 在 编 译 时 会 被 替 换 掉 ， 因 为 编 译 器 知 道 这 些
变 量 的 值 ， 并 且 知 道 这 些 变 量 在 运 行 时 不 能 改 变 。 这 种 方 式 存 在 的 一 个 问 题 是 你
使 用 了 一 个 内 部 的 或 第 三 方 库 中 的 公 有 编 译 时 常 量 ， 但 是 这 个 值 后 面 被 其 他 人 改
变 了，但 是 你 的 客 户 端 仍 然 在 使 用 老 的 值，甚 至 你 已 经 部 署 了 一 个 新 的jar。为 了
避 免 这 种 情 况 ， 当 你 在 更 新 依 赖 JAR 文 件 时 ， 确 保 重 新 编 译 你 的 程 序 。

## Java 集合框架的面试题.........................................................................

#### 这 部 分 也 包 含 数 据 结 构 、 算 法 及 数 组 的 面 试 问 题

## 48 、List、Set、Map 和 Queue 之间的区别(答案)........................


List 是 一 个 有 序 集 合 ， 允 许 元 素 重 复 。 它 的 某 些 实 现 可 以 提 供 基 于 下 标 值 的 常 量
访 问 时 间 ， 但 是 这 不 是 List 接 口 保 证 的 。Set 是 一 个 无 序 集 合 。

## 49 、poll() 方法和 remove() 方法的区别？......................................

poll() 和 remove() 都 是 从 队 列 中 取 出 一 个 元 素 ， 但 是 poll() 在 获 取 元 素 失 败
的 时 候 会 返 回 空 ， 但 是 remove() 失 败 的 时 候 会 抛 出 异 常 。

## 50 、Java 中 LinkedHashMap 和 PriorityQueue 的区别是什么？

PriorityQueue 保 证 最 高 或 者 最 低 优 先 级 的 的 元 素 总 是 在 队 列 头 部 ， 但 是
LinkedHashMap 维 持 的 顺 序 是 元 素 插 入 的 顺 序 。 当 遍 历 一 个 PriorityQueue
时，没 有 任 何 顺 序 保 证，但 是 LinkedHashMap 课 保 证 遍 历 顺 序 是 元 素 插 入 的 顺
序 。

## 51 、ArrayList 与 LinkedList 的不区别？.........................................

最 明 显 的 区 别 是 ArrrayList 底 层 的 数 据 结 构 是 数 组 ， 支 持 随 机 访 问 ， 而
LinkedList 的 底 层 数 据 结 构 书 链 表 ， 不 支 持 随 机 访 问 。 使 用 下 标 访 问 一 个 元 素 ，
ArrayList 的 时 间 复 杂 度 是 O(1)，而 LinkedList 是 O(n)。更 多 细 节 的 讨 论 参 见
答 案 。

## 52 、用哪两种方式来实现集合的排序？...............................................


你 可 以 使 用 有 序 集 合，如 TreeSet 或 TreeMap，你 也 可 以 使 用 有 顺 序 的 的 集 合，
如 list， 然 后 通 过 Collections.sort() 来 排 序 。

## 53 、Java 中怎么打印数组？.................................................................

你 可 以 使 用 Arrays.toString() 和 Arrays.deepToString() 方 法 来 打 印 数 组 。 由
于 数 组 没 有 实 现 toString() 方 法，所 以 如 果 将 数 组 传 递 给 System.out.println()
方 法 ， 将 无 法 打 印 出 数 组 的 内 容 ， 但 是 Arrays.toString() 可 以 打 印 每 个 元 素 。

## 54 、Java 中的 LinkedList 是单向链表还是双向链表？..................

是 双 向 链 表，你 可 以 检 查 JDK 的 源 码。在 Eclipse，你 可 以 使 用 快 捷 键 Ctrl+T，
直 接 在 编 辑 器 中 打 开 该 类 。

## 55 、Java 中的 TreeMap 是采用什么树实现的？(答案).................

Java 中 的 TreeMap 是 使 用 红 黑 树 实 现 的 。

## 56 、Hashtable 与 HashMap 有什么不同之处？...........................

#### 这 两 个 类 有 许 多 不 同 的 地 方 ， 下 面 列 出 了 一 部 分 ：

a)Hashtable 是 JDK 1 遗 留 下 来 的 类 ， 而 HashMap 是 后 来 增 加 的 。
b）Hashtable 是 同 步 的 ， 比 较 慢 ， 但 HashMap 没 有 同 步 策 略 ， 所 以 会 更 快。
c）Hashtable 不 允 许 有 个 空 的 key， 但 是 HashMap 允 许 出 现 一 个 nullkey。
更 多 的 不 同 之 处 参 见 答 案 。


## 57 、Java 中的 HashSet，内部是如何工作的？...............................

HashSet 的 内 部 采 用 HashMap来 实 现。由 于 Map 需 要 key 和 value，所 以
所 有 key 的 都 有 一 个 默 认 value。 类 似 于 HashMap，HashSet 不 允 许 重 复 的
key，只 允 许 有 一 个nullkey，意 思 就 是 HashSet 中 只 允 许 存 储 一 个 null 对 象。

## 58 、写一段代码在遍历 ArrayList 时移除一个元素？......................

该 问 题 的 关 键 在 于 面 试 者 使 用 的 是 ArrayList 的 remove() 还 是 Iterator 的
remove()方 法 。 这 有 一 段示 例 代 码， 是 使 用 正 确 的 方 式 来 实 现 在 遍 历 的 过 程 中 移
除 元 素 ， 而 不 会 出 现 ConcurrentModificationException 异 常 的 示 例 代 码 。

## 59 、我们能自己写一个容器类，然后使用 for-each 循环码？.......

可 以 ， 你 可 以 写 一 个 自 己 的 容 器 类 。 如 果 你 想 使 用 Java 中 增 强 的 循 环 来 遍 历 ，
你 只 需 要 实 现 Iterable 接 口。如 果 你 实 现 Collection 接 口，默 认 就 具 有 该 属 性。

## 60 、ArrayList 和 HashMap 的默认大小是多数？..........................

在 Java 7 中 ，ArrayList 的 默 认 大 小 是 10 个 元 素 ，HashMap 的 默 认 大 小是
16 个 元 素 （ 必 须 是 2 的 幂 ） 。 这 就 是 Java 7 中 ArrayList 和 HashMap 类 的
代 码 片 段 ：

//fromArrayList.javaJDK1.7
privatestaticfinalintDEFAULT_CAPACITY= 10 ;

//fromHashMap.javaJDK 7


staticfinalintDEFAULT_INITIAL_CAPACITY= 1 << 4 ;//aka 16

## 61 、有没有可能两个不相等的对象有有相同的 hashcode？..........

有 可 能 ， 两 个 不 相 等 的 对 象 可 能 会 有 相 同 的 hashcode 值 ， 这 就 是 为 什 么 在
hashmap 中 会 有 冲 突。相 等 hashcode 值 的 规 定 只 是 说 如 果 两 个 对 象 相 等，必
须 有 相 同 的hashcode 值 ， 但 是 没 有 关 于 不 相 等 对 象 的 任 何 规 定 。

## 62 、两个相同的对象会有不同的的 hashcode 吗？.......................

不 能 ， 根 据 hashcode 的 规 定 ， 这 是 不 可 能 的 。

## 63 、我们可以在 hashcode() 中使用随机数字吗？..........................

#### 答 案

[http://javarevisited.blogspot.sg/2011/10/override-hashcode-in-java-exam](http://javarevisited.blogspot.sg/2011/10/override-hashcode-in-java-exam)
ple.html

不 行，因 为 对 象 的 hashcode 值 必 须 是 相 同 的。参 见 答 案 获 取 更 多 关 于 Java 中
重 写 hashCode() 方 法 的 知 识 。

## 64 、Java 中，Comparator 与 Comparable 有什么不同？........

Comparable 接 口 用 于 定 义 对 象 的 自 然 顺 序，而 comparator 通 常 用 于 定 义 用 户
定 制 的 顺 序。Comparable 总 是 只 有 一 个，但 是 可 以 有 多 个 comparator 来 定 义
对 象 的 顺 序 。


65 ） 为 什 么 在 重 写 equals 方 法 的 时 候 需 要 重 写 hashCode 方 法 ？(答 案)
因 为 有 强 制 的 规 范 指 定 需 要 同 时 重 写 hashcode 与 equal 是 方 法，许 多 容 器 类，
如 HashMap、HashSet 都 依 赖 于 hashcode 与 equals 的 规 定 。

## JavaIO 和 NIO 的面试题....................................................................

IO 是 Java 面 试 中 一 个 非 常 重 要 的 点。你 应 该 很 好 掌 握 JavaIO，NIO，NIO2 以
及 与 操 作 系 统 ， 磁 盘 IO 相 关 的 基 础 知 识 。 下 面 是 JavaIO 中 经 常 问 的 问 题 。

## 66 、在我 Java 程序中，我有三个 socket，我需要多少个线程来处理？

## 67 、Java 中怎么创建 ByteBuffer？...................................................

byte[]bytes=newbyte[10];
ByteBufferbuf=ByteBuffer.wrap(bytes);

## 68 、Java 中，怎么读写 ByteBuffer ？.............................................

## 69 、Java 采用的是大端还是小端？.....................................................

## 70 、ByteBuffer 中的字节序是什么？.................................................


## 71 、Java 中，直接缓冲区与非直接缓冲器有什么区别？.................

#### 答 案

[http://javarevisited.blogspot.sg/2015/08/difference-between-direct-non-](http://javarevisited.blogspot.sg/2015/08/difference-between-direct-non-)
direct-mapped-bytebuffer-nio-java.html

## 72 、Java 中的内存映射缓存区是什么？.............................................

#### 答 案

[http://javarevisited.blogspot.sg/2012/01/memorymapped-file-and-io-in-j](http://javarevisited.blogspot.sg/2012/01/memorymapped-file-and-io-in-j)
ava.html

## 73 、socket 选项 TCPNODELAY 是指什么？................................

## 74 、TCP 协议与 UDP 协议有什么区别？.........................................

#### 答 案

[http://javarevisited.blogspot.com/2014/07/9-difference-between-tcp-and](http://javarevisited.blogspot.com/2014/07/9-difference-between-tcp-and)
-udp-protocol.html

## 75 、Java 中，ByteBuffer 与 StringBuffer有什么区别？(答案)..


## Java 最佳实践的面试问题.....................................................................

包 含 Java 中 各 个 部 分 的 最 佳 实 践 ， 如 集 合 ， 字 符 串 ，IO， 多 线 程 ， 错 误 和 异 常
处 理 ， 设 计 模 式 等 等 。

## 76 、Java 中，编写多线程程序的时候你会遵循哪些最佳实践？.....

这 是 我 在 写Java 并 发 程 序 的 时 候 遵 循 的 一 些 最 佳 实 践 ：
a） 给 线 程 命 名 ， 这 样 可 以 帮 助 调 试 。
b） 最 小 化 同 步 的 范 围 ， 而 不 是 将 整 个 方 法 同 步 ， 只 对 关 键 部 分 做 同 步 。
c） 如 果 可 以 ， 更 偏 向 于 使 用 volatile 而 不 是 synchronized。
d） 使 用 更 高 层 次 的 并 发 工 具 ， 而 不 是 使 用 wait() 和 notify() 来 实 现 线 程 间 通
信 ， 如 BlockingQueue，CountDownLatch 及 Semeaphore。
e） 优 先 使 用 并 发 集 合 ， 而 不 是 对 集 合 进 行 同 步 。 并 发 集 合 提 供 更 好 的 可 扩 展 性。

### 77 、说出几点 Java 中使用 Collections 的最佳实践

这 是 我 在 使 用 Java 中 Collectionc 类 的 一 些 最 佳 实 践 ：
a） 使 用 正 确 的 集 合 类 ， 例 如 ， 如 果 不 需 要 同 步 列 表 ， 使 用 ArrayList 而 不 是
Vector。
b） 优 先 使 用 并 发 集 合 ， 而 不 是 对 集 合 进 行 同 步 。 并 发 集 合 提 供 更 好 的 可 扩 展 性。
c） 使 用 接 口 代 表 和 访 问 集 合 ， 如 使 用List存 储 ArrayList， 使 用 Map 存 储
HashMap 等 等 。
d） 使 用 迭 代 器 来 循 环 集 合 。
e） 使 用 集 合 的 时 候 使 用 泛 型 。

### 78 、说出至少 5 点在 Java 中使用线程的最佳实践。


#### 答 案

[http://java67.blogspot.com/2014/01/10-points-about-thread-and-javalan](http://java67.blogspot.com/2014/01/10-points-about-thread-and-javalan)
gthread-in-java.html

这 个 问 题 与 之 前 的 问 题 类 似 ， 你 可 以 使 用 上 面 的 答 案 。 对 线 程 来 说 ， 你 应 该 ：
a） 对 线 程 命 名
b） 将 线 程 和 任 务 分 离 ， 使 用 线 程 池 执 行 器 来 执 行 Runnable 或 Callable。
c） 使 用 线 程 池

### 79 、说出 5 条 IO 的最佳实践(答案)

IO 对 Java 应 用 的 性 能 非 常 重 要。理 想 情 况 下，你 不 应 该 在 你 应 用 的 关 键 路 径 上
避 免 IO 操 作 。 下 面 是 一 些 你 应 该 遵 循 的 JavaIO 最 佳 实 践 ：
a） 使 用 有 缓 冲 区 的 IO 类 ， 而 不 要 单 独 读 取 字 节 或 字 符 。
b） 使 用 NIO 和 NIO2
c） 在 finally 块 中 关 闭 流 ， 或 者 使 用 try-w ith-resource 语 句 。
d） 使 用 内 存 映 射 文 件 获 取 更 快 的 IO。

### 80 、列出 5 个应该遵循的 JDBC 最佳实践

#### 答 案

[http://javarevisited.blogspot.sg/2012/08/top-10-jdbc-best-practices-for-j](http://javarevisited.blogspot.sg/2012/08/top-10-jdbc-best-practices-for-j)
ava.html))

#### 有 很 多 的 最 佳 实 践 ， 你 可 以 根 据 你 的 喜 好 来 例 举 。 下 面 是 一 些 更 通 用 的 原 则 ：

a） 使 用 批 量 的 操 作 来 插 入 和 更 新 数 据


b） 使 用 PreparedStatement 来 避 免 SQL 异 常 ， 并 提 高 性 能 。
c） 使 用 数 据 库 连 接 池
d） 通 过 列 名 来 获 取 结 果 集 ， 不 要 使 用 列 的 下 标 来 获 取 。

### 81 、说出几条 Java 中方法重载的最佳实践？

#### 下 面 有 几 条 可 以 遵 循 的 方 法 重 载 的 最 佳 实 践 来 避 免 造 成 自 动 装 箱 的 混 乱 。

a）不 要 重 载 这 样 的 方 法：一 个 方 法 接 收 int 参 数，而 另 个 方 法 接 收 Integer 参
数 。
b） 不 要 重 载 参 数 数 量 一 致 ， 而 只 是 参 数 顺 序 不 同 的 方 法 。
c） 如 果 重 载 的 方 法 参 数 个 数 多 于 5 个 ， 采 用 可 变 参 数 。

### Date、Time 及 Calendar 的面试题

### 82 、在多线程环境下，SimpleDateFormat 是线程安全的吗？

不 是 ， 非 常 不 幸 ，DateFormat 的 所 有 实 现 ， 包 括 SimpleDateFormat 都 不 是
线 程 安 全 的 ， 因 此 你 不 应 该 在 多 线 程 序 中 使 用 ， 除 非 是 在 对 外 线 程 安 全 的 环 境 中
使 用 ， 如 将 SimpleDateFormat 限 制 在 ThreadLocal 中 。 如 果 你 不 这 么 做 ，
在 解 析 或 者 格 式 化 日 期 的 时 候，可 能 会 获 取 到 一 个 不 正 确 的 结 果。因 此，从 日 期、
时 间 处 理 的 所 有 实 践 来 说 ， 我 强 力 推 荐 joda-time 库 。

### 83 、Java 中如何格式化一个日期？如格式化为 ddMMyyyy

### 的形式？

#### 答 案


[http://javarevisited.blogspot.com/2011/09/convert-date-to-string-simple](http://javarevisited.blogspot.com/2011/09/convert-date-to-string-simple)
dateformat.html
Java 中 ， 可 以 使 用 SimpleDateFormat 类 或 者 joda-time 库 来 格 式 日 期 。
DateFormat 类 允 许 你 使 用 多 种 流 行 的 格 式 来 格 式 化 日 期 。 参 见 答 案 中 的 示 例 代
码，代 码 中 演 示 了 将 日 期 格 式 化 成 不 同 的 格 式，如 dd-MM-yyyy 或 ddMMyyyy。

### 84 、Java 中，怎么在格式化的日期中显示时区？

#### 答 案

[http://java67.blogspot.sg/2013/01/how](http://java67.blogspot.sg/2013/01/how) -to-format-date-in-java-simpledat
eformat-example.html

### 85 、Java 中 java.util.Date 与 java.sql.Date 有什么区别？

#### 答 案

[http://java67.blogspot.sg/2014/02/how](http://java67.blogspot.sg/2014/02/how) -to-convert-javautildate-to-javasq
ldate-example.html

### 86 、Java 中，如何计算两个日期之间的差距？

#### 程 序

[http://javarevisited.blogspot.sg/2015/07/how-to-find-number-of-days-be](http://javarevisited.blogspot.sg/2015/07/how-to-find-number-of-days-be)
tween-two-dates-in-java.html


### 87 、Java 中，如何将字符串 YYYYMMDD 转换为日期？

#### 答 案

[http://java67.blogspot.sg/2014/12/string-to-date-example-in-java-multit](http://java67.blogspot.sg/2014/12/string-to-date-example-in-java-multit)
hreading.html

### 单元测试 JUnit 面试题

### 89 、如何测试静态方法？(答案)

可 以 使 用 PowerMock 库 来 测 试 静 态 方 法 。

### 90 、怎么利用 JUnit 来测试一个方法的异常？

#### 答 案

[http://javarevisited.blogspot.sg/2013/04/JUnit-tutorial-example-test-exce](http://javarevisited.blogspot.sg/2013/04/JUnit-tutorial-example-test-exce)
ption-thrown-by-java-method.html

### 91 、你使用过哪个单元测试库来测试你的 Java 程序？

### 92 、@Before 和 @BeforeClass 有什么区别？

#### 答 案


[http://javarevisited.blogspot.sg/2013/04/JUnit-tutorial-example-test-exce](http://javarevisited.blogspot.sg/2013/04/JUnit-tutorial-example-test-exce)
ption-thrown-by-java-method.html

### 编程和代码相关的面试题

### 93 、怎么检查一个字符串只包含数字？解决方案

[http://java67.blogspot.com/2014/01/java-regular-expression-to-check-nu](http://java67.blogspot.com/2014/01/java-regular-expression-to-check-nu)
mbers-in-String.html

### 94 、Java 中如何利用泛型写一个 LRU 缓存？

### 95 、写一段 Java 程序将 byte 转换为 long？

### 95 、在不使用 StringBuffer 的前提下，怎么反转一个字符串？

#### 解 决 方 案

[http://java67.blogspot.com/2012/12/how](http://java67.blogspot.com/2012/12/how) -to-reverse-string-in-java-string
buffer-stringbuilder.htm

### 97 、Java 中，怎么获取一个文件中单词出现的最高频率？

#### 解 决 方 案


[http://java67.blogspot.com/2015/10/java-program-to-find-repeated-wor](http://java67.blogspot.com/2015/10/java-program-to-find-repeated-wor)
ds-and-count.html

### 98 、如何检查出两个给定的字符串是反序的？

#### 解 决 方 案

[http://javarevisited.blogspot.sg/2013/03/Anagram-how-to-check-if-two-s](http://javarevisited.blogspot.sg/2013/03/Anagram-how-to-check-if-two-s)
tring-are-anagrams-example-tutorial.html

### 99 、Java 中，怎么打印出一个字符串的所有排列？

#### 解 决 方 案

[http://javarevisited.blogspot.com/2015/08/how-to-find-all-permutations-](http://javarevisited.blogspot.com/2015/08/how-to-find-all-permutations-)
of-string-java-example.html

### 100 、Java 中，怎样才能打印出数组中的重复元素？

#### 解 决 方 案

[http://javarevisited.blogspot.com/2015/06/3-ways-to-find-duplicate-elem](http://javarevisited.blogspot.com/2015/06/3-ways-to-find-duplicate-elem)
ents-in-array-java.html

### 101 、Java 中如何将字符串转换为整数？


Strings="123";
inti;
第 一 种 方 法 ：i=Integer.parseInt(s);
第 二 种 方 法 ：i=Integer.valueOf(s).intValue();

### 102 、在没有使用临时变量的情况如何交换两个整数变量的值？

#### 解 决 方 案

https://blog.csdn.net/z idane_2014/article/details/34180223

### 关于 OOP 和设计模式的面试题

这 部 分 包 含 Java 面 试 过 程 中 关 于 SOLID 的 设 计 原 则，OOP 基 础，如 类，对 象，
接 口 ， 继 承 ， 多 态 ， 封 装 ， 抽 象 以 及 更 高 级 的 一 些 概 念 ， 如 组 合 、 聚 合 及 关 联 。
也 包 含 了 GOF 设 计 模 式 的 问 题 。

### 103 、接口是什么？为什么要使用接口而不是直接使用具体类？

#### 接 口 用 于 定 义 API。 它 定 义 了 类 必 须 得 遵 循 的 规 则 。 同 时 ， 它 提 供 了 一 种 抽 象 ，

因 为 客 户 端 只 使 用 接 口，这 样 可 以 有 多 重 实 现，如 List 接 口，你 可 以 使 用 可 随 机
访 问 的 ArrayList， 也 可 以 使 用 方 便 插 入 和 删 除 的 LinkedList。 接 口 中 不 允 许 写
代 码 ， 以 此 来 保 证 抽 象 ， 但 是 Java 8 中 你 可 以 在 接 口 声 明 静 态 的 默 认 方 法 ， 这
种 方 法 是 具 体 的 。

### 104 、Java 中，抽象类与接口之间有什么不同？


Java 中，抽 象 类 和 接 口 有 很 多 不 同 之 处，但 是 最 重 要 的 一 个 是 Java 中 限 制 一 个
类 只 能 继 承 一 个 类 ， 但 是 可 以 实 现 多 个 接 口 。 抽 象 类 可 以 很 好 的 定 义 一 个 家 族 类
的 默 认 行 为 ， 而 接 口 能 更 好 的 定 义 类 型 ， 有 助 于 后 面 实 现 多 态 机 制 。

### 105 、除了单例模式，你在生产环境中还用过什么设计模式？

#### 这 需 要 根 据 你 的 经 验 来 回 答 。 一 般 情 况 下 ， 你 可 以 说 依 赖 注 入 ， 工 厂 模 式 ， 装 饰

#### 模 式 或 者 观 察 者 模 式 ， 随 意 选 择 你 使 用 过 的 一 种 即 可 。 不 过 你 要 准 备 回 答 接 下 的

#### 基 于 你 选 择 的 模 式 的 问 题 。

### 106 、你能解释一下里氏替换原则吗?

#### 答 案

https://blog.csdn.net/pu_xubo565599455/article/details/51488323

### 107) 什么情况下会违反迪米特法则？为什么会有这个问题？

#### 迪 米 特 法 则 建 议“只 和 朋 友 说 话，不 要 陌 生 人 说 话”，以 此 来 减 少 类 之 间 的 耦 合。

### 108 、适配器模式是什么？什么时候使用？

#### 适 配 器 模 式 提 供 对 接 口 的 转 换 。 如 果 你 的 客 户 端 使 用 某 些 接 口 ， 但 是 你 有 另 外 一

#### 些 接 口 ， 你 就 可 以 写 一 个 适 配 去 来 连 接 这 些 接 口 。

### 109 、什么是“依赖注入”和“控制反转”？为什么有人使用？


控 制 反 转 （IOC） 是Spring框 架 的 核 心 思 想 ， 用 我 自 己 的 话 说 ， 就 是 你 要 做 一 件
事 ， 别 自 己 可 劲new了 ， 你 就 说 你 要 干 啥 ， 然 后 外 包 出 去 就 好~
依 赖 注 入（DI） 在 我 浅 薄 的 想 法 中，就 是 通 过 接 口 的 引 用 和 构 造 方 法 的 表 达，将
一 些 事 情 整 好 了 反 过 来 传 给 需 要 用 到 的 地 方~

### 110 、抽象类是什么？它与接口有什么区别？你为什么要使用过

### 抽象类？

#### 接 口 用 于 规 范 ， 抽 象 类 用 于 共 性.

#### 声 明 方 法 的 存 在 而 不 去 实 现 它 的 类 被 叫 做 抽 象 类

接 口 （interface） 是 抽 象 类 的 变 体 。 在 接 口 中 ， 所 有 方 法 都 是 抽 象 的 。

### 111 、构造器注入和 setter 依赖注入，那种方式更好？

#### 每 种 方 式 都 有 它 的 缺 点 和 优 点 。 构 造 器 注 入 保 证 所 有 的 注 入 都 被 初 始 化 ， 但 是

setter 注 入 提 供 更 好 的 灵 活 性 来 设 置 可 选 依 赖 。 如 果 使 用 XML 来 描 述 依 赖 ，
Setter 注 入 的 可 读 写 会 更 强 。 经 验 法 则 是 强 制 依 赖 使 用 构 造 器 注 入 ， 可 选 依 赖 使
用 setter 注 入 。

### 112 、依赖注入和工程模式之间有什么不同？

#### 虽 然 两 种 模 式 都 是 将 对 象 的 创 建 从 应 用 的 逻 辑 中 分 离 ， 但 是 依 赖 注 入 比 工 程 模 式

#### 更 清 晰 。 通 过 依 赖 注 入 ， 你 的 类 就 是 POJO， 它 只 知 道 依 赖 而 不 关 心 它 们 怎 么 获

#### 取 。 使 用 工 厂 模 式 ， 你 的 类 需 要 通 过 工 厂 来 获 取 依 赖 。 因 此 ， 使 用 DI 会 比 使 用

#### 工 厂 模 式 更 容 易 测 试 。


### 113 、适配器模式和装饰器模式有什么区别？

#### 虽 然 适 配 器 模 式 和 装 饰 器 模 式 的 结 构 类 似 ， 但 是 每 种 模 式 的 出 现 意 图 不 同 。 适 配

#### 器 模 式 被 用 于 桥 接 两 个 接 口 ， 而 装 饰 模 式 的 目 的 是 在 不 修 改 类 的 情 况 下 给 类 增 加

#### 新 的 功 能 。

### 114 、适配器模式和代理模式之前有什么不同？

#### 这 个 问 题 与 前 面 的 类 似 ， 适 配 器 模 式 和 代 理 模 式 的 区 别 在 于 他 们 的 意 图 不 同 。 由

#### 于 适 配 器 模 式 和 代 理 模 式 都 是 封 装 真 正 执 行 动 作 的 类 ， 因 此 结 构 是 一 致 的 ， 但 是

#### 适 配 器 模 式 用 于 接 口 之 间 的 转 换 ， 而 代 理 模 式 则 是 增 加 一 个 额 外 的 中 间 层 ， 以 便

#### 支 持 分 配 、 控 制 或 智 能 访 问 。

### 115 、什么是模板方法模式？

#### 模 板 方 法 提 供 算 法 的 框 架 ， 你 可 以 自 己 去 配 置 或 定 义 步 骤 。 例 如 ， 你 可 以 将 排 序

#### 算 法 看 做 是 一 个 模 板 。 它 定 义 了 排 序 的 步 骤 ， 但 是 具 体 的 比 较 ， 可 以 使 用

Comparable 或 者 其 语 言 中 类 似 东 西 ， 具 体 策 略 由 你 去 配 置 。 列 出 算 法 概 要 的 方
法 就 是 众 所 周 知 的 模 板 方 法 。

### 116 、什么时候使用访问者模式？

#### 访 问 者 模 式 用 于 解 决 在 类 的 继 承 层 次 上 增 加 操 作 ， 但 是 不 直 接 与 之 关 联 。 这 种 模

#### 式 采 用 双 派 发 的 形 式 来 增 加 中 间 层 。

### 117 、什么时候使用组合模式？


#### 组 合 模 式 使 用 树 结 构 来 展 示 部 分 与 整 体 继 承 关 系 。 它 允 许 客 户 端 采 用 统 一 的 形 式

#### 来 对 待 单 个 对 象 和 对 象 容 器 。 当 你 想 要 展 示 对 象 这 种 部 分 与 整 体 的 继 承 关 系 时 采

#### 用 组 合 模 式 。

### 118 、继承和组合之间有什么不同？

#### 虽 然 两 种 都 可 以 实 现 代 码 复 用 ， 但 是 组 合 比 继 承 共 灵 活 ， 因 为 组 合 允 许 你 在 运 行

#### 时 选 择 不 同 的 实 现 。 用 组 合 实 现 的 代 码 也 比 继 承 测 试 起 来 更 加 简 单 。

### 119 、描述 Java 中的重载和重写？

#### 重 载 和 重 写 都 允 许 你 用 相 同 的 名 称 来 实 现 不 同 的 功 能 ， 但 是 重 载 是 编 译 时 活 动 ，

#### 而 重 写 是 运 行 时 活 动 。 你 可 以 在 同 一 个 类 中 重 载 方 法 ， 但 是 只 能 在 子 类 中 重 写 方

#### 法 。 重 写 必 须 要 有 继 承 。

### 120 、Java 中，嵌套公共静态类与顶级类有什么不同？

类 的 内 部 可 以 有 多 个 嵌 套 公 共 静 态 类 ， 但 是 一 个 Java 源 文 件 只 能 有 一 个 顶 级 公
共 类 ， 并 且 顶 级 公 共 类 的 名 称 与 源 文 件 名 称 必 须 一 致 。

### 121 、 OOP 中的 组合、聚合和关联有什么区别？

#### 如 果 两 个 对 象 彼 此 有 关 系 ， 就 说 他 们 是 彼 此 相 关 联 的 。 组 合 和 聚 合 是 面 向 对 象 中

#### 的 两 种 形 式 的 关 联 。 组 合 是 一 种 比 聚 合 更 强 力 的 关 联 。 组 合 中 ， 一 个 对 象 是 另 一

#### 个 的 拥 有 者 ， 而 聚 合 则 是 指 一 个 对 象 使 用 另 一 个 对 象 。 如 果 对 象 A 是 由 对 象 B


#### 组 合 的，则 A 不 存 在 的 话，B一 定 不 存 在，但 是 如 果 A 对 象 聚 合 了 一 个 对 象 B，

#### 则 即 使 A 不 存 在 了 ，B 也 可 以 单 独 存 在 。

### 122 、给我一个符合开闭原则的设计模式的例子？

#### 开 闭 原 则 要 求 你 的 代 码 对 扩 展 开 放 ， 对 修 改 关 闭 。 这 个 意 思 就 是 说 ， 如 果 你 想 增

#### 加 一 个 新 的 功 能 ， 你 可 以 很 容 易 的 在 不 改 变 已 测 试 过 的 代 码 的 前 提 下 增 加 新 的 代

#### 码 。 有 好 几 个 设 计 模 式 是 基 于 开 闭 原 则 的 ， 如 策 略 模 式 ， 如 果 你 需 要 一 个 新 的 策

#### 略 ， 只 需 要 实 现 接 口 ， 增 加 配 置 ， 不 需 要 改 变 核 心 逻 辑 。 一 个 正 在 工 作 的 例 子 是

Collections.sort() 方 法，这 就 是 基 于 策 略 模 式，遵 循 开 闭 原 则 的，你 不 需 为 新 的
对 象 修 改 sort() 方 法 ， 你 需 要 做 的 仅 仅 是 实 现 你 自 己 的 Comparator 接 口 。

### 123 、抽象工厂模式和原型模式之间的区别？

#### 抽 象 工 厂 模 式 ： 通 常 由 工 厂 方 法 模 式 来 实 现 。 但 一 个 工 厂 中 往 往 含 有 多 个 工 厂 方

#### 法 生 成 一 系 列 的 产 品 。 这 个 模 式 强 调 的 是 客 户 代 码 一 次 保 证 只 使 用 一 个 系 列 的 产

#### 品 。 当 要 切 换 为 另 一 个 系 列 的 产 品 ， 换 一 个 工 厂 类 即 可 。

#### 原 型 模 式 ： 工 厂 方 法 的 最 大 缺 点 就 是 ， 对 应 一 个 继 承 体 系 的 产 品 类 ， 要 有 一 个 同

#### 样 复 杂 的 工 厂 类 的 继 承 体 系 。 我 们 可 以 把 工 厂 类 中 的 工 厂 方 法 放 到 产 品 类 自 身 之

#### 中 吗 ？ 如 果 这 样 的 话，就 可 以 将 两 个 继 承 体 系 为 一 个。这 也 就 是 原 型 模 式 的 思 想，

原 型 模 式 中 的 工 厂 方 法 为clone，它 会 返 回 一 个 拷 贝（可 以 是 浅 拷 贝，也 可 以 是 深
拷 贝 ， 由 设 计 者 决 定 ） 。 为 了 保 证 用 户 代 码 中 到 时 可 以 通 过 指 针 调 用clone来 动
态 绑 定 地 生 成 所 需 的 具 体 的 类 。 这 些 原 型 对 象 必 须 事 先 构 造 好 。

原 型 模 式 想 对 工 厂 方 法 模 式 的 另 一 个 好 处 是，拷 贝 的 效 率 一 般 对 构 造 的 效 率 要 高。

#### 124 、 什 么 时 候 使 用 享 元 模 式 ？


#### 享 元 模 式 通 过 共 享 对 象 来 避 免 创 建 太 多 的 对 象 。 为 了 使 用 享 元 模 式 ， 你 需 要 确 保

你 的 对 象 是 不 可 变 的 ， 这 样 你 才 能 安 全 的 共 享 。JDK 中 String 池 、Integer 池
以 及 Long 池 都 是 很 好 的 使 用 了 享 元 模 式 的 例 子 。

### Java 面试中其他各式各样的问题

这 部 分 包 含 Java 中 关 于 XML 的 面 试 题，正 则 表 达 式 面 试 题，Java 错 误 和 异 常
及 序 列 化 面 试 题

### 125 、嵌套静态类与顶级类有什么区别？

#### 一 个 公 共 的 顶 级 类 的 源 文 件 名 称 与 类 名 相 同 ， 而 嵌 套 静 态 类 没 有 这 个 要 求 。 一 个

#### 嵌 套 类 位 于 顶 级 类 内 部 ， 需 要 使 用 顶 级 类 的 名 称 来 引 用 嵌 套 静 态 类 ， 如

HashMap.Entry 是 一 个 嵌 套 静 态 类 ，HashMap 是 一 个 顶 级 类 ，Entry是 一 个 嵌
套 静 态 类 。

### 126 、你能写出一个正则表达式来判断一个字符串是否是一个数

### 字吗？

#### 一 个 数 字 字 符 串 ， 只 能 包 含 数 字 ， 如 0 到 9 以 及 +、- 开 头 ， 通 过 这 个 信 息，

#### 你 可 以 下 一 个 如 下 的 正 则 表 达 式 来 判 断 给 定 的 字 符 串 是 不 是 数 字 。

首先要importjava.util.regex.Pattern 和 java.util.regex.Matcher
publicbooleanisNumeric(Stringstr){
Patternpattern=Pattern.compile("[0-9]*");
MatcherisNum=pattern.matcher(str);
if(!isNum.matches()){


returnfalse;
}
returntrue;
}

### 127 、Java 中，受检查异常 和 不受检查异常的区别？

#### 受 检 查 异 常 编 译 器 在 编 译 期 间 检 查 。 对 于 这 种 异 常 ， 方 法 强 制 处 理 或 者 通 过

throws 子 句 声 明 。 其 中 一 种 情 况 是 Exception 的 子 类 但 不 是
RuntimeException 的 子 类。非 受 检 查 是 RuntimeException 的 子 类，在 编 译 阶
段 不 受 编 译 器 的 检 查 。

### 128 、Java 中，throw 和 throws 有什么区别

throw 用 于 抛 出 java.lang.Throwable 类 的 一 个 实 例 化 对 象，意 思 是 说 你 可 以 通
过 关 键 字 throw 抛 出 一 个 Error 或 者 一 个Exception， 如 ：
thrownewIllegalArgumentException(“sizemustbemultipleof 2 ′′)

而throws 的 作 用 是 作 为 方 法 声 明 和 签 名 的 一 部 分 ， 方 法 被 抛 出 相 应 的 异 常 以 便
调 用 者 能 处 理 。Java 中 ， 任 何 未 处 理 的 受 检 查 异 常 强 制 在 throws 子 句 中 声 明。

### 129 、Java 中，Serializable 与 Externalizable 的区别？

Serializable 接 口 是 一 个 序 列 化 Java 类 的 接 口 ， 以 便 于 它 们 可 以 在 网 络 上 传 输
或 者 可 以 将 它 们 的 状 态 保 存 在 磁 盘 上，是 JVM 内 嵌 的 默 认 序 列 化 方 式，成 本 高、
脆 弱 而 且 不 安 全 。Externalizable 允 许 你 控 制 整 个 序 列 化 过 程 ， 指 定 特 定 的 二 进
制 格 式 ， 增 加 安 全 机 制 。


### 130 、Java 中，DOM 和 SAX 解析器有什么不同？

#### DOM 解 析 器 将 整 个 XML 文 档 加 载 到 内 存 来 创 建 一 棵 DOM 模 型 树，这 样 可 以

#### 更 快 的 查 找 节 点 和 修 改 XML 结 构 ， 而 SAX 解 析 器 是 一 个 基 于 事 件 的 解 析 器 ，

#### 不 会 将 整 个 XML 文 档 加 载 到 内 存 。 由 于 这 个 原 因 ，DOM 比 SAX 更 快 ， 也 要

#### 求 更 多 的 内 存 ， 不 适 合 于 解 析 大 XML 文 件 。

### 131 、说出 JDK1.7 中的三个新特性？

#### 虽 然 JDK1.7 不 像 JDK 5 和 8 一 样 的 大 版 本 ， 但 是 ， 还 是 有 很 多 新 的 特 性 ，

如 try-with-resource 语 句 ， 这 样 你 在 使 用 流 或 者 资 源 的 时 候 ， 就 不 需 要 手 动 关
闭，Java 会 自 动 关 闭。Fork-Join 池 某 种 程 度 上 实 现 Java 版 的 Map-reduce。
允 许 Switch 中 有 String 变 量 和 文 本 。 菱 形 操 作 符(<>)用 于 类 型 推 断 ， 不 再 需
要 在 变 量 声 明 的 右 边 申 明 泛 型 ， 因 此 可 以 写 出 可 读 写 更 强 、 更 简 洁 的 代 码 。 另 一
个 值 得 一 提 的 特 性 是 改 善 异 常 处 理 ， 如 允 许 在 同 一 个 catch 块 中 捕 获 多 个 异 常。

### 132 、说出 5 个 JDK1.8 引入的新特性？

Java 8 在 Java 历 史 上 是 一 个 开 创 新 的 版 本 ， 下 面 JDK 8 中 5 个 主 要 的 特 性：
Lambda 表 达 式 ， 允 许 像 对 象 一 样 传 递 匿 名 函 数
StreamAPI， 充 分 利 用 现 代 多 核 CPU， 可 以 写 出 很 简 洁 的 代 码
Date 与 TimeAPI， 最 终 ， 有 一 个 稳 定 、 简 单 的 日 期 和 时 间 库 可 供 你 使 用
扩 展 方 法 ， 现 在 ， 接 口 中 可 以 有 静 态 、 默 认 方 法 。
重 复 注 解 ， 现 在 你 可 以 将 相 同 的 注 解 在 同 一 类 型 上 使 用 多 次 。

### 133 、Java 中，Maven 和 ANT 有什么区别？


虽 然 两 者 都 是 构 建 工 具 ， 都 用 于 创 建 Java 应 用 ， 但 是 Maven 做 的 事 情 更 多 ，
在 基 于“约 定 优 于 配 置”的 概 念 下，提 供 标 准 的Java 项 目 结 构，同 时 能 为 应 用 自
动 管 理 依 赖（应 用 中 所 依 赖 的 JAR 文 件），Maven 与 ANT 工 具 更 多 的 不 同 之
处 请 参 见 答 案 。

这 就 是 所 有 的 面 试 题 ， 如 此 之 多 ， 是 不 是 ？ 我 可 以 保 证 ， 如 果 你 能 回 答 列 表 中 的
所 有 问 题 ， 你 就 可 以 很 轻 松 的 应 付 任 何 核 心 Java 或 者 高 级 Java 面 试 。 虽 然 ，
这 里 没 有 涵 盖 Servlet、JSP、JSF、JPA，JMS，EJB 及 其 它 JavaEE 技 术 ， 也
没 有 包 含 主 流 的 框 架 如 SpringMVC，Struts2.0，Hibernate，也 没 有 包 含 SOAP
和 RESTfulwebservice，但 是 这 份 列 表 对 做 Java 开 发 的、准 备 应 聘 Javaweb
开 发 职 位 的 人 还 是 同 样 有 用 的，因 为 所 有 的 Java 面 试，开 始 的 问 题 都 是 Java 基
础 和 JDKAPI 相 关 的。如 果 你 认 为 我 这 里 有 任 何 应 该 在 这 份 列 表 中 而 被 我 遗 漏 了
的 Java 流 行 的 问 题 ， 你 可 以 自 由 的 给 我 建 议 。 我 的 目 的 是 从 最 近 的 面 试 中 创 建
一 份 最 新 的 、 最 优 的 Java 面 试 问 题 列 表 。

## Spring 面试题（一）

### 1 、一般问题

### 1.1、不同版本的 SpringFramework 有哪些主要功能？

Version Feature

Spring2.5 发布于 2007 年。这是第一个支持注解的版本。

Spring3.0 发布于 2009 年。它完全利用了 Java5中的改进，并为 JEE6提供了支
持。

Spring4.0 发布于 2013 年。这是第一个完全支持 JAVA8 的版本。


### 1.2、什么是 SpringFramework？

Spring 是 一 个 开 源 应 用 框 架，旨 在 降 低 应 用 程 序 开 发 的 复 杂 度。它 是 轻 量 级、松
散 耦 合 的 。 它 具 有 分 层 体 系 结 构 ， 允 许 用 户 选 择 组 件 ， 同 时 还 为 J2EE 应 用 程 序
开 发 提 供 了 一 个 有 凝 聚 力 的 框 架。它 可 以 集 成 其 他 框 架，如 Structs、Hibernate、
EJB 等 ， 所 以 又 称 为 框 架 的 框 架 。

### 1.3、列举 SpringFramework 的优点。

由 于 SpringFrameworks 的 分 层 架 构 ， 用 户 可 以 自 由 选 择 自 己 需 要 的 组 件 。
SpringFramework 支 持 POJO(PlainOldJavaObject) 编 程，从 而 具 备 持 续 集
成 和 可 测 试 性 。 由 于 依 赖 注 入 和 控 制 反 转 ，JDBC 得 以 简 化 。 它 是 开 源 免 费 的 。

### 1.4、SpringFramework 有哪些不同的功能？

**轻 量 级** - Spring 在 代 码 量 和 透 明 度 方 面 都 很 轻 便。 **IOC** - 控 制 反 转 **AOP** - 面 向
切 面 编 程 可 以 将 应 用 业 务 逻 辑 和 系 统 服 务 分 离，以 实 现 高 内 聚。 **容 器** - Spring 负
责 创 建 和 管 理 对 象 （Bean） 的 生 命 周 期 和 配 置 。 **MVC** - 对 web 应 用 提 供 了 高
度 可 配 置 性，其 他 框 架 的 集 成 也 十 分 方 便。 **事 务 管 理** - 提 供 了 用 于 事 务 管 理 的 通
用 抽 象 层 。Spring 的 事 务 支 持 也 可 用 于 容 器 较 少 的 环 境 。 **JDBC 异 常** - Spring
的 JDBC 抽 象 层 提 供 了 一 个 异 常 层 次 结 构 ， 简 化 了 错 误 处 理 策 略 。

### 1.5、SpringFramework 中有多少个模块，它们分别是什么？


```
Spring 核 心 容 器 – 该 层 基 本 上 是 SpringFramework 的 核 心 。 它 包 含 以 下 模
块 ：
```

 SpringCore
 SpringBean
 SpEL(SpringExpressionLanguage)
 SpringContext

#### 数 据 访 问/集 成 – 该 层 提 供 与 数 据 库 交 互 的 支 持 。 它 包 含 以 下 模 块 ：

 JDBC(JavaDataBaseConnectivity)
 ORM(ObjectRelationalMapping)
 OXM(ObjectXMLMappers)


 JMS(JavaMessagingService)
 Transaction

```
Web – 该 层 提 供 了 创 建 Web 应 用 程 序 的 支 持 。 它 包 含 以 下 模 块 ：
```

 Web
 Web – Servlet
 Web – Socket
 Web – Portlet

#### AOP

 该层支持面向切面编程

```
Instrumentation
```

 该层为类检测和类加载器实现提供支持。

```
Test
```

 该层为使用 JUnit 和 TestNG 进行测试提供支持。

#### 几 个 杂 项 模 块:


```
Messaging – 该 模 块 为 STOMP 提 供 支 持 。 它 还 支 持 注 解 编 程 模 型 ， 该 模 型 用
于 从 WebSocket 客 户 端 路 由 和 处 理 STOMP 消 息 。
```

```
Aspects – 该 模 块 为 与 AspectJ 的 集 成 提 供 支 持 。
```

### 1.6、什么是 Spring 配置文件？

```
Spring 配 置 文 件 是 XML 文 件。该 文 件 主 要 包 含 类 信 息。它 描 述 了 这 些 类 是 如 何
配 置 以 及 相 互 引 入 的。但 是，XML 配 置 文 件 冗 长 且 更 加 干 净。如 果 没 有 正 确 规 划
和 编 写 ， 那 么 在 大 项 目 中 管 理 变 得 非 常 困 难 。
```

### 1.7、Spring 应用程序有哪些不同组件？

```
Spring 应 用 一 般 有 以 下 组 件 ：
```

 **接口** - 定义功能。
 **Bean 类** - 它包含属性，setter 和 getter 方法，函数等。
 **Spring 面向切面编程（AOP）** - 提供面向切面编程的功能。
 **Bean 配置文件** - 包含类的信息以及如何配置它们。
 **用户程序** - 它使用接口。

### 1.8、使用 Spring 有哪些方式？

```
使 用 Spring 有 以 下 方 式 ：
```

 作为一个成熟的 SpringWeb 应用程序。


 作为第三方 Web 框架，使用 SpringFrameworks 中间层。
 用于远程使用。
 作为企业级 JavaBean，它可以包装现有的 POJO（PlainOldJava
Objects）。

### 2 、依赖注入（Ioc）

### 2.1、什么是 SpringIOC 容器？

```
Spring 框 架 的 核 心 是 Spring 容 器。容 器 创 建 对 象，将 它 们 装 配 在 一 起，配 置 它
们 并 管 理 它 们 的 完 整 生 命 周 期。Spring 容 器 使 用 依 赖 注 入 来 管 理 组 成 应 用 程 序 的
组 件 。 容 器 通 过 读 取 提 供 的 配 置 元 数 据 来 接 收 对 象 进 行 实 例 化 ， 配 置 和 组 装 的 指
令 。 该 元 数 据 可 以 通 过 XML，Java 注 解 或 Java 代 码 提 供 。
```

### 2.2、什么是依赖注入？


#### 在 依 赖 注 入 中 ， 您 不 必 创 建 对 象 ， 但 必 须 描 述 如 何 创 建 它 们 。 您 不 是 直 接 在 代 码

```
中 将 组 件 和 服 务 连 接 在 一 起，而 是 描 述 配 置 文 件 中 哪 些 组 件 需 要 哪 些 服 务。由 IoC
容 器 将 它 们 装 配 在 一 起 。
```

### 2.3、可以通过多少种方式完成依赖注入？

#### 通 常 ， 依 赖 注 入 可 以 通 过 三 种 方 式 完 成 ， 即 ：

 构造函数注入
 setter 注入
 接口注入

```
在 SpringFramework 中 ， 仅 使 用 构 造 函 数 和 setter 注 入 。
```

### 2.4、区分构造函数注入和 setter 注入。

```
构造函数注入 setter 注入
没有部分注入 有部分注入
```

```
不会覆盖setter 属性 会覆盖 setter 属性
任意修改都会创建一个新实例 任意修改不会创建一个新实例
```

```
适用于设置很多属性 适用于设置少量属性
```

### 2.5、spring 中有多少种 IOC 容器？


```
BeanFactory-BeanFactory 就 像 一 个 包 含 bean 集 合 的 工 厂 类。它 会 在 客 户 端
要 求 时 实 例 化 bean。
```

```
ApplicationContext-ApplicationContext 接 口 扩 展 了 BeanFactory 接 口。它
在 BeanFactory 基 础 上 提 供 了 一 些 额 外 的 功 能 。
```

### 2.6、区分 BeanFactory 和 ApplicationContext。

```
BeanFactory ApplicationContext
```

```
它使用懒加载 它使用即时加载
它使用语法显式提供资源对象 它自己创建和管理资源对象
```

```
不支持国际化 支持国际化
不支持基于依赖的注解 支持基于依赖的注解
```

### 2.7、列举 IoC 的一些好处。

```
IoC 的 一 些 好 处 是 ：
```

 它将最小化应用程序中的代码量。
 它将使您的应用程序易于测试，因为它不需要单元测试用例中的任何单例
或 JNDI 查找机制。
 它以最小的影响和最少的侵入机制促进松耦合。
 它支持即时的实例化和延迟加载服务。

### 2.8、SpringIoC 的实现机制。


Spring 中 的 IoC 的 实 现 原 理 就 是 工 厂 模 式 加 反 射 机 制 。

#### 示 例 ：

interfaceFruit{
publicabstractvoideat();
}
classAppleimplementsFruit{
publicvoideat(){
System.out.println("Apple");
}
}
classOrangeimplementsFruit{
publicvoideat(){
System.out.println("Orange");
}
}
classFactory{
publicstaticFruitgetInstance(StringClassName){
Fruitf=null;
try{
f=(Fruit)Class.forName(ClassName).newInstance();
}catch(Exceptione){
e.printStackTrace();
}
returnf;
}
}
classClient{
publicstaticvoidmain(String[]a){


```
Fruitf=Factory.getInstance("io.github.dunwu.spring.Apple");
if(f!=null){
f.eat();
}
}
}
```

### 3 、Beans

### 3.1、什么是 springbean？

 它们是构成用户应用程序主干的对象。
 Bean 由 SpringIoC 容器管理。
 它们由 SpringIoC 容器实例化，配置，装配和管理。
 Bean 是基于用户提供给容器的配置元数据创建。

### 3.2、spring 提供了哪些配置方式？

```
基 于 xml 配 置
```

```
bean 所 需 的 依 赖 项 和 服 务 在 XML 格 式 的 配 置 文 件 中 指 定 。 这 些 配 置 文 件 通 常
包 含 许 多 bean 定 义 和 特 定 于 应 用 程 序 的 配 置 选 项 。 它 们 通 常 以 bean 标 签 开
头 。 例 如 ：
```

```
<beanid="studentbean"class="org.edureka.firstSpring.StudentBean">
<propertyname="name"value="Edureka"></property>
</bean>
```

#### 基 于 注 解 配 置

您 可 以 通 过 在 相 关 的 类 ， 方 法 或 字 段 声 明 上 使 用 注 解 ， 将 bean 配 置 为 组 件 类 本
身 ， 而 不 是 使 用 XML 来 描 述 bean 装 配 。 默 认 情 况 下 ，Spring 容 器 中 未 打 开
注 解 装 配 。 因 此 ， 您 需 要 在 使 用 它 之 前 在 Spring 配 置 文 件 中 启 用 它 。 例 如 ：

<beans>
<context:annotation-config/>
<!--beandefinitionsgohere-->
</beans>

基 于 JavaAPI 配 置

Spring 的 Java 配 置 是 通 过 使 用 @Bean 和 @Configuration 来 实 现 。

1 、 @Bean 注 解 扮 演 与 <bean/> 元 素 相 同 的 角 色 。
2 、 @Configuration 类 允 许 通 过 简 单 地 调 用 同 一 个 类 中 的 其 他 @Bean 方 法
来 定 义 bean 间 依 赖 关 系 。

例 如 ：

@Configuration
publicclassStudentConfig{
@Bean
publicStudentBeanmyStudent(){
returnnewStudentBean();
}
}


### 3.3、spring 支持集中 beanscope？

Springbean 支 持 5 种 scope：

**Singleton** - 每 个 SpringIoC 容 器 仅 有 一 个 单 实 例 。 **Prototype** - 每 次 请 求 都
会 产 生 一 个 新 的 实 例。 **Request** - 每 一 次 HTTP 请 求 都 会 产 生 一 个 新 的 实 例，并
且 该 bean 仅 在 当 前 HTTP 请 求 内 有 效。 **Session** - 每 一 次 HTTP 请 求 都 会 产
生 一 个 新 的 bean， 同 时 该 bean 仅 在 当 前 HTTPsession 内 有 效 。
**Global-session** - 类 似 于 标 准 的 HTTPSession 作 用 域 ， 不 过 它 仅 仅 在 基 于
portlet 的 web 应 用 中 才 有 意 义 。Portlet 规 范 定 义 了 全 局 Session 的 概 念 ，
它 被 所 有 构 成 某 个 portletweb 应 用 的 各 种 不 同 的 portlet 所 共 享。在 global
session 作 用 域 中 定 义 的 bean 被 限 定 于 全 局 portletSession 的 生 命 周 期 范
围 内 。 如 果 你 在 web 中 使 用 globalsession 作 用 域 来 标 识 bean， 那 么 web
会 自 动 当 成 session 类 型 来 使 用 。

仅 当 用 户 使 用 支 持 Web 的 ApplicationContext 时 ， 最 后 三 个 才 可 用 。

### 3.4、springbean 容器的生命周期是什么样的？

springbean 容 器 的 生 命 周 期 流 程 如 下 ：

1 、Spring 容 器 根 据 配 置 中 的 bean 定 义 中 实 例 化 bean。 2 、Spring 使 用 依 赖
注 入 填 充 所 有 属 性 ， 如 bean 中 所 定 义 的 配 置 。 3 、 如 果 bean 实 现
BeanNameAware 接 口 ， 则 工 厂 通 过 传 递 bean 的 ID 来 调 用
setBeanName()。 4 、 如 果 bean 实 现 BeanFactoryAware 接 口 ， 工 厂 通 过 传
递 自 身 的 实 例 来 调 用 setBeanFactory()。 5 、 如 果 存 在 与 bean 关 联 的 任 何
BeanPostProcessors， 则 调 用 preProcessBeforeInitialization() 方 法 。 6 、 如
果 为 bean 指 定 了 init 方 法 （ <bean> 的 init-method 属 性 ） ， 那 么 将 调
用 它 。 7 、 最 后 ， 如 果 存 在 与 bean 关 联 的 任 何 BeanPostProcessors， 则 将 调


用 postProcessAfterInitialization() 方 法 。 8 、 如 果 bean 实 现
DisposableBean 接 口，当 spring 容 器 关 闭 时，会 调 用 destory()。 9 、如 果 为
bean 指 定 了 destroy 方 法（ <bean> 的 destroy-method 属 性），那 么 将
调 用 它 。

### 3.5、什么是 spring 的内部 bean？

只 有 将 bean 用 作 另 一 个 bean 的 属 性 时 ， 才 能 将 bean 声 明 为 内 部 bean。
为 了 定 义 bean，Spring 的 基 于 XML 的 配 置 元 数 据 在 <property> 或
<constructor-arg> 中 提 供 了 <bean> 元 素 的 使 用 。 内 部 bean 总 是 匿 名
的 ， 它 们 总 是 作 为 原 型 。

例 如 ， 假 设 我 们 有 一 个 Student 类 ， 其 中 引 用 了 Person 类 。 这 里 我 们 将 只 创
建 一 个 Person 类 实 例 并 在 Student 中 使 用 它 。

Student.java

publicclassStudent{
privatePersonperson;
//SettersandGetters


}
publicclassPerson{
privateStringname;
privateStringaddress;
//SettersandGetters
}

bean.xml

<beanid=“StudentBean"class="com.edureka.Student">
<propertyname="person">
<!--Thisisinnerbean-->
<beanclass="com.edureka.Person">
<propertyname="name"value=“Scott"></property>
<propertyname="address"value=
“Bangalore"></property>
</bean>
</property>
</bean>

### 3.6、什么是 spring 装配

当 bean 在 Spring 容 器 中 组 合 在 一 起 时，它 被 称 为 装 配 或 bean 装 配。Spring
容 器 需 要 知 道 需 要 什 么 bean 以 及 容 器 应 该 如 何 使 用 依 赖 注 入 来 将 bean 绑 定
在 一 起 ， 同 时 装 配 bean。

### 3.7、自动装配有哪些方式？


Spring 容 器 能 够 自 动 装 配 bean。也 就 是 说，可 以 通 过 检 查 BeanFactory 的 内
容 让 Spring 自 动 解 析 bean 的 协 作 者 。

#### 自 动 装 配 的 不 同 模 式 ：

**no** - 这 是 默 认 设 置 ， 表 示 没 有 自 动 装 配 。 应 使 用 显 式 bean 引 用 进 行 装 配 。
**byName** - 它 根 据 bean 的 名 称 注 入 对 象 依 赖 项 。 它 匹 配 并 装 配 其 属 性 与 XML
文 件 中 由 相 同 名 称 定 义 的 bean。 **byType** - 它 根 据 类 型 注 入 对 象 依 赖 项。如 果 属
性 的 类 型 与 XML 文 件 中 的 一 个 bean 名 称 匹 配，则 匹 配 并 装 配 属 性。 **构 造 函 数**

- 它 通 过 调 用 类 的 构 造 函 数 来 注 入 依 赖 项。它 有 大 量 的 参 数。 **autodetect** - 首 先
  容 器 尝 试 通 过 构 造 函 数 使 用 autowire 装 配，如 果 不 能，则 尝 试 通 过 byType 自
  动 装 配 。

### 3.8、自动装配有什么局限？

覆 盖 的 可 能 性 - 您 始 终 可 以 使 用 <constructor-arg> 和 <property> 设
置 指 定 依 赖 项，这 将 覆 盖 自 动 装 配。基 本 元 数 据 类 型 - 简 单 属 性（如 原 数 据 类 型，
字 符 串 和 类）无 法 自 动 装 配。令 人 困 惑 的 性 质 - 总 是 喜 欢 使 用 明 确 的 装 配，因 为
自 动 装 配 不 太 精 确 。

### 4 、注解

### 4.1、什么是基于注解的容器配置

不 使 用 XML 来 描 述 bean 装 配，开 发 人 员 通 过 在 相 关 的 类，方 法 或 字 段 声 明 上
使 用 注 解 将 配 置 移 动 到 组 件 类 本 身 。 它 可 以 作 为 XML 设 置 的 替 代 方 案 。 例 如 ：

Spring 的 Java 配 置 是 通 过 使 用 @Bean 和 @Configuration 来 实 现 。


@Bean 注 解 扮 演 与 元 素 相 同 的 角 色 。 @Configuration 类 允 许 通 过 简 单 地 调
用 同 一 个 类 中 的 其 他 @Bean 方 法 来 定 义 bean 间 依 赖 关 系 。

例 如 ：

@Configuration
publicclassStudentConfig{
@Bean
publicStudentBeanmyStudent(){
returnnewStudentBean();
}
}

### 4.2、如何在 spring 中启动注解装配？

默 认 情 况 下，Spring 容 器 中 未 打 开 注 解 装 配。因 此，要 使 用 基 于 注 解 装 配，我 们
必 须 通 过 配 置 <context：annotation-config/> 元 素 在 Spring 配 置 文 件
中 启 用 它 。

### 4.3、@Component,@Controller,@Repository,

### @Service 有何区别？

**@Component** ： 这 将 java 类 标 记 为 bean。 它 是 任 何 Spring 管 理 组 件 的 通
用 构 造 型 。spring 的 组 件 扫 描 机 制 现 在 可 以 将 其 拾 取 并 将 其 拉 入 应 用 程 序 环 境
中 。 **@Controller** ： 这 将 一 个 类 标 记 为 SpringWebMVC 控 制 器 。 标 有 它 的
Bean 会 自 动 导 入 到 IoC 容 器 中。 **@Service** ：此 注 解 是 组 件 注 解 的 特 化。它 不
会 对 @Component 注 解 提 供 任 何 其 他 行 为 。 您 可 以 在 服 务 层 类 中 使 用


@Service 而 不 是 @Component， 因 为 它 以 更 好 的 方 式 指 定 了 意 图 。
**@Repository** ： 这 个 注 解 是 具 有 类 似 用 途 和 功 能 的 @Component 注 解 的 特
化 。 它 为 DAO 提 供 了 额 外 的 好 处 。 它 将 DAO 导 入 IoC 容 器 ， 并 使 未 经 检 查
的 异 常 有 资 格 转 换 为 SpringDataAccessException。

### 4.4、@Required 注解有什么用？

@Required 应 用 于 bean 属 性 setter 方 法 。 此 注 解 仅 指 示 必 须 在 配 置 时 使 用
bean 定 义 中 的 显 式 属 性 值 或 使 用 自 动 装 配 填 充 受 影 响 的 bean 属 性 。 如 果 尚 未
填 充 受 影 响 的 bean 属 性 ， 则 容 器 将 抛 出 BeanInitializationException。

示 例 ：

publicclassEmployee{
privateStringname;
@Required
publicvoidsetName(Stringname){
this.name=name;
}
publicstringgetName(){
returnname;
}
}

### 4.5、@Autowired 注解有什么用？

@Autow ired 可 以 更 准 确 地 控 制 应 该 在 何 处 以 及 如 何 进 行 自 动 装 配 。 此 注 解 用 于
在 setter 方 法 ， 构 造 函 数 ， 具 有 任 意 名 称 或 多 个 参 数 的 属 性 或 方 法 上 自 动 装 配
bean。 默 认 情 况 下 ， 它 是 类 型 驱 动 的 注 入 。


publicclassEmployee{
privateStringname;
@Autowired
publicvoidsetName(Stringname){
this.name=name;
}
publicstringgetName(){
returnname;
}
}

### 4.6、@Qualifier 注解有什么用？

当 您 创 建 多 个 相 同 类 型 的 bean 并 希 望 仅 使 用 属 性 装 配 其 中 一 个 bean 时，您 可
以 使 用@Qualifier 注 解 和 @Autow ired 通 过 指 定 应 该 装 配 哪 个 确 切 的 bean
来 消 除 歧 义 。

例 如 ， 这 里 我 们 分 别 有 两 个 类 ，Employee 和 EmpAccount。 在 EmpAccount
中 ， 使 用@Qualifier 指 定 了 必 须 装 配 id 为 emp1 的 bean。

Employee.java

publicclassEmployee{
privateStringname;
@Autowired
publicvoidsetName(Stringname){
this.name=name;
}
publicstringgetName(){


returnname;
}
}

EmpAccount.java

publicclassEmpAccount{
privateEmployeeemp;

@Autowired
@Qualifier(emp1)
publicvoidshowName(){
System.out.println(“Employeename: ”+emp.getName);
}
}

### 4.7、@RequestMapping 注解有什么用？

@RequestMapping 注 解 用 于 将 特 定 HTTP 请 求 方 法 映 射 到 将 处 理 相 应 请 求 的
控 制 器 中 的 特 定 类/方 法 。 此 注 释 可 应 用 于 两 个 级 别 ：

#### 类 级 别 ： 映 射 请 求 的 URL 方 法 级 别 ： 映 射 URL 以 及 HTTP 请 求 方 法

### 5 、数据访问

### 5.1、springDAO 有什么用？


```
SpringDAO 使 得 JDBC，Hibernate 或 JDO 这 样 的 数 据 访 问 技 术 更 容 易 以 一
种 统 一 的 方 式 工 作 。 这 使 得 用 户 容 易 在 持 久 性 技 术 之 间 切 换 。 它 还 允 许 您 在 编 写
代 码 时 ， 无 需 考 虑 捕 获 每 种 技 术 不 同 的 异 常 。
```

### 5.2、列举 SpringDAO 抛出的异常。

### 5.3、springJDBCAPI 中存在哪些类？

 JdbcTemplate
 SimpleJdbcTemplate
 NamedParameterJdbcTemplate
 SimpleJdbcInsert


 SimpleJdbcCall

### 5.4、使用 Spring 访问 Hibernate 的方法有哪些？

```
我 们 可 以 通 过 两 种 方 式 使 用 Spring 访 问 Hibernate：
```

```
1 、 使 用 Hibernate 模 板 和 回 调 进 行 控 制 反 转
2 、 扩 展 HibernateDAOSupport 并 应 用 AOP 拦 截 器 节 点
```

### 5.5、列举 spring 支持的事务管理类型

```
Spring 支 持 两 种 类 型 的 事 务 管 理 ：
```

#### 1 、 程 序 化 事 务 管 理 ： 在 此 过 程 中 ， 在 编 程 的 帮 助 下 管 理 事 务 。 它 为 您 提 供 极 大

#### 的 灵 活 性 ， 但 维 护 起 来 非 常 困 难 。

#### 2 、 声 明 式 事 务 管 理：在 此，事 务 管 理 与 业 务 代 码 分 离。仅 使 用 注 解 或 基 于 XML

#### 的 配 置 来 管 理 事 务 。

### 5.6、spring 支持哪些 ORM 框架

 Hibernate
 iBatis
 JPA
 JDO
 OJB


### 6 、AOP

### 6.1、什么是 AOP？

AOP(Aspect-OrientedProgramming), 即 **面 向 切 面 编 程** , 它 与
OOP(Object-OrientedProgramming, 面 向 对 象 编 程) 相 辅 相 成, 提 供 了 与
OOP 不 同 的 抽 象 软 件 结 构 的 视 角. 在 OOP 中, 我 们 以 类(class)作 为 我 们 的 基
本 单 元, 而 AOP 中 的 基 本 单 元 是 **Aspect(切 面)**

### 6.2、什么是 Aspect？

aspect 由 pointcount 和 advice 组 成, 它 既 包 含 了 横 切 逻 辑 的 定 义, 也 包
括 了 连 接 点 的 定 义.SpringAOP 就 是 负 责 实 施 切 面 的 框 架, 它 将 切 面 所 定 义 的 横
切 逻 辑 编 织 到 切 面 所 指 定 的 连 接 点 中.AOP 的 工 作 重 心 在 于 如 何 将 增 强 编 织 目 标
对 象 的 连 接 点 上, 这 里 包 含 两 个 工 作:

1 、 如 何 通 过 pointcut 和 advice 定 位 到 特 定 的 joinpoint 上 2 、 如 何 在
advice 中 编 写 切 面 代 码.


**可 以 简 单 地 认 为, 使 用 @Aspect 注 解 的 类 就 是 切 面.**

### 6.3、什么是切点（JoinPoint）

#### 程 序 运 行 中 的 一 些 时 间 点, 例 如 一 个 方 法 的 执 行, 或 者 是 一 个 异 常 的 处 理.

在 SpringAOP 中,joinpoint 总 是 方 法 的 执 行 点 。

### 6.4、什么是通知（Advice）？

特 定 JoinPoint 处 的 Aspect 所 采 取 的 动 作 称 为 Advice。SpringAOP 使 用 一
个 Advice 作 为 拦 截 器 ， 在 JoinPoint “周 围”维 护 一 系 列 的 拦 截 器 。


### 6.5、有哪些类型的通知（Advice）？

 **Before** - 这些类型的 Advice 在 joinpoint 方法之前执行，并使用
@Before 注解标记进行配置。
 **AfterReturning** - 这些类型的 Advice 在连接点方法正常执行后执
行，并使用@AfterReturning 注解标记进行配置。
 **AfterThrowing** - 这些类型的 Advice 仅在 joinpoint 方法通过抛出
异常退出并使用 @AfterThrowing 注解标记配置时执行。
 **After(finally)** - 这些类型的 Advice 在连接点方法之后执行，无论方
法退出是正常还是异常返回，并使用 @After 注解标记进行配置。
 **Around** - 这些类型的 Advice 在连接点之前和之后执行，并使用
@Around注解标记进行配置。

### 6.6、指出在 springaop 中 concern 和 cross-cutting

### concern 的不同之处。

```
concern 是 我 们 想 要 在 应 用 程 序 的 特 定 模 块 中 定 义 的 行 为 。 它 可 以 定 义 为 我 们 想
要 实 现 的 功 能 。
```

```
cross-cuttingconcern 是 一 个 适 用 于 整 个 应 用 的 行 为 ， 这 会 影 响 整 个 应 用 程 序。
例 如，日 志 记 录，安 全 性 和 数 据 传 输 是 应 用 程 序 几 乎 每 个 模 块 都 需 要 关 注 的 问 题，
因 此 它 们 是 跨 领 域 的 问 题 。
```

### 6.7、AOP 有哪些实现方式？

#### 实 现 AOP 的 技 术 ， 主 要 分 为 两 大 类 ：


#### 静 态 代 理

#### 指 使 用 AOP 框 架 提 供 的 命 令 进 行 编 译，从 而 在 编 译 阶 段 就 可 生 成 AOP 代 理 类，

#### 因 此 也 称 为 编 译 时 增 强 ；

 编译时编织（特殊编译器实现）
 类加载时编织（特殊的类加载器实现）。

#### 动 态 代 理

#### 在 运 行 时 在 内 存 中“临 时”生 成 AOP 动 态 代 理 类 ， 因 此 也 被 称 为 运 行 时 增 强 。

 JDK动态代理
 CGLIB

### 6.8、SpringAOPandAspectJAOP 有什么区别？

```
SpringAOP 基 于 动 态 代 理 方 式 实 现 ；AspectJ 基 于 静 态 代 理 方 式 实 现 。Spring
AOP 仅 支 持 方 法 级 别 的 PointCut；提 供 了 完 全 的 AOP 支 持，它 还 支 持 属 性 级
别 的 PointCut。
```

### 6.9、如何理解 Spring 中的代理？

```
将 Advice 应 用 于 目 标 对 象 后 创 建 的 对 象 称 为 代 理 。 在 客 户 端 对 象 的 情 况 下 ， 目
标 对 象 和 代 理 对 象 是 相 同 的 。
```

Advice+TargetObject=Proxy

### 6.10、什么是编织（Weaving）？

为 了 创 建 一 个 advice 对 象 而 链 接 一 个 aspect 和 其 它 应 用 类 型 或 对 象 ， 称 为 编
织 （Weaving） 。 在 SpringAOP 中 ， 编 织 在 运 行 时 执 行 。 请 参 考 下 图 ：

### 7 、MVC

### 7.1、SpringMVC 框架有什么用？

SpringWebMVC 框 架 提 供 **模 型-视 图-控 制 器** 架 构 和 随 时 可 用 的 组 件，用 于 开
发 灵 活 且 松 散 耦 合 的 Web 应 用 程 序 。MVC 模 式 有 助 于 分 离 应 用 程 序 的 不 同 方
面，如 输 入 逻 辑，业 务 逻 辑 和 UI 逻 辑，同 时 在 所 有 这 些 元 素 之 间 提 供 松 散 耦 合。

### 7.2、描述一下 DispatcherServlet 的工作流程

DispatcherServlet 的 工 作 流 程 可 以 用 一 幅 图 来 说 明 ：


1 、 向 服 务 器 发 送 HTTP 请 求 ， 请 求 被 前 端 控 制 器 DispatcherServlet 捕 获。

2 、 DispatcherServlet 根 据 **-servlet.xml** 中 的 配 置 对 请 求 的 URL 进 行 解
析，得 到 请 求 资 源 标 识 符（URI）。然 后 根 据 该 URI，调 用 HandlerMapping
获 得 该 Handler 配 置 的 所 有 相 关 的 对 象（包 括 Handler 对 象 以 及 Handler 对
象 对 应 的 拦 截 器 ） ， 最 后 以 HandlerExecutionChain 对 象 的 形 式 返 回 。

3 、 DispatcherServlet 根 据 获 得 的 Handler， 选 择 一 个 合 适 的
HandlerAdapter。（附 注：如 果 成 功 获 得 HandlerAdapter后，此 时 将 开 始
执 行 拦 截 器 的 preHandler(...)方 法 ） 。

4 、 提 取 Request中 的 模 型 数 据 ， 填 充 Handler入 参 ， 开 始 执 行 Handler
（ Controller)。 在 填 充 Handler的 入 参 过 程 中 ， 根 据 你 的 配 置 ，Spring 将
帮 你 做 一 些 额 外 的 工 作 ：


 **HttpMessageConveter** ：将请求消息（如 Json、xml等数据）转换
成一个对象，将对象转换为指定的响应信息。
 **数据转换** ：对请求消息进行数据转换。如 String转换成 Integer、
Double等。
 **数据根式化** ：对请求消息进行数据格式化。如将字符串转换成格式化数字
或格式化日期等。
 **数据验证** ：验证数据的有效性（长度、格式等），验证结果存储到
BindingResult或 Error中。

```
5 、Handler(Controller)执 行 完 成 后 ， 向 DispatcherServlet 返 回 一 个
ModelAndView 对 象 ；
```

```
6 、根 据 返 回 的 ModelAndView，选 择 一 个 适 合 的 ViewResolver（必 须 是 已
经 注 册 到 Spring 容 器 中 的 ViewResolver)返 回 给 DispatcherServlet。
```

7 、 ViewResolver 结 合 Model和 View， 来 渲 染 视 图 。

```
8 、 视 图 负 责 将 渲 染 结 果 返 回 给 客 户 端 。
```

### 7.3、介绍一下 WebApplicationContext

```
WebApplicationContext 是 ApplicationContext 的 扩 展 。 它 具 有 Web 应 用
程 序 所 需 的 一 些 额 外 功 能 。 它 与 普 通 的 ApplicationContext 在 解 析 主 题 和 决 定
与 哪 个 servlet 关 联 的 能 力 方 面 有 所 不 同 。
```

```
英 文 原 文 链 接 ：
https://www.edureka.co/blog/interview-questions/spring-interview-questi
ons/
```

## Spring 面试题（二）

### 1 、什么是spring?

```
Spring 是 个java企 业 级 应 用 的 开 源 开 发 框 架 。Spring主 要 用 来 开 发Java应 用，
但 是 有 些 扩 展 是 针 对 构 建J2EE平 台 的web应 用 。Spring 框 架 目 标 是 简 化Java
企 业 级 应 用 开 发 ， 并 通 过POJO为 基 础 的 编 程 模 型 促 进 良 好 的 编 程 习 惯 。
```

### 2 、使用Spring框架的好处是什么？

 **轻量：** Spring 是轻量的，基本的版本大约2MB。
 **控制反转：** Spring通过控制反转实现了松散耦合，对象们给出它们的依
赖，而不是创建或查找依赖的对象们。
 **面向切面的编程(AOP)：** Spring支持面向切面的编程，并且把应用业务
逻辑和系统服务分开。
 **容器：** Spring 包含并管理应用中对象的生命周期和配置。
 **MVC框架** ：Spring的WEB框架是个精心设计的框架，是Web框架的
一个很好的替代品。
 **事务管理：** Spring 提供一个持续的事务管理接口，可以扩展到上至本地
事务下至全局事务（JTA）。
 **异常处理：** Spring 提供方便的API把具体技术相关的异常（比如由JDBC，
HibernateorJDO抛出的）转化为一致的unchecked 异常。

### 3 、Spring由哪些模块组成?

```
以 下 是Spring 框 架 的 基 本 模 块 ：
```

 Coremodule
 Beanmodule
 Contextmodule
 ExpressionLanguagemodule
 JDBCmodule
 ORMmodule
 OXMmodule
 JavaMessagingService(JMS)module
 Transactionmodule
 Webmodule
 Web-Servletmodule
 Web-Strutsmodule
 Web-Portletmodule

### 4 、核心容器（应用上下文) 模块。

```
这 是 基 本 的Spring模 块 ， 提 供spring 框 架 的 基 础 功 能 ，BeanFactory 是 任 何
以spring为 基 础 的 应 用 的 核 心。Spring 框 架 建 立 在 此 模 块 之 上，它 使Spring成
为 一 个 容 器 。
```

### 5 、BeanFactory – BeanFactory 实现举例。

```
Bean 工 厂 是 工 厂 模 式 的 一 个 实 现，提 供 了 控 制 反 转 功 能，用 来 把 应 用 的 配 置 和 依
赖 从 正 真 的 应 用 代 码 中 分 离 。
```

```
最 常 用 的BeanFactory 实 现 是XmlBeanFactory 类 。
```

### 6 、XMLBeanFactory

最 常 用 的 就 是org.springframework.beans.factory.xml.XmlBeanFactory ， 它
根 据XML文 件 中 的 定 义 加 载beans。该 容 器 从XML 文 件 读 取 配 置 元 数 据 并 用 它
去 创 建 一 个 完 全 配 置 的 系 统 或 应 用 。

### 7 、解释AOP模块

AOP模 块 用 于 发 给 我 们 的Spring应 用 做 面 向 切 面 的 开 发 ， 很 多 支 持 由AOP联
盟 提 供 ， 这 样 就 确 保 了Spring和 其 他AOP框 架 的 共 通 性 。 这 个 模 块 将 元 数 据 编
程 引 入Spring。

### 8 、解释JDBC抽象和DAO模块。

#### 通 过 使 用JDBC抽 象 和DAO模 块，保 证 数 据 库 代 码 的 简 洁，并 能 避 免 数 据 库 资 源

#### 错 误 关 闭 导 致 的 问 题 ， 它 在 各 种 不 同 的 数 据 库 的 错 误 信 息 之 上 ， 提 供 了 一 个 统 一

的 异 常 访 问 层 。 它 还 利 用Spring的AOP 模 块 给Spring应 用 中 的 对 象 提 供 事 务
管 理 服 务 。

### 9 、解释对象/关系映射集成模块。

Spring 通 过 提 供ORM模 块，支 持 我 们 在 直 接JDBC之 上 使 用 一 个 对 象/关 系 映 射
映 射(ORM)工 具，Spring 支 持 集 成 主 流的ORM框 架，如Hiberate,JDO和 iBATIS
SQLMaps。Spring的 事 务 管 理 同 样 支 持 以 上 所 有ORM框 架 及JDBC。

### 10 、解释WEB 模块。


```
Spring的WEB模 块 是 构 建 在applicationcontext 模 块 基 础 之 上 ， 提 供 一 个 适
合web应 用 的 上 下 文。这 个 模 块 也 包 括 支 持 多 种 面 向web的 任 务，如 透 明 地 处 理
多 个 文 件 上 传 请 求 和 程 序 级 请 求 参 数 的 绑 定 到 你 的 业 务 对 象 。 它 也 有 对Jakarta
Struts的 支 持 。
```

### 12 、Spring配置文件

```
Spring配 置 文 件 是 个XML 文 件，这 个 文 件 包 含 了 类 信 息，描 述 了 如 何 配 置 它 们，
以 及 如 何 相 互 调 用 。
```

### 13 、什么是SpringIOC 容器？

```
SpringIOC 负 责 创 建 对 象，管 理 对 象（通 过 依 赖 注 入（DI），装 配 对 象，配 置 对
象 ， 并 且 管 理 这 些 对 象 的 整 个 生 命 周 期 。
```

### 14 、IOC的优点是什么？

#### IOC 或 依 赖 注 入 把 应 用 的 代 码 量 降 到 最 低。它 使 应 用 容 易 测 试，单 元 测 试 不 再 需

#### 要 单 例 和JNDI查 找 机 制。最 小 的 代 价 和 最 小 的 侵 入 性 使 松 散 耦 合 得 以 实 现。IOC

#### 容 器 支 持 加 载 服 务 时 的 饿 汉 式 初 始 化 和 懒 加 载 。

### 15 、ApplicationContext通常的实现是什么?

 **FileSystemXmlApplicationContext ：** 此容器从一个XML文件中加
载beans的定义，XMLBean 配置文件的全路径名必须提供给它的构造函数。


 **ClassPathXmlApplicationContext：** 此容器也从一个XML文件中加
载beans的定义，这里，你需要正确设置classpath因为这个容器将在classpath
里找bean配置。
 **WebXmlApplicationContext：** 此容器加载一个XML文件，此文件定
义了一个WEB应用的所有bean。

### 16 、Bean 工厂和 Applicationcontexts 有什么区别？

```
Applicationcontexts提 供 一 种 方 法 处 理 文 本 消 息 ， 一 个 通 常 的 做 法 是 加 载 文 件
资 源（比 如 镜 像），它 们 可 以 向 注 册 为 监 听 器 的bean发 布 事 件。另 外，在 容 器 或
容 器 内 的 对 象 上 执 行 的 那 些 不 得 不 由bean工 厂 以 程 序 化 方 式 处 理 的 操 作，可 以在
Applicationcontexts中 以 声 明 的 方 式 处 理 。Applicationcontexts实 现了
MessageSource接 口 ， 该 接 口 的 实 现 以 可 插 拔 的 方 式 提 供 获 取 本 地 化 消 息 的 方
法 。
```

### 17 、一个Spring的应用看起来象什么？

 一个定义了一些功能的接口。
 这实现包括属性，它的Setter ， getter 方法和函数等。
 SpringAOP。
 Spring 的XML 配置文件。
 使用以上功能的客户端程序。

### 依赖注入

### 18 、什么是Spring的依赖注入？


#### 依 赖 注 入 ， 是IOC的 一 个 方 面 ， 是 个 通 常 的 概 念 ， 它 有 多 种 解 释 。 这 概 念 是 说 你

#### 不 用 创 建 对 象 ， 而 只 需 要 描 述 它 如 何 被 创 建 。 你 不 在 代 码 里 直 接 组 装 你 的 组 件 和

#### 服 务 ， 但 是 要 在 配 置 文 件 里 描 述 哪 些 组 件 需 要 哪 些 服 务 ， 之 后 一 个 容 器 （IOC容

#### 器 ） 负 责 把 他 们 组 装 起 来 。

### 19 、有哪些不同类型的IOC（依赖注入）方式？

 **构造器依赖注入：** 构造器依赖注入通过容器触发一个类的构造器来实现
的，该类有一系列参数，每个参数代表一个对其他类的依赖。
 **Setter方法注入：** Setter方法注入是容器通过调用无参构造器或无参
static工厂 方法实例化bean之后，调用该bean的setter方法，即实现了基
于setter的依赖注入。

### 20 、哪种依赖注入方式你建议使用，构造器注入，还是 Setter

### 方法注入？

```
你 两 种 依 赖 方 式 都 可 以 使 用 ， 构 造 器 注 入 和Setter方 法 注 入 。 最 好 的 解 决 方 案 是
用 构 造 器 参 数 实 现 强 制 依 赖 ，setter方 法 实 现 可 选 依 赖 。
```

### SpringBeans

### 21.什么是Springbeans?


Springbeans 是 那 些 形 成Spring应 用 的 主 干 的java对 象 。 它 们 被SpringIOC
容 器 初 始 化 ， 装 配 ， 和 管 理 。 这 些beans通 过 容 器 中 配 置 的 元 数 据 创 建 。 比 如 ，
以XML文 件 中 的 形 式 定 义 。

Spring 框 架 定 义 的beans都 是 单 件beans。 在beantag中 有 个 属 性”
singleton”， 如 果 它 被 赋 为TRUE，bean 就 是 单 件 ， 否 则 就 是 一 个 prototype
bean。 默 认 是TRUE， 所 以 所 有 在Spring框 架 中 的beans 缺 省 都 是 单 件 。

### 22 、一个 SpringBean 定义 包含什么？

一 个SpringBean 的 定 义 包 含 容 器 必 知 的 所 有 配 置 元 数 据 ， 包 括 如 何 创 建 一个
bean， 它 的 生 命 周 期 详 情 及 它 的 依 赖 。

### 23 、如何给Spring 容器提供配置元数据?

这 里 有 三 种 重 要 的 方 法 给Spring 容 器 提 供 配 置 元 数 据 。

XML配 置 文 件 。

基 于 注 解 的 配 置 。

基 于java的 配 置 。

### 24 、你怎样定义类的作用域?

当 定 义 一 个 在Spring里 ， 我 们 还 能 给 这 个bean声 明 一 个 作 用 域 。 它 可 以 通过
bean 定 义 中 的scope属 性 来 定 义。如，当Spring要 在 需 要 的 时 候 每 次 生 产 一 个
新 的bean实 例，bean的scope属 性 被 指 定 为prototype。另 一 方 面，一 个bean


```
每 次 使 用 的 时 候 必 须 返 回 同 一 个 实 例 ， 这 个bean的scope 属 性 必 须 设 为
singleton。
```

### 25 、解释Spring支持的几种bean的作用域。

```
Spring框 架 支 持 以 下 五 种bean的 作 用 域 ：
```

 **singleton:** bean在每个Springioc 容器中只有一个实例。
 **prototype** ：一个bean的定义可以有多个实例。
 **request** ：每次http请求都会创建一个bean，该作用域仅在基于web
的SpringApplicationContext情形下有效。
 **session** ：在一个HTTPSession中，一个bean定义对应一个实例。该
作用域仅在基于web的SpringApplicationContext情形下有效。
 **global-session** ：在一个全局的HTTPSession中，一个bean定义对应
一个实例。该作用域仅在基于web的SpringApplicationContext情形下有效。

```
缺 省 的Springbean 的 作 用 域 是Singleton.
```

### 26 、Spring框架中的单例bean是线程安全的吗?

```
不 ，Spring框 架 中 的 单 例bean不 是 线 程 安 全 的 。
```

### 27 、解释Spring框架中bean的生命周期。

 Spring容器 从XML 文件中读取bean的定义，并实例化bean。
 Spring根据bean的定义填充所有的属性。


 如果bean实现了BeanNameAware 接口，Spring 传递bean的ID 到
setBeanName方法。
 如果Bean 实现了 BeanFactoryAware 接口， Spring传递
beanfactory 给setBeanFactory 方法。
 如果有任何与bean相关联的BeanPostProcessors，Spring会在
postProcesserBeforeInitialization()方法内调用它们。
 如果bean实现IntializingBean了，调用它的afterPropertySet方法，
如果bean声明了初始化方法，调用此初始化方法。
 如果有BeanPostProcessors 和bean关联，这些bean的
postProcessAfterInitialization() 方法将被调用。
 如果bean实现了 DisposableBean，它将调用destroy()方法。

### 28 、哪些是重要的bean生命周期方法？你能重载它们吗？

```
有 两 个 重 要 的bean 生 命 周 期 方 法 ， 第 一 个 是setup ， 它 是 在 容 器 加 载bean
的 时 候 被 调 用 。 第 二 个 方 法 是 teardown 它 是 在 容 器 卸 载 类 的 时 候 被 调 用 。
```

```
Thebean 标 签 有 两 个 重 要 的 属 性（init-method和destroy-method）。用 它 们
你 可 以 自 己 定 制 初 始 化 和 注 销 方 法 。 它 们 也 有 相 应 的 注 解 （@PostConstruct和
@PreDestroy） 。
```

### 29 、什么是Spring的内部bean？

```
当 一 个bean仅 被 用 作 另 一 个bean的 属 性 时 ， 它 能 被 声 明 为 一 个 内 部bean， 为
了 定 义innerbean， 在Spring 的 基 于XML的 配 置 元 数 据 中 ， 可 以 在 或 元
素 内 使 用 元 素 ， 内 部bean通 常 是 匿 名 的 ， 它 们 的Scope一 般 是prototype。
```

### 30 、在 Spring中如何注入一个java集合？


```
Spring提 供 以 下 几 种 集 合 的 配 置 元 素 ：
```

 类型用于注入一列值，允许有相同的值。
 类型用于注入一组值，不允许有相同的值。
 类型用于注入一组键值对，键和值都可以为任意类型。
 类型用于注入一组键值对，键和值都只能为String类型。

### 31 、什么是bean装配?

```
装 配，或bean 装 配 是 指 在Spring 容 器 中 把bean组 装 到 一 起，前 提 是 容 器 需 要
知 道bean的 依 赖 关 系 ， 如 何 通 过 依 赖 注 入 来 把 它 们 装 配 到 一 起 。
```

### 32 、什么是bean的自动装配？

```
Spring 容 器 能 够 自 动 装 配 相 互 合 作 的bean， 这 意 味 着 容 器 不 需 要 和 配 置 ， 能 通
过Bean工 厂 自 动 处 理bean之 间 的 协 作 。
```

### 33 、解释不同方式的自动装配 。

```
有 五 种 自 动 装 配 的 方 式，可 以 用 来 指 导Spring容 器 用 自 动 装 配 方 式 来 进 行 依 赖 注
入 。
```

 **no** ：默认的方式是不进行自动装配，通过显式设置ref 属性来进行装配。


 **byName：** 通过参数名 自动装配，Spring容器在配置文件中发现bean
的autowire属性被设置成byname，之后容器试图匹配、装配和该bean的属
性具有相同名字的bean。
 **byType:：** 通过参数类型自动装配，Spring容器在配置文件中发现bean
的autowire属性被设置成byType，之后容器试图匹配、装配和该bean的属
性具有相同类型的bean。如果有多个bean符合条件，则抛出错误。
 **constructor：这个方式类似于** byType，但是要提供给构造器参数，如
果没有确定的带参数的构造器参数类型，将会抛出异常。
 **autodetect：** 首先尝试使用constructor来自动装配，如果无法工作，
则使用byType方式。

### 34.自动装配有哪些局限性?

#### 自 动 装 配 的 局 限 性 是 ：

 **重写** ：你仍需用 和 配置来定义依赖，意味着总要重写自动装配。
 **基本数据类型** ：你不能自动装配简单的属性，如基本数据类型，String
字符串，和类。
 **模糊特性：** 自动装配不如显式装配精确，如果有可能，建议使用显式装配。

### 35 、你可以在Spring中注入一个null 和一个空字符串吗？

#### 可 以 。

### Spring注解


### 36 、什么是基于Java的Spring注解配置? 给一些注解的例子.

基 于Java的 配 置 ， 允 许 你 在 少 量 的Java注 解 的 帮 助 下 ， 进 行 你 的 大 部 分Spring
配 置 而 非 通 过XML文 件 。

以@Configuration 注 解 为 例 ， 它 用 来 标 记 类 可 以 当 做 一 个bean的 定 义 ，被
SpringIOC容 器 使 用 。 另 一 个 例 子 是@Bean注 解 ， 它 表 示 此 方 法 将 要 返 回 一 个
对 象 ， 作 为 一 个bean注 册 进Spring应 用 上 下 文 。

### 37 、什么是基于注解的容器配置?

#### 相 对 于XML文 件，注 解 型 的 配 置 依 赖 于 通 过 字 节 码 元 数 据 装 配 组 件，而 非 尖 括 号

#### 的 声 明 。

#### 开 发 者 通 过 在 相 应 的 类，方 法 或 属 性 上 使 用 注 解 的 方 式，直 接 组 件 类 中 进 行 配 置，

而 不 是 使 用xml表 述bean的 装 配 关 系 。

### 38 、怎样开启注解装配？

注 解 装 配 在 默 认 情 况 下 是 不 开 启 的，为 了 使 用 注 解 装 配，我 们 必 须 在Spring配 置
文 件 中 配 置 context:annotation-config/元 素 。

### 39 、@Required 注解

这 个 注 解 表 明bean的 属 性 必 须 在 配 置 的 时 候 设 置，通 过 一 个bean定 义 的 显 式 的
属 性 值 或 通 过 自 动 装 配 ， 若@Required注 解 的bean属 性 未 被 设 置 ， 容 器 将 抛出
BeanInitializationException。


### 40 、@Autowired 注解

@Autow ired 注 解 提 供 了 更 细 粒 度 的 控 制 ， 包 括 在 何 处 以 及 如 何 完 成 自 动 装 配 。
它 的 用 法 和@Required一 样，修 饰setter方 法、构 造 器、属 性 或 者 具 有 任 意 名 称
和/或 多 个 参 数 的PN方 法 。

### 41 、@Qualifier 注解

当 有 多 个 相 同 类 型 的bean却 只 有 一 个 需 要 自 动 装 配 时 ， 将@Qualifier 注 解 和
@Autow ire 注 解 结 合 使 用 以 消 除 这 种 混 淆 ， 指 定 需 要 装 配 的 确 切 的bean。

### Spring数据访问

### 42.在Spring框架中如何更有效地使用JDBC?

使 用SpringJDBC 框 架 ， 资 源 管 理 和 错 误 处 理 的 代 价 都 会 被 减 轻 。 所 以 开 发 者 只
需 写statements 和 queries从 数 据 存 取 数 据，JDBC也 可 以 在Spring框 架 提 供
的 模 板 类 的 帮 助 下 更 有 效 地 被 使 用 ， 这 个 模 板 叫JdbcTemplate （ 例 子 见 这里
here）

### 43 、JdbcTemplate

JdbcTemplate 类 提 供 了 很 多 便 利 的 方 法 解 决 诸 如 把 数 据 库 数 据 转 变 成 基 本 数 据
类 型 或 对 象 ， 执 行 写 好 的 或 可 调 用 的 数 据 库 操 作 语 句 ， 提 供 自 定 义 的 数 据 错 误 处
理 。


### 44 、Spring对DAO的支持

```
Spring对 数 据 访 问 对 象 （DAO） 的 支 持 旨 在 简 化 它 和 数 据 访 问 技 术 如JDBC，
HibernateorJDO 结 合 使 用。这 使 我 们 可 以 方 便 切 换 持 久 层。编 码 时 也 不 用 担 心
会 捕 获 每 种 技 术 特 有 的 异 常 。
```

### 45 、使用Spring通过什么方式访问Hibernate?

```
在Spring中 有 两 种 方 式 访 问Hibernate：
```

 控制反转 HibernateTemplate和 Callback。
 继承 HibernateDAOSupport提供一个AOP 拦截器。

### 46 、Spring支持的ORM

```
Spring支 持 以 下ORM：
```

 Hibernate
 iBatis
 JPA(JavaPersistenceAPI)
 TopLink
 JDO(JavaDataObjects)
 OJB


### 47.如何通过HibernateDaoSupport将Spring和Hibernate

### 结合起来？

```
用Spring的 SessionFactory 调 用 LocalSessionFactory。 集 成 过 程 分 三 步 ：
```

 配置theHibernateSessionFactory。
 继承HibernateDaoSupport实现一个DAO。
 在AOP支持的事务中装配。

### 48 、Spring支持的事务管理类型

```
Spring支 持 两 种 类 型 的 事 务 管 理 ：
```

 **编程式事务管理** ：这意味你通过编程的方式管理事务，给你带来极大的灵
活性，但是难维护。
 **声明式事务管理：** 这意味着你可以将业务代码和事务管理分离，你只需用
注解和XML配置来管理事务。

### 49 、Spring框架的事务管理有哪些优点？

 它为不同的事务API 如 JTA，JDBC，Hibernate，JPA和JDO，提供
一个不变的编程模式。
 它为编程式事务管理提供了一套简单的API而不是一些复杂的事务API
如


 它支持声明式事务管理。
 它和Spring各种数据访问抽象层很好得集成。

### 50 、你更倾向用那种事务管理类型？

```
大 多 数Spring框 架 的 用 户 选 择 声 明 式 事 务 管 理 ， 因 为 它 对 应 用 代 码 的 影 响 最 小，
因 此 更 符 合 一 个 无 侵 入 的 轻 量 级 容 器 的 思 想 。 声 明 式 事 务 管 理 要 优 于 编 程 式 事 务
管 理 ， 虽 然 比 编 程 式 事 务 管 理 （ 这 种 方 式 允 许 你 通 过 代 码 控 制 事 务 ） 少 了 一 点 灵
活 性 。
```

### Spring面向切面编程（AOP）

### 51 、解释AOP

#### 面 向 切 面 的 编 程 ， 或AOP， 是 一 种 编 程 技 术 ， 允 许 程 序 模 块 化 横 向 切 割 关 注 点，

#### 或 横 切 典 型 的 责 任 划 分 ， 如 日 志 和 事 务 管 理 。

### 52 、Aspect 切面

#### AOP核 心 就 是 切 面 ， 它 将 多 个 类 的 通 用 行 为 封 装 成 可 重 用 的 模 块 ， 该 模 块 含 有 一

#### 组API提 供 横 切 功 能。比 如，一 个 日 志 模 块 可 以 被 称 作 日 志 的AOP切 面。根 据 需

```
求 的 不 同 ， 一 个 应 用 程 序 可 以 有 若 干 切 面 。 在SpringAOP中 ， 切 面 通 过 带 有
@Aspect注 解 的 类 实 现 。
```

### 52 、在SpringAOP 中，关注点和横切关注的区别是什么？


#### 关 注 点 是 应 用 中 一 个 模 块 的 行 为 ， 一 个 关 注 点 可 能 会 被 定 义 成 一 个 我 们 想 实 现 的

#### 一 个 功 能 。

#### 横 切 关 注 点 是 一 个 关 注 点 ， 此 关 注 点 是 整 个 应 用 都 会 使 用 的 功 能 ， 并 影 响 整 个 应

#### 用 ， 比 如 日 志 ， 安 全 和 数 据 传 输 ， 几 乎 应 用 的 每 个 模 块 都 需 要 的 功 能 。 因 此 这 些

#### 都 属 于 横 切 关 注 点 。

### 54 、连接点

#### 连 接 点 代 表 一 个 应 用 程 序 的 某 个 位 置 ， 在 这 个 位 置 我 们 可 以 插 入 一 个AOP切 面，

```
它 实 际 上 是 个 应 用 程 序 执 行SpringAOP的 位 置 。
```

### 55 、通知

#### 通 知 是 个 在 方 法 执 行 前 或 执 行 后 要 做 的 动 作 ， 实 际 上 是 程 序 执 行 时 要 通过

```
SpringAOP框 架 触 发 的 代 码 段 。
```

```
Spring切 面 可 以 应 用 五 种 类 型 的 通 知 ：
```

 **before** ：前置通知，在一个方法执行前被调用。
 **after:** 在方法执行之后调用的通知，无论方法执行是否成功。
 **after-returning:** 仅当方法成功完成后执行的通知。
 **after-throwing:** 在方法抛出异常退出时执行的通知。
 **around:** 在方法执行之前和之后调用的通知。

### 56 、切点


#### 切 入 点 是 一 个 或 一 组 连 接 点 ， 通 知 将 在 这 些 位 置 执 行 。 可 以 通 过 表 达 式 或 匹 配 的

#### 方 式 指 明 切 入 点 。

### 57 、什么是引入?

#### 引 入 允 许 我 们 在 已 存 在 的 类 中 增 加 新 的 方 法 和 属 性 。

### 58 、什么是目标对象?

#### 被 一 个 或 者 多 个 切 面 所 通 知 的 对 象 。 它 通 常 是 一 个 代 理 对 象 。 也 指 被 通 知

（advised） 对 象 。

### 59 、什么是代理?

#### 代 理 是 通 知 目 标 对 象 后 创 建 的 对 象 。 从 客 户 端 的 角 度 看 ， 代 理 对 象 和 目 标 对 象 是

#### 一 样 的 。

### 60 、有几种不同类型的自动代理？

BeanNameAutoProxyCreator

DefaultAdvisorAutoProxyCreator

Metadataautoproxying

### 61 、什么是织入。什么是织入应用的不同点？


#### 织 入 是 将 切 面 和 到 其 他 应 用 类 型 或 对 象 连 接 或 创 建 一 个 被 通 知 对 象 的 过 程 。

#### 织 入 可 以 在 编 译 时 ， 加 载 时 ， 或 运 行 时 完 成 。

### 62 、解释基于XMLSchema方式的切面实现。

#### 在 这 种 情 况 下 ， 切 面 由 常 规 类 以 及 基 于XML的 配 置 实 现 。

### 63 、解释基于注解的切面实现

在 这 种 情 况 下(基 于@AspectJ的 实 现)，涉 及 到 的 切 面 声 明 的 风 格 与 带 有java5标
注 的 普 通java类 一 致 。

### Spring 的MVC

### 64 、什么是Spring的MVC框架？

Spring 配 备 构 建Web 应 用 的 全 功 能MVC框 架 。Spring可 以 很 便 捷 地 和 其他
MVC框 架 集 成，如Struts，Spring 的MVC框 架 用 控 制 反 转 把 业 务 对 象 和 控 制 逻
辑 清 晰 地 隔 离 。 它 也 允 许 以 声 明 的 方 式 把 请 求 参 数 和 业 务 对 象 绑 定 。

### 65 、DispatcherServlet

Spring的MVC框 架 是 围绕DispatcherServlet来 设 计 的，它 用 来 处 理 所 有的HTTP
请 求 和 响 应 。


### 66 、WebApplicationContext

WebApplicationContext 继 承了ApplicationContext 并 增 加 了 一些WEB应 用
必 备 的 特 有 功 能 ， 它 不 同 于 一 般 的ApplicationContext ， 因 为 它 能 处 理 主 题 ，
并 找 到 被 关 联 的servlet。

### 67 、什么是SpringMVC框架的控制器？

#### 控 制 器 提 供 一 个 访 问 应 用 程 序 的 行 为 ， 此 行 为 通 常 通 过 服 务 接 口 实 现 。 控 制 器 解

析 用 户 输 入 并 将 其 转 换 为 一 个 由 视 图 呈 现 给 用 户 的 模 型 。Spring用 一 个 非 常 抽 象
的 方 式 实 现 了 一 个 控 制 层 ， 允 许 用 户 创 建 多 种 用 途 的 控 制 器 。

### 68 、@Controller 注解

该 注 解 表 明 该 类 扮 演 控 制 器 的 角 色 ，Spring不 需 要 你 继 承 任 何 其 他 控 制 器 基 类 或
引 用ServletAPI。

### 69 、@RequestMapping 注解

#### 该 注 解 是 用 来 映 射 一 个URL到 一 个 类 或 一 个 特 定 的 方 处 理 法 上 。

## 微服务 面试题

### 1 、您对微服务有何了解？


**微 服 务** ，又 称 微 服 务 **架 构** ，是 一 种 架 构 风 格，它 将 应 用 程 序 构 建 为 以 **业 务 领 域** 为
模 型 的 小 型 自 治 服 务 集 合 **。**

通 俗 地 说 ， 你 必 须 看 到 蜜 蜂 如 何 通 过 对 齐 六 角 形 蜡 细 胞 来 构 建 它 们 的 蜂 窝 状 物 。
他 们 最 初 从 使 用 各 种 材 料 的 小 部 分 开 始 ， 并 继 续 从 中 构 建 一 个 大 型 蜂 箱 。 这 些 细
胞 形 成 图 案 ， 产 生 坚 固 的 结 构 ， 将 蜂 窝 的 特 定 部 分 固 定 在 一 起 。 这 里 ， 每 个 细 胞
独 立 于 另 一 个 细 胞 ， 但 它 也 与 其 他 细 胞 相 关 。 这 意 味 着 对 一 个 细 胞 的 损 害 不 会 损
害 其 他 细 胞 ， 因 此 ， 蜜 蜂 可 以 在 不 影 响 完 整 蜂 箱 的 情 况 下 重 建 这 些 细 胞 。


#### 图 1 ： 微 服 务 的 蜂 窝 表 示 – 微 服 务 访 谈 问 题

#### 请 参 考 上 图 。 这 里 ， 每 个 六 边 形 形 状 代 表 单 独 的 服 务 组 件 。 与 蜜 蜂 的 工 作 类 似 ，

#### 每 个 敏 捷 团 队 都 使 用 可 用 的 框 架 和 所 选 的 技 术 堆 栈 构 建 单 独 的 服 务 组 件 。 就 像 在

#### 蜂 箱 中 一 样，每 个 服 务 组 件 形 成 一 个 强 大 的 微 服 务 架 构，以 提 供 更 好 的 可 扩 展 性。

#### 此 外 ， 敏 捷 团 队 可 以 单 独 处 理 每 个 服 务 组 件 的 问 题 ， 而 对 整 个 应 用 程 序 没 有 影 响

#### 或 影 响 最 小 。

### 2 、微服务架构有哪些优势？

#### 图 2 ： 微 服 务 的 优 点 – 微 服 务 访 谈 问 题

 **独立开发** – 所有微服务都可以根据各自的功能轻松开发
 **独立部署** – 基于其服务，可以在任何应用程序中单独部署它们
 **故障隔离** – 即使应用程序的一项服务不起作用，系统仍可继续运行
 **混合技术堆栈** – 可以使用不同的语言和技术来构建同一应用程序的不同
服务
 **粒度缩放** – 单个组件可根据需要进行缩放，无需将所有组件缩放在一起


### 3 。微服务有哪些特点？

#### 图 3 ： 微 服 务 的 特 点 – 微 服 务 访 谈 问 题

 **解耦** – 系统内的服务很大程度上是分离的。因此，整个应用程序可以轻
松构建，更改和扩展
 **组件化** – 微服务被视为可以轻松更换和升级的独立组件
 **业务能力** – 微服务非常简单，专注于单一功能
 **自治** – 开发人员和团队可以彼此独立工作，从而提高速度
 **持续交付** – 通过软件创建，测试和批准的系统自动化，允许频繁发布软
件
 **责任** – 微服务不关注应用程序作为项目。相反，他们将应用程序视为他
们负责的产品
 **分散治理** – 重点是使用正确的工具来做正确的工作。这意味着没有标准
化模式或任何技术模式。开发人员可以自由选择最有用的工具来解决他们的问题
 **敏捷** – 微服务支持敏捷开发。任何新功能都可以快速开发并再次丢弃


### 4 、设计微服务的最佳实践是什么？

#### 以 下 是 设 计 微 服 务 的 最 佳 实 践 ：

#### 图 4 ： 设 计 微 服 务 的 最 佳 实 践 – 微 服 务 访 谈 问 题

### 5 、微服务架构如何运作？

#### 微 服 务 架 构 具 有 以 下 组 件 ：


#### 图 5 ： 微 服 务 架 构 – 微 服 务 面 试 问 题

 **客户端** – 来自不同设备的不同用户发送请求。
 **身份提供商** – 验证用户或客户身份并颁发安全令牌。
 **API网关** – 处理客户端请求。
 **静态内容** – 容纳系统的所有内容。
 **管理** – 在节点上平衡服务并识别故障。
 **服务发现** – 查找微服务之间通信路径的指南。
 **内容交付网络** – 代理服务器及其数据中心的分布式网络。
 **远程服务** – 启用驻留在IT设备网络上的远程访问信息。

### 6 、微服务架构的优缺点是什么？


### 7 、单片，SOA和微服务架构有什么区别？

#### 图 6 ： 单 片SOA和 微 服 务 之 间 的 比 较 – 微 服 务 访 谈 问 题

 **单片架构** 类似于大容器，其中应用程序的所有软件组件组装在一起并紧密
封装。


 一个 **面向服务的架构** 是一种相互通信服务的集合。通信可以涉及简单的数
据传递，也可以涉及两个或多个协调某些活动的服务。
 **微服务架构** 是一种架构风格，它将应用程序构建为以业务域为模型的小型
自治服务集合。

### 8 、在使用微服务架构时，您面临哪些挑战？

#### 开 发 一 些 较 小 的 微 服 务 听 起 来 很 容 易 ， 但 开 发 它 们 时 经 常 遇 到 的 挑 战 如 下 。

 **自动化组件** ：难以自动化，因为有许多较小的组件。因此，对于每个组件，
我们必须遵循Build，Deploy和Monitor的各个阶段。
 **易感性** ：将大量组件维护在一起变得难以部署，维护，监控和识别问题。
它需要在所有组件周围具有很好的感知能力。
 **配置管理** ：有时在各种环境中维护组件的配置变得困难。
 **调试** ：很难找到错误的每一项服务。维护集中式日志记录和仪表板以调试
问题至关重要。

### 9 、SOA和微服务架构之间的主要区别是什么？

#### SOA和 微 服 务 之 间 的 主 要 区 别 如 下 ：


### 10 、微服务有什么特点？

#### 您 可 以 列 出 微 服 务 的 特 征 ， 如 下 所 示 ：

#### 图 7 ： 微 服 务 的 特 征 – 微 服 务 访 谈 问 题

### 11 、什么是领域驱动设计？


#### 图 8 ： DDD原 理 – 微 服 务 面 试 问 题

### 12 、为什么需要域驱动设计（DDD）？

#### 图 9 ： 我 们 需 要DDD的 因 素 – 微 服 务 面 试 问 题

### 13 、什么是无所不在的语言？


#### 如 果 您 必 须 定 义 泛 在 语 言 （UL） ， 那 么 它 是 特 定 域 的 开 发 人 员 和 用 户 使 用 的 通 用

#### 语 言 ， 通 过 该 语 言 可 以 轻 松 解 释 域 。

#### 无 处 不 在 的 语 言 必 须 非 常 清 晰 ， 以 便 它 将 所 有 团 队 成 员 放 在 同 一 页 面 上 ， 并 以 机

#### 器 可 以 理 解 的 方 式 进 行 翻 译 。

### 14 、什么是凝聚力？

#### 模 块 内 部 元 素 所 属 的 程 度 被 认 为 是 凝 聚 力 。

### 15 、什么是耦合？

#### 组 件 之 间 依 赖 关 系 强 度 的 度 量 被 认 为 是 耦 合 。 一 个 好 的 设 计 总 是 被 认 为 具 有 高 内

#### 聚 力 和 低 耦 合 性 。

### 16 、什么是REST/RESTful以及它的用途是什么？

**RepresentationalStateTransfer（REST）/RESTful** Web服 务 是 一 种 帮 助 计
算 机 系 统 通 过Internet进 行 通 信 的 架 构 风 格 。 这 使 得 微 服 务 更 容 易 理 解 和 实 现 。

微 服 务 可 以 使 用 或 不 使 用RESTfulAPI实 现 ， 但 使 用RESTfulAPI构 建 松 散 耦 合
的 微 服 务 总 是 更 容 易 。

### 17 、你对SpringBoot有什么了解？


事 实 上，随 着 新 功 能 的 增 加，弹 簧 变 得 越 来 越 复 杂。如 果 必 须 启 动 新 的spring项
目，则 必 须 添 加 构 建 路 径 或 添 加maven依 赖 项，配 置 应 用 程 序 服 务 器，添 加spring
配 置 。 所 以 一 切 都 必 须 从 头 开 始 。

**SpringBoot** 是 解 决 这 个 问 题 的 方 法 。 使 用springboot可 以 避 免 所 有 样 板 代 码
和 配 置 。 因 此 ， 基 本 上 认 为 自 己 就 好 像 你 正 在 烘 烤 蛋 糕 一 样 ， 春 天 就 像 制 作 蛋 糕
所 需 的 成 分 一 样 ， 弹 簧 靴 就 是 你 手 中 的 完 整 蛋 糕 。

**图 10 ：** SpringBoot的 因 素 – 微 服 务 面 试 问 题

### 18 、什么是Spring引导的执行器？

SpringBoot执 行 程 序 提 供 了restfulWeb服 务，以 访 问 生 产 环 境 中 运 行 应 用 程 序
的 当 前 状 态 。 在 执 行 器 的 帮 助 下 ， 您 可 以 检 查 各 种 指 标 并 监 控 您 的 应 用 程 序 。

### 19 、什么是SpringCloud？


```
根 据SpringCloud的 官 方 网 站 ，SpringCloud为 开 发 人 员 提 供 了 快 速 构 建 分 布
式 系 统 中 一 些 常 见 模 式 的 工 具 （ 例 如 配 置 管 理 ， 服 务 发 现 ， 断 路 器 ， 智 能 路 由 ，
领 导 选 举 ， 分 布 式 会 话 ， 集 群 状 态 ） 。
```

### 20 、SpringCloud解决了哪些问题？

```
在 使 用SpringBoot开 发 分 布 式 微 服 务 时，我 们 面 临 的 问 题 很 少 由SpringCloud
解 决 。
```

 **与分布式系统相关的复杂性 –** 包括网络问题，延迟开销，带宽问题，安
全问题。
 **处理服务发现的能力 –** 服务发现允许集群中的进程和服务找到彼此并进
行通信。
 **解决冗余问题 –** 冗余问题经常发生在分布式系统中。
 **负载平衡 –** 改进跨多个计算资源（例如计算机集群，网络链接，中央处
理单元）的工作负载分布。
 **减少性能问题 –** 减少因各种操作开销导致的性能问题。

### 21 、在SpringMVC应用程序中使用WebMvcTest注释有什

### 么用处？

```
在 测 试 目 标 只 关 注SpringMVC组 件 的 情 况 下， WebMvcTest 注 释 用 于 单 元 测试
SpringMVC应 用 程 序。在 上 面 显 示 的 快 照 中，我 们 只 想 启 动ToTestController。
执 行 此 单 元 测 试 时 ， 不 会 启 动 所 有 其 他 控 制 器 和 映 射 。
```

### 22 。你能否给出关于休息和微服务的要点？

```
虽 然 您 可 以 通 过 多 种 方 式 实 现 微 服 务 ， 但RESToverHTTP是 实 现 微 服 务 的 一 种
方 式。REST还 可 用 于 其 他 应 用 程 序，如Web应 用 程 序，API设 计 和MVC应 用 程
序 ， 以 提 供 业 务 数 据 。
```

#### 微 服 务 是 一 种 体 系 结 构 ， 其 中 系 统 的 所 有 组 件 都 被 放 入 单 独 的 组 件 中 ， 这 些 组 件

#### 可 以 单 独 构 建 ， 部 署 和 扩 展 。 微 服 务 的 某 些 原 则 和 最 佳 实 践 有 助 于 构 建 弹 性 应 用

#### 程 序 。

#### 简 而 言 之 ， 您 可 以 说REST是 构 建 微 服 务 的 媒 介 。

### 23 、什么是不同类型的微服务测试？

#### 在 使 用 微 服 务 时 ， 由 于 有 多 个 微 服 务 协 同 工 作 ， 测 试 变 得 非 常 复 杂 。 因 此 ， 测 试

#### 分 为 不 同 的 级 别 。

 在 **底层** ，我们有 **面向技术的测试，** 如单元测试和性能测试。这些是完全自
动化的。
 在 **中间层面** ，我们进行了诸如压力测试和可用性测试之类的 **探索** 性测试。
 在 **顶层，** 我们的 **验收测试** 数量很少。这些验收测试有助于利益相关者理
解和验证软件功能。

### 24 、您对DistributedTransaction有何了解？


#### 分 布 式 事 务 是 指 单 个 事 件 导 致 两 个 或 多 个 不 能 以 原 子 方 式 提 交 的 单 独 数 据 源 的 突

#### 变 的 任 何 情 况 。 在 微 服 务 的 世 界 中 ， 它 变 得 更 加 复 杂 ， 因 为 每 个 服 务 都 是 一 个 工

#### 作 单 元 ， 并 且 大 多 数 时 候 多 个 服 务 必 须 协 同 工 作 才 能 使 业 务 成 功 。

### 25 、什么是Idempotence以及它在哪里使用？

#### 幂 等 性 是 能 够 以 这 样 的 方 式 做 两 次 事 情 的 特 性 ， 即 最 终 结 果 将 保 持 不 变 ， 即 好 像

#### 它 只 做 了 一 次 。

**用 法** ：在 远 程 服 务 或 数 据 源 中 **使 用** Idempotence，这 样 当 它 多 次 接 收 指 令 时，它
只 处 理 指 令 一 次 。

### 26 、什么是有界上下文？

#### 有 界 上 下 文 是 域 驱 动 设 计 的 核 心 模 式 。DDD战 略 设 计 部 门 的 重 点 是 处 理 大 型 模 型

#### 和 团 队 。DDD通 过 将 大 型 模 型 划 分 为 不 同 的 有 界 上 下 文 并 明 确 其 相 互 关 系 来 处 理

#### 大 型 模 型 。

### 27 、什么是双因素身份验证？

#### 双 因 素 身 份 验 证 为 帐 户 登 录 过 程 启 用 第 二 级 身 份 验 证 。


#### 图 11 ： 双 因 素 认 证 的 表 示 – 微 服 务 访 谈 问 题

#### 因 此 ， 假 设 用 户 必 须 只 输 入 用 户 名 和 密 码 ， 那 么 这 被 认 为 是 单 因 素 身 份 验 证 。

### 28 、双因素身份验证的凭据类型有哪些？

#### 这 三 种 凭 证 是 ：


#### 图 12 ： 双 因 素 认 证 的 证 书 类 型 – 微 服 务 面 试 问 题

### 29 、什么是客户证书？

#### 客 户 端 系 统 用 于 向 远 程 服 务 器 发 出 经 过 身 份 验 证 的 请 求 的 一 种 数 字 证 书 称 为 客 户

#### 端 证 书 。 客 户 端 证 书 在 许 多 相 互 认 证 设 计 中 起 着 非 常 重 要 的 作 用 ， 为 请 求 者 的 身

#### 份 提 供 了 强 有 力 的 保 证 。

### 30 、PACT在微服务架构中的用途是什么？

#### PACT 是 一 个 开 源 工 具 ， 允 许 测 试 服 务 提 供 者 和 消 费 者 之 间 的 交 互 ， 与 合 同 隔 离，

#### 从 而 提 高 微 服 务 集 成 的 可 靠 性 。

#### 微 服 务 中 的 用 法

 用于在微服务中实现消费者驱动的合同。
 测试微服务的消费者和提供者之间的消费者驱动的合同。

#### 查 看 即 将 到 来 的 批 次

### 31 、什么是OAuth？

```
OAuth 代 表 开 放 授 权 协 议。这 允 许 通 过 在HTTP服 务 上 启 用 客 户 端 应 用 程 序（例
如 第 三 方 提 供 商Facebook，GitHub等 ） 来 访 问 资 源 所 有 者 的 资 源 。 因 此 ， 您 可
以 在 不 使 用 其 凭 据 的 情 况 下 与 另 一 个 站 点 共 享 存 储 在 一 个 站 点 上 的 资 源 。
```

### 32 、康威定律是什么？

“任 何 设 计 系 统 的 组 织 （ 广 泛 定 义 ） 都 将 产 生 一 种 设 计 ， 其 结 构 是 组 织 通 信 结 构
的 副 本 。” – **M e lCo nw a y**

**图 13 ：** Conway定 律 的 表 示 – 微 服 务 访 谈 问 题

该 法 律 基 本 上 试 图 传 达 这 样 一 个 事 实 ： 为 了 使 软 件 模 块 起 作 用 ， 整 个 团 队 应 该 进
行 良 好 的 沟 通 。 因 此 ， 系 统 的 结 构 反 映 了 产 生 它 的 组 织 的 社 会 边 界 。

### 33 、合同测试你懂什么？

根 据MartinFlower的 说 法 ， **合 同 测 试** 是 在 外 部 服 务 边 界 进 行 的 测 试 ， 用 于 验 证
其 是 否 符 合 消 费 服 务 预 期 的 合 同 。

#### 此 外 ， 合 同 测 试 不 会 深 入 测 试 服 务 的 行 为 。 更 确 切 地 说 ， 它 测 试 该 服 务 调 用 的 输

#### 入 ＆ 输 出 包 含 所 需 的 属 性 和 所 述 响 应 延 迟 ， 吞 吐 量 是 允 许 的 限 度 内 。


### 34 、什么是端到端微服务测试？

#### 端 到 端 测 试 验 证 了 工 作 流 中 的 每 个 流 程 都 正 常 运 行 。 这 可 确 保 系 统 作 为 一 个 整 体

#### 协 同 工 作 并 满 足 所 有 要 求 。

#### 通 俗 地 说 ， 你 可 以 说 端 到 端 测 试 是 一 种 测 试 ， 在 特 定 时 期 后 测 试 所 有 东 西 。

#### 图 14 ： 测 试 层 次 – 微 服 务 面 试 问 题

### 35 、Container在微服务中的用途是什么？


容 器 是 管 理 基 于 微 服 务 的 应 用 程 序 以 便 单 独 开 发 和 部 署 它 们 的 好 方 法。您 可 以 将
微 服 务 封 装 在 容 器 映 像 及 其 依 赖 项 中，然 后 可 以 使 用 它 来 滚 动 按 需 实 例 的 微 服 务，
而 无 需 任 何 额 外 的 工 作 。

#### 图 15 ： 容 器 的 表 示 及 其 在 微 服 务 中 的 使 用 方 式 – 微 服 务 访 谈 问 题

### 36 、什么是微服务架构中的DRY？

#### DRY 代 表 不 要 重 复 自 己 。它 基 本 上 促 进 了 重 用 代 码 的 概 念。这 导 致 开 发 和 共 享 库，

#### 这 反 过 来 导 致 紧 密 耦 合 。

### 37 、什么是消费者驱动的合同（CDC）？

#### 这 基 本 上 是 用 于 开 发 微 服 务 的 模 式 ， 以 便 它 们 可 以 被 外 部 系 统 使 用 。 当 我 们 处 理

#### 微 服 务 时，有 一 个 特 定 的 提 供 者 构 建 它，并 且 有 一 个 或 多 个 使 用 微 服 务 的 消 费 者。

#### 通 常，提 供 程 序 在XML文 档 中 指 定 接 口。但 在 消 费 者 驱 动 的 合 同 中，每 个 服 务 消

#### 费 者 都 传 达 了 提 供 商 期 望 的 接 口 。


### 38 、Web，RESTfulAPI在微服务中的作用是什么？

#### 微 服 务 架 构 基 于 一 个 概 念 ， 其 中 所 有 服 务 应 该 能 够 彼 此 交 互 以 构 建 业 务 功 能 。 因

此，要 实 现 这 一 点，每 个 微 服 务 必 须 具 有 接 口。这 使 得WebAPI成 为 微 服 务 的 一
个 非 常 重 要 的 推 动 者 。RESTfulAPI基 于Web的 开 放 网 络 原 则 ， 为 构 建 微 服 务 架
构 的 各 个 组 件 之 间 的 接 口 提 供 了 最 合 理 的 模 型 。

### 39 、您对微服务架构中的语义监控有何了解？

#### 语 义 监 控 ， 也 称 为 综 合 监 控 ， 将 自 动 化 测 试 与 监 控 应 用 程 序 相 结 合 ， 以 检 测 业

#### 务 失 败 因 素 。

### 40 、我们如何进行跨功能测试？

#### 跨 功 能 测 试 是 对 非 功 能 性 需 求 的 验 证 ， 即 那 些 无 法 像 普 通 功 能 那 样 实 现 的 需 求 。

### 41 、我们如何在测试中消除非决定论？

#### 非 确 定 性 测 试 （NDT）基 本 上 是 不 可 靠 的 测 试。所 以，有 时 可 能 会 发 生 它 们 通 过，

#### 显 然 有 时 它 们 也 可 能 会 失 败 。 当 它 们 失 败 时 ， 它 们 会 重 新 运 行 通 过 。

#### 从 测 试 中 删 除 非 确 定 性 的 一 些 方 法 如 下 ：

#### 1 、 隔 离

#### 2 、 异 步

#### 3 、 远 程 服 务

#### 4 、 隔 离


#### 5 、 时 间

#### 6 、 资 源 泄 漏

### 42 、Mock或Stub有什么区别？

#### 存 根

 一个有助于运行测试的虚拟对象。
 在某些可以硬编码的条件下提供固定行为。
 永远不会测试存根的任何其他行为。

```
例 如，对 于 空 堆 栈，您 可 以 创 建 一 个 只 为empty（）方 法 返 回true的 存 根。因 此，
这 并 不 关 心 堆 栈 中 是 否 存 在 元 素 。
```

#### 嘲 笑

 一个虚拟对象，其中最初设置了某些属性。
 此对象的行为取决于set属性。
 也可以测试对象的行为。

```
例 如，对 于Customer对 象，您 可 以 通 过 设 置 名 称 和 年 龄 来 模 拟 它。您 可 以 将age
设 置 为 12 ，然 后 测 试isAdult（）方 法，该 方 法 将 在 年 龄 大 于 18 时 返 回true。因
此 ， 您 的MockCustomer对 象 适 用 于 指 定 的 条 件 。
```

### 43 、您对MikeCohn的测试金字塔了解多少？


**MikeCohn** 提 供 了 一 个 名 为 **TestPyramid** 的 模 型 **。** 这 描 述 了 软 件 开 发 所 需 的 自
动 化 测 试 类 型 。

**图 16 ：** MikeCohn的 测 试 金 字 塔 – 微 服 务 面 试 问 题

根 据 金 字 塔 ， 第 一 层 的 测 试 数 量 应 该 最 高 。 在 服 务 层 ， 测 试 次 数 应 小 于 单 元 测 试
级 别 ， 但 应 大 于 端 到 端 级 别 。

### 44 、Docker的目的是什么？

**Docker** 提 供 了 一 个 可 用 于 托 管 任 何 应 用 程 序 的 容 器 环 境。在 此，软 件 应 用 程 序 和
支 持 它 的 依 赖 项 紧 密 打 包 在 一 起 。

因 此 ， 这 个 打 包 的 产 品 被 称 为 **Container** ， 因 为 它 是 由Docker完 成 的 ， 所 以 它
被 称 为 **Docker容 器 ！**


### 45 、什么是金丝雀释放？

```
CanaryReleasing 是 一 种 降 低 在 生 产 中 引 入 新 软 件 版 本 的 风 险 的 技 术。这 是 通 过
将 变 更 缓 慢 地 推 广 到 一 小 部 分 用 户 ， 然 后 将 其 发 布 到 整 个 基 础 架 构 ， 即 将 其 提 供
给 每 个 人 来 完 成 的 。
```

### 46 、什么是持续集成（CI）？

#### 持 续 集 成（CI） 是 每 次 团 队 成 员 提 交 版 本 控 制 更 改 时 自 动 构 建 和 测 试 代 码 的 过 程。

#### 这 鼓 励 开 发 人 员 通 过 在 每 个 小 任 务 完 成 后 将 更 改 合 并 到 共 享 版 本 控 制 存 储 库 来 共

#### 享 代 码 和 单 元 测 试 。

### 47 、什么是持续监测？

#### 持 续 监 控 深 入 监 控 覆 盖 范 围 ， 从 浏 览 器 内 前 端 性 能 指 标 ， 到 应 用 程 序 性 能 ， 再 到

#### 主 机 虚 拟 化 基 础 架 构 指 标 。

### 48 、架构师在微服务架构中的角色是什么？

#### 微 服 务 架 构 中 的 架 构 师 扮 演 以 下 角 色 ：

 决定整个软件系统的布局。
 帮助确定组件的分区。因此，他们确保组件相互粘合，但不紧密耦合。
 与开发人员共同编写代码，了解日常生活中面临的挑战。
 为开发微服务的团队提供某些工具和技术的建议。


 提供技术治理，以便技术开发团队遵循微服务原则。

### 49 、我们可以用微服务创建状态机吗？

#### 我 们 知 道 拥 有 自 己 的 数 据 库 的 每 个 微 服 务 都 是 一 个 可 独 立 部 署 的 程 序 单 元 ， 这 反

#### 过 来 又 让 我 们 可 以 创 建 一 个 状 态 机 。 因 此 ， 我 们 可 以 为 特 定 的 微 服 务 指 定 不 同 的

#### 状 态 和 事 件 。

```
例 如 ， 我 们 可 以 定 义Order微 服 务 。 订 单 可 以 具 有 不 同 的 状 态 。Order状 态 的 转
换 可 以 是Order微 服 务 中 的 独 立 事 件 。
```

### 50 、什么是微服务中的反应性扩展？

```
ReactiveExtensions也 称 为Rx。 这 是 一 种 设 计 方 法 ， 我 们 通 过 调 用 多 个 服 务 来
收 集 结 果 ， 然 后 编 译 组 合 响 应 。 这 些 调 用 可 以 是 同 步 或 异 步 ， 阻 塞 或 非 阻 塞 。Rx
是 分 布 式 系 统 中 非 常 流 行 的 工 具 ， 与 传 统 流 程 相 反 。
```

```
希 望 这 些 微 服 务 面 试 问 题 可 以 帮 助 您 进 行 微 服 务 架 构 师 访 谈 。
```

```
翻 译 来 源 ：
https://www.edureka.co/blog/interview-questions/microservices-intervie
w-questions/
```

## Linux 面试题


### 1 、绝对路径用什么符号表示？当前目录、上层目录用什么表示？

### 主目录用什么表示? 切换目录用什么命令？

#### 答 案 ：

绝 对 路 径 ： 如/etc/init.d
当 前 目 录 和 上 层 目 录 ： ./ ../
主 目 录 ： ~/
切 换 目 录 ： cd

### 2 、怎么查看当前进程？怎么执行退出？怎么查看当前路径？

#### 答 案 ：

查 看 当 前 进 程 ： ps
执 行 退 出 ： exit
查 看 当 前 路 径 ： pwd

### 3 、怎么清屏？怎么退出当前命令？怎么执行睡眠？怎么查看当

### 前用户 id？查看指定帮助用什么命令？

#### 答 案 ：

清 屏 ： clear
退 出 当 前 命 令 ： ctrl+c 彻 底 退 出
执 行 睡 眠 ： ctrl+z 挂 起 当 前 进 程fg 恢 复 后 台


查 看 当 前 用 户 id： ”id“： 查 看 显 示 目 前 登 陆 账 户 的 uid 和 gid 及 所 属 分 组
及 用 户 名
查 看 指 定 帮 助 ： 如 manadduser 这 个 很 全 而 且 有 例 子 ； adduser--help 这
个 告 诉 你 一 些 常 用 参 数 ； infoadduesr；

### 4 、Ls 命令执行什么功能？ 可以带哪些参数，有什么区别？

#### 答 案 ：

ls 执 行 的 功 能 ： 列 出 指 定 目 录 中 的 目 录 ， 以 及 文 件
哪 些 参 数 以 及 区 别： a 所 有 文 件l 详 细 信 息，包 括 大 小 字 节 数，可 读 可 写 可 执 行
的 权 限 等

### 5 、建立软链接(快捷方式)，以及硬链接的命令。

#### 答 案 ：

软 链 接 ： ln-sslinksource
硬 链 接 ： lnlinksource

### 6 、目录创建用什么命令？创建文件用什么命令？复制文件用什

### 么命令？

#### 答 案 ：

创 建 目 录 ： mkdir


创 建 文 件：典 型 的 如 touch，vi 也 可 以 创 建 文 件，其 实 只 要 向 一 个 不 存 在 的 文 件
输 出 ， 都 会 创 建 文 件
复 制 文 件 ： cp7. 文 件 权 限 修 改 用 什 么 命 令 ？ 格 式 是 怎 么 样 的 ？
文 件 权 限 修 改 ： chmod

**格 式 如 下 ：**

chmodu+xfile给file的 属 主 增 加 执 行 权 限 chmod 751 file 给 file 的 属 主 分 配
读 、 写 、 执 行(7)的 权 限 ， 给 file 的 所 在 组 分 配 读 、 执 行(5)的 权 限 ， 给 其 他 用 户
分 配 执 行(1)的 权 限
chmodu=rwx,g=rx,o=xfile上 例 的 另 一 种 形 式 chmod=rfile 为 所 有 用 户 分 配
读 权 限
chmod444file同 上 例 chmoda-wx,a+rfile同 上 例
$chmod-Ru+rdirectory 递 归 地 给 directory 目 录 下 所 有 文 件 和 子 目 录 的 属
主 分 配 读 的 权 限

### 7 、查看文件内容有哪些命令可以使用？

#### 答 案 ：

vi 文 件 名 #编 辑 方 式 查 看 ， 可 修 改
cat 文 件 名 #显 示 全 部 文 件 内 容
more 文 件 名 #分 页 显 示 文 件 内 容
less 文 件 名 #与 more 相 似 ， 更 好 的 是 可 以 往 前 翻 页
tail 文 件 名 #仅 查 看 尾 部 ， 还 可 以 指 定 行 数
head 文 件 名 #仅 查 看 头 部,还 可 以 指 定 行 数


### 8 、随意写文件命令？怎么向屏幕输出带空格的字符串，比如”

### helloworld”?

#### 答 案 ：

写 文 件 命 令 ：vi

向 屏 幕 输 出 带 空 格 的 字 符 串:echohelloworld

### 9 、终端是哪个文件夹下的哪个文件？黑洞文件是哪个文件夹下

### 的哪个命令？

#### 答 案 ：

终 端 /dev/tty

黑 洞 文 件 /dev/null

### 10 、移动文件用哪个命令？改名用哪个命令？

#### 答 案 ：

mvmv


### 11 、复制文件用哪个命令？如果需要连同文件夹一块复制呢？

### 如果需要有提示功能呢？

#### 答 案 ：

cpcp-r ？ ？ ？ ？

### 12 、删除文件用哪个命令？如果需要连目录及目录下文件一块

### 删除呢？删除空文件夹用什么命令？

#### 答 案 ：

rmrm-rrmdir

### 13 、Linux 下命令有哪几种可使用的通配符？分别代表什么含

### 义?

#### 答 案 ：

#### “？”可 替 代 单 个 字 符 。

#### “*”可 替 代 任 意 多 个 字 符 。

方 括 号“[charset]”可 替 代 charset 集 中 的 任 何 单 个 字 符 ， 如[a-z]，[abABC]


### 14 、用什么命令对一个文件的内容进行统计？(行号、单词数、

### 字节数)

#### 答 案 ：

wc 命 令 -c 统 计 字 节 数 -l 统 计 行 数 -w 统 计 字 数 。

### 15 、Grep 命令有什么用？ 如何忽略大小写？ 如何查找不含

### 该串的行?

#### 答 案 ：

#### 是 一 种 强 大 的 文 本 搜 索 工 具，它 能 使 用 正 则 表 达 式 搜 索 文 本，并 把 匹 配 的 行 打 印

#### 出 来 。

grep[stringSTRING]filenamegrep[^string]filename

### 16 、Linux 中进程有哪几种状态？在 ps 显示出来的信息中，

### 分别用什么符号表示的？

#### 答 案 ：

#### 1 、 不 可 中 断 状 态 ： 进 程 处 于 睡 眠 状 态 ， 但 是 此 刻 进 程 是 不 可 中 断 的 。 不 可 中 断，

#### 指 进 程 不 响 应 异 步 信 号 。


#### 2 、暂 停 状 态/跟 踪 状 态：向 进 程 发 送 一 个 SIGSTOP 信 号，它 就 会 因 响 应 该 信 号 而

#### 进 入 TASK_STOPPED 状 态;当 进 程 正 在 被 跟 踪 时，它 处 于 TASK_TRACED 这 个

#### 特 殊 的 状 态 。

#### 正 被 跟 踪”指 的 是 进 程 暂 停 下 来 ， 等 待 跟 踪 它 的 进 程 对 它 进 行 操 作 。

3 、 就 绪 状 态 ： 在 run_queue 队 列 里 的 状 态

4 、 运 行 状 态 ： 在 run_queue 队 列 里 的 状 态

#### 5 、 可 中 断 睡 眠 状 态 ： 处 于 这 个 状 态 的 进 程 因 为 等 待 某 某 事 件 的 发 生 （ 比 如 等 待

socket 连 接 、 等 待 信 号 量 ） ， 而 被 挂 起

6 、zombie 状 态（僵 尸）：父 亲 没 有 通 过 wait 系 列 的 系 统 调 用 会 顺 便 将 子 进 程
的 尸 体 （task_struct） 也 释 放 掉

#### 7 、 退 出 状 态

D 不 可 中 断 Uninterruptible（usuallyIO）
R 正 在 运 行 ， 或 在 队 列 中 的 进 程
S 处 于 休 眠 状 态
T 停 止 或 被 追 踪
Z 僵 尸 进 程
W 进 入 内 存 交 换 （ 从 内 核 2.6 开 始 无 效 ）
X 死 掉 的 进 程

### 17 、怎么使一个命令在后台运行?

#### 答 案 ：

#### 一 般 都 是 使 用 & 在 命 令 结 尾 来 让 程 序 自 动 运 行 。(命 令 后 可 以 不 追 加 空 格)


### 18 、利用 ps 怎么显示所有的进程? 怎么利用 ps 查看指定进

### 程的信息？

#### 答 案 ：

ps-ef(systemv 输出)

ps-auxbsd格式输出

ps-ef|greppid

### 19 、哪个命令专门用来查看后台任务?

#### 答 案 ：

job-l

### 20 、把后台任务调到前台执行使用什么命令?把停下的后台任务

### 在后台执行起来用什么命令?

#### 答 案 ：

把 后 台 任 务 调 到 前 台 执 行 fg

把 停 下 的 后 台 任 务 在 后 台 执 行 起 来 bg


### 21 、终止进程用什么命令? 带什么参数?

#### 答 案 ：

kill[-s<信 息 名 称 或 编 号>][程 序] 或 kill[-l<信 息 编 号>]

kill-9pid

### 22 、怎么查看系统支持的所有信号？

#### 答 案 ：

kill-l

### 23 、搜索文件用什么命令? 格式是怎么样的?

#### 答 案 ：

find<指 定 目 录><指 定 条 件><指 定 动 作>

whereis 加 参 数 与 文 件 名

locate 只 加 文 件 名

find 直 接 搜 索 磁 盘 ， 较 慢 。

find/-name"string*"


### 24 、查看当前谁在使用该主机用什么命令? 查找自己所在的终

### 端信息用什么命令?

#### 答 案 ：

查 找 自 己 所 在 的 终 端 信 息 ：whoami

查 看 当 前 谁 在 使 用 该 主 机 ：who

### 25 、使用什么命令查看用过的命令列表?

#### 答 案 ：

history

### 26 、使用什么命令查看磁盘使用空间？ 空闲空间呢?

#### 答 案 ：

df-hl

文 件 系 统 容 量 已 用 可 用 已 用% 挂 载 点

FilesystemSizeUsedAvailUse%Mountedon/dev/hda245G19G24G
44%/
/dev/hda1494M19M450M4%/boot


### 27 、使用什么命令查看网络是否连通?

#### 答 案 ：

```
netstat
```

### 28 、使用什么命令查看 ip 地址及接口信息？

#### 答 案 ：

```
ifconfig
```

### 29 、查看各类环境变量用什么命令?

#### 答 案 ：

```
查 看 所 有 env
查 看 某 个 ， 如 home： env$HOME
```

### 30 、通过什么命令指定命令提示符?

#### 答 案 ：

 \u：显示当前用户账号
 \h：显示当前主机名


 \W：只显示当前路径最后一个目录
 \w：显示当前绝对路径（当前用户目录会以~代替）
 $PWD：显示当前全路径
 $：显示命令行’$'或者’#'符号
 #：下达的第几个命令
 \d：代表日期，格式为weekdaymonthdate，例如："MonAug1"
 \t：显示时间为 24 小时格式，如：HH：MM：SS
 \T：显示时间为 12 小时格式
 \A：显示时间为 24 小时格式：HH：MM
 \v：BASH的版本信息 如exportPS1=’[\u@\h\w#]$‘

### 31 、查找命令的可执行文件是去哪查找的? 怎么对其进行设置

### 及添加?

#### 答 案 ：

```
whereis[-bfmsu][-B<目 录>...][-M<目 录>...][-S<目 录>...][文 件...]
```

```
补 充 说 明 ：whereis 指 令 会 在 特 定 目 录 中 查 找 符 合 条 件 的 文 件 。 这 些 文 件 的 烈 性
应 属 于 原 始 代 码 ， 二 进 制 文 件 ， 或 是 帮 助 文 件 。
```

 -b 只查找二进制文件。
 -B<目录> 只在设置的目录下查找二进制文件。 -f 不显示文件名前的
路径名称。
 -m 只查找说明文件。
 -M<目录> 只在设置的目录下查找说明文件。-s 只查找原始代码文件。
 -S<目录>只在设置的目录下查找原始代码文件。 -u 查找不包含指定
类型的文件。


w-hich 指令会在 PATH 变量指定的路径中，搜索某个系统命令的位置，并且
返回第一个搜索结果。
 -n 指定文件名长度，指定的长度必须大于或等于所有文件中最长的文件
名。
 -p 与-n 参数相同，但此处的包括了文件的路径。-w 指定输出时栏位
的宽度。
 -V 显示版本信息

### 32 、通过什么命令查找执行命令?

#### 答 案 ：

```
which 只 能 查 可 执 行 文 件
```

```
whereis 只 能 查 二 进 制 文 件 、 说 明 文 档 ， 源 文 件 等
```

### 33 、怎么对命令进行取别名？

#### 答 案 ：

aliasla='ls-a'

### 34 、du 和 df 的定义，以及区别？

#### 答 案 ：

```
du 显 示 目 录 或 文 件 的 大 小
```

df 显 示 每 个<文 件>所 在 的 文 件 系 统 的 信 息 ， 默 认 是 显 示 所 有 文 件 系 统 。
（ 文 件 系 统 分 配 其 中 的 一 些 磁 盘 块 用 来 记 录 它 自 身 的 一 些 数 据 ， 如 i 节 点 ， 磁 盘
分 布 图 ， 间 接 块 ， 超 级 块 等 。 这 些 数 据 对 大 多 数 用 户 级 的 程 序 来 说 是 不 可 见 的 ，
通 常 称 为 MetaData。）du 命 令 是 用 户 级 的 程 序，它 不 考 虑 MetaData，而 df
命 令 则 查 看 文 件 系 统 的 磁 盘 分 配 图 并 考 虑 MetaData。
df 命 令 获 得 真 正 的 文 件 系 统 数 据 ， 而 du 命 令 只 查 看 文 件 系 统 的 部 分 情 况 。

### 35 、awk 详解。

#### 答 案 ：

awk'{pattern+action}'{filenames}
#cat/etc/passwd|awk-F':''{print1"\t"7}'//-F的意思是以':'分隔 root
/bin/bash
daemon/bin/sh 搜索/etc/passwd 有 root 关键字的所有行

#awk-F:'/root/'/etc/passwdroot:x:0:0:root:/root:/bin/bash

### 36 、当你需要给命令绑定一个宏或者按键的时候，应该怎么做

### 呢？

#### 答 案 ：

可 以 使 用bind命 令 ，bind可 以 很 方 便 地 在shell中 实 现 宏 或 按 键 的 绑 定 。

#### 在 进 行 按 键 绑 定 的 时 候 ， 我 们 需 要 先 获 取 到 绑 定 按 键 对 应 的 字 符 序 列 。


比 如 获 取F12的 字 符 序 列 获 取 方 法 如 下 ： 先 按 下Ctrl+V,然 后 按 下F12.我 们 就 可
以 得 到F12的 字 符 序 列 ^[[24~。

接 着 使 用bind进 行 绑 定 。

[root@localhost~]#bind ‘”\e[24~":"date"'

注 意 ： 相 同 的 按 键 在 不 同 的 终 端 或 终 端 模 拟 器 下 可 能 会 产 生 不 同 的 字 符 序 列 。

【 附 】 也 可 以 使 用showkey-a命 令 查 看 按 键 对 应 的 字 符 序 列 。

### 37 、如果一个linux新手想要知道当前系统支持的所有命令的

### 列表，他需要怎么做？

#### 答 案 ：

使 用 命 令compgen-c， 可 以 打 印 出 所 有 支 持 的 命 令 列 表 。

[root@localhost~]$compgen-c
l.
ll
ls
which
if
then
else
elif
fi
case


esac
for
select
while
until
do
done
...

### 38 、如果你的助手想要打印出当前的目录栈，你会建议他怎么

### 做？

#### 答 案 ：

使 用Linux 命 令dirs可 以 将 当 前 的 目 录 栈 打 印 出 来 。

[root@localhost~]#dirs
/usr/share/X11

【 附 】 ： 目 录 栈 通 过pushdpopd 来 操 作 。

### 39 、你的系统目前有许多正在运行的任务，在不重启机器的条

### 件下，有什么方法可以把所有正在运行的进程移除呢？

#### 答 案 ：

使 用linux命 令 ’disown-r ’可 以 将 所 有 正 在 运 行 的 进 程 移 除 。


### 40 、bashshell 中的hash 命令有什么作用？

#### 答 案 ：

linux命 令’hash’管 理 着 一 个 内 置 的 哈 希 表，记 录 了 已 执 行 过 的 命 令 的 完 整 路 径,
用 该 命 令 可 以 打 印 出 你 所 使 用 过 的 命 令 以 及 执 行 的 次 数 。

[root@localhost~]#hash

hitscommand

2 /bin/ls

2 /bin/su

### 41 、哪一个bash内置命令能够进行数学运算。

#### 答 案 ：

bashshell 的 内 置 命 令let 可 以 进 行 整 型 数 的 数 学 运 算 。

#!/bin/bash
...
...
letc=a+b
...
...


### 42 、怎样一页一页地查看一个大文件的内容呢？

#### 答 案 ：

通 过 管 道 将 命 令”catfile_name.txt” 和 ’more’ 连 接 在 一 起 可 以 实 现 这 个
需 要.

[root@localhost~]#catfile_name.txt|more

### 43 、数据字典属于哪一个用户的？

#### 答 案 ：

#### 数 据 字 典 是 属 于’SYS’用 户 的，用 户‘SYS’ 和 ’SYSEM’是 由 系 统 默 认 自 动

#### 创 建 的

### 44 、怎样查看一个linux命令的概要与用法？假设你在/bin目

### 录中偶然看到一个你从没见过的的命令，怎样才能知道它的作用

### 和用法呢？

#### 答 案 ：

使 用 命 令whatis 可 以 先 出 显 示 出 这 个 命 令 的 用 法 简 要，比 如，你 可 以 使 用whatis
zcat 去 查 看‘zcat’的 介 绍 以 及 使 用 简 要 。

[root@localhost~]#whatiszcat


zcat[gzip](1) – compressorexpandfiles

### 45 、使用哪一个命令可以查看自己文件系统的磁盘空间配额

### 呢？

#### 答 案 ：

使 用 命 令repquota 能 够 显 示 出 一 个 文 件 系 统 的 配 额 信 息

【 附 】 只 有root用 户 才 能 够 查 看 其 它 用 户 的 配 额 。

## Spring Boot 面试题

### 1 、什么是SpringBoot？

多 年 来 ， 随 着 新 功 能 的 增 加 ，spring变 得 越 来 越 复 杂 。 只 需 访问
https://spring.io/projects 页 面，我 们 就 会 看 到 可 以 在 我 们 的 应 用 程 序 中 使 用 的
所 有Spring项 目 的 不 同 功 能 。 如 果 必 须 启 动 一 个 新 的Spring项 目 ， 我 们 必 须 添
加 构 建 路 径 或 添 加Maven依 赖 关 系 ， 配 置 应 用 程 序 服 务 器 ， 添 加spring配 置 。
因 此，开 始 一 个 新 的spring项 目 需 要 很 多 努 力，因 为 我 们 现 在 必 须 从 头 开 始 做 所
有 事 情 。

SpringBoot是 解 决 这 个 问 题 的 方 法 。SpringBoot已 经 建 立 在 现 有spring框 架
之 上。使 用spring启 动，我 们 避 免 了 之 前 我 们 必 须 做 的 所 有 样 板 代 码 和 配 置。因
此 ，SpringBoot可 以 帮 助 我 们 以 最 少 的 工 作 量 ， 更 加 健 壮 地 使 用 现 有 的Spring
功 能 。


### 2 、SpringBoot有哪些优点？

SpringBoot的 优 点 有 ：

1 、 减 少 开 发 ， 测 试 时 间 和 努 力 。

2 、 使 用JavaConfig有 助 于 避 免 使 用XML。

3 、 避 免 大 量 的Maven导 入 和 各 种 版 本 冲 突 。

4 、 提 供 意 见 发 展 方 法 。

5 、 通 过 提 供 默 认 值 快 速 开 始 开 发 。

6 、 没 有 单 独 的Web服 务 器 需 要 。 这 意 味 着 你 不 再 需 要 启 动Tomcat，Glassfish
或 其 他 任 何 东 西 。

7 、需 要 更 少 的 配 置 因 为 没 有web.xml文 件。只 需 添 加 用@Configuration注 释
的 类，然 后 添 加 用@Bean注 释 的 方 法，Spring将 自 动 加 载 对 象 并 像 以 前 一 样 对 其
进 行 管 理。您 甚 至 可 以 将@Autow ired添 加 到bean方 法 中，以 使Spring自 动 装
入 需 要 的 依 赖 关 系 中 。

#### 8 、基 于 环 境 的 配 置 使 用 这 些 属 性，您 可 以 将 您 正 在 使 用 的 环 境 传 递 到 应 用 程 序：

-Dspring.profiles.active={enviornment}。 在 加 载 主 应 用 程 序 属 性 文 件 后 ，
Spring将 在（application{environment}.properties）中 加 载 后 续 的 应 用 程 序 属
性 文 件 。

### 3 、什么是JavaConfig？


SpringJavaConfig是Spring社 区 的 产 品 ， 它 提 供 了 配 置SpringIoC容 器 的纯
Java方 法 。 因 此 它 有 助 于 避 免 使 用XML配 置 。 使 用JavaConfig的 优 点 在 于 ：

1 、 面 向 对 象 的 配 置 。 由 于 配 置 被 定 义 为JavaConfig中 的 类 ， 因 此 用 户 可 以 充 分
利 用Java中 的 面 向 对 象 功 能 。 一 个 配 置 类 可 以 继 承 另 一 个 ， 重 写 它 的@Bean方
法 等 。

2 、减 少 或 消 除XML配 置。基 于 依 赖 注 入 原 则 的 外 化 配 置 的 好 处 已 被 证 明。但 是，
许 多 开 发 人 员 不 希 望 在XML和Java之 间 来 回 切 换。JavaConfig为 开 发 人 员 提 供
了 一 种纯Java方 法 来 配 置与XML配 置 概 念 相 似的Spring容 器。从 技 术 角 度 来 讲，
只 使 用JavaConfig配 置 类 来 配 置 容 器 是 可 行 的 ， 但 实 际 上 很 多 人 认 为将
JavaConfig与XML混 合 匹 配 是 理 想 的 。

3 、 类 型 安 全 和 重 构 友 好 。JavaConfig提 供 了 一 种 类 型 安 全 的 方 法 来 配 置Spring
容 器。由 于Java5.0对 泛 型 的 支 持，现 在 可 以 按 类 型 而 不 是 按 名 称 检 索bean，不
需 要 任 何 强 制 转 换 或 基 于 字 符 串 的 查 找 。

### 4 、如何重新加载SpringBoot上的更改，而无需重新启动服务

### 器？

#### 这 可 以 使 用DEV工 具 来 实 现 。 通 过 这 种 依 赖 关 系 ， 您 可 以 节 省 任 何 更 改 ， 嵌 入式

tomcat将 重 新 启 动。SpringBoot有 一 个 开 发 工 具（DevTools）模 块，它 有 助 于
提 高 开 发 人 员 的 生 产 力 。Java开 发 人 员 面 临 的 一 个 主 要 挑 战 是 将 文 件 更 改 自 动 部
署 到 服 务 器 并 自 动 重 启 服 务 器 。 开 发 人 员 可 以 重 新 加 载SpringBoot上 的 更 改 ，
而 无 需 重 新 启 动 服 务 器。这 将 消 除 每 次 手 动 部 署 更 改 的 需 要。SpringBoot在 发 布
它 的 第 一 个 版 本 时 没 有 这 个 功 能。这 是 开 发 人 员 最 需 要 的 功 能。DevTools模 块 完
全 满 足 开 发 人 员 的 需 求。该 模 块 将 在 生 产 环 境 中 被 禁 用。它 还 提 供H2数 据 库 控 制
台 以 更 好 地 测 试 应 用 程 序 。


<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-devtools</artifactId>
<optional>true</optional>

### 5 、SpringBoot中的监视器是什么？

Springbootactuator是spring启 动 框 架 中 的 重 要 功 能 之 一 。Springboot监 视
器 可 帮 助 您 访 问 生 产 环 境 中 正 在 运 行 的 应 用 程 序 的 当 前 状 态 。 有 几 个 指 标 必 须 在
生 产 环 境 中 进 行 检 查 和 监 控 。 即 使 一 些 外 部 应 用 程 序 可 能 正 在 使 用 这 些 服 务 来 向
相 关 人 员 触 发 警 报 消 息 。 监 视 器 模 块 公 开 了 一 组 可 直 接 作 为HTTPURL访 问的
REST端 点 来 检 查 状 态 。

### 6 、如何在SpringBoot中禁用Actuator端点安全性？

#### 默 认 情 况 下，所 有 敏 感 的HTTP端 点 都 是 安 全 的，只 有 具 有ACTUATOR角 色 的 用

户 才 能 访 问 它 们。安 全 性 是 使 用 标 准 的HttpServletRequest.isUserInRole方 法 实
施 的 。 我 们 可 以 使 用

来 禁 用 安 全 性 。 只 有 在 执 行 机 构 端 点 在 防 火 墙 后 访 问 时 ， 才 建 议 禁 用 安 全 性 。

### 7 、如何在自定义端口上运行SpringBoot应用程序？

为 了 在 自 定 义 端 口 上 运 行SpringBoot应 用 程 序 ， 您 可 以在
application.properties中 指 定 端 口 。

server.port= 8090


### 8 、什么是YAML？

#### YAML是 一 种 人 类 可 读 的 数 据 序 列 化 语 言 。 它 通 常 用 于 配 置 文 件 。

#### 与 属 性 文 件 相 比，如 果 我 们 想 要 在 配 置 文 件 中 添 加 复 杂 的 属 性，YAML文 件 就 更 加

#### 结 构 化 ， 而 且 更 少 混 淆 。 可 以 看 出YAML具 有 分 层 配 置 数 据 。

### 9 、如何实现SpringBoot应用程序的安全性？

为 了 实 现SpringBoot的 安 全 性 ， 我 们 使 用 spring-boot-starter-security依 赖
项 ， 并 且 必 须 添 加 安 全 配 置 。 它 只 需 要 很 少 的 代 码 。 配 置 类 将 必 须 扩展
WebSecurityConfigurerAdapter并 覆 盖 其 方 法 。

### 10 、如何集成SpringBoot和ActiveMQ？

对 于 集 成SpringBoot和ActiveMQ， 我 们 使 用

依 赖 关 系 。 它 只 需 要 很 少 的 配 置 ， 并 且 不 需 要 样 板 代 码 。

### 11 、如何使用SpringBoot实现分页和排序？

使 用SpringBoot实 现 分 页 非 常 简 单 。 使 用SpringData-JPA可 以 实 现 将 可 分 页
的

#### 传 递 给 存 储 库 方 法 。


### 12 、什么是Swagger？你用SpringBoot实现了它吗？

Swagger广 泛 用 于 可 视 化API，使 用SwaggerUI为 前 端 开 发 人 员 提 供 在 线 沙 箱。
Swagger是 用 于 生 成RESTfulWeb服 务 的 可 视 化 表 示 的 工 具，规 范 和 完 整 框 架 实
现。它 使 文 档 能 够 以 与 服 务 器 相 同 的 速 度 更 新。当 通 过Swagger正 确 定 义 时，消
费 者 可 以 使 用 最 少 量 的 实 现 逻 辑 来 理 解 远 程 服 务 并 与 其 进 行 交 互。因 此，Swagger
消 除 了 调 用 服 务 时 的 猜 测 。

### 13 、什么是SpringProfiles？

SpringProfiles允 许 用 户 根 据 配 置 文 件（dev，test，prod等）来 注 册bean。因
此，当 应 用 程 序 在 开 发 中 运 行 时，只 有 某 些bean可 以 加 载，而 在PRODUCTION
中 ， 某 些 其 他bean可 以 加 载 。 假 设 我 们 的 要 求 是Swagger文 档 仅 适 用 于QA环
境，并 且 禁 用 所 有 其 他 文 档。这 可 以 使 用 配 置 文 件 来 完 成。SpringBoot使 得 使 用
配 置 文 件 非 常 简 单 。

### 14 、什么是SpringBatch？

SpringBootBatch提 供 可 重 用 的 函 数，这 些 函 数 在 处 理 大 量 记 录 时 非 常 重 要，包
括 日 志/跟 踪 ， 事 务 管 理 ， 作 业 处 理 统 计 信 息 ， 作 业 重 新 启 动 ， 跳 过 和 资 源 管 理 。
它 还 提 供 了 更 先 进 的 技 术 服 务 和 功 能 ， 通 过 优 化 和 分 区 技 术 ， 可 以 实 现 极 高 批 量
和 高 性 能 批 处 理 作 业 。 简 单 以 及 复 杂 的 大 批 量 批 处 理 作 业 可 以 高 度 可 扩 展 的 方 式
利 用 框 架 处 理 重 要 大 量 的 信 息 。

### 15 、什么是FreeMarker模板？


FreeMarker是 一 个 基 于Java的 模 板 引 擎，最 初 专 注 于 使 用MVC软 件 架 构 进 行 动
态 网 页 生 成。使 用Freemarker的 主 要 优 点 是 表 示 层 和 业 务 层 的 完 全 分 离。程 序 员
可 以 处 理 应 用 程 序 代 码 ， 而 设 计 人 员 可 以 处 理html页 面 设 计 。 最 后 使用
freemarker可 以 将 这 些 结 合 起 来 ， 给 出 最 终 的 输 出 页 面 。

### 16 、如何使用SpringBoot实现异常处理？

Spring提 供 了 一 种 使 用ControllerAdvice处 理 异 常 的 非 常 有 用 的 方 法 。 我 们 通
过 实 现 一 个ControlerAdvice类 ， 来 处 理 控 制 器 类 抛 出 的 所 有 异 常 。

### 17 、您使用了哪些startermaven依赖项？

#### 使 用 了 下 面 的 一 些 依 赖 项

spring-boot-starter-activemq
spring-boot-starter-security

这 有 助 于 增 加 更 少 的 依 赖 关 系 ， 并 减 少 版 本 的 冲 突 。

### 18 、什么是CSRF攻击？

#### CSRF代 表 跨 站 请 求 伪 造 。 这 是 一 种 攻 击 ， 迫 使 最 终 用 户 在 当 前 通 过 身 份 验 证的

Web应 用 程 序 上 执 行 不 需 要 的 操 作 。CSRF攻 击 专 门 针 对 状 态 改 变 请 求 ， 而 不 是
数 据 窃 取 ， 因 为 攻 击 者 无 法 查 看 对 伪 造 请 求 的 响 应 。

### 19 、什么是WebSockets？


WebSocket是 一 种 计 算 机 通 信 协 议 ， 通 过 单 个TCP连 接 提 供 全 双 工 通 信 信 道 。

1 、WebSocket是 双 向 的 -使 用WebSocket客 户 端 或 服 务 器 可 以 发 起 消 息 发 送。

2 、WebSocket是 全 双 工 的 -客 户 端 和 服 务 器 通 信 是 相 互 独 立 的 。

3 、单 个TCP连 接 -初 始 连 接 使 用HTTP，然 后 将 此 连 接 升 级 到 基 于 套 接 字 的 连 接。
然 后 这 个 单 一 连 接 用 于 所 有 未 来 的 通 信

4 、Light-与http相 比 ，WebSocket消 息 数 据 交 换 要 轻 得 多 。

### 20 、什么是AOP？

#### 在 软 件 开 发 过 程 中 ， 跨 越 应 用 程 序 多 个 点 的 功 能 称 为 交 叉 问 题 。 这 些 交 叉 问 题 与

#### 应 用 程 序 的 主 要 业 务 逻 辑 不 同 。 因 此 ， 将 这 些 横 切 关 注 与 业 务 逻 辑 分 开 是 面 向 方

#### 面 编 程 （AOP） 的 地 方 。


### 21 、什么是ApacheKafka？

ApacheKafka是 一 个 分 布 式 发 布 - 订 阅 消 息 系 统 。 它 是 一 个 可 扩 展 的 ， 容 错 的
发 布 - 订 阅 消 息 系 统，它 使 我 们 能 够 构 建 分 布 式 应 用 程 序。这 是 一 个Apache顶
级 项 目 。Kafka适 合 离 线 和 在 线 消 息 消 费 。

### 22 、我们如何监视所有SpringBoot微服务？

SpringBoot提 供 监 视 器 端 点 以 监 控 各 个 微 服 务 的 度 量。这 些 端 点 对 于 获 取 有 关 应
用 程 序 的 信 息 （ 如 它 们 是 否 已 启 动 ） 以 及 它 们 的 组 件 （ 如 数 据 库 等 ） 是 否 正 常 运
行 很 有 帮 助 。 但 是 ， 使 用 监 视 器 的 一 个 主 要 缺 点 或 困 难 是 ， 我 们 必 须 单 独 打 开 应
用 程 序 的 知 识 点 以 了 解 其 状 态 或 健 康 状 况。想 象 一 下 涉及 50 个 应 用 程 序 的 微 服 务，
管 理 员 将 不 得 不 击 中 所 有 50 个 应 用 程 序 的 执 行 终 端 。

#### 为 了 帮 助 我 们 处 理 这 种 情 况 ， 我 们 将 使 用 位 于

的 开 源 项 目。 它 建 立 在SpringBootActuator之 上，它 提 供 了 一 个WebUI，使
我 们 能 够 可 视 化 多 个 应 用 程 序 的 度 量 。

## Spring Cloud 面试题

### 1 、什么是SpringCloud？

Springcloud流 应 用 程 序 启 动 器 是 基 于SpringBoot的Spring集 成 应 用 程 序 ，
提 供 与 外 部 系 统 的 集 成 。SpringcloudTask， 一 个 生 命 周 期 短 暂 的 微 服 务 框 架，
用 于 快 速 构 建 执 行 有 限 数 据 处 理 的 应 用 程 序 。


### 2 、使用SpringCloud有什么优势？

使 用SpringBoot开 发 分 布 式 微 服 务 时 ， 我 们 面 临 以 下 问 题

1 、 与 分 布 式 系 统 相 关 的 复 杂 性-这 种 开 销 包 括 网 络 问 题 ， 延 迟 开 销 ， 带 宽 问 题 ，
安 全 问 题 。

#### 2 、 服 务 发 现-服 务 发 现 工 具 管 理 群 集 中 的 流 程 和 服 务 如 何 查 找 和 互 相 交 谈 。 它 涉

#### 及 一 个 服 务 目 录，在 该 目 录 中 注 册 服 务，然 后 能 够 查 找 并 连 接 到 该 目 录 中 的 服 务。

#### 3 、 冗 余-分 布 式 系 统 中 的 冗 余 问 题 。

#### 4 、 负 载 平 衡 --负 载 平 衡 改 善 跨 多 个 计 算 资 源 的 工 作 负 荷 ， 诸 如 计 算 机 ， 计 算 机

#### 集 群 ， 网 络 链 路 ， 中 央 处 理 单 元 ， 或 磁 盘 驱 动 器 的 分 布 。

#### 5 、 性 能-问 题 由 于 各 种 运 营 开 销 导 致 的 性 能 问 题 。

6 、 部 署 复 杂 性-Devops技 能 的 要 求 。

### 3 、服务注册和发现是什么意思？SpringCloud如何实现？

#### 当 我 们 开 始 一 个 项 目 时 ， 我 们 通 常 在 属 性 文 件 中 进 行 所 有 的 配 置 。 随 着 越 来 越 多

#### 的 服 务 开 发 和 部 署 ， 添 加 和 修 改 这 些 属 性 变 得 更 加 复 杂 。 有 些 服 务 可 能 会 下 降 ，

而 某 些 位 置 可 能 会 发 生 变 化 。 手 动 更 改 属 性 可 能 会 产 生 问 题 。 Eureka服 务 注 册
和 发 现 可 以 在 这 种 情 况 下 提 供 帮 助。由 于 所 有 服 务 都 在Eureka服 务 器 上 注 册 并 通
过 调 用Eureka服 务 器 完 成 查 找 ， 因 此 无 需 处 理 服 务 地 点 的 任 何 更 改 和 处 理 。

### 4 、负载平衡的意义什么？


#### 在 计 算 中 ， 负 载 平 衡 可 以 改 善 跨 计 算 机 ， 计 算 机 集 群 ， 网 络 链 接 ， 中 央 处 理 单 元

#### 或 磁 盘 驱 动 器 等 多 种 计 算 资 源 的 工 作 负 载 分 布 。 负 载 平 衡 旨 在 优 化 资 源 使 用 ， 最

#### 大 化 吞 吐 量 ， 最 小 化 响 应 时 间 并 避 免 任 何 单 一 资 源 的 过 载 。 使 用 多 个 组 件 进 行 负

#### 载 平 衡 而 不 是 单 个 组 件 可 能 会 通 过 冗 余 来 提 高 可 靠 性 和 可 用 性 。 负 载 平 衡 通 常 涉

#### 及 专 用 软 件 或 硬 件 ， 例 如 多 层 交 换 机 或 域 名 系 统 服 务 器 进 程 。

### 5 、什么是Hystrix？它如何实现容错？

Hystrix是 一 个 延 迟 和 容 错 库，旨 在 隔 离 远 程 系 统，服 务 和 第 三 方 库 的 访 问 点，当
出 现 故 障 是 不 可 避 免 的 故 障 时，停 止 级 联 故 障 并 在 复 杂 的 分 布 式 系 统 中 实 现 弹 性。

通 常 对 于 使 用 微 服 务 架 构 开 发 的 系 统，涉 及 到 许 多 微 服 务。这 些 微 服 务 彼 此 协 作。

#### 思 考 以 下 微 服 务

#### 假 设 如 果 上 图 中 的 微 服 务 9 失 败 了 ， 那 么 使 用 传 统 方 法 我 们 将 传 播 一 个 异 常 。 但

#### 这 仍 然 会 导 致 整 个 系 统 崩 溃 。


#### 随 着 微 服 务 数 量 的 增 加 ， 这 个 问 题 变 得 更 加 复 杂 。 微 服 务 的 数 量 可 以 高 达1000.

这是hystrix出 现 的 地 方 我 们 将 使用Hystrix在 这 种 情 况 下的Fallback方 法 功 能。
我 们 有 两 个 服务employee-consumer使 用由employee-consumer公 开 的 服 务。

简 化 图 如 下 所 示

现 在 假 设 由 于 某 种 原 因，employee-producer公 开 的 服 务 会 抛 出 异 常。我 们 在 这
种 情 况 下 使 用Hystrix定 义 了 一 个 回 退 方 法。这 种 后 备 方 法 应 该 具 有 与 公 开 服 务 相
同 的 返 回 类 型 。 如 果 暴 露 服 务 中 出 现 异 常 ， 则 回 退 方 法 将 返 回 一 些 值 。

### 6 、什么是Hystrix断路器？我们需要它吗？

由 于 某 些 原 因 ，employee-consumer公 开 服 务 会 引 发 异 常 。 在 这 种 情 况 下 使用
Hystrix我 们 定 义 了 一 个 回 退 方 法。如 果 在 公 开 服 务 中 发 生 异 常，则 回 退 方 法 返 回
一 些 默 认 值 。


如 果firstPagemethod() 中 的 异 常 继 续 发 生，则Hystrix电 路 将 中 断，并 且 员 工
使 用 者 将 一 起 跳 过firtsPage方 法 ， 并 直 接 调 用 回 退 方 法 。 断 路 器 的 目 的 是 给 第
一 页 方 法 或 第 一 页 方 法 可 能 调 用 的 其 他 方 法 留 出 时 间 ， 并 导 致 异 常 恢 复 。 可 能 发
生 的 情 况 是 ， 在 负 载 较 小 的 情 况 下 ， 导 致 异 常 的 问 题 有 更 好 的 恢 复 机 会 。

### 7 、什么是NetflixFeign？它的优点是什么？

Feign是 受 到Retrofit，JAXRS-2.0和WebSocket启 发 的java客 户 端 联 编 程 序。
Feign的 第 一 个 目 标 是 将 约 束 分 母 的 复 杂 性 统 一 到httpapis，而 不 考 虑 其 稳 定 性。
在employee-consumer的 例 子 中，我 们 使 用 了employee-producer使 用REST
模 板 公 开 的REST服 务 。


#### 但 是 我 们 必 须 编 写 大 量 代 码 才 能 执 行 以 下 步 骤

#### 1 、 使 用 功 能 区 进 行 负 载 平 衡 。

#### 2 、 获 取 服 务 实 例 ， 然 后 获 取 基 本URL。

#### 3 、 利 用REST模 板 来 使 用 服 务 。 前 面 的 代 码 如 下

@Controller
publicclassConsumerControllerClient{

@Autowired
privateLoadBalancerClientloadBalancer;

publicvoidgetEmployee()throwsRestClientException,IOException{

ServiceInstance
serviceInstance=loadBalancer.choose("employee-producer");

System.out.println(serviceInstance.getUri());

StringbaseUrl=serviceInstance.getUri().toString();

baseUrl=baseUrl+"/employee";

```
RestTemplaterestTemplate=newRestTemplate();
ResponseEntity<String>response=null;
try{
response=restTemplate.exchange(baseUrl,
HttpMethod.GET,getHeaders(),String.class);
```

```
}catch(Exceptionex)
{
System.out.println(ex);
}
System.out.println(response.getBody());
```

之 前 的 代 码，有 像NullPointer这 样 的 例 外 的 机 会，并 不 是 最 优 的。我 们 将 看 到 如
何 使 用NetflixFeign使 呼 叫 变 得 更 加 轻 松 和 清 洁 。 如 果NetflixRibbon依 赖 关
系 也 在 类 路 径 中 ， 那 么Feign默 认 也 会 负 责 负 载 平 衡 。

### 8 、什么是SpringCloudBus？我们需要它吗？

考 虑 以 下 情 况 ： 我 们 有 多 个 应 用 程 序 使 用Spring CloudConfig读 取 属 性 ，而
SpringCloudConfig从GIT读 取 这 些 属 性 。

下 面 的 例 子 中 多 个 员 工 生 产 者 模 块 从EmployeeConfigModule获 取Eureka注
册 的 财 产 。


如 果 假 设GIT中 的Eureka注 册 属 性 更 改 为 指 向 另 一 台Eureka服 务 器，会 发 生 什
么 情 况 。 在 这 种 情 况 下 ， 我 们 将 不 得 不 重 新 启 动 服 务 以 获 取 更 新 的 属 性 。

还 有 另 一 种 使 用 执 行 器 端 点/刷 新 的 方 式 。 但 是 我 们 将 不 得 不 为 每 个 模 块 单 独 调 用
这 个url。例 如，如 果EmployeeProducer1部 署 在 端 口 8080 上，则 调 用 http：
//localhost： 8080 /refresh。 同 样 对 于EmployeeProducer2http：//
localhost： 8081 /refresh等 等 。 这 又 很 麻 烦 。 这 就 是SpringCloudBus发 挥
作 用 的 地 方 。


SpringCloudBus提 供 了 跨 多 个 实 例 刷 新 配 置 的 功 能 。 因 此 ， 在 上 面 的 示 例 中 ，
如 果 我 们 刷 新EmployeeProducer1， 则 会 自 动 刷 新 所 有 其 他 必 需 的 模 块 。 如 果
我 们 有 多 个 微 服 务 启 动 并 运 行 ， 这 特 别 有 用 。 这 是 通 过 将 所 有 微 服 务 连 接 到 单 个
消 息 代 理 来 实 现 的 。 无 论 何 时 刷 新 实 例 ， 此 事 件 都 会 订 阅 到 侦 听 此 代 理 的 所 有 微
服 务，并 且 它 们 也 会 刷 新。可 以 通 过 使 用 端 点/总 线/刷 新 来 实 现 对 任 何 单 个 实 例 的
刷 新 。

## RabbitMQ 面试题

### 1 、什么是rabbitmq

#### 采 用AMQP高 级 消 息 队 列 协 议 的 一 种 消 息 队 列 技 术,最 大 的 特 点 就 是 消 费 并 不 需

#### 要 确 保 提 供 方 存 在,实 现 了 服 务 之 间 的 高 度 解 耦


### 2 、为什么要使用rabbitmq

#### 1 、 在 分 布 式 系 统 下 具 备 异 步,削 峰,负 载 均 衡 等 一 系 列 高 级 功 能;

#### 2 、 拥 有 持 久 化 的 机 制 ， 进 程 消 息 ， 队 列 中 的 信 息 也 可 以 保 存 下 来 。

#### 3 、 实 现 消 费 者 和 生 产 者 之 间 的 解 耦 。

#### 4 、对 于 高 并 发 场 景 下，利 用 消 息 队 列 可 以 使 得 同 步 访 问 变 为 串 行 访 问 达 到 一 定 量

#### 的 限 流 ， 利 于 数 据 库 的 操 作 。

#### 5.可 以 使 用 消 息 队 列 达 到 异 步 下 单 的 效 果 ， 排 队 中 ， 后 台 进 行 逻 辑 下 单 。

### 3 、使用rabbitmq的场景

#### 1 、 服 务 间 异 步 通 信

#### 2 、 顺 序 消 费

#### 3 、 定 时 任 务

#### 4 、 请 求 削 峰

### 4 、如何确保消息正确地发送至RabbitMQ？ 如何确保消息接

### 收方消费了消息？

#### 发 送 方 确 认 模 式

将 信 道 设 置 成confirm模 式 （ 发 送 方 确 认 模 式 ） ， 则 所 有 在 信 道 上 发 布 的 消 息 都
会 被 指 派 一 个 唯 一 的ID。
一 旦 消 息 被 投 递 到 目 的 队 列 后 ， 或 者 消 息 被 写 入 磁 盘 后 （ 可 持 久 化 的 消 息 ） ， 信
道 会 发 送 一 个 确 认 给 生 产 者 （ 包 含 消 息 唯 一ID） 。
如 果RabbitMQ发 生 内 部 错 误 从 而 导 致 消 息 丢 失 ， 会 发 送 一 条nack（not
acknowledged， 未 确 认 ） 消 息 。


#### 发 送 方 确 认 模 式 是 异 步 的 ， 生 产 者 应 用 程 序 在 等 待 确 认 的 同 时 ， 可 以 继 续 发 送 消

#### 息 。 当 确 认 消 息 到 达 生 产 者 应 用 程 序 ， 生 产 者 应 用 程 序 的 回 调 方 法 就 会 被 触 发 来

#### 处 理 确 认 消 息 。

#### 接 收 方 确 认 机 制

#### 接 收 方 消 息 确 认 机 制

#### 消 费 者 接 收 每 一 条 消 息 后 都 必 须 进 行 确 认 （ 消 息 接 收 和 消 息 确 认 是 两 个 不 同 操

作 ） 。 只 有 消 费 者 确 认 了 消 息 ，RabbitMQ才 能 安 全 地 把 消 息 从 队 列 中 删 除 。
这 里 并 没 有 用 到 超 时 机 制 ，RabbitMQ仅 通 过Consumer的 连 接 中 断 来 确 认 是 否
需 要 重 新 发 送 消 息 。 也 就 是 说 ， 只 要 连 接 不 中 断 ，RabbitMQ给 了Consumer足
够 长 的 时 间 来 处 理 消 息 。 保 证 数 据 的 最 终 一 致 性 ；

下 面 罗 列 几 种 特 殊 情 况

如 果 消 费 者 接 收 到 消 息 ， 在 确 认 之 前 断 开 了 连 接 或 取 消 订 阅 ，RabbitMQ会 认 为
消 息 没 有 被 分 发 ， 然 后 重 新 分 发 给 下 一 个 订 阅 的 消 费 者 。 （ 可 能 存 在 消 息 重 复 消
费 的 隐 患 ， 需 要 去 重 ）
如 果 消 费 者 接 收 到 消 息 却 没 有 确 认 消 息 ， 连 接 也 未 断 开 ， 则RabbitMQ认 为 该 消
费 者 繁 忙 ， 将 不 会 给 该 消 费 者 分 发 更 多 的 消 息 。

### 5.如何避免消息重复投递或重复消费？

在 消 息 生 产 时 ，MQ内 部 针 对 每 条 生 产 者 发 送 的 消 息 生 成 一 个inner-msg-id， 作
为 去 重 的 依 据 （ 消 息 投 递 失 败 并 重 传 ） ， 避 免 重 复 的 消 息 进 入 队 列 ；

在 消 息 消 费 时，要 求 消 息 体 中 必 须 要 有 一 个bizId（对 于 同 一 业 务 全 局 唯 一，如 支
付ID、 订 单ID、 帖 子ID等 ） 作 为 去 重 的 依 据 ， 避 免 同 一 条 消 息 被 重 复 消 费 。


### 6 、消息基于什么传输？

#### 由 于TCP连 接 的 创 建 和 销 毁 开 销 较 大 ， 且 并 发 数 受 系 统 资 源 限 制 ， 会 造 成 性 能 瓶

颈 。RabbitMQ使 用 信 道 的 方 式 来 传 输 数 据 。 信 道 是 建 立 在 真 实 的TCP连 接 内 的
虚 拟 连 接 ， 且 每 条TCP连 接 上 的 信 道 数 量 没 有 限 制 。

### 7 、消息如何分发？

若 该 队 列 至 少 有 一 个 消 费 者 订 阅，消 息 将 以 循 环（round-robin）的 方 式 发 送 给 消
费 者 。 每 条 消 息 只 会 分 发 给 一 个 订 阅 的 消 费 者 （ 前 提 是 消 费 者 能 够 正 常 处 理 消 息
并 进 行 确 认 ） 。
通 过 路 由 可 实 现 多 消 费 的 功 能

### 8 、消息怎么路由？

#### 消 息 提 供 方->路 由->一 至 多 个 队 列

消 息 发 布 到 交 换 器 时 ， 消 息 将 拥 有 一 个 路 由 键 （routingkey） ， 在 消 息 创 建 时 设
定 。
通 过 队 列 路 由 键 ， 可 以 把 队 列 绑 定 到 交 换 器 上 。
消 息 到 达 交 换 器 后 ，RabbitMQ会 将 消 息 的 路 由 键 与 队 列 的 路 由 键 进 行 匹 配 （ 针
对 不 同 的 交 换 器 有 不 同 的 路 由 规 则 ） ；

**常 用 的 交 换 器 主 要 分 为 一 下 三 种**

fanout： 如 果 交 换 器 收 到 消 息 ， 将 会 广 播 到 所 有 绑 定 的 队 列 上
direct： 如 果 路 由 键 完 全 匹 配 ， 消 息 就 被 投 递 到 相 应 的 队 列
topic： 可 以 使 来 自 不 同 源 头 的 消 息 能 够 到 达 同 一 个 队 列 。 使 用topic交 换 器 时，
可 以 使 用 通 配 符


### 9 、如何确保消息不丢失？

#### 消 息 持 久 化 ， 当 然 前 提 是 队 列 必 须 持 久 化

RabbitMQ确 保 持 久 性 消 息 能 从 服 务 器 重 启 中 恢 复 的 方 式 是 ， 将 它 们 写 入 磁 盘 上
的 一 个 持 久 化 日 志 文 件 ， 当 发 布 一 条 持 久 性 消 息 到 持 久 交 换 器 上 时 ，Rabbit会 在
消 息 提 交 到 日 志 文 件 后 才 发 送 响 应 。
一 旦 消 费 者 从 持 久 队 列 中 消 费 了 一 条 持 久 化 消 息 ，RabbitMQ会 在 持 久 化 日 志 中
把 这 条 消 息 标 记 为 等 待 垃 圾 收 集。如 果 持 久 化 消 息 在 被 消 费 之 前RabbitMQ重 启，
那 么Rabbit会 自 动 重 建 交 换 器 和 队 列（以 及 绑 定），并 重 新 发 布 持 久 化 日 志 文 件
中 的 消 息 到 合 适 的 队 列 。

### 10 、使用RabbitMQ有什么好处？

#### 1 、 服 务 间 高 度 解 耦

#### 2 、 异 步 通 信 性 能 高

#### 3 、 流 量 削 峰

### 11 、RabbitMQ的集群

#### 镜 像 集 群 模 式

你 创 建 的queue，无 论 元 数 据 还 是queue里 的 消 息 都 会 存 在 于 多 个 实 例 上，然 后
每 次 你 写 消 息 到queue的 时 候，都 会 自 动 把 消 息 到 多 个 实 例 的queue里 进 行 消 息
同 步 。

#### 好 处 在 于 ， 你 任 何 一 个 机 器 宕 机 了 ， 没 事 儿 ， 别 的 机 器 都 可 以 用 。 坏 处 在 于 ， 第

#### 一 ， 这 个 性 能 开 销 也 太 大 了 吧 ， 消 息 同 步 所 有 机 器 ， 导 致 网 络 带 宽 压 力 和 消 耗 很


重 ！ 第 二 ， 这 么 玩 儿 ， 就 没 有 扩 展 性 可 言 了 ， 如 果 某 个queue负 载 很 重 ， 你 加 机
器，新 增 的 机 器 也 包 含 了 这个queue的 所 有 数 据，并 没 有 办 法 线 性 扩 展 你的queue

### 12 、mq的缺点

#### 系 统 可 用 性 降 低

#### 系 统 引 入 的 外 部 依 赖 越 多，越 容 易 挂 掉，本 来 你 就 是A系 统 调 用BCD三 个 系 统 的

#### 接 口 就 好 了 ， 人ABCD四 个 系 统 好 好 的 ， 没 啥 问 题 ， 你 偏 加 个MQ进 来 ， 万一

#### MQ挂 了 咋 整 ？MQ挂 了 ， 整 套 系 统 崩 溃 了 ， 你 不 就 完 了 么 。

#### 系 统 复 杂 性 提 高

#### 硬 生 生 加个MQ进 来，你 怎 么 保 证 消 息 没 有 重 复 消 费 ？ 怎 么 处 理 消 息 丢 失 的 情 况 ？

#### 怎 么 保 证 消 息 传 递 的 顺 序 性 ？ 头 大 头 大 ， 问 题 一 大 堆 ， 痛 苦 不 已

#### 一 致 性 问 题

#### A系 统 处 理 完 了 直 接 返 回 成 功 了，人 都 以 为 你 这 个 请 求 就 成 功 了；但 是 问 题 是，要

#### 是BCD三 个 系 统 那 里，BD两 个 系 统 写 库 成 功 了，结 果C系 统 写 库 失 败 了，咋 整 ？

#### 你 这 数 据 就 不 一 致 了 。

#### 所 以 消 息 队 列 实 际 是 一 种 非 常 复 杂 的 架 构 ， 你 引 入 它 有 很 多 好 处 ， 但 是 也 得 针 对

#### 它 带 来 的 坏 处 做 各 种 额 外 的 技 术 方 案 和 架 构 来 规 避 掉 ， 最 好 之 后 ， 你 会 发 现 ， 妈

#### 呀，系 统 复 杂 度 提 升 了 一 个 数 量 级，也 许 是 复 杂 了 10 倍。但 是 关 键 时 刻，用，还

#### 是 得 用 的

## kafka 面试题

### 1 、如何获取topic主题的列表


bin/kafka-topics.sh--list--zookeeperlocalhost:2181

### 2 、生产者和消费者的命令行是什么？

#### 生 产 者 在 主 题 上 发 布 消 息 ：

bin/kafka-console-producer.sh--broker-list192.168.43.49:9092--topic
Hello-Kafka
注 意 这 里 的IP是server.properties中 的listeners的 配 置。接 下 来 每 个 新 行 就 是
输 入 一 条 新 消 息 。
消 费 者 接 受 消 息 ：
bin/kafka-console-consumer.sh--zookeeperlocalhost:2181--topic
Hello-Kafka--from-beginning

### 3 、consumer是推还是拉？

Kafka最 初 考 虑 的 问 题 是 ，customer应 该 从brokes拉 取 消 息 还 是brokers将 消
息 推 送 到consumer，也 就 是pull还push。在 这 方 面，Kafka遵 循 了 一 种 大 部 分
消 息 系 统 共 同 的 传 统 的 设 计 ：producer将 消 息 推 送 到broker，consumer从
broker拉 取 消 息 。

一 些 消 息 系 统 比 如Scribe和ApacheFlume采 用 了push模 式 ， 将 消 息 推 送 到 下
游 的consumer。这 样 做 有 好 处 也 有 坏 处：由broker决 定 消 息 推 送 的 速 率，对 于
不 同 消 费 速 率 的consumer就 不 太 好 处 理 了 。 消 息 系 统 都 致 力 于 让consumer以
最 大 的 速 率 最 快 速 的 消 费 消 息 ， 但 不 幸 的 是 ，push模 式 下 ， 当broker推 送 的 速
率 远 大 于consumer消 费 的 速 率 时 ，consumer恐 怕 就 要 崩 溃 了 。 最 终Kafka还
是 选 取 了 传 统 的pull模 式 。


Pull模 式 的 另 外 一 个 好 处是consumer可 以 自 主 决 定 是 否 批 量 的从broker拉 取 数
据。Push模 式 必 须 在 不 知 道 下 游consumer消 费 能 力 和 消 费 策 略 的 情 况 下 决 定 是
立 即 推 送 每 条 消 息 还 是 缓 存 之 后 批 量 推 送 。 如 果 为 了 避 免consumer崩 溃 而 采 用
较 低 的 推 送 速 率 ， 将 可 能 导 致 一 次 只 推 送 较 少 的 消 息 而 造 成 浪 费 。Pull模 式 下 ，
consumer就 可 以 根 据 自 己 的 消 费 能 力 去 决 定 这 些 策 略 。

Pull有 个 缺 点 是，如 果broker没 有 可 供 消 费 的 消 息，将 导 致consumer不 断 在 循
环 中 轮 询，直 到 新 消 息 到t达。为 了 避 免 这 点，Kafka有 个 参 数 可 以 让consumer
阻 塞 知 道 新 消 息 到 达(当 然 也 可 以 阻 塞 知 道 消 息 的 数 量 达 到 某 个 特 定 的 量 这 样 就 可
以 批 量 发 送)。

### 4 、讲讲kafka维护消费状态跟踪的方法

大 部 分 消 息 系 统 在broker端 的 维 护 消 息 被 消 费 的 记 录 ： 一 个 消 息 被 分 发到
consumer后broker就 马 上 进 行 标 记 或 者 等 待customer的 通 知 后 进 行 标 记 。 这
样 也 可 以 在 消 息 在 消 费 后 立 马 就 删 除 以 减 少 空 间 占 用 。

但 是 这 样 会 不 会 有 什 么 问 题 呢 ？ 如 果 一 条 消 息 发 送 出 去 之 后 就 立 即 被 标 记 为 消 费
过 的 ， 一 旦consumer处 理 消 息 时 失 败 了 （ 比 如 程 序 崩 溃 ） 消 息 就 丢 失 了 。 为 了
解 决 这 个 问 题 ， 很 多 消 息 系 统 提 供 了 另 外 一 个 个 功 能 ： 当 消 息 被 发 送 出 去 之 后 仅
仅 被 标 记 为 已 发 送 状 态 ， 当 接 到consumer已 经 消 费 成 功 的 通 知 后 才 标 记 为 已 被
消 费 的 状 态。这 虽 然 解 决 了 消 息 丢 失 的 问 题，但 产 生 了 新 问 题，首 先 如 果consumer
处 理 消 息 成 功 了 但 是 向broker发 送 响 应 时 失 败 了，这 条 消 息 将 被 消 费 两 次。第 二
个 问 题 时 ，broker必 须 维 护 每 条 消 息 的 状 态 ， 并 且 每 次 都 要 先 锁 住 消 息 然 后 更 改
状 态 然 后 释 放 锁 。 这 样 麻 烦 又 来 了 ， 且 不 说 要 维 护 大 量 的 状 态 数 据 ， 比 如 如 果 消
息 发 送 出 去 但 没 有 收 到 消 费 成 功 的 通 知 ， 这 条 消 息 将 一 直 处 于 被 锁 定 的 状 态 ，
Kafka采 用 了 不 同 的 策 略。Topic被 分 成 了 若 干 分 区，每 个 分 区 在 同 一 时 间 只 被 一
个consumer消 费 。 这 意 味 着 每 个 分 区 被 消 费 的 消 息 在 日 志 中 的 位 置 仅 仅 是 一 个
简 单 的 整 数：offset。这 样 就 很 容 易 标 记 每 个 分 区 消 费 状 态 就 很 容 易 了，仅 仅 需 要
一 个 整 数 而 已 。 这 样 消 费 状 态 的 跟 踪 就 很 简 单 了 。


这 带 来 了 另 外 一 个 好 处 ：consumer可 以 把offset调 成 一 个 较 老 的 值 ， 去 重 新 消
费 老 的 消 息 。 这 对 传 统 的 消 息 系 统 来 说 看 起 来 有 些 不 可 思 议 ， 但 确 实 是 非 常 有 用
的 ， 谁 规 定 了 一 条 消 息 只 能 被 消 费 一 次 呢 ？

### 5 、讲一下主从同步**

https://blog.csdn.net/honglei915/article/details/37565289

### 6 、为什么需要消息系统，mysql不能满足需求吗？

#### 1.解 耦 ：

#### 允 许 你 独 立 的 扩 展 或 修 改 两 边 的 处 理 过 程 ， 只 要 确 保 它 们 遵 守 同 样 的 接 口 约 束 。

#### 2.冗 余 ：

#### 消 息 队 列 把 数 据 进 行 持 久 化 直 到 它 们 已 经 被 完 全 处 理 ， 通 过 这 一 方 式 规 避 了 数 据

#### 丢 失 风 险。许 多 消 息 队 列 所 采 用 的”插 入-获 取-删 除”范 式 中，在 把 一 个 消 息 从 队

#### 列 中 删 除 之 前 ， 需 要 你 的 处 理 系 统 明 确 的 指 出 该 消 息 已 经 被 处 理 完 毕 ， 从 而 确 保

#### 你 的 数 据 被 安 全 的 保 存 直 到 你 使 用 完 毕 。

#### 3.扩 展 性 ：

#### 因 为 消 息 队 列 解 耦 了 你 的 处 理 过 程，所 以 增 大 消 息 入 队 和 处 理 的 频 率 是 很 容 易 的，

#### 只 要 另 外 增 加 处 理 过 程 即 可 。

#### 4.灵 活 性 & 峰 值 处 理 能 力 ：


#### 在 访 问 量 剧 增 的 情 况 下 ， 应 用 仍 然 需 要 继 续 发 挥 作 用 ， 但 是 这 样 的 突 发 流 量 并 不

#### 常 见 。 如 果 为 以 能 处 理 这 类 峰 值 访 问 为 标 准 来 投 入 资 源 随 时 待 命 无 疑 是 巨 大 的 浪

#### 费 。 使 用 消 息 队 列 能 够 使 关 键 组 件 顶 住 突 发 的 访 问 压 力 ， 而 不 会 因 为 突 发 的 超 负

#### 荷 的 请 求 而 完 全 崩 溃 。

#### 5.可 恢 复 性 ：

#### 系 统 的 一 部 分 组 件 失 效 时 ， 不 会 影 响 到 整 个 系 统 。 消 息 队 列 降 低 了 进 程 间 的 耦 合

#### 度 ， 所 以 即 使 一 个 处 理 消 息 的 进 程 挂 掉 ， 加 入 队 列 中 的 消 息 仍 然 可 以 在 系 统 恢 复

#### 后 被 处 理 。

#### 6.顺 序 保 证 ：

#### 在 大 多 使 用 场 景 下，数 据 处 理 的 顺 序 都 很 重 要。大 部 分 消 息 队 列 本 来 就 是 排 序 的，

并 且 能 保 证 数 据 会 按 照 特 定 的 顺 序 来 处 理 。 （Kafka 保 证 一 个 Partition 内 的 消
息 的 有 序 性 ）

**7.缓 冲 ：**

有 助 于 控 制 和 优 化 数 据 流 经 过 系 统 的 速 度 ， 解 决 生 产 消 息 和 消 费 消 息 的 处 理 速 度
不 一 致 的 情 况 。

#### 8.异 步 通 信 ：

#### 很 多 时 候 ， 用 户 不 想 也 不 需 要 立 即 处 理 消 息 。 消 息 队 列 提 供 了 异 步 处 理 机 制 ， 允

#### 许 用 户 把 一 个 消 息 放 入 队 列 ， 但 并 不 立 即 处 理 它 。 想 向 队 列 中 放 入 多 少 消 息 就 放

#### 多 少 ， 然 后 在 需 要 的 时 候 再 去 处 理 它 们 。

### 7 、Zookeeper对于Kafka的作用是什么？


Zookeeper是 一 个 开 放 源 码 的、高 性 能 的 协 调 服 务，它 用 于Kafka的 分 布 式 应 用。

Zookeeper主 要 用 于 在 集 群 中 不 同 节 点 之 间 进 行 通 信

在Kafka中 ， 它 被 用 于 提 交 偏 移 量 ， 因 此 如 果 节 点 在 任 何 情 况 下 都 失 败 了 ， 它 都
可 以 从 之 前 提 交 的 偏 移 量 中 获 取

除 此 之 外，它 还 执 行 其 他 活 动，如:leader检 测、分 布 式 同 步、配 置 管 理、识 别 新
节 点 何 时 离 开 或 连 接 、 集 群 、 节 点 实 时 状 态 等 等 。

### 8 、数据传输的事务定义有哪三种？

#### 和MQTT的 事 务 定 义 一 样 都 是 3 种 。

#### （ 1 ） 最 多 一 次: 消 息 不 会 被 重 复 发 送 ， 最 多 被 传 输 一 次 ， 但 也 有 可 能 一 次 不 传 输

#### （ 2 ） 最 少 一 次: 消 息 不 会 被 漏 发 送 ， 最 少 被 传 输 一 次 ， 但 也 有 可 能 被 重 复 传 输.

（ 3 ）精 确 的 一 次（Exactlyonce）: 不 会 漏 传 输 也 不 会 重 复 传 输,每 个 消 息 都 传 输
被 一 次 而 且 仅 仅 被 传 输 一 次 ， 这 是 大 家 所 期 望 的

### 9 、Kafka判断一个节点是否还活着有那两个条件？

（ 1 ）节 点 必 须 可 以 维 护 和ZooKeeper的 连 接，Zookeeper通 过 心 跳 机 制 检 查 每
个 节 点 的 连 接
（ 2 ）如 果 节 点 是 个follower,他 必 须 能 及 时 的 同 步leader的 写 操 作，延 时 不 能 太
久


### 10 、Kafka 与传统MQ消息系统之间有三个关键区别

(1).Kafka 持 久 化 日 志 ， 这 些 日 志 可 以 被 重 复 读 取 和 无 限 期 保 留
(2).Kafka 是 一 个 分 布 式 系 统：它 以 集 群 的 方 式 运 行，可 以 灵 活 伸 缩，在 内 部 通 过
复 制 数 据 提 升 容 错 能 力 和 高 可 用 性
(3).Kafka 支 持 实 时 的 流 式 处 理

### 11 、讲一讲kafka的ack的三种机制

request.required.acks有 三 个 值 01 -1(all)

0:生 产 者 不 会 等 待broker的ack，这 个 延 迟 最 低 但 是 存 储 的 保 证 最 弱 当server挂
掉 的 时 候 就 会 丢 数 据 。

1 ：服 务 端 会 等 待ack值 leader副 本 确 认 接 收 到 消 息 后 发 送ack但 是 如 果leader
挂 掉 后 他 不 确 保 是 否 复 制 完 成 新leader也 会 导 致 数 据 丢 失 。

-1(all)： 服 务 端 会 等 所 有 的follower的 副 本 受 到 数 据 后 才 会 受 到leader发 出的
ack， 这 样 数 据 不 会 丢 失

#### 12 、 消 费 者 如 何 不 自 动 提 交 偏 移 量 ， 由 应 用 提 交 ？

将auto.commit.offset设 为false， 然 后 在 处 理 一 批 消 息 后commitSync() 或 者
异 步 提 交commitAsync()
即 ：

ConsumerRecords<>records=consumer.poll();
for(ConsumerRecord<>record:records){
。。。
tyr{


consumer.commitSync()
}
。。。
}

### 13 、消费者故障，出现活锁问题如何解决？

#### 出 现“活 锁”的 情 况 ， 是 它 持 续 的 发 送 心 跳 ， 但 是 没 有 处 理 。 为 了 预 防 消 费 者 在

这 种 情 况 下 一 直 持 有 分 区，我 们 使 用max.poll.interval.ms活 跃 检 测 机 制。 在 此
基 础 上 ， 如 果 你 调 用 的poll的 频 率 大 于 最 大 间 隔 ， 则 客 户 端 将 主 动 地 离 开 组 ， 以
便 其 他 消 费 者 接 管 该 分 区 。 发 生 这 种 情 况 时 ， 你 会 看 到offset提 交 失 败 （ 调用
commitSync（ ） 引 发 的CommitFailedException） 。 这 是 一 种 安 全 机 制 ， 保 障
只 有 活 动 成 员 能 够 提 交offset。 所 以 要 留 在 组 中 ， 你 必 须 持 续 调 用poll。

**消 费 者 提 供 两 个 配 置 设 置 来 控 制poll循 环 ：**

max.poll.interval.ms：增 大poll的 间 隔，可 以 为 消 费 者 提 供 更 多 的 时 间 去 处 理 返
回 的 消 息（调 用poll(long)返 回 的 消 息，通 常 返 回 的 消 息 都 是 一 批）。缺 点 是 此 值
越 大 将 会 延 迟 组 重 新 平 衡 。

max.poll.records： 此 设 置 限 制 每 次 调 用poll返 回 的 消 息 数 ， 这 样 可 以 更 容 易 的
预 测 每 次poll间 隔 要 处 理 的 最 大 值。通 过 调 整 此 值，可 以 减 少poll间 隔，减 少 重
新 平 衡 分 组 的

对 于 消 息 处 理 时 间 不 可 预 测 地 的 情 况，这 些 选 项 是 不 够 的。 处 理 这 种 情 况 的 推 荐
方 法 是 将 消 息 处 理 移 到 另 一 个 线 程 中，让 消 费 者 继 续 调 用poll。 但 是 必 须 注 意 确
保 已 提 交 的offset不 超 过 实 际 位 置 。 另 外 ， 你 必 须 禁 用 自 动 提 交 ， 并 只 有 在 线 程
完 成 处 理 后 才 为 记 录 手 动 提 交 偏 移 量（取 决 于 你）。 还 要 注 意，你 需 要pause暂
停 分 区 ， 不 会 从poll接 收 到 新 消 息 ， 让 线 程 处 理 完 之 前 返 回 的 消 息 （ 如 果 你 的 处
理 能 力 比 拉 取 消 息 的 慢 ， 那 创 建 新 线 程 将 导 致 你 机 器 内 存 溢 出 ） 。


### 14 、如何控制消费的位置

kafka使 用seek(TopicPartition,long)指 定 新 的 消 费 位 置 。 用 于 查 找 服 务 器 保 留
的 最 早 和 最 新 的offset的 特 殊 的 方 法 也 可 用 （seekToBeginning(Collection) 和
seekToEnd(Collection)）

### 15 、kafka分布式（不是单机）的情况下，如何保证消息的顺

### 序消费?

Kafka分 布 式 的 单 位是partition，同 一个partition用 一个writeaheadlog组 织，
所 以 可 以 保 证FIFO的 顺 序 。 不 同partition之 间 不 能 保 证 顺 序 。 但 是 绝 大 多 数 用
户 都 可 以 通 过messagekey来 定 义 ， 因 为 同 一 个key的message可 以 保 证 只 发
送 到 同 一 个partition。

Kafka 中 发 送 1 条 消 息 的 时 候 ， 可 以 指 定(topic,partition,key) 3 个 参 数 。
partiton 和 key 是 可 选 的。如 果 你 指 定 了 partition，那 就 是 所 有 消 息 发 往 同 1
个 partition，就 是 有 序 的。并 且 在 消 费 端，Kafka 保 证， 1 个 partition 只 能被
1 个 consumer 消 费。或 者 你 指 定 key（比 如 orderid），具 有 同 1 个 key 的
所 有 消 息 ， 会 发 往 同 1 个 partition。

### 16 、kafka的高可用机制是什么？

这 个 问 题 比 较 系 统，回 答 出kafka的 系 统 特 点，leader和follower的 关 系，消 息
读 写 的 顺 序 即 可 。

https://www.cnblogs.com/qingyunzong/p/9004703.html


https://www.tuicool.com/articles/BNRza2E

https://yq.aliyun.com/articles/64703

## 17 、kafka如何减少数据丢失

ht t p s :/ / w w w .c n b lo g s .c o m / h u x i 2 b / p / 6 0 5 6 3 6 4 .h tm l

## 18 、kafka如何不消费重复数据？比如扣款，我们不能重复的

## 扣。

#### 其 实 还 是 得 结 合 业 务 来 思 考 ， 我 这 里 给 几 个 思 路 ：

#### 比 如 你 拿 个 数 据 要 写 库 ， 你 先 根 据 主 键 查 一 下 ， 如 果 这 数 据 都 有 了 ， 你 就 别 插 入

了 ，update 一 下 好 吧 。
比 如 你 是 写 Redis， 那 没 问 题 了 ， 反 正 每 次 都 是 set， 天 然 幂 等 性 。
比 如 你 不 是 上 面 两 个 场 景 ， 那 做 的 稍 微 复 杂 一 点 ， 你 需 要 让 生 产 者 发 送 每 条 数 据
的 时 候，里 面 加 一 个 全 局 唯 一 的 id，类 似 订 单 id 之 类 的 东 西，然 后 你 这 里 消 费
到 了 之 后，先 根 据 这 个 id 去 比 如 Redis 里 查 一 下，之 前 消 费 过 吗 ？ 如 果 没 有 消
费 过 ， 你 就 处 理 ， 然 后 这 个 id 写 Redis。 如 果 消 费 过 了 ， 那 你 就 别 处 理 了 ， 保
证 别 重 复 处 理 相 同 的 消 息 即 可 。
比 如 基 于 数 据 库 的 唯 一 键 来 保 证 重 复 数 据 不 会 重 复 插 入 多 条 。 因 为 有 唯 一 键 约 束
了 ， 重 复 数 据 插 入 只 会 报 错 ， 不 会 导 致 数 据 库 中 出 现 脏 数 据 。

# 互联网 Java 工程师面试题

内容涵盖：Java、MyBatis、ZooKeeper、Dubbo、Elasticsearch、Memcached、

Redis、MySQL、Spring、SpringBoot、SpringCloud、RabbitMQ、Kafka、
Linux 等技术栈