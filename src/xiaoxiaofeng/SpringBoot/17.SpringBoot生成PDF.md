## æœ¬æ–‡ç®€ä»‹

æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åœ¨SpringBooté¡¹ç›®ä¸‹ï¼Œé€šè¿‡ä»£ç å’Œæ“ä½œæ­¥éª¤ï¼Œè¯¦ç»†çš„ä»‹ç»äº†å¦‚ä½•æ“ä½œPDFã€‚å¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°å‡†å¤‡é€šè¿‡JAVAæ“ä½œPDFçš„ä½ ã€‚

> é¡¹ç›®æ¡†æ¶ç”¨çš„SpringBootï¼Œä½†åœ¨JAVAä¸­ä»£ç éƒ½æ˜¯é€šç”¨çš„ã€‚

æœ¬æ–‡æ¶‰åŠpdfæ“ä½œï¼Œå¦‚ä¸‹ï¼š

* PDFæ¨¡æ¿åˆ¶ä½œ
* åŸºäºPDFæ¨¡æ¿ç”Ÿæˆï¼Œå¹¶æ”¯æŒä¸‹è½½
* è‡ªå®šä¹‰ä¸­æ–‡å­—ä½“
* å®Œå…¨åŸºäºä»£ç ç”Ÿæˆï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•
* åˆå¹¶PDFï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•
* åˆå¹¶PDFï¼Œå¹¶æ”¯æŒä¸‹è½½

åŸºäºPDFæ¨¡æ¿ç”Ÿæˆï¼šé€‚ç”¨äºå›ºå®šæ ¼å¼çš„PDFæ¨¡æ¿ï¼ŒåŸºäºå†…å®¹è¿›è¡Œå¡«ç©ºï¼Œä¾‹å¦‚ï¼šåˆåŒä¿¡æ¯ç”Ÿæˆã€å›ºå®šæ ¼å¼è¡¨æ ¼ç­‰ç­‰

å®Œå…¨åŸºäºä»£ç ç”Ÿæˆï¼šé€‚ç”¨äºä¸å›ºå®šçš„PDFï¼Œä¾‹å¦‚ï¼šåŠ¨æ€è¡¨æ ¼ã€åŠ¨æ€æ·»åŠ æŸå—å†…å®¹ã€ä¸ç¡®å®šçš„å†…å®¹å¤§å°ç­‰ä¸ç¡®å®šçš„åœºæ™¯

### PDFæ–‡ä»¶ç®€ä»‹

PDFæ˜¯å¯ç§»æ¤æ–‡æ¡£æ ¼å¼ï¼Œæ˜¯ä¸€ç§ç”µå­æ–‡ä»¶æ ¼å¼ï¼Œå…·æœ‰è®¸å¤šå…¶ä»–ç”µå­æ–‡æ¡£æ ¼å¼æ— æ³•ç›¸æ¯”çš„ä¼˜ç‚¹ã€‚PDFæ–‡ä»¶æ ¼å¼å¯ä»¥å°†æ–‡å­—ã€å­—å‹ã€æ ¼å¼ã€é¢œè‰²åŠç‹¬ç«‹äºè®¾å¤‡å’Œåˆ†è¾¨ç‡çš„å›¾å½¢å›¾åƒç­‰å°è£…åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¯¥æ ¼å¼æ–‡ä»¶è¿˜å¯ä»¥åŒ…å«è¶…æ–‡æœ¬é“¾æ¥ã€å£°éŸ³å’ŒåŠ¨æ€å½±åƒç­‰ç”µå­ä¿¡æ¯ï¼Œæ”¯æŒç‰¹é•¿æ–‡ä»¶ï¼Œé›†æˆåº¦å’Œå®‰å…¨å¯é æ€§éƒ½è¾ƒé«˜ã€‚åœ¨ç³»ç»Ÿå¼€å‘ä¸­é€šå¸¸ç”¨æ¥ç”Ÿæˆæ¯”è¾ƒæ­£å¼çš„æŠ¥å‘Šæˆ–è€…åˆåŒç±»çš„ç”µå­æ–‡æ¡£ã€‚

## ä»£ç å®ç°PDFæ“ä½œ

é¦–å…ˆéœ€è¦å¼•å…¥æˆ‘ä»¬çš„ä¾èµ–ï¼Œè¿™é‡Œé€šè¿‡mavenç®¡ç†ä¾èµ–

åœ¨pom.xmlæ–‡ä»¶æ·»åŠ ä»¥ä¸‹ä¾èµ–

~~~xml
<!--pdfæ“ä½œ-->
<!-- https://mvnrepository.com/artifact/com.itextpdf/itextpdf -->
<dependency>
    <groupId>com.itextpdf</groupId>
    <artifactId>itextpdf</artifactId>
    <version>${itextpdf-version}</version>
</dependency>
~~~

### åŸºäºPDFæ¨¡æ¿ç”Ÿæˆï¼Œå¹¶ä¸‹è½½

#### PDFæ¨¡æ¿åˆ¶ä½œ

1. é¦–å…ˆåœ¨wordæˆ–è€…å…¶ä»–è½¯ä»¶é‡Œé¢åˆ¶ä½œæ¨¡æ¿ï¼ŒæŒ‘é€‰ä½ ç†Ÿæ‚‰çš„è½¯ä»¶å³å¯ï¼Œå‰ææ˜¯å¯ç”Ÿæˆpdfã€‚




![image-20220815134838696](https://image.xiaoxiaofeng.site/article/img/2022/08/15/xxf-20220815134842.png)

2. å°†wordæ–‡ä»¶è½¬ä¸ºpdfæ–‡ä»¶ã€‚

![image-20220815135121685](https://image.xiaoxiaofeng.site/article/img/2022/08/15/xxf-20220815135123.png)

3. ä½¿ç”¨Adobe Acrobatè½¯ä»¶æ“ä½œpdfï¼Œè¿™é‡Œç”¨çš„æ˜¯è¿™ä¸ªè½¯ä»¶ï¼Œåªè¦èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå…¶ä»–çš„è½¯ä»¶ä¹Ÿå¯~

   é€‰æ‹©è¡¨å•ç¼–è¾‘å“ˆï¼Œæˆ‘ä»¬è¦åœ¨å¯¹åº”çš„å‘ä¸Šæ·»åŠ è¡¨å•å ä½

![image-20220815135323496](https://image.xiaoxiaofeng.site/article/img/2022/08/15/xxf-20220815135327.png)

4. åœ¨è¡¨å•ä¸Šæ·»åŠ æ–‡æœ¬åŸŸå³å¯ï¼Œæ‰€æœ‰çš„æ ¼å¼éƒ½ç”¨æ–‡æœ¬åŸŸå³å¯ï¼Œè¿™é‡Œåªæ˜¯å å‘ã€‚

   å¯¹åº”çš„åŸŸåç§°è¦ä¸ç¨‹åºçš„åç§°å¯¹åº”ï¼Œæ–¹ä¾¿åé¢æ•°æ®å¡«å……ï¼Œä¸ç„¶åé¢éœ€è¦æ‰‹åŠ¨å¤„ç†èµ‹å€¼ã€‚

![image-20220815135431811](https://image.xiaoxiaofeng.site/article/img/2022/08/15/xxf-20220815135436.png)

![image-20220815135520626](https://image.xiaoxiaofeng.site/article/img/2022/08/15/xxf-20220815135523.png)

5. åˆ›å»ºä¸ªç®€å•çš„æ¨¡æ¿å§ï¼Œè¦æ³¨æ„å¡«å……çš„ç©ºé—´è¦å……è¶³ï¼Œä¸ç„¶ä¼šå‡ºç°æ•°æ®å±•ç¤ºä¸å…¨å‘¦~

   æ•ˆæœå¦‚ä¸‹ï¼š

![image-20220815135622485](https://image.xiaoxiaofeng.site/article/img/2022/08/15/xxf-20220815135625.png)

å¥½äº†ï¼Œåˆ°è¿™é‡Œæ¨¡æ¿å°±ç”Ÿæˆå¥½äº†ï¼Œæˆ‘ä»¬ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åæ”¾åœ¨æˆ‘ä»¬çš„`/resources/templates`ç›®å½•ä¸‹

#### PDFç”Ÿæˆä»£ç ç¼–å†™

åœ¨`util`åŒ…ä¸‹åˆ›å»º`PdfUtil.java`å·¥å…·ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

~~~java
package com.maple.demo.util;

import com.itextpdf.text.Document;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.Image;
import com.itextpdf.text.Rectangle;
import com.itextpdf.text.pdf.*;

import javax.servlet.ServletOutputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.util.Map;
import java.util.Objects;


/**
 * @author ç¬‘å°æ«
 * @date 2022/8/15
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
public class PdfUtil {

    private PdfUtil() {

    }

    /**
     * åˆ©ç”¨æ¨¡æ¿ç”Ÿæˆpdf
     *
     * @param data         å†™å…¥çš„æ•°æ®
     * @param photoMap     å›¾ç‰‡ä¿¡æ¯
     * @param out          è‡ªå®šä¹‰ä¿å­˜pdfçš„æ–‡ä»¶æµ
     * @param templatePath pdfæ¨¡æ¿è·¯å¾„
     */
    public static void fillTemplate(Map<String, Object> data, Map<String, String> photoMap, ServletOutputStream out, String templatePath) {
        PdfReader reader;
        ByteArrayOutputStream bos;
        PdfStamper stamper;
        try {
            // è¯»å–pdfæ¨¡æ¿
            reader = new PdfReader(templatePath);
            bos = new ByteArrayOutputStream();
            stamper = new PdfStamper(reader, bos);
            AcroFields acroFields = stamper.getAcroFields();
            // èµ‹å€¼
            for (String name : acroFields.getFields().keySet()) {
                String value = data.get(name) != null ? data.get(name).toString() : null;
                acroFields.setField(name, value);
            }

            // å›¾ç‰‡èµ‹å€¼
            for (Map.Entry<String, String> entry : photoMap.entrySet()) {
                if (Objects.isNull(entry.getKey())) {
                    continue;
                }
                String key = entry.getKey();
                String url = entry.getValue();
                // æ ¹æ®åœ°å€è¯»å–éœ€è¦æ”¾å…¥pdfä¸­çš„å›¾ç‰‡
                Image image = Image.getInstance(url);
                // è®¾ç½®å›¾ç‰‡åœ¨å“ªä¸€é¡µ
                PdfContentByte overContent = stamper.getOverContent(acroFields.getFieldPositions(key).get(0).page);
                // è·å–æ¨¡æ¿ä¸­å›¾ç‰‡åŸŸçš„å¤§å°
                Rectangle signRect = acroFields.getFieldPositions(key).get(0).position;
                float x = signRect.getLeft();
                float y = signRect.getBottom();
                // å›¾ç‰‡ç­‰æ¯”ç¼©æ”¾
                image.scaleAbsolute(signRect.getWidth(), signRect.getHeight());
                // å›¾ç‰‡ä½ç½®
                image.setAbsolutePosition(x, y);
                // åœ¨è¯¥é¡µåŠ å…¥å›¾ç‰‡
                overContent.addImage(image);
            }

            // å¦‚æœä¸ºfalseé‚£ä¹ˆç”Ÿæˆçš„PDFæ–‡ä»¶è¿˜èƒ½ç¼–è¾‘ï¼Œä¸€å®šè¦è®¾ä¸ºtrue
            stamper.setFormFlattening(true);
            stamper.close();
            Document doc = new Document();
            PdfCopy copy = new PdfCopy(doc, out);
            doc.open();
            PdfImportedPage importPage = copy.getImportedPage(new PdfReader(bos.toByteArray()), 1);
            copy.addPage(importPage);
            doc.close();
            bos.close();
        } catch (IOException | DocumentException e) {
            e.printStackTrace();
        }
    }
}

~~~

åœ¨`controller`åŒ…ä¸‹åˆ›å»º`TestPdfController.java`ç±»ï¼Œå¹¶iä»£ç å¦‚ä¸‹ï¼š

~~~java
package com.maple.demo.controller;

import com.maple.demo.util.PdfUtil;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

/**
 * @author ç¬‘å°æ«
 * @date 2022/8/15
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
@Slf4j
@RestController
@RequestMapping("/example")
@Api(tags = "å®ä¾‹æ¼”ç¤º-PDFæ“ä½œæ¥å£")
public class TestPdfController {

    @ApiOperation(value = "æ ¹æ®PDFæ¨¡æ¿å¯¼å‡ºPDF")
    @GetMapping("/exportPdf")
    public void exportPdf(HttpServletResponse response) {
        Map<String, Object> dataMap = new HashMap<>(16);
        dataMap.put("nickName", "ç¬‘å°æ«");
        dataMap.put("age", 18);
        dataMap.put("sex", "ç”·");
        dataMap.put("csdnUrl", "https://zhangfz.blog.csdn.net/");
        dataMap.put("siteUrl", "https://www.xiaoxiaofeng.com/");
        dataMap.put("desc", "å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç¬‘å°æ«ã€‚");

        Map<String, String> photoMap = new HashMap<>(16);
        photoMap.put("logo", "https://profile.csdnimg.cn/C/9/4/2_qq_34988304");

        // è®¾ç½®responseå‚æ•°ï¼Œå¯ä»¥æ‰“å¼€ä¸‹è½½é¡µé¢
        response.reset();
        response.setCharacterEncoding("UTF-8");
        // å®šä¹‰è¾“å‡ºç±»å‹
        response.setContentType("application/PDF;charset=utf-8");
        // è®¾ç½®åç§°
        response.setHeader("Content-Disposition", "attachment; filename=" + "xiaoxiaofeng.pdf");
        try {
            ServletOutputStream out = response.getOutputStream();
            // æ¨¡æ¿è·¯å¾„è®°
            PdfUtil.fillTemplate(dataMap, photoMap, out, "src/main/resources/templates/xiaoxiaofeng.pdf");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

~~~

é‡å¯é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:6666/example/exportPdf`

å¯¼å‡ºçš„æ–‡ä»¶æ•ˆæœå¦‚ä¸‹ï¼šğŸ‘‡

![image-20220816165204811](https://image.xiaoxiaofeng.site/article/img/2022/08/16/xxf-20220816165233.png)

### å®Œå…¨åŸºäºä»£ç ç”Ÿæˆï¼Œå¹¶ä¿å­˜

å®Œå…¨åŸºäºä»£ç ç”ŸæˆPDFæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒå®šåˆ¶åŒ–äº†ï¼Œè¿™é‡Œåªè®²å¸¸è§çš„æ“ä½œï¼Œå¤§å®¶å¯ä»¥ç”¨ä½œå‚è€ƒï¼š

#### è‡ªå®šä¹‰å­—ä½“

PDFç”Ÿæˆçš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰é‡åˆ°è¿‡ä¸¢å¤±ä¸­æ–‡å­—ä½“çš„é—®é¢˜å‘¢ï¼Œå”‰~è§£å†³ä¸€ä¸‹

å…ˆä¸‹è½½å­—ä½“ï¼Œè¿™é‡Œç”¨é»‘ä½“æ¼”ç¤ºå“ˆï¼Œä¸‹è½½åœ°å€ï¼š[https://www.zitijia.com/downloadpage?itemid=281258939050380345](https://www.zitijia.com/downloadpage?itemid=281258939050380345)

ä¸‹è½½å®Œä¼šå¾—åˆ°ä¸€ä¸ª`Simhei.ttf`æ–‡ä»¶ï¼Œå¯¹æˆ‘ä»¬å°±æ˜¯è¦å®ƒ

å…ˆåœ¨`util`åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªå­—ä½“å·¥å…·ç±»å§ï¼Œä»£ç å¦‚ä¸‹ï¼š

> **æ³¨æ„**ï¼šä»£ç ä¸­ç›¸å…³çš„ç»å¯¹è·¯å¾„è¦æ›¿æ¢æˆè‡ªå·±çš„

~~~java
package com.maple.demo.util;

import com.itextpdf.text.*;
import com.itextpdf.text.pdf.BaseFont;
import com.itextpdf.text.pdf.PdfPTable;

import java.io.IOException;
import java.util.List;

/**
 * @author ç¬‘å°æ«
 * @date 2022/8/15
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
public class PdfFontUtil {

    private PdfFontUtil() {
    }

    /**
     * åŸºç¡€é…ç½®ï¼Œå¯ä»¥æ”¾ç›¸å¯¹è·¯å¾„ï¼Œè¿™é‡Œæ¼”ç¤ºç»å¯¹è·¯å¾„ï¼Œå› ä¸ºå­—ä½“æ–‡ä»¶è¿‡å¤§ï¼Œè¿™é‡Œä¸ä¼ åˆ°é¡¹ç›®é‡Œé¢äº†ï¼Œéœ€è¦çš„è‡ªå·±ä¸‹è½½
     * ä¸‹è½½åœ°å€ï¼šhttps://www.zitijia.com/downloadpage?itemid=281258939050380345
     */
    public static final String FONT = "D:\\font/Simhei.ttf";

    /**
     * åŸºç¡€æ ·å¼
     */
    public static final Font TITLE_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 20, Font.BOLD);
    public static final Font NODE_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 15, Font.BOLD);
    public static final Font BLOCK_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 13, Font.BOLD, BaseColor.BLACK);
    public static final Font INFO_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 12, Font.NORMAL, BaseColor.BLACK);
    public static final Font CONTENT_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);


    /**
     * æ®µè½æ ·å¼è·å–
     */
    public static Paragraph getParagraph(String content, Font font, Integer alignment) {
        Paragraph paragraph = new Paragraph(content, font);
        if (alignment != null && alignment >= 0) {
            paragraph.setAlignment(alignment);
        }
        return paragraph;
    }

    /**
     * å›¾ç‰‡æ ·å¼
     */
    public static Image getImage(String imgPath, float width, float height) throws IOException, BadElementException {
        Image image = Image.getInstance(imgPath);
        image.setAlignment(Image.MIDDLE);
        if (width > 0 && height > 0) {
            image.scaleAbsolute(width, height);
        }
        return image;
    }

    /**
     * è¡¨æ ¼ç”Ÿæˆ
     */
    public static PdfPTable getPdfTable(int numColumns, float totalWidth) {
        // è¡¨æ ¼å¤„ç†
        PdfPTable table = new PdfPTable(numColumns);
        // è®¾ç½®è¡¨æ ¼å®½åº¦æ¯”ä¾‹ä¸º%100
        table.setWidthPercentage(100);
        // è®¾ç½®å®½åº¦:å®½åº¦å¹³å‡
        table.setTotalWidth(totalWidth);
        // é”ä½å®½åº¦
        table.setLockedWidth(true);
        // è®¾ç½®è¡¨æ ¼ä¸Šé¢ç©ºç™½å®½åº¦
        table.setSpacingBefore(10f);
        // è®¾ç½®è¡¨æ ¼ä¸‹é¢ç©ºç™½å®½åº¦
        table.setSpacingAfter(10f);
        // è®¾ç½®è¡¨æ ¼é»˜è®¤ä¸ºæ— è¾¹æ¡†
        table.getDefaultCell().setBorder(0);
        table.setPaddingTop(50);
        table.setSplitLate(false);
        return table;
    }

    /**
     * è¡¨æ ¼å†…å®¹å¸¦æ ·å¼
     */
    public static void addTableCell(PdfPTable dataTable, Font font, List<String> cellList) {
        for (String content : cellList) {
            dataTable.addCell(getParagraph(content, font, -1));
        }
    }
}

~~~

#### pdfç”Ÿæˆå·¥å…·ç±»

ç»§ç»­åœ¨`util`åŒ…ä¸‹çš„`PdfUtil.java`å·¥å…·ç±»é‡Œæ·»åŠ ï¼Œå› ä¸ºæœ¬æ–‡æ¶‰åŠåˆ°çš„æ“ä½œæ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªè´´ç›¸å…³ä»£ç ï¼Œæœ€åç»Ÿä¸€è´´ä¸€ä¸ªå®Œæˆçš„æ–‡ä»¶

> **æ³¨æ„**ï¼šä»£ç ä¸­ç›¸å…³çš„ç»å¯¹è·¯å¾„è¦æ›¿æ¢æˆè‡ªå·±çš„

~~~java
	/**
     * åˆ›å»ºPDFï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šä½ç½®
     *
     * @param filePath ä¿å­˜è·¯å¾„
     */
    public static void createPdfPage(String filePath) {
        // FileOutputStream éœ€è¦å…³é—­ï¼Œé‡Šæ”¾èµ„æº
        try (FileOutputStream outputStream = new FileOutputStream(filePath)) {
            // åˆ›å»ºæ–‡æ¡£
            Document document = new Document();
            PdfWriter writer = PdfWriter.getInstance(document, outputStream);
            document.open();
            // æŠ¥å‘Šæ ‡é¢˜
            document.add(PdfFontUtil.getParagraph("ç¬‘å°æ«çš„ç½‘ç«™ä»‹ç»", TITLE_FONT, 1));
            document.add(PdfFontUtil.getParagraph("\nç½‘ç«™åç§°ï¼šç¬‘å°æ«(www.xiaoxiaofeng.com)", INFO_FONT, -1));
            document.add(PdfFontUtil.getParagraph("\nç”Ÿæˆæ—¶é—´ï¼š2022-07-02\n\n", INFO_FONT, -1));
            // æŠ¥å‘Šå†…å®¹
            // æ®µè½æ ‡é¢˜ + æŠ¥è¡¨å›¾
            document.add(PdfFontUtil.getParagraph("æ–‡ç« æ•°æ®ç»Ÿè®¡", NODE_FONT, -1));
            document.add(PdfFontUtil.getParagraph("\nÂ· ç½‘ç«™é¦–é¡µå›¾\n\n", BLOCK_FONT, -1));
            // è®¾ç½®å›¾ç‰‡å®½é«˜
            float documentWidth = document.getPageSize().getWidth() - document.leftMargin() - document.rightMargin();
            float documentHeight = documentWidth / 580 * 320;
            document.add(PdfFontUtil.getImage("D:\\xiaoxiaofeng.jpg", documentWidth - 80, documentHeight - 80));
            // æ•°æ®è¡¨æ ¼
            document.add(PdfFontUtil.getParagraph("\nÂ· æ•°æ®è¯¦æƒ…\n\n", BLOCK_FONT, -1));
            // ç”Ÿæˆ6åˆ—çš„è¡¨æ ¼
            PdfPTable dataTable = PdfFontUtil.getPdfTable(6, 500);
            // è®¾ç½®è¡¨æ ¼
            List<String> tableHeadList = tableHead();
            List<List<String>> tableDataList = getTableData();
            PdfFontUtil.addTableCell(dataTable, CONTENT_FONT, tableHeadList);
            for (List<String> tableData : tableDataList) {
                PdfFontUtil.addTableCell(dataTable, CONTENT_FONT, tableData);
            }
            document.add(dataTable);
            document.add(PdfFontUtil.getParagraph("\nÂ· æŠ¥è¡¨æè¿°\n\n", BLOCK_FONT, -1));
            document.add(PdfFontUtil.getParagraph("æ•°æ®æŠ¥å‘Šå¯ä»¥ç›‘æ§æ¯å¤©çš„æ¨å¹¿æƒ…å†µï¼Œ" +
                    "å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®è¡¨ç°è¿›è¡Œåˆ†æï¼Œä»¥æå‡æ¨å¹¿æ•ˆæœã€‚", CONTENT_FONT, -1));
            document.newPage();
            document.close();
            writer.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /**
     * æ¨¡æ‹Ÿæ•°æ®
     */
    private static List<String> tableHead() {
        List<String> tableHeadList = new ArrayList<>();
        tableHeadList.add("çœä»½");
        tableHeadList.add("åŸå¸‚");
        tableHeadList.add("æ•°é‡");
        tableHeadList.add("ç™¾åˆ†æ¯”1");
        tableHeadList.add("ç™¾åˆ†æ¯”2");
        tableHeadList.add("ç™¾åˆ†æ¯”3");
        return tableHeadList;
    }

    /**
     * æ¨¡æ‹Ÿæ•°æ®
     */
    private static List<List<String>> getTableData() {
        List<List<String>> tableDataList = new ArrayList<>();
        for (int i = 0; i < 3; i++) {
            List<String> tableData = new ArrayList<>();
            tableData.add("æµ™æ±Ÿ" + i);
            tableData.add("æ­å·" + i);
            tableData.add("276" + i);
            tableData.add("33.3%");
            tableData.add("34.3%");
            tableData.add("35.3%");
            tableDataList.add(tableData);
        }
        return tableDataList;
    }
~~~

åœ¨`controller`åŒ…ä¸‹çš„`TestPdfController.java`ç±»ä¸­æ·»åŠ ä»£ç ï¼Œå› ä¸ºæœ¬æ–‡æ¶‰åŠåˆ°çš„æ“ä½œæ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªè´´ç›¸å…³ä»£ç ï¼Œæœ€åç»Ÿä¸€è´´ä¸€ä¸ªå®Œæˆçš„æ–‡ä»¶ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š

> **æ³¨æ„**ï¼šä»£ç ä¸­ç›¸å…³çš„ç»å¯¹è·¯å¾„è¦æ›¿æ¢æˆè‡ªå·±çš„

~~~java
	@ApiOperation(value = "æµ‹è¯•çº¯ä»£ç ç”ŸæˆPDFåˆ°æŒ‡å®šç›®å½•")
    @GetMapping("/createPdfLocal")
    public void create() {
        PdfUtil.createPdfPage("D:\\xxf.pdf");
    }
~~~

é‡å¯é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:6666/example/createPdfLocal`

å¯ä»¥åœ¨`D:\\test`ç›®å½•ä¸‹çœ‹åˆ°`xxf.pdf`æ–‡ä»¶

![image-20220816170702824](https://image.xiaoxiaofeng.site/article/img/2022/08/16/xxf-20220816170704.png)

æˆ‘ä»¬æ‰“å¼€çœ‹ä¸€ä¸‹æ•ˆæœï¼š

![image-20220816170841371](https://image.xiaoxiaofeng.site/article/img/2022/08/16/xxf-20220816170846.png)

### åˆå¹¶PDFï¼Œå¹¶ä¿å­˜

ç»§ç»­åœ¨`util`åŒ…ä¸‹çš„`PdfUtil.java`å·¥å…·ç±»é‡Œæ·»åŠ ï¼Œå› ä¸ºæœ¬æ–‡æ¶‰åŠåˆ°çš„æ“ä½œæ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªè´´ç›¸å…³ä»£ç ï¼Œæœ€åç»Ÿä¸€è´´ä¸€ä¸ªå®Œæˆçš„æ–‡ä»¶ã€‚

~~~java
/**
     * åˆå¹¶pdfæ–‡ä»¶
     *
     * @param files   è¦åˆå¹¶æ–‡ä»¶æ•°ç»„(ç»å¯¹è·¯å¾„å¦‚{ "D:\\test\\1.pdf", "D:\\test\\2.pdf" , "D:\\test\\3.pdf"})
     * @param newFile åˆå¹¶åå­˜æ”¾çš„ç›®å½•D:\\test\\xxf-merge.pdf
     * @return boolean ç”ŸæˆåŠŸè¿”å›true, å¦å‰‡è¿”å›false
     */
    public static boolean mergePdfFiles(String[] files, String newFile) {
        boolean retValue = false;
        Document document;
        try (FileOutputStream fileOutputStream = new FileOutputStream(newFile)) {
            document = new Document(new PdfReader(files[0]).getPageSize(1));
            PdfCopy copy = new PdfCopy(document, fileOutputStream);
            document.open();
            for (String file : files) {
                PdfReader reader = new PdfReader(file);
                int n = reader.getNumberOfPages();
                for (int j = 1; j <= n; j++) {
                    document.newPage();
                    PdfImportedPage page = copy.getImportedPage(reader, j);
                    copy.addPage(page);
                }
            }
            retValue = true;
            document.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return retValue;
    }
~~~

åœ¨`controller`åŒ…ä¸‹çš„`TestPdfController.java`ç±»ä¸­æ·»åŠ ä»£ç ï¼Œå› ä¸ºæœ¬æ–‡æ¶‰åŠåˆ°çš„æ“ä½œæ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªè´´ç›¸å…³ä»£ç ï¼Œæœ€åç»Ÿä¸€è´´ä¸€ä¸ªå®Œæˆçš„æ–‡ä»¶ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š

> **æ³¨æ„**ï¼šä»£ç ä¸­ç›¸å…³çš„ç»å¯¹è·¯å¾„è¦æ›¿æ¢æˆè‡ªå·±çš„

~~~java
    @ApiOperation(value = "æµ‹è¯•åˆå¹¶PDFåˆ°æŒ‡å®šç›®å½•")
    @GetMapping("/mergePdf")
    public Boolean mergePdf() {
        String[] files = {"D:\\test\\1.pdf", "D:\\test\\2.pdf"};
        String newFile = "D:\\test\\xxf-merge.pdf";
        return PdfUtil.mergePdfFiles(files, newFile);
    }
~~~

æˆ‘ä»¬é¦–å…ˆè¦å‡†å¤‡ä¸¤ä¸ªæ–‡ä»¶`D:\\test\\1.pdf,D:\\test\\2.pdf`ï¼Œè¿™é‡Œå¯ä»¥æŒ‡å®šæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”Ÿæˆçš„pdfæ–‡ä»¶ã€‚

> å¦‚æœæ˜¯å¤„ç†ç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¿™é‡Œè¯´ä¸‹æ€æƒ³ï¼šç¨‹åºåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œæ³¨æ„è¦å”¯ä¸€å‘½åï¼Œç„¶åå°†ç”ŸæˆPDFæ–‡ä»¶ä¿å­˜åˆ°è¿™ä¸ªç›®å½•ï¼Œç„¶åä»è¿™ä¸ªç›®å½•ä¸‹æ‹¿åˆ°pdfè¿›è¡Œå¤„ç†ï¼Œæœ€åå¤„ç†å®Œæˆï¼Œä¿å­˜åˆ°å¯¹åº”çš„ç›®å½•ä¸‹ï¼Œåˆ é™¤è¿™ä¸ªä¸´æ—¶ç›®å½•å’Œä¸‹é¢çš„æ–‡ä»¶ã€‚è¿™é‡Œä¸åšæ¼”ç¤ºã€‚ã€Šåˆå¹¶PDFï¼Œå¹¶ä¸‹è½½ã€‹é‡Œé¢ç•¥æœ‰æ¶‰åŠï¼Œä½†æ˜¯å¤„ç†çš„å•ä¸ªæ–‡ä»¶ï¼Œç¨å¾®æ”¹é€ å³å¯

é‡å¯é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:6666/example/mergePdf`

å¯ä»¥åœ¨`D:\\test`ç›®å½•ä¸‹çœ‹åˆ°`xxf-merge`æ–‡ä»¶

![image-20220816172150022](https://image.xiaoxiaofeng.site/article/img/2022/08/16/xxf-20220816172526.png)

æ‰“å¼€çœ‹ä¸€ä¸‹æ•ˆæœï¼š

![image-20220816172236016](https://image.xiaoxiaofeng.site/article/img/2022/08/16/xxf-20220816172242.png)

### åˆå¹¶PDFï¼Œå¹¶ä¸‹è½½

ç»§ç»­åœ¨`util`åŒ…ä¸‹çš„`PdfUtil.java`å·¥å…·ç±»é‡Œæ·»åŠ ï¼Œè¿™é‡Œåªè´´å°†æ–‡ä»¶è½¬ä¸ºè¾“å‡ºæµï¼Œå¹¶åˆ é™¤æ–‡ä»¶çš„ç›¸å…³ä»£ç ï¼Œåˆå¹¶ç›¸å…³ä»£ç è§ã€Šåˆå¹¶PDFï¼Œå¹¶ä¿å­˜ã€‹çš„utilç±»ã€‚

~~~java

    /**
     * è¯»å–PDFï¼Œè¯»å–ååˆ é™¤PDFï¼Œé€‚ç”¨äºç”Ÿæˆåéœ€è¦å¯¼å‡ºPDFï¼Œåˆ›å»ºä¸´æ—¶æ–‡ä»¶
     */
    public static void readDeletePdf(String fileName, ServletOutputStream outputStream) {
        File file = new File(fileName);
        if (!file.exists()) {
            System.out.println(fileName + "æ–‡ä»¶ä¸å­˜åœ¨");
        }
        try (InputStream in = new FileInputStream(fileName)) {
            IOUtils.copy(in, outputStream);
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                Files.delete(file.toPath());
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
~~~

åœ¨`controller`åŒ…ä¸‹çš„`TestPdfController.java`ç±»ä¸­æ·»åŠ ä»£ç ï¼Œå› ä¸ºæœ¬æ–‡æ¶‰åŠåˆ°çš„æ“ä½œæ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªè´´ç›¸å…³ä»£ç ï¼Œæœ€åç»Ÿä¸€è´´ä¸€ä¸ªå®Œæˆçš„æ–‡ä»¶ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š

> **æ³¨æ„**ï¼šä»£ç ä¸­ç›¸å…³çš„ç»å¯¹è·¯å¾„è¦æ›¿æ¢æˆè‡ªå·±çš„

~~~java
@ApiOperation(value = "æµ‹è¯•åˆå¹¶PDFåå¹¶å¯¼å‡º")
    @GetMapping("/exportMergePdf")
    public void createPdf(HttpServletResponse response) {
        // è®¾ç½®responseå‚æ•°ï¼Œå¯ä»¥æ‰“å¼€ä¸‹è½½é¡µé¢
        response.reset();
        response.setCharacterEncoding("UTF-8");
        // å®šä¹‰è¾“å‡ºç±»å‹
        response.setContentType("application/PDF;charset=utf-8");
        // è®¾ç½®åç§°
        response.setHeader("Content-Disposition", "attachment; filename=" + "xiaoxiaofeng.pdf");
        try (ServletOutputStream out = response.getOutputStream()) {
            String[] files = {"D:\\test\\1.pdf", "D:\\test\\2.pdf"};
            // ç”Ÿæˆä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œè½¬æ¢ä¸ºæµåï¼Œå†åˆ é™¤è¯¥æ–‡ä»¶
            String newFile = "src\\main\\resources\\templates\\" + UUID.randomUUID() + ".pdf";
            boolean isOk = PdfUtil.mergePdfFiles(files, newFile);
            if (isOk) {
                PdfUtil.readDeletePdf(newFile, out);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
~~~

é‡å¯é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:6666/example/exportMergePdf`ä¼šæç¤ºæˆ‘ä»¬ä¸‹è½½ã€‚

![image-20220816172814426](https://image.xiaoxiaofeng.site/article/img/2022/08/16/xxf-20220816173046.png)

### å®Œæ•´ä»£ç 

#### PdfUtil.java

~~~java
package com.maple.demo.util;

import com.itextpdf.text.Document;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.Image;
import com.itextpdf.text.Rectangle;
import com.itextpdf.text.pdf.*;
import org.apache.commons.compress.utils.IOUtils;

import javax.servlet.ServletOutputStream;
import java.io.*;
import java.nio.file.Files;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.Objects;

import static com.maple.demo.util.PdfFontUtil.*;

/**
 * @author ç¬‘å°æ«
 * @date 2022/8/15
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
public class PdfUtil {

    private PdfUtil() {

    }

    /**
     * åˆ©ç”¨æ¨¡æ¿ç”Ÿæˆpdf
     *
     * @param data         å†™å…¥çš„æ•°æ®
     * @param photoMap     å›¾ç‰‡ä¿¡æ¯
     * @param out          è‡ªå®šä¹‰ä¿å­˜pdfçš„æ–‡ä»¶æµ
     * @param templatePath pdfæ¨¡æ¿è·¯å¾„
     */
    public static void fillTemplate(Map<String, Object> data, Map<String, String> photoMap, ServletOutputStream out, String templatePath) {
        PdfReader reader;
        ByteArrayOutputStream bos;
        PdfStamper stamper;
        try {
            // è¯»å–pdfæ¨¡æ¿
            reader = new PdfReader(templatePath);
            bos = new ByteArrayOutputStream();
            stamper = new PdfStamper(reader, bos);
            AcroFields acroFields = stamper.getAcroFields();
            // èµ‹å€¼
            for (String name : acroFields.getFields().keySet()) {
                String value = data.get(name) != null ? data.get(name).toString() : null;
                acroFields.setField(name, value);
            }

            // å›¾ç‰‡èµ‹å€¼
            for (Map.Entry<String, String> entry : photoMap.entrySet()) {
                if (Objects.isNull(entry.getKey())) {
                    continue;
                }
                String key = entry.getKey();
                String url = entry.getValue();
                // æ ¹æ®åœ°å€è¯»å–éœ€è¦æ”¾å…¥pdfä¸­çš„å›¾ç‰‡
                Image image = Image.getInstance(url);
                // è®¾ç½®å›¾ç‰‡åœ¨å“ªä¸€é¡µ
                PdfContentByte overContent = stamper.getOverContent(acroFields.getFieldPositions(key).get(0).page);
                // è·å–æ¨¡æ¿ä¸­å›¾ç‰‡åŸŸçš„å¤§å°
                Rectangle signRect = acroFields.getFieldPositions(key).get(0).position;
                float x = signRect.getLeft();
                float y = signRect.getBottom();
                // å›¾ç‰‡ç­‰æ¯”ç¼©æ”¾
                image.scaleAbsolute(signRect.getWidth(), signRect.getHeight());
                // å›¾ç‰‡ä½ç½®
                image.setAbsolutePosition(x, y);
                // åœ¨è¯¥é¡µåŠ å…¥å›¾ç‰‡
                overContent.addImage(image);
            }

            // å¦‚æœä¸ºfalseé‚£ä¹ˆç”Ÿæˆçš„PDFæ–‡ä»¶è¿˜èƒ½ç¼–è¾‘ï¼Œä¸€å®šè¦è®¾ä¸ºtrue
            stamper.setFormFlattening(true);
            stamper.close();
            Document doc = new Document();
            PdfCopy copy = new PdfCopy(doc, out);
            doc.open();
            PdfImportedPage importPage = copy.getImportedPage(new PdfReader(bos.toByteArray()), 1);
            copy.addPage(importPage);
            doc.close();
            bos.close();
        } catch (IOException | DocumentException e) {
            e.printStackTrace();
        }
    }

    /**
     * åˆ›å»ºPDFï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šä½ç½®
     *
     * @param filePath ä¿å­˜è·¯å¾„
     */
    public static void createPdfPage(String filePath) {
        // FileOutputStream éœ€è¦å…³é—­ï¼Œé‡Šæ”¾èµ„æº
        try (FileOutputStream outputStream = new FileOutputStream(filePath)) {
            // åˆ›å»ºæ–‡æ¡£
            Document document = new Document();
            PdfWriter writer = PdfWriter.getInstance(document, outputStream);
            document.open();
            // æŠ¥å‘Šæ ‡é¢˜
            document.add(PdfFontUtil.getParagraph("ç¬‘å°æ«çš„ç½‘ç«™ä»‹ç»", TITLE_FONT, 1));
            document.add(PdfFontUtil.getParagraph("\nç½‘ç«™åç§°ï¼šç¬‘å°æ«(www.xiaoxiaofeng.com)", INFO_FONT, -1));
            document.add(PdfFontUtil.getParagraph("\nç”Ÿæˆæ—¶é—´ï¼š2022-07-02\n\n", INFO_FONT, -1));
            // æŠ¥å‘Šå†…å®¹
            // æ®µè½æ ‡é¢˜ + æŠ¥è¡¨å›¾
            document.add(PdfFontUtil.getParagraph("æ–‡ç« æ•°æ®ç»Ÿè®¡", NODE_FONT, -1));
            document.add(PdfFontUtil.getParagraph("\nÂ· ç½‘ç«™é¦–é¡µå›¾\n\n", BLOCK_FONT, -1));
            // è®¾ç½®å›¾ç‰‡å®½é«˜
            float documentWidth = document.getPageSize().getWidth() - document.leftMargin() - document.rightMargin();
            float documentHeight = documentWidth / 580 * 320;
            document.add(PdfFontUtil.getImage("D:\\xiaoxiaofeng.jpg", documentWidth - 80, documentHeight - 80));
            // æ•°æ®è¡¨æ ¼
            document.add(PdfFontUtil.getParagraph("\nÂ· æ•°æ®è¯¦æƒ…\n\n", BLOCK_FONT, -1));
            // ç”Ÿæˆ6åˆ—çš„è¡¨æ ¼
            PdfPTable dataTable = PdfFontUtil.getPdfTable(6, 500);
            // è®¾ç½®è¡¨æ ¼
            List<String> tableHeadList = tableHead();
            List<List<String>> tableDataList = getTableData();
            PdfFontUtil.addTableCell(dataTable, CONTENT_FONT, tableHeadList);
            for (List<String> tableData : tableDataList) {
                PdfFontUtil.addTableCell(dataTable, CONTENT_FONT, tableData);
            }
            document.add(dataTable);
            document.add(PdfFontUtil.getParagraph("\nÂ· æŠ¥è¡¨æè¿°\n\n", BLOCK_FONT, -1));
            document.add(PdfFontUtil.getParagraph("æ•°æ®æŠ¥å‘Šå¯ä»¥ç›‘æ§æ¯å¤©çš„æ¨å¹¿æƒ…å†µï¼Œ" +
                    "å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®è¡¨ç°è¿›è¡Œåˆ†æï¼Œä»¥æå‡æ¨å¹¿æ•ˆæœã€‚", CONTENT_FONT, -1));
            document.newPage();
            document.close();
            writer.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /**
     * æ¨¡æ‹Ÿæ•°æ®
     */
    private static List<String> tableHead() {
        List<String> tableHeadList = new ArrayList<>();
        tableHeadList.add("çœä»½");
        tableHeadList.add("åŸå¸‚");
        tableHeadList.add("æ•°é‡");
        tableHeadList.add("ç™¾åˆ†æ¯”1");
        tableHeadList.add("ç™¾åˆ†æ¯”2");
        tableHeadList.add("ç™¾åˆ†æ¯”3");
        return tableHeadList;
    }

    /**
     * æ¨¡æ‹Ÿæ•°æ®
     */
    private static List<List<String>> getTableData() {
        List<List<String>> tableDataList = new ArrayList<>();
        for (int i = 0; i < 3; i++) {
            List<String> tableData = new ArrayList<>();
            tableData.add("æµ™æ±Ÿ" + i);
            tableData.add("æ­å·" + i);
            tableData.add("276" + i);
            tableData.add("33.3%");
            tableData.add("34.3%");
            tableData.add("35.3%");
            tableDataList.add(tableData);
        }
        return tableDataList;
    }

    /**
     * åˆå¹¶pdfæ–‡ä»¶
     *
     * @param files   è¦åˆå¹¶æ–‡ä»¶æ•°ç»„(ç»å¯¹è·¯å¾„å¦‚{ "D:\\test\\1.pdf", "D:\\test\\2.pdf" , "D:\\test\\3.pdf"})
     * @param newFile åˆå¹¶åå­˜æ”¾çš„ç›®å½•D:\\test\\xxf-merge.pdf
     * @return boolean ç”ŸæˆåŠŸè¿”å›true, å¦å‰‡è¿”å›false
     */
    public static boolean mergePdfFiles(String[] files, String newFile) {
        boolean retValue = false;
        Document document;
        try (FileOutputStream fileOutputStream = new FileOutputStream(newFile)) {
            document = new Document(new PdfReader(files[0]).getPageSize(1));
            PdfCopy copy = new PdfCopy(document, fileOutputStream);
            document.open();
            for (String file : files) {
                PdfReader reader = new PdfReader(file);
                int n = reader.getNumberOfPages();
                for (int j = 1; j <= n; j++) {
                    document.newPage();
                    PdfImportedPage page = copy.getImportedPage(reader, j);
                    copy.addPage(page);
                }
            }
            retValue = true;
            document.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return retValue;
    }

    /**
     * è¯»å–PDFï¼Œè¯»å–ååˆ é™¤PDFï¼Œé€‚ç”¨äºç”Ÿæˆåéœ€è¦å¯¼å‡ºPDFï¼Œåˆ›å»ºä¸´æ—¶æ–‡ä»¶
     */
    public static void readDeletePdf(String fileName, ServletOutputStream outputStream) {
        File file = new File(fileName);
        if (!file.exists()) {
            System.out.println(fileName + "æ–‡ä»¶ä¸å­˜åœ¨");
        }
        try (InputStream in = new FileInputStream(fileName)) {
            IOUtils.copy(in, outputStream);
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                Files.delete(file.toPath());
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}

~~~

#### PdfFontUtil.java

~~~java
package com.maple.demo.util;

import com.itextpdf.text.*;
import com.itextpdf.text.pdf.BaseFont;
import com.itextpdf.text.pdf.PdfPTable;

import java.io.IOException;
import java.util.List;

/**
 * @author ç¬‘å°æ«
 * @date 2022/8/15
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
public class PdfFontUtil {

    private PdfFontUtil() {
    }

    /**
     * åŸºç¡€é…ç½®ï¼Œå¯ä»¥æ”¾ç›¸å¯¹è·¯å¾„ï¼Œè¿™é‡Œæ¼”ç¤ºç»å¯¹è·¯å¾„ï¼Œå› ä¸ºå­—ä½“æ–‡ä»¶è¿‡å¤§ï¼Œè¿™é‡Œä¸ä¼ åˆ°é¡¹ç›®é‡Œé¢äº†ï¼Œéœ€è¦çš„è‡ªå·±ä¸‹è½½
     * ä¸‹è½½åœ°å€ï¼šhttps://www.zitijia.com/downloadpage?itemid=281258939050380345
     */
    public static final String FONT = "D:\\font/Simhei.ttf";

    /**
     * åŸºç¡€æ ·å¼
     */
    public static final Font TITLE_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 20, Font.BOLD);
    public static final Font NODE_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 15, Font.BOLD);
    public static final Font BLOCK_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 13, Font.BOLD, BaseColor.BLACK);
    public static final Font INFO_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, 12, Font.NORMAL, BaseColor.BLACK);
    public static final Font CONTENT_FONT = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);


    /**
     * æ®µè½æ ·å¼è·å–
     */
    public static Paragraph getParagraph(String content, Font font, Integer alignment) {
        Paragraph paragraph = new Paragraph(content, font);
        if (alignment != null && alignment >= 0) {
            paragraph.setAlignment(alignment);
        }
        return paragraph;
    }

    /**
     * å›¾ç‰‡æ ·å¼
     */
    public static Image getImage(String imgPath, float width, float height) throws IOException, BadElementException {
        Image image = Image.getInstance(imgPath);
        image.setAlignment(Image.MIDDLE);
        if (width > 0 && height > 0) {
            image.scaleAbsolute(width, height);
        }
        return image;
    }

    /**
     * è¡¨æ ¼ç”Ÿæˆ
     */
    public static PdfPTable getPdfTable(int numColumns, float totalWidth) {
        // è¡¨æ ¼å¤„ç†
        PdfPTable table = new PdfPTable(numColumns);
        // è®¾ç½®è¡¨æ ¼å®½åº¦æ¯”ä¾‹ä¸º%100
        table.setWidthPercentage(100);
        // è®¾ç½®å®½åº¦:å®½åº¦å¹³å‡
        table.setTotalWidth(totalWidth);
        // é”ä½å®½åº¦
        table.setLockedWidth(true);
        // è®¾ç½®è¡¨æ ¼ä¸Šé¢ç©ºç™½å®½åº¦
        table.setSpacingBefore(10f);
        // è®¾ç½®è¡¨æ ¼ä¸‹é¢ç©ºç™½å®½åº¦
        table.setSpacingAfter(10f);
        // è®¾ç½®è¡¨æ ¼é»˜è®¤ä¸ºæ— è¾¹æ¡†
        table.getDefaultCell().setBorder(0);
        table.setPaddingTop(50);
        table.setSplitLate(false);
        return table;
    }

    /**
     * è¡¨æ ¼å†…å®¹å¸¦æ ·å¼
     */
    public static void addTableCell(PdfPTable dataTable, Font font, List<String> cellList) {
        for (String content : cellList) {
            dataTable.addCell(getParagraph(content, font, -1));
        }
    }
}

~~~

#### TestPdfController.java

~~~java
package com.maple.demo.controller;

import com.maple.demo.util.PdfUtil;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

/**
 * @author ç¬‘å°æ«
 * @date 2022/8/15
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
@Slf4j
@RestController
@RequestMapping("/example")
@Api(tags = "å®ä¾‹æ¼”ç¤º-PDFæ“ä½œæ¥å£")
public class TestPdfController {

    @ApiOperation(value = "æ ¹æ®PDFæ¨¡æ¿å¯¼å‡ºPDF")
    @GetMapping("/exportPdf")
    public void exportPdf(HttpServletResponse response) {
        Map<String, Object> dataMap = new HashMap<>(16);
        dataMap.put("nickName", "ç¬‘å°æ«");
        dataMap.put("age", 18);
        dataMap.put("sex", "ç”·");
        dataMap.put("csdnUrl", "https://zhangfz.blog.csdn.net/");
        dataMap.put("siteUrl", "https://www.xiaoxiaofeng.com/");
        dataMap.put("desc", "å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç¬‘å°æ«ã€‚");

        Map<String, String> photoMap = new HashMap<>(16);
        photoMap.put("logo", "https://profile.csdnimg.cn/C/9/4/2_qq_34988304");

        // è®¾ç½®responseå‚æ•°ï¼Œå¯ä»¥æ‰“å¼€ä¸‹è½½é¡µé¢
        response.reset();
        response.setCharacterEncoding("UTF-8");
        // å®šä¹‰è¾“å‡ºç±»å‹
        response.setContentType("application/PDF;charset=utf-8");
        // è®¾ç½®åç§°
        response.setHeader("Content-Disposition", "attachment; filename=" + "xiaoxiaofeng.pdf");
        try {
            ServletOutputStream out = response.getOutputStream();
            // æ¨¡æ¿è·¯å¾„è®°
            PdfUtil.fillTemplate(dataMap, photoMap, out, "src/main/resources/templates/xiaoxiaofeng.pdf");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    @ApiOperation(value = "æµ‹è¯•çº¯ä»£ç ç”ŸæˆPDFåˆ°æŒ‡å®šç›®å½•")
    @GetMapping("/createPdfLocal")
    public void create() {
        PdfUtil.createPdfPage("D:\\test\\xxf.pdf");
    }

    @ApiOperation(value = "æµ‹è¯•åˆå¹¶PDFåˆ°æŒ‡å®šç›®å½•")
    @GetMapping("/mergePdf")
    public Boolean mergePdf() {
        String[] files = {"D:\\test\\1.pdf", "D:\\test\\2.pdf"};
        String newFile = "D:\\test\\xxf-merge.pdf";
        return PdfUtil.mergePdfFiles(files, newFile);
    }

    @ApiOperation(value = "æµ‹è¯•åˆå¹¶PDFåå¹¶å¯¼å‡º")
    @GetMapping("/exportMergePdf")
    public void createPdf(HttpServletResponse response) {
        // è®¾ç½®responseå‚æ•°ï¼Œå¯ä»¥æ‰“å¼€ä¸‹è½½é¡µé¢
        response.reset();
        response.setCharacterEncoding("UTF-8");
        // å®šä¹‰è¾“å‡ºç±»å‹
        response.setContentType("application/PDF;charset=utf-8");
        // è®¾ç½®åç§°
        response.setHeader("Content-Disposition", "attachment; filename=" + "xiaoxiaofeng.pdf");
        try (ServletOutputStream out = response.getOutputStream()) {
            String[] files = {"D:\\test\\1.pdf", "D:\\test\\2.pdf"};
            // ç”Ÿæˆä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œè½¬æ¢ä¸ºæµåï¼Œå†åˆ é™¤è¯¥æ–‡ä»¶
            String newFile = "src\\main\\resources\\templates\\" + UUID.randomUUID() + ".pdf";
            boolean isOk = PdfUtil.mergePdfFiles(files, newFile);
            if (isOk) {
                PdfUtil.readDeletePdf(newFile, out);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

~~~



## å…³äºç¬‘å°æ«ğŸ’•

> æœ¬ç« åˆ°è¿™é‡Œç»“æŸäº†ï¼Œå–œæ¬¢çš„æœ‹å‹å…³æ³¨ä¸€ä¸‹æˆ‘å‘¦ï¼Œå¤§ä¼™çš„æ”¯æŒï¼Œå°±æ˜¯æˆ‘åšæŒå†™ä¸‹å»çš„åŠ¨åŠ›ã€‚
>
> å¾®ä¿¡å…¬ä¼—å·ï¼šç¬‘å°æ«
>
> ç¬‘å°æ«ä¸ªäººåšå®¢ï¼š[https://www.xiaoxiaofeng.com](https://www.xiaoxiaofeng.com)
>
> CSDNï¼š[https://zhangfz.blog.csdn.net](https://zhangfz.blog.csdn.net)
>
> GitHubæ–‡æ¡£ï¼š[https://github.com/hack-feng/Java-Notes](https://github.com/hack-feng/Java-Notes) 
>
> æœ¬æ–‡æºç ï¼š[https://github.com/hack-feng/maple-demo](https://github.com/hack-feng/maple-demo)
