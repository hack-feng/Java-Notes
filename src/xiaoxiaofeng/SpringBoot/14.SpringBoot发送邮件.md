![image-20220722102856334](https://s2.loli.net/2022/07/22/7zZF1XofpKwTcm8.png)

![image-20220722103017127](https://s2.loli.net/2022/07/22/PrUYsKez2A6EBJQ.png)

![image-20220722103304011](https://s2.loli.net/2022/07/22/PwMW5kXIyeU17jQ.png)

![image-20220722103408797](https://s2.loli.net/2022/07/22/3O7FI18lCRfLbpX.png)





### 发送邮件
* pom.xml添加引用
~~~xml
<!-- 配置thymeleaf模板依赖 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>

<!-- 支持发送邮件依赖 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-mail</artifactId>
</dependency>
~~~

* 配置发送邮件的application
~~~yaml
spring
  mail:
    default-encoding: UTF-8
    host: smtp.qq.com
    username: 邮箱地址
    password: 
    port: 22
    protocol: smtp
    properties:
      mail:
        smtp:
          ssl:
            enable: true
          socketFactory:
            port: 465
            class: javax.net.ssl.SSLSocketFactory
~~~

| 邮箱类型   | SMTP服务器地址  | 端口号   |
| ---------- | --------------- | -------- |
| QQ邮箱     | smtp.qq.com     | 465或587 |
| sina邮箱   | smtp.sina.cn    | 465或587 |
| 126邮箱    | smtp.126.com    | 465或994 |
| aliyun邮箱 | smtp.aliyun.com | 465或994 |
| 163邮箱    | smtp.163.com    | 465或994 |
| yeah邮箱   | smtp.yeah.net   | 465或994 |

* 编写发送邮件类

~~~java
package com.maple.demo.config.bean;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.RequiredArgsConstructor;
import org.thymeleaf.context.Context;

import java.util.List;

/**
 * @author 笑小枫
 * @date 2022/7/22
 */
@Data
@Builder
@AllArgsConstructor
@RequiredArgsConstructor
public class EmailBean {
    /**
     * 填充内容
     */
    private Context context;

    /**
     * 使用模板，和text互斥，优先使用模板，模板不存在发送text内容
     */
    private String templateName;

    /**
     * 发送给谁
     */
    private String toUser;

    /**
     * 抄送给谁
     */
    private String[] ccUser;

    /**
     * 邮件主体
     */
    private String subject;

    /**
     * 邮件内容，和templateName互斥，优先使用模板，模板不存在发送text内容
     */
    private String text;

    /**
     * 附件列表
     */
    private List<String> attachmentList;
}
~~~

* 编写邮件的工具类

~~~java
package com.maple.demo.util;

import com.maple.demo.config.bean.EmailBean;
import lombok.RequiredArgsConstructor;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.FileSystemResource;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Service;
import org.thymeleaf.TemplateEngine;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;

/**
 * @author 笑小枫
 * @date 2022/7/22
 */
@Service
@RequiredArgsConstructor
public class EmailUtil {

    private final JavaMailSender mailSender;

    private final TemplateEngine templateEngine;

    @Value("${spring.mail.username}")
    private String from;

    @Async
    public void sendEmail(EmailBean emailBean) {
        try {
            // 解决附件名称过长导致的附件名称乱码问题
            System.setProperty("mail.mime.splitlongparameters", "false");
            // 定义邮件信息
            MimeMessage message = mailSender.createMimeMessage();
            MimeMessageHelper helper;
            helper = new MimeMessageHelper(message, true);
            helper.setFrom(from);
            helper.setTo(emailBean.getToUser());
            helper.setSubject(emailBean.getSubject());
            if (emailBean.getCcUser() != null && emailBean.getCcUser().length > 0) {
                helper.setCc(emailBean.getCcUser());
            }

            // 如果存在模板，定义邮件模板中的内容，context的内容对应email.html的${project}占位的内容
            if (emailBean.getContext() != null && StringUtils.isNotBlank(emailBean.getTemplateName())) {
                String emailContent = templateEngine.process(emailBean.getTemplateName(), emailBean.getContext());
                helper.setText(emailContent, true);
            } else {
                helper.setText(emailBean.getText());
            }

            // 如果存在附件，定义邮件的附件
            if (emailBean.getAttachmentList() != null && !emailBean.getAttachmentList().isEmpty()) {
                for (String attachment : emailBean.getAttachmentList()) {
                    FileSystemResource file = new FileSystemResource(attachment);
                    if (StringUtils.isNotBlank(file.getFilename())) {
                        helper.addAttachment(file.getFilename(), file);
                    }

                }
            }
            mailSender.send(message);
        } catch (MessagingException e) {
            e.printStackTrace();
        }
    }
}

~~~

* 配置发送邮件的模板
在resources目录下创建templates目录。创建email.html模板。
~~~html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>xiaoxiaofeng</title>
    <style>
        body {
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }
        #main {
            text-align: center;
        }
    </style>
</head>
<body>
<div id="main">
    <h3>欢迎使用 <span th:text="${project}"></span></h3>
    您的验证码是：<h2><span th:text="${code}"></span></h2>
    <span>本站由<a href="https://www.xiaoxiaofeng.site" target="_blank">笑小枫(https://www.xiaoxiaofeng.site)</a>提供技术支持</span>
</div>
</body>
</html>
~~~



~~~java
package com.maple.demo.controller;

import com.maple.demo.config.bean.EmailBean;
import com.maple.demo.util.EmailUtil;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import lombok.AllArgsConstructor;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.thymeleaf.context.Context;

import java.util.ArrayList;
import java.util.List;

/**
 * @author 笑小枫
 * @date 2022/7/22
 */
@RestController
@AllArgsConstructor
@RequestMapping("/example")
@Api(tags = "实例演示-发送邮件")
public class TestSendEmailController {

    private final EmailUtil emailUtil;

    @PostMapping("/sendEmailText")
    @ApiOperation(value = "发送纯文本带附件的邮件")
    public void sendEmailText(String text) {
        List<String> attachmentList = new ArrayList<>();
        // 定义绝对路径
        attachmentList.add("D:\\xiaoxiaofeng.jpg");
        // 定义相对路径
        attachmentList.add("src/main/resources/templates/email.html");

        EmailBean emailBean = EmailBean.builder()
                .text(text)
                .subject("欢迎使用笑小枫个人博客")
                .toUser("1150640979@qq.com")
                .attachmentList(attachmentList)
                .build();

        emailUtil.sendEmail(emailBean);
    }

    @PostMapping("/sendEmailTemplate")
    @ApiOperation(value = "根据html模板发送验证码邮件")
    public void sendEmailTemplate() {
        Context context = new Context();
        context.setVariable("project", "笑小枫个人博客");
        // 生成6位数字验证码
        String code = String.valueOf((int) (Math.random() * 900000 + 100000));
        context.setVariable("code", code);
        EmailBean emailBean = EmailBean.builder()
                .context(context)
                .templateName("email")
                .subject("笑小枫发送验证码")
                .toUser("1150640979@qq.com")
                .build();

        emailUtil.sendEmail(emailBean);
    }
}
~~~



![image-20220722155018734](https://s2.loli.net/2022/07/22/wQCSZEJTMma3F92.png)

![image-20220722161355471](https://s2.loli.net/2022/07/22/5Q6zOqHetRvfKAC.png)

![image-20220722154523528](https://s2.loli.net/2022/07/22/2kev4WiCDyYJjbf.png)