## 3. é›†æˆMybatis Plus

### 3.1 é…ç½®åŸºç¡€ä¾èµ–âš™ï¸

ğŸ‘‰é¦–å…ˆï¼Œé¡¹ç›®ä¸­ä¼šä½¿ç”¨åˆ°mysqlã€mybatis-plusã€druidæ•°æ®è¿æ¥æ± ç­‰ç­‰åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€ä¸€è®²è§£ä¸€ä¸‹ã€‚

| ä¾èµ–åç§°                                  | ä¾èµ–æè¿°                                  | ç‰ˆæœ¬    |
| ----------------------------------------- | ----------------------------------------- | ------- |
| mysql-connector-java:mysql-connector-java | mysqlé©±åŠ¨                                 | 8.0.29  |
| com.alibaba:druid                         | é˜¿é‡Œå·´å·´Druidæ•°æ®åº“è¿æ¥æ±                  | 1.2.11  |
| com.baomidou:mybatis-plus-boot-starter    | mybatis-plusçš„ä¾èµ–                        | 3.5.2   |
| com.baomidou:mybatis-plus-generator       | mybatis-plusçš„è‡ªåŠ¨ç”Ÿæˆä»£ç æ’ä»¶            | 3.5.2   |
| org.apache.velocity:velocity-engine-core  | Java çš„æ¨¡æ¿å¼•æ“æ¡†æ¶ï¼Œç”¨äºä»£ç è‡ªåŠ¨ç”Ÿæˆ     | 2.3     |
| org.projectlombok:lombok                  | ä»£ç ç®€åŒ–ï¼Œgetter/setterã€æ„é€ å™¨ç¼–è¯‘æ—¶ç”Ÿæˆ | 1.18.24 |
| com.alibaba:fastjson                      | é˜¿é‡Œå·´å·´Jsonæ“ä½œå·¥å…·ç±»                    | 2.0.7   |

å®Œæ•´çš„pom.xmlæ–‡ä»¶å¦‚ä¸‹ï¼šğŸ‘‡

~~~xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		 xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.3.12.RELEASE</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.maple</groupId>
	<artifactId>maple-demo</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>maple-demo</name>
	<description>Demo project for Spring Boot</description>

	<properties>
		<java-version>1.8</java-version>
		<lombok-version>1.18.24</lombok-version>
		<druid-version>1.2.11</druid-version>
		<mybatis-plus-version>3.5.2</mybatis-plus-version>
		<velocity-version>2.3</velocity-version>
		<fastjson-version>2.0.7</fastjson-version>
		<mysql-connector-version>8.0.29</mysql-connector-version>
	</properties>

	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
			<exclusions>
				<exclusion>
					<groupId>org.junit.vintage</groupId>
					<artifactId>junit-vintage-engine</artifactId>
				</exclusion>
			</exclusions>
		</dependency>

		<!-- å¼•å…¥webç›¸å…³ -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<!--ä½¿ç”¨Mysqlæ•°æ®åº“-->
		<dependency>
			<groupId>mysql</groupId>
			<artifactId>mysql-connector-java</artifactId>
			<version>${mysql-connector-version}</version>
		</dependency>
		<!--ä½¿ç”¨é˜¿é‡Œå·´å·´druidæ•°æ®åº“è¿æ¥æ± -->
		<dependency>
			<groupId>com.alibaba</groupId>
			<artifactId>druid-spring-boot-starter</artifactId>
			<version>${druid-version}</version>
		</dependency>

		<!-- mybatis-plusçš„ä¾èµ– -->
		<dependency>
			<groupId>com.baomidou</groupId>
			<artifactId>mybatis-plus-boot-starter</artifactId>
			<version>${mybatis-plus-version}</version>
		</dependency>
		<!-- mybatis-plusçš„è‡ªåŠ¨ç”Ÿæˆä»£ç æ’ä»¶ -->
		<dependency>
			<groupId>com.baomidou</groupId>
			<artifactId>mybatis-plus-generator</artifactId>
			<version>${mybatis-plus-version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.velocity</groupId>
			<artifactId>velocity-engine-core</artifactId>
			<version>${velocity-version}</version>
		</dependency>

		<!--Lombokç®¡ç†Getter/Setter/logç­‰-->
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<scope>provided</scope>
			<version>${lombok-version}</version>
		</dependency>

		<!-- å¤„ç†JSON -->
		<dependency>
			<groupId>com.alibaba</groupId>
			<artifactId>fastjson</artifactId>
			<version>${fastjson-version}</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
		</plugins>
	</build>
</project>
~~~

### 3.2 å¼•å…¥Mysqlé…ç½®

ğŸ‘‰é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªMysqlæ•°æ®åº“mapleï¼Œå­—ç¬¦é›†é€‰æ‹©utf8ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„å·¥å…·æ˜¯Navicat Premium 11ã€‚å½“ç„¶å…¶ä»–å·¥å…·éƒ½æ˜¯ä¸€æ ·ï¼Œæ²¡æœ‰ç‰¹ä½¿è¦æ±‚ã€‚

![image-20220710141353991](http://file.xiaoxiaofeng.site/blog/image/2022/07/10/20220710141354.png) 

ğŸ‘‰åˆ›å»ºä¸€å¼ usc_userè¡¨ï¼Œå½“ç„¶æœ‰å¾ˆå¤šå­—æ®µæˆ‘ä»¬å¯èƒ½æš‚ä¸”ä¸éœ€è¦ï¼Œæš‚ä¸”ä¿ç•™ï¼Œsqlå¦‚ä¸‹ï¼šğŸ‘‡

~~~mysql
CREATE TABLE `usc_user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `account` varchar(30) DEFAULT NULL COMMENT 'ç”¨æˆ·è´¦å·',
  `user_name` varchar(30) DEFAULT NULL COMMENT 'ç”¨æˆ·å§“å',
  `nick_name` varchar(30) DEFAULT NULL COMMENT 'ç”¨æˆ·æ˜µç§°',
  `user_type` varchar(2) DEFAULT '00' COMMENT 'ç”¨æˆ·ç±»å‹ï¼ˆ00ç³»ç»Ÿç”¨æˆ·,01å°ç¨‹åºç”¨æˆ·ï¼‰',
  `email` varchar(50) DEFAULT '' COMMENT 'ç”¨æˆ·é‚®ç®±',
  `phone` varchar(11) DEFAULT '' COMMENT 'æ‰‹æœºå·ç ',
  `sex` char(1) DEFAULT '0' COMMENT 'ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”· 1å¥³ 2æœªçŸ¥ï¼‰',
  `avatar` varchar(100) DEFAULT '' COMMENT 'å¤´åƒåœ°å€',
  `salt` varchar(32) DEFAULT NULL COMMENT 'ç”¨æˆ·åŠ å¯†ç›å€¼',
  `password` varchar(100) DEFAULT '' COMMENT 'å¯†ç ',
  `status` char(1) DEFAULT '0' COMMENT 'å¸å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  `create_id` bigint(20) DEFAULT NULL COMMENT 'åˆ›å»ºäººid',
  `create_name` varchar(64) DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_id` bigint(20) DEFAULT NULL COMMENT 'æ›´æ–°äººid',
  `update_name` varchar(64) DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `delete_flag` tinyint(1) DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—',
  `remark` varchar(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='ç”¨æˆ·ä¸­å¿ƒ-ç”¨æˆ·ä¿¡æ¯è¡¨';
~~~

ğŸ‘‰åˆ›å»ºå¥½æ•°æ®åº“åï¼Œé…ç½®æˆ‘ä»¬é¡¹ç›®çš„application.ymlæ–‡ä»¶

~~~yml
server:
  port: 6666

spring:
  application:
    name: maple-admin
  # é…ç½®æ•°æ®åº“è¿æ¥
  datasource:
    # æ•°æ®åº“è¿æ¥åœ°å€åŠå¸¸ç”¨é…ç½®
    url: jdbc:mysql://127.0.0.1:3306/maple?useUnicode=yes&characterEncoding=UTF-8&useSSL=false&serverTimezone=UTC
    # æ•°æ®åº“è¿æ¥é©±åŠ¨
    driverClassName: com.mysql.cj.jdbc.Driver
    # æ•°æ®åº“ç”¨æˆ·
    username: root
    # æ•°æ®åº“ç”¨æˆ·å¯†ç 
    password: 123456
    # é…ç½®druidæ•°æ®åº“è¿æ¥æ± ---------------------------------------
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      # åˆå§‹åŒ–å¤§å°ï¼Œæœ€å°ï¼Œæœ€å¤§
      initialSize: 5
      minIdle: 5
      maxActive: 20
      # é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´
      maxWait: 60000
      # é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’
      timeBetweenEvictionRunsMillis: 60000
      # é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’
      minEvictableIdleTimeMillis: 300000
      # æ ¡éªŒSQLï¼ŒOracleé…ç½® spring.datasource.validationQuery=SELECT 1 FROM DUALï¼Œå¦‚æœä¸é…validationQueryé¡¹ï¼Œåˆ™ä¸‹é¢ä¸‰é¡¹é…ç½®æ— ç”¨
      validationQuery: SELECT 'x'
      testWhileIdle: true
      testOnBorrow: false
      testOnReturn: false
      # æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å°
      poolPreparedStatements: true
      maxPoolPreparedStatementPerConnectionSize: 20
      # é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ï¼Œ'wall'ç”¨äºé˜²ç«å¢™
      filters: stat,wall
      # é€šè¿‡connectPropertieså±æ€§æ¥æ‰“å¼€mergeSqlåŠŸèƒ½ï¼›æ…¢SQLè®°å½•
      connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000
      # åˆå¹¶å¤šä¸ªDruidDataSourceçš„ç›‘æ§æ•°æ®
      useGlobalDataSourceStat: true

# é…ç½®mybatis-plusçš„xmlå’Œbeançš„ç›®å½•
mybatis-plus:
  mapper-locations: classpath:mapper/*.xml
  configuration:
    # å¼€å¯é©¼å³°åŠŸèƒ½
    map-underscore-to-camel-case: true
    # æ—¥å¿—æ‰“å°åŠŸèƒ½
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  #é€»è¾‘åˆ é™¤é…ç½®
  global-config:
    db-config:
      # é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)
      logic-delete-value: 1
      # é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)
      logic-not-delete-value: 0
~~~

è‡³æ­¤ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“é…ç½®å·²ç»å®ŒæˆâœŒã€‚æ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®ä¸€ä¸‹Mybatis-plusã€‚

### 3.3 å¼•å…¥MyBatis-Plusé…ç½®

#### é…ç½®MyBatis-Plus

* MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚
* MyBatis-Plusæ˜¯åŸºäºMyBatisæ¡†æ¶è¿›ä¸€æ­¥çš„å°è£…ï¼Œå¢å¼ºäº†MyBatisçš„åŠŸèƒ½ï¼Œåªéœ€ç®€å•é…ç½®ï¼Œå³å¯å¿«é€Ÿè¿›è¡Œå•è¡¨ CRUD æ“ä½œï¼Œä»è€ŒèŠ‚çœå¤§é‡æ—¶é—´ï¼Œä»¥åŠä¸€äº›å¸¸ç”¨å·¥å…·çš„å°è£…ã€‚

* MyBatisä¸­æ–‡æ–‡æ¡£åœ°å€ï¼šhttps://mybatis.org/mybatis-3/zh/index.html
* MyBatis-Pluså®˜æ–¹åœ°å€ï¼šhttps://baomidou.com/

æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·é…ç½®ä¸€ä¸‹MyBatis-Plusï¼š

> è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨Mybatis-plusç”Ÿæˆä»£ç ã€åˆ†é¡µã€é€»è¾‘åˆ é™¤ã€å¸¸ç”¨å­—æ®µè‡ªåŠ¨æ³¨å…¥æ•°æ®ç­‰æ’ä»¶ã€‚

ğŸ‘‰é¦–å…ˆæ˜¯application.yml

~~~yml
# é…ç½®mybatis-plusçš„xmlå’Œbeançš„ç›®å½•
mybatis-plus:
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true    # å¼€å¯é©¼å³°åŠŸèƒ½
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl    # æ—¥å¿—æ‰“å°åŠŸèƒ½
  global-config:  #é€»è¾‘åˆ é™¤é…ç½®
    db-config:
      logic-delete-value: 1 # é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)
      logic-not-delete-value: 0 # é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)
~~~

ç„¶åæˆ‘ä»¬åœ¨com.maple.demoä¸‹åˆ›å»ºconfigç›®å½•å­˜æ”¾æˆ‘ä»¬çš„ç³»ç»Ÿé…ç½®ï¼Œåœ¨configç›®å½•åˆ›å»ºMybatisPlusConfig.javaæ–‡ä»¶

è¿™é‡Œé…ç½®ä¸‹Mybaitsçš„è‡ªåŠ¨å¡«å……æœºåˆ¶å’Œdruidç›‘æ§é¡µé¢

~~~java
package com.maple.demo.config;

import com.alibaba.druid.support.http.StatViewServlet;
import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
import org.apache.ibatis.reflection.MetaObject;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.web.servlet.ServletRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.transaction.annotation.EnableTransactionManagement;

import javax.servlet.Servlet;
import java.util.Date;

/**
 * Mybatis plusé…ç½®
 *
 * @author ç¬‘å°æ«
 * @date 2022/7/10
 */
@EnableTransactionManagement
@Configuration
@MapperScan("com.maple.demo.mapper")
public class MybatisPlusConfig implements MetaObjectHandler {

    /**
     * æ–°å¢æ—¶,è‡ªåŠ¨å¡«å……æ•°æ®
     */
    @Override
    public void insertFill(MetaObject metaObject) {
        this.setFieldValByName("isDeleted", false, metaObject);
        this.setFieldValByName("createId", 1L, metaObject);
        this.setFieldValByName("createName", "å ä½ç¬¦", metaObject);
        this.setFieldValByName("createTime", new Date(), metaObject);
        this.setFieldValByName("updateId", 1L, metaObject);
        this.setFieldValByName("updateName", "å ä½ç¬¦", metaObject);
        this.setFieldValByName("updateTime", new Date(), metaObject);
    }

    /**
     * ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨å¡«å……æ•°æ®
     */
    @Override
    public void updateFill(MetaObject metaObject) {
        this.setFieldValByName("updateId", 1L, metaObject);
        this.setFieldValByName("updateName", "å ä½ç¬¦", metaObject);
        this.setFieldValByName("updateTime", new Date(), metaObject);
    }

    /**
     * é…ç½®druidç›‘æ§æœåŠ¡å™¨
     *
     * @return è¿”å›ç›‘æ§æ³¨å†Œçš„servletå¯¹è±¡
     */
    @Bean
    public ServletRegistrationBean<Servlet> statViewServlet() {
        ServletRegistrationBean<Servlet> servletRegistrationBean = new ServletRegistrationBean<>(new StatViewServlet(), "/druid/*");
        // æ·»åŠ IPç™½åå•ï¼Œå¦‚æœä¸éœ€è¦é»‘åå•ã€ç™½åå•çš„åŠŸèƒ½ï¼Œæ³¨é‡Šæ‰å³å¯
        servletRegistrationBean.addInitParameter("allow", "192.168.25.125,127.0.0.1");
        // æ·»åŠ IPé»‘åå•ï¼Œå½“ç™½åå•å’Œé»‘åå•é‡å¤æ—¶ï¼Œé»‘åå•ä¼˜å…ˆçº§æ›´é«˜
        servletRegistrationBean.addInitParameter("deny", "192.168.25.123");
        // æ·»åŠ æ§åˆ¶å°ç®¡ç†ç”¨æˆ·
        servletRegistrationBean.addInitParameter("loginUsername", "druid");
        servletRegistrationBean.addInitParameter("loginPassword", "123456");
        // æ˜¯å¦èƒ½å¤Ÿé‡ç½®æ•°æ®
        servletRegistrationBean.addInitParameter("resetEnable", "false");
        return servletRegistrationBean;
    }
}
~~~

å…¶ä¸­ï¼ŒcreateIdã€createNameæš‚æ—¶ä½¿ç”¨å ä½ç¬¦ï¼ŒåæœŸç»“åˆç™»å½•åä»JWTé‡Œé¢è·å–ã€‚

#### é…ç½®è‡ªåŠ¨ç”Ÿæˆä»£ç æ’ä»¶

ğŸ‘‰é¦–å…ˆåˆ›å»º`BaseEntity.java`ï¼Œæ‰€æœ‰çš„å®ä½“ç±»éƒ½ç»§æ‰¿è¯¥å¯¹è±¡ï¼Œç”¨äºå­˜æ”¾ç³»ç»Ÿå­—æ®µï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡

```java
package com.maple.demo.config.bean;

import com.baomidou.mybatisplus.annotation.FieldFill;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import java.io.Serializable;
import java.util.Date;

/**
 * @author ç¬‘å°æ«
 * @date 2022/7/11
 */
@Data
public class BaseEntity implements Serializable {

    @TableId(type = IdType.AUTO)
    protected Long id;

    @ApiModelProperty("åˆ›å»ºäººid")
    @TableField(value = "create_id", fill = FieldFill.INSERT)
    private Long createId;

    @ApiModelProperty("åˆ›å»ºäººåç§°")
    @TableField(value = "create_name", fill = FieldFill.INSERT)
    private String createName;

    @ApiModelProperty("åˆ›å»ºæ—¶é—´")
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private Date createTime;

    @ApiModelProperty("æ›´æ–°äººid")
    @TableField(value = "update_id", fill = FieldFill.INSERT_UPDATE)
    private Long updateId;

    @ApiModelProperty("æ›´æ–°äººåç§°")
    @TableField(value = "update_name", fill = FieldFill.INSERT_UPDATE)
    private String updateName;

    @ApiModelProperty("æ›´æ–°æ—¶é—´")
    @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
    private Date updateTime;
}
```



ğŸ‘‰é…ç½®MyBatis-Plusä»£ç ç”Ÿæˆå·¥å…·ï¼Œåœ¨com.maple.demoç›®å½•ä¸‹åˆ›å»ºutilç›®å½•ï¼Œç”¨äºå­˜æ”¾å·¥å…·ç±»ã€‚

ç„¶ååˆ›å»ºGenerator.javaï¼Œä»£ç å¦‚ä¸‹ï¼šğŸ‘‡

~~~java
package com.maple.demo.util;

import com.baomidou.mybatisplus.generator.FastAutoGenerator;
import com.maple.demo.config.bean.BaseEntity;

/**
 * MyBatis-Plusä»£ç ç”Ÿæˆå·¥å…·
 *
 * @author ç¬‘å°æ«
 * @date 2019/4/25
 */
public class Generator {

    public static void main(String[] args) {

        // è®¾ç½®ä½œè€…
        String auth = "ç¬‘å°æ«";
        // è®¾ç½®çˆ¶åŒ…å
        String packageName = "com.maple.demo";
        // è®¾ç½®çˆ¶åŒ…æ¨¡å—å
        String moduleName = "";
        // æŒ‡å®šè¾“å‡ºç›®å½•
        String path = "D:";
        String url = "jdbc:mysql://127.0.0.1:3306/maple?useUnicode=true&useSSL=false&characterEncoding=utf8";
        String username = "root";
        String password = "Zhang123";
        // è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å
        String table = "usc_user";
        // è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€
        String[] tablePrefix = {"usc_", "sys_"};
        generateTest(auth, packageName, path, moduleName, url, username, password, table, tablePrefix);
    }

    private static void generateTest(String auth, String packageName, String path, String moduleName,
                                     String url, String username, String password, String table, String[] tablePrefix) {
        FastAutoGenerator.create(url, username, password)
                .globalConfig(builder -> builder.author(auth)
                        // å¼€å¯ swagger æ¨¡å¼
                        .enableSwagger()
                        .outputDir(path))
                .packageConfig(builder -> builder.parent(packageName)
                                .moduleName(moduleName)
                        // è®¾ç½®mapperXmlç”Ÿæˆè·¯å¾„
                        //.pathInfo(Collections.singletonMap(OutputFile.xml, path))
                )
                .strategyConfig(builder -> builder.addInclude(table)
                        .addTablePrefix(tablePrefix)
                        .entityBuilder().superClass(BaseEntity.class).enableLombok().logicDeleteColumnName("delete_flag")
                        .controllerBuilder().enableRestStyle()
                )
                .execute();
    }
}
~~~

> æ³¨æ„ï¼šé€‚ç”¨ç‰ˆæœ¬ï¼šmybatis-plus-generator 3.5.1 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯¹å†å²ç‰ˆæœ¬ä¸å…¼å®¹ï¼3.5.1 ä»¥ä¸‹çš„è¯·å‚è€ƒ[ä»£ç ç”Ÿæˆå™¨æ—§](https://baomidou.com/pages/d357af/)

* superClass(BaseEntity.class)ï¼šentityä½¿ç”¨çˆ¶ç±»BaseEntity.classï¼Œå‡å°‘idã€åˆ›å»ºäººã€ä¿®æ”¹äººç­‰ç³»ç»Ÿå­—æ®µ
* .enableSwagger()ï¼šæˆ‘ä»¬é…ç½®äº†knife4jï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å¯swaggeræ¨¡å¼ï¼Œè¿™æ ·ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº›swaggerçš„æ³¨è§£
* logicDeleteColumnName("delete_flag")ï¼šå¼€å¯é€»è¾‘åˆ é™¤

* enableLombok()ï¼šé¡¹ç›®ä½¿ç”¨lombokï¼Œå‡å°‘getter/setterä»£ç çš„ç¼–å†™ï¼Œä½¿ç”¨æ’ä»¶ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆ
* controllerBuilder().enableRestStyle()ï¼šcontrollerä½¿ç”¨Restä»£ç é£æ ¼

ğŸ‘‰ç„¶åæˆ‘ä»¬æ‰§è¡Œè¯¥Mainæ–¹æ³•

![image-20220711163747350](http://file.xiaoxiaofeng.site/blog/image/2022/07/11/20220711163747.png)

 ç„¶åä¼šåœ¨é…ç½®çš„ç›®å½•ä¸‹ç”Ÿæˆcomæ–‡ä»¶å¤¹ï¼Œæœ¬æ–‡çš„åœ¨Dï¼šç›˜ä¸‹ã€‚

æˆ‘ä»¬å°†ä»£ç å¤åˆ¶åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæ­¤æ—¶çš„é¡¹ç›®ä»£ç ç»“æ„å¦‚ä¸‹å¦‚ï¼šğŸ‘‡
![image-20220711205818035](http://file.xiaoxiaofeng.site/blog/image/2022/07/11/20220711205824.png)

### 3.3 åŠŸèƒ½æµ‹è¯•ğŸ‘Œ

ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æµ‹è¯•ä¸€ä¸‹å§

åœ¨UserController.javaæ–‡ä»¶ä¸­æ·»åŠ æ–°å¢ç”¨æˆ·å’Œæ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ğŸ‘‡

~~~java
package com.maple.demo.controller;

import com.maple.demo.entity.User;
import com.maple.demo.service.IUserService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import lombok.AllArgsConstructor;
import org.springframework.web.bind.annotation.*;

/**
 * <p>
 * ç”¨æˆ·ä¸­å¿ƒ-ç”¨æˆ·ä¿¡æ¯è¡¨ å‰ç«¯æ§åˆ¶å™¨
 * </p>
 *
 * @author ç¬‘å°æ«
 * @since 2022-07-11
 */
@RestController
@RequestMapping("/user")
@AllArgsConstructor
@Api(tags = "ç”¨æˆ·ä¿¡æ¯ç®¡ç†")
public class UserController {

    private final IUserService userService;

    @ApiOperation(value = "æ’å…¥ç”¨æˆ·ä¿¡æ¯")
    @PostMapping("/insert")
    public User insert(@RequestBody User user){
         userService.save(user);
         return user;
    }

    @ApiOperation(value = "æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯")
    @GetMapping("/selectById")
    public User selectById(Long userId){
        return userService.getById(userId);
    }
}
~~~

è¿™æ˜¯æˆ‘ä»¬åœ¨æ‰“å¼€æˆ‘ä»¬çš„Knife4jï¼Œå¯ä»¥åœ¨Swagger Modelsé‡Œé¢çœ‹åˆ°æˆ‘ä»¬æ·»åŠ çš„Userå¯¹è±¡ğŸ‘‡

![image-20220711214628173](http://file.xiaoxiaofeng.site/blog/image/2022/07/11/20220711214628.png)

åœ¨ç”¨æˆ·ä¿¡æ¯ç®¡ç†é‡Œé¢å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ¥å£ä¿¡æ¯ï¼Œæˆ‘ä»¬å…ˆè°ƒç”¨ä¸€ä¸‹æ’å…¥æ–¹æ³•ã€‚

å‚æ•°æˆ‘ä»¬åªä¿ç•™ç®€å•çš„å‡ ä¸ªï¼Œå¦‚ä¸‹ğŸ‘‡

~~~json
{
  "account": "xiaoxiaofeng",
  "email": "1150640979@qq.com",
  "nickName": "ç¬‘å°æ«",
  "password": "123456",
  "phone": "18300000000",
  "userName": "ç¬‘å°æ«"
}
~~~

è°ƒç”¨ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºğŸ‘‡

![image-20220711214940096](http://file.xiaoxiaofeng.site/blog/image/2022/07/11/20220711214940.png)

å¯ä»¥çœ‹åˆ°æ•°æ®é‡Œé¢ï¼Œæˆ‘ä»¬çš„æ•°æ®å·²ç»æ’å…¥è¿›å»äº†ğŸ‘‡

![image-20220711220037702](http://file.xiaoxiaofeng.site/blog/image/2022/07/11/20220711220038.png)

æ¥ä¸‹æ¥æˆ‘ä»¬è°ƒç”¨æŸ¥è¯¢æ¥å£çœ‹ä¸€ä¸‹ğŸ‘‡

![image-20220711220216123](http://file.xiaoxiaofeng.site/blog/image/2022/07/11/20220711220216.png)

OKï¼Œå¤§åŠŸå‘ŠæˆâœŒï¸

æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­é…ç½®é˜¿é‡Œå·´å·´çš„Druidæ•°æ®åº“è¿æ¥æ± ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„sqlæ‰§è¡Œæƒ…å†µå‘¢ï¼Ÿ

å¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://127.0.0.1:6666/druid

åœ¨SQLç›‘æ§ä¸­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„sqlæ‰§è¡Œæƒ…å†µï¼Œä»¥åŠä¸€äº›æ…¢sqlçš„åˆ†æğŸ‘‡

![image-20220711221854172](http://file.xiaoxiaofeng.site/blog/image/2022/07/11/20220711221854.png)

## å°ç»“

å¥½å•¦ï¼Œæœ¬æ–‡å°±åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ä»¬ç®€å•çš„æ€»ç»“ä¸€ä¸‹ï¼Œä¸»è¦ä»‹ç»äº†ä»¥ä¸‹å†…å®¹ğŸ‘‡ğŸ‘‡

* SpringBooté›†æˆmysqlæ•°æ®åº“
* é›†æˆMybatis Plusæ¡†æ¶
* é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¼”ç¤ºäº†ä¸€ä¸‹ä½¿ç”¨Mybatis Plusè¿›è¡Œæ•°æ®æ’å…¥å’ŒæŸ¥è¯¢
* ä½¿ç”¨Knife4jè¿›è¡Œæ¥å£è°ƒè¯•
* é›†æˆé˜¿é‡Œå·´å·´Druidæ•°æ®è¿æ¥æ± 
* é€šè¿‡Druidé¡µé¢è¿›è¡Œæ‰§è¡ŒsqlæŸ¥è¯¢ã€åˆ†æ

## å…³äºç¬‘å°æ«ğŸ’•

> æœ¬ç« åˆ°è¿™é‡Œç»“æŸäº†ï¼Œå–œæ¬¢çš„æœ‹å‹å…³æ³¨ä¸€ä¸‹æˆ‘å‘¦ï¼Œå¤§ä¼™çš„æ”¯æŒï¼Œå°±æ˜¯æˆ‘åšæŒå†™ä¸‹å»çš„åŠ¨åŠ›ã€‚
> åç»­æ–‡ç« ä¼šé™†ç»­æ›´æ–°ï¼Œæ–‡æ¡£ä¼šåŒæ­¥åœ¨å¾®ä¿¡å…¬ä¼—å·ã€ä¸ªäººåšå®¢ã€CSDNå’ŒGitHubä¿æŒåŒæ­¥æ›´æ–°ã€‚
> å¾®ä¿¡å…¬ä¼—å·ï¼šç¬‘å°æ«
> ç¬‘å°æ«ä¸ªäººåšå®¢ï¼š[https://www.xiaoxiaofeng.com](https://www.xiaoxiaofeng.com)
> CSDNï¼š[https://zhangfz.blog.csdn.net](https://zhangfz.blog.csdn.net)
> GitHubæ–‡æ¡£ï¼š[https://github.com/hack-feng/Java-Notes](https://github.com/hack-feng/Java-Notes) 
