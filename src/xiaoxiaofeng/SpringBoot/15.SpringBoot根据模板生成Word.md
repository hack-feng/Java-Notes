### é€šè¿‡mavenå¼•å…¥éœ€è¦çš„ä¾èµ–

~~~xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-freemarker</artifactId>
</dependency>
~~~

### åˆ›å»ºå¯¼å‡ºæ¨¡ç‰ˆ

#### 1ã€é¦–å…ˆåˆ›å»ºä¸€ä¸ªwordæ¨¡ç‰ˆæ–‡æ¡£ï¼Œæ¨¡ç‰ˆå¦‚ä¸‹å›¾

 ![SpringCloudæ±Ÿæ¹–](D:\zhangfuzeng\code\Java-Notes\src\note\images\exportword\01.jpg)

 wordæ¨¡ç‰ˆåœ°å€ï¼š[ç‚¹å‡»ä¸‹è½½](http://file.xiaoxiaofeng.site/files/word.doc)

 æ³¨æ„wordä¸­çš„å ä½ç¬¦çš„æ ¼å¼ï¼Œå°±æ˜¯freemakerçš„æ ¼å¼

 è¯¦ç»†è§£é‡Šå¦‚ä¸‹ï¼š

 * æ–‡å­—å¤„ç†ï¼š

 ç›´æ¥ç”¨${} ä¸­é—´ä¸ºæ›¿æ¢çš„å­—æ®µåã€‚

 å¦‚æœç›´æ¥åœ¨wordé‡Œé¢å®šä¹‰${title}ï¼Œåœ¨è½¬æ¢æˆxmlçš„æ—¶å€™æœ‰å¯èƒ½ä¼šè¢«ä¸€äº›ç¼–ç éš”å¼€ï¼Œè¿™ä¸ªæ—¶å€™åªéœ€è¦ç”¨wordæ‰“å¼€xmlï¼Œå°†è¿™äº›å†…å®¹é‡æ–°è¾“å…¥ä¸€éã€‚

> å¼ºçƒˆå»ºè®®ç”¨IDEæ‰“å¼€ï¼Œç„¶åæ ¼å¼åŒ–ä¸‹ï¼Œåœ¨è¿›è¡Œæ£€æŸ¥å¤„ç†ï¼Œèƒ½ç”¨æœç´¢å°½é‡æœç´¢ï¼Œxmlçš„æ ¼å¼é‡Œé¢æœ‰å¤ªå¤šçš„ä»£ç ï¼Œä¸è¦ç¡¬åˆšğŸ˜‚

 * å›¾ç‰‡å¤„ç†ï¼š

 éœ€è¦åœ¨wordæ–‡æ¡£æ¨¡ç‰ˆä¸­æ’å…¥å›¾ç‰‡

 å°†wordè½¬æ¢æˆxmlåï¼Œæ‰“å¼€xmlï¼Œä¼šå°†æˆ‘ä»¬çš„å›¾ç‰‡è½¬æ¢æˆé•¿é•¿çš„ä¸€æ®µbase64ã€‚

 æˆ‘ä»¬æŠŠbase64æ¢æˆæˆ‘ä»¬çš„${pic}å°±å¯ä»¥äº†ï¼Œpicä¸ºå­—æ®µåï¼Œå¯ä»»æ„æ›¿æ¢

 * åˆ—è¡¨å¤„ç†ï¼š

 éœ€è¦åœ¨wordæ–‡æ¡£æ¨¡ç‰ˆä¸­æ’å…¥è¡¨æ ¼

 æ‰¾åˆ°ç¬¬äºŒä¸ª`<w:tr>`ï¼Œç¬¬ä¸€è¡Œæ˜¯æˆ‘ä»¬çš„æ ‡é¢˜ï¼Œåœ¨å…¶å‰é¢æ·»åŠ  <#list peopleList as list> å…¶ä¸­ peopleListæ˜¯ä¼ å…¥listçš„é›†åˆåç§° list æ˜¯åˆ«åã€‚

 å‚æ•°å–å€¼ä¸ºï¼š${list.name}è¿™æ ·ã€‚

 åœ¨ä¸`<w:tr>`é…å¯¹çš„</w:tr>åé¢æ·»åŠ </#list>ã€‚ è¯­æ³•åŒfreemakerçš„forå¾ªç¯è¯­æ³•

#### åˆ›å»ºftlæ¨¡æ¿

å°†ä¸Šè¿°wordæ–‡æ¡£å¦å­˜ä¸ºtest.xmlæ ¼å¼ï¼Œå¦å­˜å®Œä¹‹åå¯ä»¥ç”¨æµè§ˆå™¨æ‰“å¼€test.xmlæ–‡ä»¶ï¼ŒæŸ¥çœ‹æˆ‘ä»¬çš„å ä½ç¬¦æ˜¯å¦æ ‡å‡†

![SpringCloudæ±Ÿæ¹–](D:\zhangfuzeng\code\Java-Notes\src\note\images\exportword\03.jpg)

æ³¨æ„ï¼šå ä½ç¬¦æœ‰æ—¶å€™ä¼šå‘ç”Ÿè¢«éš”å¼€çš„æƒ…å†µï¼Œå¦‚ä¸‹å›¾ï¼š

![SpringCloudæ±Ÿæ¹–](https://s2.loli.net/2022/07/27/uvBdSxC7MDeqKrQ.png)

å›¾ç‰‡çš„æ›¿æ¢åŒä¸Šé¢çš„è¯´æ˜ï¼Œå›¾ç‰‡ä¸ºä¸€ä¸²é•¿é•¿çš„base64ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![SpringCloudæ±Ÿæ¹–](D:\zhangfuzeng\code\Java-Notes\src\note\images\exportword\02.jpg)

ç„¶åå°†æ–‡ä»¶æ”¾ç½®resources/templatesç›®å½•ä¸‹ã€‚

æ”¾ç½®åœ¨resourceç›®å½•ä¸‹å³å¯ï¼Œå‰©ä¸‹çš„ç›®å½•æ ¹æ®è‡ªå·±éœ€æ±‚å®šåˆ¶ã€‚æ³¨æ„è¦ä¸WordUtil.javaä¸­çš„ç›®å½•å¯¹åº”ã€‚

### ç¼–å†™ç¨‹åº

#### é€šç”¨çš„å¯¼å‡ºå·¥å…·ç±»

åœ¨utilåŒ…ä¸‹åˆ›å»º`WordUtil.java`å·¥å…·ç±»ï¼ŒğŸ‘‡

~~~java
package com.maple.demo.util;

import freemarker.template.Configuration;
import freemarker.template.Template;
import freemarker.template.TemplateException;

import java.io.*;
import java.nio.charset.StandardCharsets;
import java.util.Map;

import static freemarker.template.Configuration.DEFAULT_INCOMPATIBLE_IMPROVEMENTS;

/**
 * @author ç¬‘å°æ«
 * @date 2022/7/27
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
public class WordUtil {
    private final Configuration configuration;

    public WordUtil() {
        configuration = new Configuration(DEFAULT_INCOMPATIBLE_IMPROVEMENTS);
        configuration.setDefaultEncoding("UTF-8");
    }

    public void createWord(Map<String, Object> dataMap, String templateName, String fileName) {
        // æ¨¡æ¿æ–‡ä»¶æ‰€åœ¨è·¯å¾„
        configuration.setClassForTemplateLoading(this.getClass(), "/templates");
        Template t = null;
        try {
            // è·å–æ¨¡æ¿æ–‡ä»¶
            t = configuration.getTemplate(templateName, "UTF-8");
        } catch (IOException e) {
            e.printStackTrace();
        }
        // å¯¼å‡ºæ–‡ä»¶
        File outFile = new File(fileName);
        try (Writer out = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(outFile), StandardCharsets.UTF_8))) {
            if (t != null) {
                // å°†å¡«å……æ•°æ®å¡«å…¥æ¨¡æ¿æ–‡ä»¶å¹¶è¾“å‡ºåˆ°ç›®æ ‡æ–‡ä»¶
                t.process(dataMap, out);
            }
        } catch (IOException | TemplateException e1) {
            e1.printStackTrace();
        }
    }
}
~~~

#### è¯·æ±‚æ¥å£

åœ¨`controller`åŒ…ä¸‹åˆ›å»º`TestWordController.java`ğŸ‘‡

å…¶ä¸­ç”¨åˆ°äº†ä¹‹å‰æ–‡ç« çš„æ–‡ä»¶è½¬base64ï¼Œå‚è€ƒæ–‡ç« [15.Base64ä¸Fileäº’è½¬]()

~~~java
package com.maple.demo.controller;

import com.maple.demo.util.Base64Util;
import com.maple.demo.util.WordUtil;
import io.swagger.annotations.Api;
import lombok.AllArgsConstructor;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URLEncoder;
import java.util.*;

/**
 * @author ç¬‘å°æ«
 * @date 2022/7/27
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
@RestController
@AllArgsConstructor
@RequestMapping("/example")
@Api(tags = "å®ä¾‹æ¼”ç¤º-æ ¹æ®æ¨¡æ¿ç”Ÿæˆword")
public class TestWordController {
    /**
     * æ–‡å­—å¤„ç†ï¼š
     * ç›´æ¥ç”¨${} ä¸­é—´ä¸ºæ›¿æ¢çš„å­—æ®µåã€‚
     * å¦‚æœç›´æ¥åœ¨wordé‡Œé¢å®šä¹‰${title}ï¼Œåœ¨è½¬æ¢æˆxmlçš„æ—¶å€™æœ‰å¯èƒ½ä¼šè¢«ä¸€äº›ç¼–ç éš”å¼€ï¼Œè¿™ä¸ªæ—¶å€™åªéœ€è¦ç”¨wordæ‰“å¼€xmlï¼Œå°†è¿™äº›å†…å®¹é‡æ–°è¾“å…¥ä¸€éã€‚
     * å¯ä»¥ç”¨æµè§ˆå™¨æ‰“å¼€xmlï¼Œæ£€å‡ºè‡ªå·±å®šä¹‰çš„${}çš„å†…å®¹æ˜¯å¦éƒ½åœ¨ä¸€èµ·ï¼Œæ˜¯å¦æœ‰è¢«ç¼–ç éš”å¼€çš„æƒ…å†µã€‚
     * å›¾ç‰‡å¤„ç†ï¼š
     * éœ€è¦åœ¨wordæ–‡æ¡£æ¨¡ç‰ˆä¸­æ’å…¥å›¾ç‰‡
     * å°†wordè½¬æ¢æˆxmlåï¼Œæ‰“å¼€xmlï¼Œä¼šå°†æˆ‘ä»¬çš„å›¾ç‰‡è½¬æ¢æˆé•¿é•¿çš„ä¸€æ®µbase64ã€‚
     * æˆ‘ä»¬æŠŠbase64æ¢æˆæˆ‘ä»¬çš„${pic}å°±å¯ä»¥äº†ï¼Œpicä¸ºå­—æ®µåï¼Œå¯ä»»æ„æ›¿æ¢
     * åˆ—è¡¨å¤„ç†ï¼š
     * éœ€è¦åœ¨wordæ–‡æ¡£æ¨¡ç‰ˆä¸­æ’å…¥è¡¨æ ¼
     * æ‰¾åˆ°ç¬¬äºŒä¸ª<w:tr>ï¼Œåœ¨å…¶å‰é¢æ·»åŠ  <#list peopleList as list> å…¶ä¸­ peopleListæ˜¯ä¼ å…¥listçš„é›†åˆåç§° list æ˜¯åˆ«åã€‚
     * å‚æ•°å–å€¼ä¸ºï¼š${list.name}è¿™æ ·ã€‚
     * åœ¨ä¸<w:tr>é…å¯¹çš„</w:tr>åé¢æ·»åŠ </#list>ã€‚ è¯­æ³•åŒfreemakerçš„forå¾ªç¯è¯­æ³•
     */
    @GetMapping("/exportWord")
    public void exportWord(HttpServletRequest request, HttpServletResponse response) throws IOException {
        // 1.åˆ›å»ºä¸´æ—¶æ–‡ä»¶å¤¹
        String rootPath = request.getSession().getServletContext().getRealPath("/");
        String fileName = UUID.randomUUID().toString().replace("-", "");

        // å¤„ç†å›¾ç‰‡ä¿¡æ¯ï¼Œå°†å›¾ç‰‡è½¬ä¸ºbase64å­—ç¬¦ä¸²
        File imageFile = new File("D:\\xiaoxiaofeng.jpg");
        String base64 = Base64Util.fileToBase64(imageFile);

        // å¤„ç†è¡¨æ ¼çš„æ•°æ®ä¿¡æ¯
        List<Map<String, Object>> list = new ArrayList<>();
        int size = 5;
        for (int i = 0; i < size; i++) {
            Map<String, Object> map = new HashMap<>(16);
            map.put("nickName", "ç¬‘å°æ«" + i);
            map.put("visitTime", "2022-07-27");
            map.put("isLike", "æ˜¯");
            map.put("isAttention", "æ˜¯");
            list.add(map);
        }

        // åŠ è½½wordä¸­çš„æ•°æ®ä¿¡æ¯
        WordUtil word = new WordUtil();
        Map<String, Object> dataMap = new HashMap<>(16);
        dataMap.put("title", "è®°å¾—å…³æ³¨æˆ‘å“Ÿ");
        dataMap.put("email", "1150640979@qq.com");
        dataMap.put("name", "ç¬‘å°æ«");
        dataMap.put("createDate", "2022-07-27");
        dataMap.put("pic", base64);
        dataMap.put("peopleList", list);
        word.createWord(dataMap, "word.xml", rootPath + "/" + fileName + ".doc");

        String exportName = "æµ‹è¯•word";
        response.setCharacterEncoding("utf-8");
        response.setContentType("application/msword");
        // è®¾ç½®æµè§ˆå™¨ä»¥ä¸‹è½½çš„æ–¹å¼å¤„ç†è¯¥æ–‡ä»¶å
        response.setHeader("Content-Disposition", "attachment;filename=".concat(String.valueOf(URLEncoder.encode(exportName + ".doc", "UTF-8"))));

        File file = new File(rootPath + "/" + fileName + ".doc");
        try (InputStream fin = new FileInputStream(file);
             ServletOutputStream out = response.getOutputStream()) {
            // ç¼“å†²åŒº
            byte[] buffer = new byte[512];
            int bytesToRead;
            // é€šè¿‡å¾ªç¯å°†è¯»å…¥çš„Wordæ–‡ä»¶çš„å†…å®¹è¾“å‡ºåˆ°æµè§ˆå™¨ä¸­
            while ((bytesToRead = fin.read(buffer)) != -1) {
                out.write(buffer, 0, bytesToRead);
            }
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            // åˆ é™¤ä¸´æ—¶æ–‡ä»¶
            file.delete();
        }
    }
}
~~~

### æµ‹è¯•

åœ¨æµè§ˆå™¨è¾“å…¥http://localhost:6666/example/exportWordä¾¿å¯ä»¥çœ‹åˆ°ä½ çš„wordå‡ºæ¥äº†å‘¦ã€‚

å¯¼å‡ºæ•ˆæœå›¾å¦‚ä¸‹ï¼š
![image-20220727170847272](https://s2.loli.net/2022/07/27/O4xunqQdcgi7ofm.png)

## å…³äºç¬‘å°æ«ğŸ’•

> æœ¬ç« åˆ°è¿™é‡Œç»“æŸäº†ï¼Œå–œæ¬¢çš„æœ‹å‹å…³æ³¨ä¸€ä¸‹æˆ‘å‘¦ğŸ˜˜ğŸ˜˜ï¼Œå¤§ä¼™çš„æ”¯æŒï¼Œå°±æ˜¯æˆ‘åšæŒå†™ä¸‹å»çš„åŠ¨åŠ›ã€‚
> è€è§„çŸ©ï¼Œæ‡‚äº†å°±ç‚¹èµæ”¶è—ï¼›ä¸æ‡‚å°±é—®ï¼Œæ—¥å¸¸åœ¨çº¿ï¼Œæˆ‘ä¼šå°±ä¼šå›å¤å“ˆ~ğŸ¤ª
> åç»­æ–‡ç« ä¼šé™†ç»­æ›´æ–°ï¼Œæ–‡æ¡£ä¼šåŒæ­¥åœ¨å¾®ä¿¡å…¬ä¼—å·ã€ä¸ªäººåšå®¢ã€CSDNå’ŒGitHubä¿æŒåŒæ­¥æ›´æ–°ã€‚ğŸ˜¬
> å¾®ä¿¡å…¬ä¼—å·ï¼šç¬‘å°æ«
> ç¬‘å°æ«ä¸ªäººåšå®¢ï¼š[https://www.xiaoxiaofeng.com](https://www.xiaoxiaofeng.com)
> CSDNï¼š[https://zhangfz.blog.csdn.net](https://zhangfz.blog.csdn.net)
> æœ¬æ–‡æºç ï¼š[https://github.com/hack-feng/maple-demo](https://github.com/hack-feng/maple-demo) 

