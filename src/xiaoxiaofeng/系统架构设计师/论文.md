2019年3月，我在山东省某港口参与”现代化绿色港口平台“项目的搭建，该项目主要打造以港口为基础，整合港口航运、货运、港口业务为一体的统一平台。在该项目组中我担任系统架构师的职务，主要负责整体架构设计与系统架构搭建。针对项目需求分析和项目组的架构讨论，决定采用**层次式架构**技术来实现**，分为用户界面视图、业务逻辑层和数据层。用户可以通过浏览器可以直接访问系统，提高了用户使用的易用性，业务逻辑和数据分离，不同的业务模块化管理，是项目更加清晰，具有层次化**。项目开发历时18个月完成，到目前，项目已稳定运行了2年多的时间，大大提高了港口作业能力和用户来港办理业务的便利性。得到了领导、港口员工、用户的一致好评。

随着社会的发展，加强信息化建设是各单位的首要任务。该港口分为多个港区，各个港区又有不同的业务线，例如提供电子口岸信息查询、集装箱运输、件杂货货物运输、干散货货物运输等。货主和货代对货物信息查询、运输极为不便，进港货运车辆需要持有货主或货代公司开具的进港证明，货物进出货单据等等一系列纸质证明。因此，该港口决定打造一端注册、多港可用的统一化平台。提供信息查询、业务办理线上化，让用户在有网的环境下，可以随时随地的查询业务信息；统一管理用户信息，车辆信息，让来港办理业务的用户和车辆提前登记备案，根据车牌号自动识别进出港，根据用户身份证和车牌号自动从系统获取提入货信息；和港内各业务生产系统打通，进行操作交互，打通各生产业务系统数据，实现业务数据统一化，避免“信息孤岛”的出现。

根据项目需求分析，整个项目采用层次式架构，之所以选择层次式架构，因为用户的分散性和浏览器的普遍性，让用户使用浏览器可以直接访问项目是最佳选择，同时针对特殊业务场景和不方便使用浏览器的用户，例如货运司机、现场作业员等，我们配套开发对应的APP系统，因此选择分层架构，可以让模型与视图分离，浏览器视图和APP视图可以公用一套模型，提高模型的复用性，减少了开发的工作量。同时将数据与业务进行隔离，将数据信息保存在Mysql数据库中，并对数据定期备份处理，提高了数据的安全性。针对项目适应度和现有开发人员的技术栈进行评估，最终讨论选择使用Java语言开发，后端使用SpringBoot、Spring框架完成业务处理，使用Mybatis框架完成数据的实例化，使用Mysql数据库储存数据，使用比较流程的前端框架VUE开发页面，给用户更好的体验。

层次式架构搭建主要包含视图层、业务层和数据层，其中视图层主要是向用户展示的界面，同时也是用户交互的界面；业务层主要对业务逻辑进行处理，对数据进行加工；数据层主要进行数据持久化操作，提供数据查询等。使用层次式架构，可以让项目各模块界限更加清晰，各负责各事情。大大提高系统的性能、可修改性、可扩展性、安全性，系统界面设计也更加灵活，提高了用户的易用性。接下来，详细的描述一下项目使用层次式架构搭建的过程。

视图层是用户第一体验，在项目框架选型时，我们参考MVC的设计模式，但抛弃了MVC经典设计模式中传统的Servlet和JSP，采用声明式的前端框架Vue，使前后端项目进行分离，不用的开发群体可以更好的关注自己的工作，更好的对画面进行加载渲染，提高了系统的易用性。考虑到系统面向的不仅有港内业务人员，还有社会上用户，每个人的操作习惯都不同，以及关注的重点不同，界面需要提供良好的可修改性，用户可以根据自己操作风格和侧重信息自定义画面展示元素。当用户发生操作，请求程序接口，获取最新的数据变更，并呈现给用户。同时为了满足不方便使用电脑，只能使用手机的用户为了提供更好的界面体验，开发配套的App程序。APP程序给一些用户提供了很大的便利，例如进港作业的司机师傅，可以使用app在进行港内作业区域导航，现场作业人员可以使用app进行库存盘点，提货/入货登记等。

业务逻辑层专注对系统的逻辑进行处理，系统使用Maven进行管理，开发版本使用Git管理，每一个模块我们创建一个新的SpringBoot模块，使其代码可以隔离，代码逻辑比较清晰。整个项目中涉及到多个不同的用户角色，包括港内管理人员，社会用户群体，各业务线的作业人员等。我们把系统分为多个模块，其中基础模块包括：港内人员模块，社会公司人员模块，消息推送模块，系统信息模块等；因为每个具体的业务线之间业务互不干扰，所以每个业务线拆分一个单独的服务，使其业务处理进行弱耦合，插拔式接入与移除，提高系统的灵活性和可扩展性，其中包括：集装箱业务模块、件杂货业务模块、干散货业务模块等。之所以采用这种模块化的拆分，是因为整个平台在搭建的过程中，会持续的集成港内原有的业务系统，和业务系统进行数据交互，按模块拆分后，整个系统的层次更加清晰，各系统之间的存在界限，业务描述也更加明确。通过统一的用户服务模块，用户在界面注册后，可以申请开通不同港区权限，港区管理员对数据进行审核，使用户统一化。通过对各业务系统的集成，使平台统一化。通过对司机用户信息管理和车辆管理，以用户身份证号和车牌号为统一凭证，打通了业务系统的隔阂，并可通过身份证号和车牌号进出港和提入货，逐步实现无纸化，电子化，不仅使用户进出港更加便利，减少了纸质文件的遗失造假，对保护环境也起到了一定的作用。

在业务逻辑层设计的时候，因为系统中存在大量与业务生产系统交互的操作，单独添加了一层访问层模块，用来给调用用户提供一组统一的交互服务，然后通过路径转发到对应的业务模块。因为是和不同的业务系统进行交互，在设计的过程采用非对称加密对数据进行处理，平台统一生成公钥和密钥，平台统一保管密钥，并把不同的公钥分发给各个业务生产系统，相互调用的过程中，生成摘要信息，保证数据的完整性，并对数据进行加密传输，保证数据的安全性。

数据层我们使用Mybatis对数据进行持久化，使用Mybatis的可以简化sql的编写。使用Mysql数据库对数据进行储存，在数据库设计时，我们遵循第三范式的原则，在遵循数据库设计原则的同时，为了提高数据查询的效率，也做了一些反规范化的操作，例如对常用且不变的数据列进行冗余，减少查询时表的join，针对报表的查询进行重新组表，按照模块进行分库处理。在数据库设计的时候，我们针对不同业务线的特点进行了特殊化的设计，例如电子口岸查询模块，其中只要插入和查询操作，我们对数据库进行读写分离，一个数据库实例只进行写操作，做主备防止发生单机故障，同时部署多个实例进行读操作。

当然，系统还是存在一些问题，比如随着业务数据量的不断增加，统计一些比较久远的数据报表效率比较低，系统相应比较慢，针对这一问题，根据港区报表的统计都是按年或月的习惯，我们使用Mycat对数据库表按年的时间维度进行水平拆分，对一些需要计算的数据，提前计算好后，保存在派生列中，从而提高数据查询的效率，达到”2-5-10原则“，大报表统计的响应时间也控制在了8s以内。因为项目采用了三层架构，并针对业务层做了模块化拆分，因此，在项目部署的时候会有大量服务需要部署、发布。最开始因为运维力量不足，导致发布耗时较长，发现问题后，加强了运维的力量，使用k8s对docker容器编排管理。针对项目部署搭建了cicd自动化运维平台，配置衍生的运维页面，并自动记录每次的操作动作，使系统的运维更加可视化。

最后，经过整个项目组的共同努力，我们按期保质保量的完成了这个项目，采用这个层次化结构体系，完全满足项目需求，整个系统具有很高的易用性，得到了用户的一致好评。系统扩展方便，安全可靠，具有很高的层次化和模块化。系统的成功上线，港区也将会将更多的业务集成到平台中，进一步提高用户的便利性。



