 *  单点登录（Single Sign On），简称 SSO，是指在多系统应用群中登录一个系统，便可在其它所有系统中得到授权而无需再次登录，包括单点登录与单点注销两部分
 *  单点登录涉及 SSO 认证中心与众子系统，子系统与 SSO 认证中心需要通信以交换令牌、校验令牌及发起注销请求，因而子系统必须集成 SSO 的客户端，SSO 认证中心则是 SSO 服务端，整个单点登录过程实质是 SSO **客户端**与**服务端**通信的过程

## 登录 ##

 *  SSO 需要一个独立的认证中心，只有认证中心能接受用户的用户名密码等安全信息，其他系统不提供登录入口，只接受认证中心的间接授权
 *  间接授权通过**令牌**实现，SSO 认证中心验证用户的用户名密码没问题，创建**授权令牌**，在接下来的跳转过程中，**授权令牌**作为参数发送给各个子系统，子系统拿到令牌，即得到了授权，可以借此创建局部会话，局部会话登录方式与单系统的登录方式相同
    
     ![笑小枫-www.xiaoxiaofeng.com](https://image.xiaoxiaofeng.site/spider/2023/4/25/xxf-1682414426602.png) 
    图 1 单点登录过程

 *  用户访问系统 1 的受保护资源，系统 1 发现用户未登录，跳转至 SSO 认证中心，并将**自己的地址**作为参数
 *  SSO 认证中心发现用户未登录，将用户引导至登录页面
 *  用户输入用户名密码提交登录申请
 *  SSO 认证中心校验用户信息，创建用户与 SSO 认证中心之间的会话，称为**全局会话**，同时创建**授权令牌**
 *  SSO 认证中心带着**令牌**跳转会最初的请求地址（系统 1）
 *  系统 1 拿到令牌，去 SSO 认证中心**校验令牌**是否有效
 *  SSO 认证中心校验令牌，返回有效，**注册**系统 1
 *  系统 1 使用该令牌创建与用户的会话，称为**局部会话**，返回受保护资源
 *  用户访问系统 2 的受保护资源
 *  系统 2 发现用户未登录，跳转至 SSO 认证中心，并将自己的地址作为参数
 *  SSO 认证中心发现用户已登录，跳转回系统 2 的地址，并附上令牌
 *  系统 2 拿到令牌，去 SSO 认证中心校验令牌是否有效
 *  SSO 认证中心校验令牌，返回有效，注册系统 2
 *  系统 2 使用该令牌创建与用户的局部会话，返回受保护资源

## 注销 ##

 ![笑小枫-www.xiaoxiaofeng.com](https://image.xiaoxiaofeng.site/spider/2023/4/25/xxf-1682414427861.png) 
图 2 单点注销过程

 *  用户向系统 1 发起注销请求
 *  系统 1 根据用户与系统 1 建立的会话 id 拿到**令牌**，向 SSO 认证中心发起注销请求
 *  SSO 认证中心校验令牌有效，销毁全局会话，同时**取出所有用此令牌注册的系统地址**
 *  SSO 认证中心向所有注册系统发起注销请求
 *  各注册系统接收 SSO 认证中心的注销请求，销毁局部会话
 *  SSO 认证中心引导用户至登录页面

## 实现 ##

### sso-client ###

 *  拦截子系统未登录用户请求，跳转至 sso 认证中心
 *  接收并存储 sso 认证中心发送的令牌
 *  与 sso-server 通信，校验令牌的有效性
 *  建立局部会话
 *  拦截用户注销请求，向 sso 认证中心发送注销请求
 *  接收 sso 认证中心发出的注销请求，销毁局部会话

### sso-server ###

 *  验证用户的登录信息
 *  创建全局会话
 *  创建授权令牌
 *  与 sso-client 通信发送令牌
 *  校验 sso-client 令牌有效性
 *  系统注册
 *  接收 sso-client 注销请求，注销所有会话


[dc6c179fb4e1990e922fb37e0e0b854f.png]: https://static.sitestack.cn/projects/sdky-java-note/dc6c179fb4e1990e922fb37e0e0b854f.png
[aa3b693a0ae7a8972398635d4c1bb105.png]: https://static.sitestack.cn/projects/sdky-java-note/aa3b693a0ae7a8972398635d4c1bb105.png