## æœ¬æ–‡ç®€ä»‹

ç›¸ä¿¡å¤§å®¶åœ¨æ—¥å¸¸å·¥ä½œä¸­éƒ½é‡åˆ°è¿‡åŠ å¯†çš„åœºæ™¯å§ï¼Œåƒç™»å½•å¯†ç åŠ å¯†ä¿å­˜ã€æ— tokenæ¥å£éªŒç­¾ã€æ•°æ®åŠ å¯†ä¼ è¾“ç­‰ç­‰ã€‚

æœ¬æ–‡å°†è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹åŠ å¯†çš„æ–¹å¼ï¼Œå¹¶åˆ†æä½¿ç”¨åœºæ™¯ï¼Œå¹¶ä¼šä»¥è¯¦ç»†çš„ä»£ç å®Œæ•´çš„ä»‹ç»å¦‚ä½•ä½¿ç”¨åŠ å¯†ï¼Œè®©å°ä¼™ä¼´ä»¬é‡åˆ°åŠ å¯†æ—¶ï¼Œæœ‰æ›´å¥½çš„é€‰æ‹©ã€‚

![img](https://image.xiaoxiaofeng.site/blog/2023/06/13/xxf-20230613093240.jpeg?xxfjava)

## åŠ å¯†æ–¹å¼æœ‰å“ªäº›ï¼ŸğŸ§

![img](https://image.xiaoxiaofeng.site/blog/2023/06/13/xxf-20230613093706.jpeg?xxfjava)

### åŒå‘åŠ å¯†

åŒå‘åŠ å¯†æ˜¯å¯é€†çš„ï¼Œå¤šç”¨äºæ•°æ®ä¼ è¾“ï¼Œä¸»è¦åˆ†ä¸º`å¯¹ç§°ç§˜é’¥åŠ å¯†`ã€`éå¯¹ç§°ç§˜é’¥åŠ å¯†`

1. å¯¹ç§°ç§˜é’¥åŠ å¯†

   å¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œå°±æ˜¯é‡‡ç”¨è¿™ç§åŠ å¯†æ–¹æ³•çš„åŒæ–¹ä½¿ç”¨æ–¹å¼ç”¨åŒæ ·çš„å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚å¯†é’¥æ˜¯æ§åˆ¶åŠ å¯†åŠè§£å¯†è¿‡ç¨‹çš„æŒ‡ä»¤ã€‚

   å¸¸ç”¨çš„å¯¹ç§°åŠ å¯†æœ‰ï¼šDESã€IDEAã€RC2ã€RC4ã€SKIPJACKã€RC5ã€AESç®—æ³•ç­‰

2. éå¯¹ç§°ç§˜é’¥åŠ å¯†

   ä¸å¯¹ç§°åŠ å¯†ç®—æ³•ä¸åŒï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼šå…¬å¼€å¯†é’¥ï¼ˆpublickeyï¼‰å’Œç§æœ‰å¯†é’¥ ï¼ˆprivatekeyï¼‰ã€‚å…¬å¼€å¯†é’¥ä¸ç§æœ‰å¯†é’¥æ˜¯ä¸€å¯¹ï¼Œå¦‚æœç”¨å…¬å¼€å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œåªæœ‰ç”¨å¯¹åº”çš„ç§æœ‰å¯†é’¥æ‰èƒ½è§£å¯†ï¼›å¦‚æœç”¨ç§æœ‰å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç”¨å¯¹åº”çš„å…¬å¼€å¯†é’¥æ‰èƒ½è§£å¯†ã€‚å› ä¸ºåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯†é’¥ï¼Œæ‰€ä»¥è¿™ç§ç®—æ³•å«ä½œéå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚

   å¸¸è§çš„éå¯¹ç§°åŠ å¯†æœ‰ï¼šRSAã€DSAç®—æ³•ç­‰


### å•å‘åŠ å¯†

å•å‘åŠ å¯†æ˜¯ä¸å¯é€†çš„ï¼Œä¸»è¦ç”¨ä½œå¯†ç ä¿å­˜ï¼Œæ•°æ®éªŒç­¾ç­‰ï¼Œæˆ‘ä»¬æ— éœ€çŸ¥é“åŠ å¯†å‰çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Ÿåªè¦æˆ‘ä»¬ç”¨ç›®æ ‡æ•°æ®åŠ å¯†åå’Œå¯†æ–‡æ¯”è¾ƒæ˜¯å¦ä¸€è‡´ã€‚

å¸¸è§çš„å•å‘åŠ å¯†æœ‰ï¼šMD5ã€SHAç®—æ³•

æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¸¸è§çš„éœ€è¦åŠ å¯†å¤„ç†åœºæ™¯ä¸‹ï¼Œå¦‚ä½•é€‰æ‹©åŠ å¯†æ–¹å¼ï¼Œä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä»‹ç»ï¼š

* æ•°æ®åŠ å¯†å‚¨å­˜ï¼ˆMD5+ç›å€¼ï¼›ä¸å¯é€†ï¼Œæ°¸ä¹…æœ‰æ•ˆï¼‰
* æ¥å£éªŒç­¾ï¼ˆSHA+ç›å€¼ï¼›ä¸å¯é€†ï¼Œæœ‰æ—¶æ•ˆæ€§ï¼‰
* æ•°æ®åŠ å¯†ä¼ è¾“ï¼ˆRSAï¼›æ•°æ®å¯é€†ï¼Œå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼‰

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹å„ç§åŠ å¯†çš„ä½¿ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼ï¼›

æœ¬æ–‡æ¶‰åŠåˆ°çš„æœºå¯†ä¸»è¦ç”¨`org.springframework.util.DigestUtils`ç±»ä¸‹çš„æ–¹æ³•ã€‚

## æ•°æ®åŠ å¯†å‚¨å­˜

è¯´åˆ°æ•°æ®åŠ å¯†ï¼Œæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯MD5äº†å§ã€‚

~~~java
    /**
     * MD5åŠ å¯†å¤„ç†
     *
     * @param password å¯†ç æ˜æ–‡
     * @return åŠ å¯†åå¯†æ–‡
     */
    public static String md5(String password) {
        return DigestUtils.md5DigestAsHex(password.getBytes());
    }
~~~

`123456`åŠ å¯†åçš„å¯†ç ä¸ºï¼š`e10adc3949ba59abbe56e057f20f883e`

æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„æ ·å­ï¼Œä¹‹å‰æ¥è§¦è¿‡ä¸€ä¸ªå°é¡¹ç›®ï¼Œæ”¾å®Œæœ›å»ï¼Œæ•°æ®åº“å¯†å¯†éº»éº»çš„å…¨æ˜¯è¿™ä¸ªå€¼ğŸ˜‚

![img](https://image.xiaoxiaofeng.site/blog/2023/06/13/xxf-20230613093258.png?xxfjava)

åŒä¸€ä¸ªå¯†ç åŠ å¯†åï¼ŒåŠ å¯†åçš„ç»“æœä¹Ÿä¸€è‡´ï¼Œè¿™æ ·å­˜å‚¨æ•°æ®å²‚ä¸æ˜¯ä¹Ÿä¸å®‰å…¨ï¼Œæ˜¾ç„¶åªæ˜¯å•çº¯çš„MD5åŠ å¯†å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚é‚£æˆ‘ä»¬æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥å°è¯•æ·»åŠ ä¸€ä¸ªç›å€¼ï¼Œç„¶åå†å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæ¯ä¸ªç”¨æˆ·éšæœºç”Ÿæˆä¸€ä¸ªç›å€¼ï¼Œç„¶åæ ¹æ®`æ•°æ®+ç›`çš„å½¢å¼åŠ å¯†ï¼Œç„¶ååŠ å¯†åçš„æ•°æ®å’Œç›å€¼éƒ½è½åº“ï¼Œè¿™æ ·å°±è§£å†³äº†åŒä¸€ä¸ªå¯†ç åŠ å¯†åçš„ç»“æœä¹Ÿä¸ä¸€æ ·äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ€ä¹ˆå®ç°ï¼Œä¸‹é¢æä¾›äº†ä¸€ä¸ªå®ç°å·¥å…·ç±»ï¼Œä¾›å¤§å®¶å‚è€ƒğŸ‘‡

~~~java
package com.maple.demo.util.common;

import com.maple.demo.config.bean.ErrorCode;
import com.maple.demo.config.exception.MapleCommonException;
import lombok.extern.slf4j.Slf4j;
import org.springframework.util.DigestUtils;
import org.springframework.util.StringUtils;


/**
 * MD5æ’’ç›åŠ å¯† åŠMD5åŠ å¯†
 *
 * @author ç¬‘å°æ«
 * @date 2022/7/20
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
@Slf4j
public class Md5Util {

    private Md5Util() {

    }

    public static void main(String[] args) {
        String password = "123456";
        log.info("æ™®é€šMD5åŠ å¯†ï¼š" + md5(password));
        String salt = "xxx";
        String cipherText = encrypt(password, salt);
        log.info("MD5åŠ ç›åŠ å¯†åçš„å¯†æ–‡ï¼š" + cipherText);
        boolean isOk = verifyPassword(password, cipherText, salt);
        log.info("æ ¡éªŒå¯†ç ç»“æœï¼š" + isOk);
    }

    /**
     * MD5åŠ å¯†å¤„ç†
     *
     * @param password å¯†ç æ˜æ–‡
     * @return åŠ å¯†åå¯†æ–‡
     */
    public static String md5(String password) {
        return DigestUtils.md5DigestAsHex(password.getBytes());
    }

    /**
     * å¯†ç åŠ å¯†å¤„ç†
     *
     * @param password å¯†ç æ˜æ–‡
     * @param salt     ç›
     * @return åŠ å¯†åå¯†æ–‡
     */
    public static String encrypt(String password, String salt) {
        if (StringUtils.isEmpty(password) || StringUtils.isEmpty(salt)) {
            log.error("å¯†ç åŠ å¯†å¤±è´¥åŸå› ï¼š password and salt cannot be empty");
            throw new MapleCommonException(ErrorCode.PARAM_ERROR);
        }
        return DigestUtils.md5DigestAsHex((salt + password).getBytes());
    }

    /**
     * æ ¡éªŒå¯†ç 
     *
     * @param target å¾…æ ¡éªŒå¯†ç 
     * @param source åŸå¯†ç 
     * @param salt   åŠ å¯†åŸå¯†ç çš„ç›
     */
    public static boolean verifyPassword(String target, String source, String salt) {
        if (StringUtils.isEmpty(target) || StringUtils.isEmpty(source) || StringUtils.isEmpty(salt)) {
            log.info("æ ¡éªŒå¯†ç å¤±è´¥ï¼ŒåŸå›  target ={}ï¼Œ source ={}ï¼Œ salt ={}", target, source, salt);
            return false;
        }
        String targetEncryptPwd = encrypt(target, salt);
        return targetEncryptPwd.equals(source);
    }
}

~~~

è¿™åªæ˜¯ä¸€ç§ç®€å•çš„åˆ©ç”¨MD5çš„å®ç°æ–¹å¼ï¼Œè¿˜æœ‰å¾ˆå¤šå®ç°æ–¹å¼ï¼Œåƒä½¿ç”¨SHAæˆ–è€…è‡ªå·±å†™åŠ å¯†ç®—æ³•ç­‰ç­‰ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä½¿ç”¨SHAæ–¹å¼åŠ å¯†ã€‚

## æ¥å£éªŒç­¾

æ¥å£éªŒç­¾ä¸»è¦ç”¨äºå’Œç¬¬ä¸‰æ–¹æ¥å£äº¤äº’çš„æ—¶å€™ï¼Œä½¿ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œå…¶å®å°±æ˜¯ç”¨ä¸å¯é€†åŠ å¯†çš„å½¢å¼åŠ äº†ä¸€ä¸ªæ—¶é—´çš„æœ‰æ•ˆæœŸã€‚è¿™é‡Œç”¨SHAè·Ÿå¤§å®¶æ¼”ç¤ºä¸€ä¸‹ï¼Œå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥ç”¨ä¸Šæ–‡çš„MD5çš„å½¢å¼ã€‚

æ•°æ®ä¼ è¾“æ ¼å¼å¦‚ä¸‹ï¼š

 * ç­¾åå¤„ç†å·¥å…·ç±»

 * æ ¼å¼sign_yyyyMMddHHmmss

 * signï¼šåŠ å¯†åçš„æ•°æ®

 * _ï¼šç”¨äºåŒºåˆ†æ•°æ®ï¼Œæ–¹ä¾¿åç«¯åˆ†å‰²å¤„ç†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå‚æ•°ä¼ è¾“

 * yyyyMMddHHmmssï¼šå½“å‰æ—¶é—´ï¼Œç”¨äºéªŒè¯ç­¾åæœ‰æ•ˆæ—¶é—´

 * <p>

 * å…¶ä¸­sign=SHA256(data&yyyyMMddHHmmss&salt)

 * dataï¼šå»ºè®®æ”¾å”¯ä¸€çš„ä¸šåŠ¡æ•°æ®

 * yyyyMMddHHmmssï¼šå’Œä¸Šæ–‡çš„æ—¶é—´è¦ä¸€è‡´

 * saltï¼šç›å€¼ï¼Œå¯éšæœºç”Ÿäº§ï¼Œå¦¥å–„ä¿ç®¡

å·¥å…·ç±»ä¸­ç”¨åˆ°äº†è‡ªå·±å°è£…çš„æ—¶é—´å¤„ç†å·¥å…·ç±»ï¼Œè¯¦æƒ…è§[https://www.xiaoxiaofeng.com/archives/javadate](https://www.xiaoxiaofeng.com/archives/javadate)

è‡ªå®šä¹‰å¼‚å¸¸å¯ä»¥è‡ªå·±æ›¿æ¢æˆRuntimeExceptionï¼Œæˆ–è€…è§[https://www.xiaoxiaofeng.com/archives/springboot05](https://www.xiaoxiaofeng.com/archives/springboot05)ä¸­è‡ªå®šä¹‰å¼‚å¸¸éƒ¨åˆ†

~~~java
package com.maple.demo.util.common;

import com.maple.demo.config.bean.ErrorCode;
import com.maple.demo.config.exception.MapleCheckException;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.codec.digest.DigestUtils;
import org.apache.commons.lang3.StringUtils;

import java.util.Date;

/**
 * ç­¾åå¤„ç†å·¥å…·ç±»
 * æ ¼å¼sign_yyyyMMddHHmmss
 * signï¼šåŠ å¯†åçš„æ•°æ®
 * _ï¼šç”¨äºåŒºåˆ†æ•°æ®ï¼Œæ–¹ä¾¿åç«¯åˆ†å‰²å¤„ç†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå‚æ•°ä¼ è¾“
 * yyyyMMddHHmmssï¼šå½“å‰æ—¶é—´ï¼Œç”¨äºéªŒè¯ç­¾åæœ‰æ•ˆæ—¶é—´
 * <p>
 * å…¶ä¸­sign=SHA256(data&yyyyMMddHHmmss&salt)
 * dataï¼šå»ºè®®æ”¾å”¯ä¸€çš„ä¸šåŠ¡æ•°æ®
 * yyyyMMddHHmmssï¼šå’Œä¸Šæ–‡çš„æ—¶é—´è¦ä¸€è‡´
 * saltï¼šç›å€¼ï¼Œå¯éšæœºç”Ÿäº§ï¼Œå¦¥å–„ä¿ç®¡
 *
 * @author ç¬‘å°æ«
 * @date 2022/7/20
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
@Slf4j
public class SignUtil {

    private SignUtil() {
    }

    public static void main(String[] args) {
        String data = "XXF001";
        String date = DateUtil.dateToStr(new Date(), DateUtil.YYYYMMDDHHMMSS);
        String salt = "d84d9e1fe49d427da66fd78724dcfc29";
        String ciphertext = DigestUtils.sha256Hex(data + "&" + date + "&" + salt);
        log.info("åŠ å¯†åçš„å¯†æ–‡ï¼š" + ciphertext);
        checkCangoSign(data, ciphertext + "_" + date, salt, 300L);
    }

    /**
     * ç¿è°·ç­¾åéªŒè¯
     * æ ¼å¼sign_yyyyMMddHHmmss
     * å…¶ä¸­sign=sha256Hex(unionId&yyyyMMddHHmmss&salt)
     *
     * @param businessData ä¸šåŠ¡æ•°æ®
     * @param sign         ç­¾åä¿¡æ¯
     * @param salt         åŠ å¯†ç›å€¼
     * @param expireSecond æœ‰æ•ˆæœŸ(ç§’)
     */
    public static void checkCangoSign(String businessData, String sign, String salt, Long expireSecond) {
        if (StringUtils.isBlank(businessData) || StringUtils.isBlank(sign)) {
            log.error(String.format("éªŒç­¾å¤±è´¥ï¼ŒbusinessDataæˆ–signä¸ºç©ºï¼ŒbusinessDataï¼š%sï¼›signï¼š%s", businessData, sign));
            throw new MapleCheckException(ErrorCode.COMMON_ERROR, "å‚æ•°æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•");
        }
        String[] signArray = sign.split("_");
        // ç­¾åæ‹†åˆ†åä¸ºä¸¤éƒ¨åˆ†
        int singNum = 2;

        Date reqDate = DateUtil.strToDate(signArray[1], DateUtil.YYYYMMDDHHMMSS);
        Date nowDate = new Date();

        if (reqDate == null || (signArray.length != singNum || secondBetween(reqDate, nowDate) > expireSecond)) {
            log.error(String.format("éªŒç­¾å¤±è´¥ï¼Œsignæ— æ•ˆï¼ŒbusinessDataï¼š%sï¼›signï¼š%s", businessData, sign));
            throw new MapleCheckException(ErrorCode.COMMON_ERROR, "signæ— æ•ˆ");
        }

        if (secondBetween(nowDate, reqDate) > expireSecond) {
            log.error(String.format("éªŒç­¾å¤±è´¥ï¼Œsignå·²è¿‡æœŸï¼ŒbusinessDataï¼š%sï¼›signï¼š%s", businessData, sign));
            throw new MapleCheckException(ErrorCode.COMMON_ERROR, "signå·²è¿‡æœŸï¼Œè¯·é‡è¯•");
        }
        String checkDataSha256 = DigestUtils.sha256Hex(businessData + "&" + signArray[1] + "&" + salt);
        if (!signArray[0].equalsIgnoreCase(checkDataSha256)) {
            log.error(String.format("éªŒç­¾å¤±è´¥ï¼Œç­¾åéªŒè¯å¤±è´¥ï¼ŒbusinessDataï¼š%sï¼›signï¼š%s", businessData, sign));
            throw new MapleCheckException(ErrorCode.COMMON_ERROR, "ç­¾åéªŒè¯å¤±è´¥");
        }
    }

    /**
     * è·å–ä¸¤ä¸ªæ—¶é—´ä¹‹é—´ç›¸å·®çš„ç§’æ•°
     *
     * @param startDate å¼€å§‹æ—¶é—´
     * @param endDate   ç»“æŸæ—¶é—´
     * @return ç›¸å·®çš„æ—¶é—´ï¼ˆç§’ï¼‰
     */
    private static long secondBetween(Date startDate, Date endDate) {
        return (startDate.getTime() - endDate.getTime()) / 1000;
    }
}

~~~

## æ•°æ®åŠ å¯†ä¼ è¾“

ä»€ä¹ˆæ—¶å€™éœ€è¦æ•°æ®åŠ å¯†ä¼ è¾“å‘¢ï¼Œæ¯”å¦‚Aç³»ç»Ÿæœ‰ä¸€æ‰¹æ•°æ®è¦ç»™Bç³»ç»Ÿï¼ŒAç³»ç»Ÿå’ŒBç³»ç»Ÿä¸­æ²¡æœ‰ä»»ä½•çš„é™åˆ¶ï¼Œè°éƒ½å¯ä»¥è°ƒç”¨ï¼Œè¿™ç§åœºæ™¯å°±éœ€è¦å¯¹æ¥å£è¿›è¡ŒéªŒç­¾æ“ä½œï¼Œå¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡Œæ•°æ®åŠ å¯†ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨ã€‚

è¿™ä¸ªæ—¶å€™æ•°æ®åŠ å¯†å°±ä¸èƒ½ä½¿ç”¨å•å‘åŠ å¯†äº†ï¼Œå› ä¸ºBç³»ç»Ÿæ‹¿åˆ°æ•°æ®åè¦è¿›è¡Œæ•°æ®è§£å¯†ï¼Œæ‰€ä»¥è¦ç”¨åŒå‘åŠ å¯†ï¼Œè¿™é‡Œæ¼”ç¤ºä¸€ä¸‹éå¯¹ç§°çš„åŒå‘åŠ å¯†RSAã€‚

é€šè¿‡ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œæ ¹æ®å¯†é’¥è¿›è¡Œæ•°æ®åŠ å¯†ï¼Œä¸€èˆ¬å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œåƒä¸Šæ–‡çš„ä¾‹å­ï¼ŒAç³»ç»Ÿåº”è¯¥æŒæœ‰å…¬é’¥åŠ å¯†ï¼ŒBç³»ç»ŸæŒæœ‰ç§é’¥è§£å¯†ã€‚

![img](https://image.xiaoxiaofeng.site/blog/2023/06/13/xxf-20230613093135.png?xxfjava)

è¯¦ç»†å®ç°è§ä»£ç ğŸ‘‡

~~~java
package com.maple.demo.util.common;

import com.alibaba.fastjson.JSON;
import com.maple.demo.config.bean.ErrorCode;
import com.maple.demo.config.exception.MapleCommonException;
import lombok.extern.slf4j.Slf4j;
import org.springframework.util.Base64Utils;

import javax.crypto.Cipher;
import java.nio.charset.StandardCharsets;
import java.security.*;
import java.security.interfaces.RSAPrivateKey;
import java.security.interfaces.RSAPublicKey;
import java.security.spec.InvalidKeySpecException;
import java.security.spec.PKCS8EncodedKeySpec;
import java.security.spec.X509EncodedKeySpec;
import java.util.HashMap;
import java.util.Map;

/**
 * RSAåŠ è§£å¯†å¤„ç†å·¥å…·ç±»
 *
 * @author ç¬‘å°æ«
 * @date 2022/7/20
 * @see <a href="https://www.xiaoxiaofeng.com">https://www.xiaoxiaofeng.com</a>
 */
@Slf4j
public class RsaUtil {

    /**
     * æŒ‡å®šåŠ å¯†ç®—æ³•RSAéå¯¹ç§°åŠ å¯†
     */
    private static final String RSA = "RSA";

    /**
     * æŒ‡å®šRSAéå¯¹ç§°ç®—æ³•/ECBæ¨¡å¼/å¡«å……æ–¹å¼
     * é»˜è®¤å¡«å……æ–¹å¼ï¼šRSA/ECB/PKCS1Padding
     */
    private static final String RSA_CIPHER = "RSA/ECB/OAEPWITHSHA-256ANDMGF1PADDING";

    public static void main(String[] args) {
        Map<String, String> keys = createKeys();
        log.info("å¯†é’¥å¯¹ï¼š" + JSON.toJSONString(keys));
        try {
            String ciphertext = publicEncrypt("123abcABC", keys.get("publicKey"));
            log.info("åŠ å¯†åçš„æ•°æ®ï¼š" + ciphertext);
            String original = privateDecrypt(ciphertext, keys.get("privateKey"));
            log.info("è§£å¯†åçš„åŸæ–‡ï¼š" + original);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }


    private static Map<String, String> createKeys() {
        //ä¸ºRSAç®—æ³•åˆ›å»ºä¸€ä¸ªKeyPairGeneratorå¯¹è±¡ï¼ˆKeyPairGeneratorï¼Œå¯†é’¥å¯¹ç”Ÿæˆå™¨ï¼Œç”¨äºç”Ÿæˆå…¬é’¥å’Œç§é’¥å¯¹ï¼‰
        KeyPairGenerator kpg;
        try {
            kpg = KeyPairGenerator.getInstance(RSA);
        } catch (NoSuchAlgorithmException e) {
            log.error("è·å–å…¬é’¥ç§é’¥å‘ç”Ÿé”™è¯¯", e);
            throw new IllegalArgumentException("No such algorithm-->[" + RSA + "]");
        }

        //åˆå§‹åŒ–KeyPairGeneratorå¯¹è±¡,å¯†é’¥é•¿åº¦
        kpg.initialize(2048);
        //ç”Ÿæˆå¯†åŒ™å¯¹
        KeyPair keyPair = kpg.generateKeyPair();
        //å¾—åˆ°å…¬é’¥
        Key publicKey = keyPair.getPublic();
        //è¿”å›ä¸€ä¸ªpublicKeyç»è¿‡äºŒæ¬¡åŠ å¯†åçš„å­—ç¬¦ä¸²
        String publicKeyStr = Base64Utils.encodeToString(publicKey.getEncoded());
        //å¾—åˆ°ç§é’¥
        Key privateKey = keyPair.getPrivate();
        //è¿”å›ä¸€ä¸ªprivateKeyç»è¿‡äºŒæ¬¡åŠ å¯†åçš„å­—ç¬¦ä¸²
        String privateKeyStr = Base64Utils.encodeToString(privateKey.getEncoded());

        Map<String, String> keyPairMap = new HashMap<>(16);
        keyPairMap.put("publicKey", publicKeyStr);
        keyPairMap.put("privateKey", privateKeyStr);
        return keyPairMap;
    }

    /**
     * å¾—åˆ°å…¬é’¥
     *
     * @param publicKey å¯†é’¥å­—ç¬¦ä¸²ï¼ˆç»è¿‡base64ç¼–ç ï¼‰
     */
    private static RSAPublicKey getPublicKey(String publicKey) throws NoSuchAlgorithmException, InvalidKeySpecException {
        //é€šè¿‡X509ç¼–ç çš„KeyæŒ‡ä»¤è·å¾—å…¬é’¥å¯¹è±¡
        KeyFactory keyFactory = KeyFactory.getInstance(RSA);
        X509EncodedKeySpec x509KeySpec = new X509EncodedKeySpec(Base64Utils.decodeFromString(publicKey));
        return (RSAPublicKey) keyFactory.generatePublic(x509KeySpec);
    }

    /**
     * å¾—åˆ°ç§é’¥
     *
     * @param privateKey å¯†é’¥å­—ç¬¦ä¸²ï¼ˆç»è¿‡base64ç¼–ç ï¼‰
     */
    private static RSAPrivateKey getPrivateKey(String privateKey) throws NoSuchAlgorithmException, InvalidKeySpecException {
        //é€šè¿‡PKCS#8ç¼–ç çš„KeyæŒ‡ä»¤è·å¾—ç§é’¥å¯¹è±¡
        KeyFactory keyFactory = KeyFactory.getInstance(RSA);
        PKCS8EncodedKeySpec pkcs8KeySpec = new PKCS8EncodedKeySpec(Base64Utils.decodeFromString(privateKey));
        return (RSAPrivateKey) keyFactory.generatePrivate(pkcs8KeySpec);
    }

    /**
     * å…¬é’¥åŠ å¯†
     */
    public static String publicEncrypt(String data, String publicKey) {
        try {
            byte[] dataByte = data.getBytes(StandardCharsets.UTF_8);
            Cipher cipher = Cipher.getInstance(RSA_CIPHER);
            cipher.init(Cipher.ENCRYPT_MODE, getPublicKey(publicKey));
            return Base64Utils.encodeToString(cipher.doFinal(dataByte));
        } catch (Exception e) {
            log.error("åŠ å¯†å­—ç¬¦ä¸²é‡åˆ°å¼‚å¸¸", e);
            throw new MapleCommonException(ErrorCode.COMMON_ERROR, "åŠ å¯†å­—ç¬¦ä¸²é‡åˆ°å¼‚å¸¸");
        }
    }

    /**
     * ç§é’¥è§£å¯†
     */
    public static String privateDecrypt(String data, String privateKey) {
        try {
            Cipher cipher = Cipher.getInstance(RSA_CIPHER);
            cipher.init(Cipher.DECRYPT_MODE, getPrivateKey(privateKey));
            return new String(cipher.doFinal(Base64Utils.decodeFromString(data)), StandardCharsets.UTF_8);
        } catch (Exception e) {
            log.error("è§£å¯†å­—ç¬¦ä¸²é‡åˆ°å¼‚å¸¸", e);
            throw new MapleCommonException(ErrorCode.COMMON_ERROR, "è§£å¯†å­—ç¬¦ä¸²é‡åˆ°å¼‚å¸¸");
        }
    }
}

~~~

## å…³äºç¬‘å°æ«ğŸ’•

> æœ¬ç« åˆ°è¿™é‡Œç»“æŸäº†ï¼Œå–œæ¬¢çš„æœ‹å‹å…³æ³¨ä¸€ä¸‹æˆ‘å‘¦ğŸ˜˜ğŸ˜˜ï¼Œå¤§ä¼™çš„æ”¯æŒï¼Œå°±æ˜¯æˆ‘åšæŒå†™ä¸‹å»çš„åŠ¨åŠ›ã€‚
> è€è§„çŸ©ï¼Œæ‡‚äº†å°±ç‚¹èµæ”¶è—ï¼›ä¸æ‡‚å°±é—®ï¼Œæ—¥å¸¸åœ¨çº¿ï¼Œæˆ‘ä¼šå°±ä¼šå›å¤å“ˆ~ğŸ¤ª
> å¾®ä¿¡å…¬ä¼—å·ï¼šç¬‘å°æ«
> ç¬‘å°æ«ä¸ªäººåšå®¢ï¼š[https://www.xiaoxiaofeng.com](https://www.xiaoxiaofeng.com)
> CSDNï¼š[https://zhangfz.blog.csdn.net](https://zhangfz.blog.csdn.net)
> æœ¬æ–‡æºç ï¼š[https://github.com/hack-feng/maple-demo](https://github.com/hack-feng/maple-demo) 

